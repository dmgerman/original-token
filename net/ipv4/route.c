multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;ROUTE - implementation of the IP router.&n; *&n; * Version:&t;@(#)route.c&t;1.0.14&t;05/31/93&n; *&n; * Authors:&t;Ross Biro, &lt;bir7@leland.Stanford.Edu&gt;&n; *&t;&t;Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;&n; *&t;&t;Alan Cox, &lt;gw4pts@gw4pts.ampr.org&gt;&n; *&t;&t;Linus Torvalds, &lt;Linus.Torvalds@helsinki.fi&gt;&n; *&t;&t;Alexey Kuznetsov, &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; * Fixes:&n; *&t;&t;Alan Cox&t;:&t;Verify area fixes.&n; *&t;&t;Alan Cox&t;:&t;cli() protects routing changes&n; *&t;&t;Rui Oliveira&t;:&t;ICMP routing table updates&n; *&t;&t;(rco@di.uminho.pt)&t;Routing table insertion and update&n; *&t;&t;Linus Torvalds&t;:&t;Rewrote bits to be sensible&n; *&t;&t;Alan Cox&t;:&t;Added BSD route gw semantics&n; *&t;&t;Alan Cox&t;:&t;Super /proc &gt;4K &n; *&t;&t;Alan Cox&t;:&t;MTU in route table&n; *&t;&t;Alan Cox&t;: &t;MSS actually. Also added the window&n; *&t;&t;&t;&t;&t;clamper.&n; *&t;&t;Sam Lantinga&t;:&t;Fixed route matching in rt_del()&n; *&t;&t;Alan Cox&t;:&t;Routing cache support.&n; *&t;&t;Alan Cox&t;:&t;Removed compatibility cruft.&n; *&t;&t;Alan Cox&t;:&t;RTF_REJECT support.&n; *&t;&t;Alan Cox&t;:&t;TCP irtt support.&n; *&t;&t;Jonathan Naylor&t;:&t;Added Metric support.&n; *&t;Miquel van Smoorenburg&t;:&t;BSD API fixes.&n; *&t;Miquel van Smoorenburg&t;:&t;Metrics.&n; *&t;&t;Alan Cox&t;:&t;Use __u32 properly&n; *&t;&t;Alan Cox&t;:&t;Aligned routing errors more closely with BSD&n; *&t;&t;&t;&t;&t;our system is still very different.&n; *&t;&t;Alan Cox&t;:&t;Faster /proc handling&n; *&t;Alexey Kuznetsov&t;:&t;Massive rework to support tree based routing,&n; *&t;&t;&t;&t;&t;routing caches and better behaviour.&n; *&t;&t;&n; *&t;&t;Olaf Erb&t;:&t;irtt wasn&squot;t being copied right.&n; *&t;&t;Bjorn Ekwall&t;:&t;Kerneld route support.&n; *&t;&t;Alan Cox&t;:&t;Multicast fixed (I hope)&n; * &t;&t;Pavel Krauz&t;:&t;Limited broadcast fixed&n; *&t;Alexey Kuznetsov&t;:&t;End of old history. Splitted to fib.c and&n; *&t;&t;&t;&t;&t;route.c and rewritten from scratch.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;linux/net_alias.h&gt;
r_static
r_void
id|rt_run_flush
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
DECL|variable|rt_flush_timer
r_static
r_struct
id|timer_list
id|rt_flush_timer
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
id|RT_FLUSH_DELAY
comma
l_int|0L
comma
id|rt_run_flush
)brace
suffix:semicolon
multiline_comment|/*&n; *&t;Interface to generic destination cache.&n; */
r_static
r_void
id|ipv4_dst_destroy
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|ipv4_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
suffix:semicolon
r_static
r_struct
id|dst_entry
op_star
id|ipv4_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
suffix:semicolon
DECL|variable|ipv4_dst_ops
r_struct
id|dst_ops
id|ipv4_dst_ops
op_assign
(brace
id|AF_INET
comma
id|ipv4_dst_check
comma
id|ipv4_dst_reroute
comma
id|ipv4_dst_destroy
)brace
suffix:semicolon
multiline_comment|/*&n; * Route cache.&n; */
DECL|variable|rt_cache_size
r_static
id|atomic_t
id|rt_cache_size
suffix:semicolon
DECL|variable|rt_hash_table
r_static
r_struct
id|rtable
op_star
id|rt_hash_table
(braket
id|RT_HASH_DIVISOR
)braket
suffix:semicolon
r_static
r_struct
id|rtable
op_star
id|rt_intern_hash
c_func
(paren
r_int
id|hash
comma
r_struct
id|rtable
op_star
id|rth
comma
id|u16
id|protocol
)paren
suffix:semicolon
DECL|function|rt_hash_code
r_static
id|__inline__
r_int
id|rt_hash_code
c_func
(paren
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
)paren
(brace
r_int
id|hash
op_assign
(paren
(paren
id|daddr
op_amp
l_int|0xF0F0F0F0
)paren
op_rshift
l_int|4
)paren
op_or
(paren
(paren
id|daddr
op_amp
l_int|0x0F0F0F0F
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|hash
op_assign
id|hash
op_xor
id|saddr
op_xor
id|tos
suffix:semicolon
id|hash
op_assign
id|hash
op_xor
(paren
id|hash
op_rshift
l_int|16
)paren
suffix:semicolon
r_return
(paren
id|hash
op_xor
(paren
id|hash
op_rshift
l_int|8
)paren
)paren
op_amp
l_int|0xFF
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|rt_cache_get_info
r_static
r_int
id|rt_cache_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_char
id|temp
(braket
l_int|129
)braket
suffix:semicolon
r_struct
id|rtable
op_star
id|r
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pos
op_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|offset
OL
l_int|128
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
l_string|&quot;Iface&bslash;tDestination&bslash;tGateway &bslash;tFlags&bslash;tRefCnt&bslash;tUse&bslash;tMetric&bslash;tSource&bslash;t&bslash;tMTU&bslash;tWindow&bslash;tIRTT&bslash;tTOS&bslash;tHH&bslash;tARP&quot;
)paren
suffix:semicolon
id|len
op_assign
l_int|128
suffix:semicolon
)brace
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RT_HASH_DIVISOR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|r
op_assign
id|rt_hash_table
(braket
id|i
)braket
suffix:semicolon
id|r
suffix:semicolon
id|r
op_assign
id|r-&gt;u.rt_next
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; *&t;Spin through entries until we are ready&n;&t;&t;&t; */
id|pos
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_le
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|temp
comma
l_string|&quot;%s&bslash;t%08lX&bslash;t%08lX&bslash;t%X&bslash;t%d&bslash;t%u&bslash;t%d&bslash;t%08lX&bslash;t%d&bslash;t%u&bslash;t%u&bslash;t%02x&bslash;t%d&bslash;t%1d&bslash;t%08x&bslash;t%02x&quot;
comma
id|r-&gt;u.dst.dev
ques
c_cond
id|r-&gt;u.dst.dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
(paren
r_int
r_int
)paren
id|r-&gt;rt_dst
comma
(paren
r_int
r_int
)paren
id|r-&gt;rt_gateway
comma
id|r-&gt;rt_flags
comma
id|r-&gt;u.dst.refcnt
comma
id|r-&gt;u.dst.use
comma
l_int|0
comma
(paren
r_int
r_int
)paren
id|r-&gt;rt_src
comma
(paren
r_int
)paren
id|r-&gt;u.dst.pmtu
comma
id|r-&gt;u.dst.window
comma
(paren
r_int
)paren
id|r-&gt;u.dst.rtt
comma
id|r-&gt;key.tos
comma
id|r-&gt;u.dst.hh
ques
c_cond
id|r-&gt;u.dst.hh-&gt;hh_refcnt
suffix:colon
op_minus
l_int|1
comma
id|r-&gt;u.dst.hh
ques
c_cond
id|r-&gt;u.dst.hh-&gt;hh_uptodate
suffix:colon
l_int|0
comma
id|r-&gt;rt_spec_dst
comma
id|i
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
id|len
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|offset
op_plus
id|length
)paren
r_goto
id|done
suffix:semicolon
)brace
)brace
id|done
suffix:colon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
id|len
op_minus
(paren
id|pos
op_minus
id|offset
)paren
suffix:semicolon
id|len
op_assign
id|pos
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
DECL|function|rt_free
r_static
r_void
id|__inline__
id|rt_free
c_func
(paren
r_struct
id|rtable
op_star
id|rt
)paren
(brace
id|dst_free
c_func
(paren
op_amp
id|rt-&gt;u.dst
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_check_expire
r_void
id|ip_rt_check_expire
c_func
(paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_static
r_int
id|rover
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RT_HASH_DIVISOR
op_div
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rover
op_assign
(paren
id|rover
op_plus
l_int|1
)paren
op_amp
(paren
id|RT_HASH_DIVISOR
op_minus
l_int|1
)paren
suffix:semicolon
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|rover
)braket
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rth
op_assign
op_star
id|rthp
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|rtable
op_star
id|rth_next
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Cleanup aged off entries.&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|rth-&gt;u.dst.refcnt
op_logical_and
id|now
op_minus
id|rth-&gt;u.dst.lastuse
OG
id|RT_CACHE_TIMEOUT
)paren
(brace
op_star
id|rthp
op_assign
id|rth_next
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|rt_cache_size
)paren
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
l_string|&quot;rt_check_expire clean %02x@%08x&bslash;n&quot;
comma
id|rover
comma
id|rth-&gt;rt_dst
)paren
suffix:semicolon
macro_line|#endif
id|rt_free
c_func
(paren
id|rth
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rth_next
)paren
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Pseudo-LRU ordering.&n;&t;&t;&t; * Really we should teach it to move&n;&t;&t;&t; * rarely used but permanently living entries&n;&t;&t;&t; * (f.e. rdisc, igmp etc.) to the end of list.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|rth_next-&gt;u.dst.lastuse
op_minus
id|rth-&gt;u.dst.lastuse
OG
id|RT_CACHE_BUBBLE_THRESHOLD
op_logical_or
(paren
id|rth-&gt;u.dst.lastuse
op_minus
id|rth_next-&gt;u.dst.lastuse
OL
l_int|0
op_logical_and
id|rth-&gt;u.dst.use
OL
id|rth_next-&gt;u.dst.use
)paren
)paren
(brace
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
l_string|&quot;rt_check_expire bubbled %02x@%08x&lt;-&gt;%08x&bslash;n&quot;
comma
id|rover
comma
id|rth-&gt;rt_dst
comma
id|rth_next-&gt;rt_dst
)paren
suffix:semicolon
macro_line|#endif
op_star
id|rthp
op_assign
id|rth_next
suffix:semicolon
id|rth-&gt;u.rt_next
op_assign
id|rth_next-&gt;u.rt_next
suffix:semicolon
id|rth_next-&gt;u.rt_next
op_assign
id|rth
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|rthp
op_assign
op_amp
id|rth_next-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
)brace
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|rt_cache_flush
r_void
id|rt_cache_flush
c_func
(paren
r_int
id|how
)paren
(brace
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt_flush_timer.expires
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|rt_flush_timer.expires
OG
l_int|0
op_logical_or
id|rt_flush_timer.expires
op_minus
id|jiffies
OG
id|RT_FLUSH_DELAY
op_div
l_int|2
)paren
id|how
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|how
)paren
(brace
r_if
c_cond
(paren
id|rt_flush_timer.expires
)paren
id|del_timer
c_func
(paren
op_amp
id|rt_flush_timer
)paren
suffix:semicolon
id|rt_flush_timer.expires
op_assign
l_int|0
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|rt_run_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt_flush_timer.expires
)paren
(brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|del_timer
c_func
(paren
op_amp
id|rt_flush_timer
)paren
suffix:semicolon
id|rt_flush_timer.expires
op_assign
id|jiffies
op_plus
id|RT_FLUSH_DELAY
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|rt_flush_timer
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|rt_run_flush
r_void
id|rt_run_flush
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RT_HASH_DIVISOR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|nr
op_assign
l_int|0
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rth
op_assign
id|rt_hash_table
(braket
id|i
)braket
)paren
)paren
(brace
id|sti
c_func
(paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rt_hash_table
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|next
)paren
(brace
id|next
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|rt_cache_size
)paren
suffix:semicolon
id|nr
op_increment
suffix:semicolon
id|rth-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|rt_free
c_func
(paren
id|rth
)paren
suffix:semicolon
)brace
macro_line|#if RT_CACHE_DEBUG &gt;= 2
r_if
c_cond
(paren
id|nr
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;rt_cache_flush: %d@%02x&bslash;n&quot;
comma
id|nr
comma
id|i
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
DECL|function|rt_garbage_collect
r_static
r_void
id|rt_garbage_collect
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_static
r_int
id|expire
op_assign
id|RT_CACHE_TIMEOUT
op_rshift
l_int|1
suffix:semicolon
r_static
r_int
r_int
id|last_gc
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
r_int
r_int
id|now
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|now
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/*&n;&t; * Garbage collection is pretty expensive,&n;&t; * do not make it too frequently.&n;&t; */
r_if
c_cond
(paren
id|now
op_minus
id|last_gc
OL
l_int|1
op_star
id|HZ
)paren
(brace
id|expire
op_rshift_assign
l_int|1
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|expire
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RT_HASH_DIVISOR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|rt_hash_table
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|i
)braket
suffix:semicolon
(paren
id|rth
op_assign
op_star
id|rthp
)paren
suffix:semicolon
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;u.dst.refcnt
op_logical_or
id|now
op_minus
id|rth-&gt;u.dst.lastuse
OG
id|expire
)paren
r_continue
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|rt_cache_size
)paren
suffix:semicolon
op_star
id|rthp
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|rth-&gt;u.rt_next
op_assign
l_int|NULL
suffix:semicolon
id|rt_free
c_func
(paren
id|rth
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|last_gc
op_assign
id|now
suffix:semicolon
r_if
c_cond
(paren
id|rt_cache_size
OL
id|RT_CACHE_MAX_SIZE
)paren
id|expire
op_assign
id|RT_CACHE_TIMEOUT
op_rshift
l_int|1
suffix:semicolon
r_else
id|expire
op_rshift_assign
l_int|1
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|rt_ll_bind
r_static
r_int
id|rt_ll_bind
c_func
(paren
r_struct
id|rtable
op_star
id|rt
)paren
(brace
r_struct
id|dst_entry
op_star
id|neigh
suffix:semicolon
r_struct
id|hh_cache
op_star
id|hh
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
op_logical_and
id|rt-&gt;u.dst.dev-&gt;hard_header_cache
)paren
(brace
id|neigh
op_assign
id|rt-&gt;u.dst.neighbour
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|neigh
)paren
id|neigh
op_assign
id|arp_find_neighbour
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|rt-&gt;u.dst.neighbour
op_assign
id|neigh
suffix:semicolon
r_for
c_loop
(paren
id|hh
op_assign
id|neigh-&gt;hh
suffix:semicolon
id|hh
suffix:semicolon
id|hh
op_assign
id|hh-&gt;hh_next
)paren
r_if
c_cond
(paren
id|hh-&gt;hh_type
op_eq
id|ETH_P_IP
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|hh
op_logical_and
(paren
id|hh
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|hh
)paren
comma
id|GFP_ATOMIC
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
macro_line|#if RT_CACHE_DEBUG &gt;= 2
r_extern
id|atomic_t
id|hh_count
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|hh_count
)paren
suffix:semicolon
macro_line|#endif
id|memset
c_func
(paren
id|hh
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hh_cache
)paren
)paren
suffix:semicolon
id|hh-&gt;hh_type
op_assign
id|ETH_P_IP
suffix:semicolon
id|hh-&gt;hh_refcnt
op_assign
l_int|0
suffix:semicolon
id|hh-&gt;hh_next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;u.dst.dev
op_member_access_from_pointer
id|hard_header_cache
c_func
(paren
op_amp
id|rt-&gt;u.dst
comma
id|neigh
comma
id|hh
)paren
)paren
(brace
id|kfree
c_func
(paren
id|hh
)paren
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|atomic_dec
c_func
(paren
op_amp
id|hh_count
)paren
suffix:semicolon
macro_line|#endif
id|hh
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|neigh
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|hh-&gt;hh_refcnt
)paren
suffix:semicolon
id|hh-&gt;hh_next
op_assign
id|neigh-&gt;hh
suffix:semicolon
id|neigh-&gt;hh
op_assign
id|hh
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|hh
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|hh-&gt;hh_refcnt
)paren
suffix:semicolon
id|rt-&gt;u.dst.hh
op_assign
id|hh
suffix:semicolon
r_return
id|hh-&gt;hh_uptodate
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rt_intern_hash
r_static
r_struct
id|rtable
op_star
id|rt_intern_hash
c_func
(paren
r_int
id|hash
comma
r_struct
id|rtable
op_star
id|rt
comma
id|u16
id|protocol
)paren
(brace
r_struct
id|rtable
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;u.dst.priority
op_assign
id|rt_tos2priority
c_func
(paren
id|rt-&gt;key.tos
)paren
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|hash
)braket
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rth
op_assign
op_star
id|rthp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|rth-&gt;key
comma
op_amp
id|rt-&gt;key
comma
r_sizeof
(paren
id|rt-&gt;key
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Put it first */
op_star
id|rthp
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|rth-&gt;u.rt_next
op_assign
id|rt_hash_table
(braket
id|hash
)braket
suffix:semicolon
id|rt_hash_table
(braket
id|hash
)braket
op_assign
id|rth
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rth-&gt;u.dst.refcnt
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rth-&gt;u.dst.use
)paren
suffix:semicolon
id|rth-&gt;u.dst.lastuse
op_assign
id|now
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt_free
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
id|rth
suffix:semicolon
)brace
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rt_cache_size
op_ge
id|RT_CACHE_MAX_SIZE
)paren
id|rt_garbage_collect
c_func
(paren
)paren
suffix:semicolon
id|rt-&gt;u.rt_next
op_assign
id|rt_hash_table
(braket
id|hash
)braket
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
r_if
c_cond
(paren
id|rt-&gt;u.rt_next
)paren
(brace
r_struct
id|rtable
op_star
id|trt
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;rt_cache @%02x: %08x&quot;
comma
id|hash
comma
id|rt-&gt;rt_dst
)paren
suffix:semicolon
r_for
c_loop
(paren
id|trt
op_assign
id|rt-&gt;u.rt_next
suffix:semicolon
id|trt
suffix:semicolon
id|trt
op_assign
id|trt-&gt;u.rt_next
)paren
id|printk
c_func
(paren
l_string|&quot; . %08x&quot;
comma
id|trt-&gt;rt_dst
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|rt_hash_table
(braket
id|hash
)braket
op_assign
id|rt
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rt_cache_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|protocol
op_eq
id|ETH_P_IP
)paren
id|rt_ll_bind
c_func
(paren
id|rt
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
id|rt
suffix:semicolon
)brace
DECL|function|ip_rt_redirect
r_void
id|ip_rt_redirect
c_func
(paren
id|u32
id|old_gw
comma
id|u32
id|daddr
comma
id|u32
id|new_gw
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|off_link
op_assign
l_int|0
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
comma
op_star
op_star
id|rthp
suffix:semicolon
id|u32
id|skeys
(braket
l_int|2
)braket
op_assign
(brace
id|saddr
comma
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|device
op_star
id|pdev
op_assign
id|net_alias_main_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tos
op_and_assign
id|IPTOS_TOS_MASK
suffix:semicolon
r_if
c_cond
(paren
id|new_gw
op_eq
id|old_gw
op_logical_or
op_logical_neg
id|ipv4_config.accept_redirects
op_logical_or
id|MULTICAST
c_func
(paren
id|new_gw
)paren
op_logical_or
id|BADCLASS
c_func
(paren
id|new_gw
)paren
op_logical_or
id|ZERONET
c_func
(paren
id|new_gw
)paren
)paren
r_goto
id|reject_redirect
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_gw
op_xor
id|dev-&gt;pa_addr
)paren
op_amp
id|dev-&gt;pa_mask
)paren
id|off_link
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv4_config.rfc1620_redirects
)paren
(brace
r_if
c_cond
(paren
id|off_link
)paren
r_goto
id|reject_redirect
suffix:semicolon
r_if
c_cond
(paren
id|ipv4_config.secure_redirects
op_logical_and
id|ip_fib_chk_default_gw
c_func
(paren
id|new_gw
comma
id|dev
)paren
)paren
r_goto
id|reject_redirect
suffix:semicolon
)brace
id|fi
op_assign
id|fib_lookup_info
c_func
(paren
id|new_gw
comma
l_int|0
comma
l_int|0
comma
op_amp
id|loopback_dev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_eq
l_int|NULL
op_logical_or
id|fi-&gt;fib_flags
op_amp
(paren
id|RTF_LOCAL
op_or
id|RTF_BROADCAST
op_or
id|RTF_NAT
)paren
)paren
r_goto
id|reject_redirect
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|skeys
(braket
id|i
)braket
comma
id|tos
)paren
suffix:semicolon
id|rthp
op_assign
op_amp
id|rt_hash_table
(braket
id|hash
)braket
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rth
op_assign
op_star
id|rthp
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_ne
id|daddr
op_logical_or
id|rth-&gt;key.src
op_ne
id|skeys
(braket
id|i
)braket
op_logical_or
id|rth-&gt;key.tos
op_ne
id|tos
op_logical_or
id|rth-&gt;key.dst_dev
op_ne
l_int|NULL
op_logical_or
id|rth-&gt;key.src_dev
op_ne
l_int|NULL
)paren
(brace
id|rthp
op_assign
op_amp
id|rth-&gt;u.rt_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rth-&gt;rt_dst
op_ne
id|daddr
op_logical_or
id|rth-&gt;rt_src
op_ne
id|saddr
op_logical_or
id|rth-&gt;rt_flags
op_amp
id|RTF_REJECT
op_logical_or
id|rth-&gt;rt_gateway
op_ne
id|old_gw
op_logical_or
id|rth-&gt;u.dst.dev
op_ne
id|dev
)paren
r_break
suffix:semicolon
id|rt
op_assign
id|dst_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rtable
)paren
comma
op_amp
id|ipv4_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Copy all the information.&n;&t;&t;&t; */
id|rt-&gt;u.dst.refcnt
op_assign
l_int|1
suffix:semicolon
id|rt-&gt;u.dst.dev
op_assign
id|dev
suffix:semicolon
id|rt-&gt;u.dst.input
op_assign
id|rth-&gt;u.dst.input
suffix:semicolon
id|rt-&gt;u.dst.output
op_assign
id|rth-&gt;u.dst.output
suffix:semicolon
id|rt-&gt;u.dst.pmtu
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|rt-&gt;u.dst.rtt
op_assign
id|TCP_TIMEOUT_INIT
suffix:semicolon
id|rt-&gt;u.dst.window
op_assign
l_int|0
suffix:semicolon
id|rt-&gt;u.dst.use
op_assign
l_int|1
suffix:semicolon
id|rt-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|rt-&gt;rt_flags
op_assign
id|rth-&gt;rt_flags
op_or
id|RTF_DYNAMIC
op_or
id|RTF_MODIFIED
suffix:semicolon
id|rt-&gt;rt_flags
op_and_assign
op_complement
id|RTF_GATEWAY
suffix:semicolon
r_if
c_cond
(paren
id|new_gw
op_ne
id|daddr
)paren
id|rt-&gt;rt_flags
op_or_assign
id|RTF_GATEWAY
suffix:semicolon
id|rt-&gt;rt_src
op_assign
id|rth-&gt;rt_src
suffix:semicolon
id|rt-&gt;rt_dst
op_assign
id|rth-&gt;rt_dst
suffix:semicolon
id|rt-&gt;rt_src_dev
op_assign
id|rth-&gt;rt_src_dev
suffix:semicolon
id|rt-&gt;rt_spec_dst
op_assign
id|rth-&gt;rt_spec_dst
suffix:semicolon
id|rt-&gt;key
op_assign
id|rth-&gt;key
suffix:semicolon
multiline_comment|/* But gateway is different ... */
id|rt-&gt;rt_gateway
op_assign
id|new_gw
suffix:semicolon
r_if
c_cond
(paren
id|off_link
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_dev
op_ne
id|dev
op_logical_and
id|net_alias_main_dev
c_func
(paren
id|fi-&gt;fib_dev
)paren
op_eq
id|pdev
)paren
id|rt-&gt;u.dst.dev
op_assign
id|fi-&gt;fib_dev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipv4_config.rfc1620_redirects
op_logical_and
op_logical_neg
id|rt_ll_bind
c_func
(paren
id|rt
)paren
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt_free
c_func
(paren
id|rt
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
op_star
id|rthp
op_assign
id|rth-&gt;u.rt_next
suffix:semicolon
id|rt_free
c_func
(paren
id|rth
)paren
suffix:semicolon
id|rt
op_assign
id|rt_intern_hash
c_func
(paren
id|hash
comma
id|rt
comma
id|ETH_P_IP
)paren
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
id|reject_redirect
suffix:colon
r_if
c_cond
(paren
id|ipv4_config.log_martians
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Redirect from %lX/%s to %lX ignored.&quot;
l_string|&quot;Path = %lX -&gt; %lX, tos %02x&bslash;n&quot;
comma
id|ntohl
c_func
(paren
id|old_gw
)paren
comma
id|dev-&gt;name
comma
id|ntohl
c_func
(paren
id|new_gw
)paren
comma
id|ntohl
c_func
(paren
id|saddr
)paren
comma
id|ntohl
c_func
(paren
id|daddr
)paren
comma
id|tos
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_advice
r_void
id|ip_rt_advice
c_func
(paren
r_struct
id|rtable
op_star
op_star
id|rp
comma
r_int
id|advice
)paren
(brace
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_if
c_cond
(paren
id|advice
)paren
r_return
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt
op_assign
op_star
id|rp
)paren
op_ne
l_int|NULL
op_logical_and
(paren
id|rt-&gt;rt_flags
op_amp
(paren
id|RTF_DYNAMIC
op_or
id|RTF_MODIFIED
)paren
)paren
)paren
(brace
macro_line|#if RT_CACHE_DEBUG &gt;= 1
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ip_rt_advice: redirect to %08x/%02x dropped&bslash;n&quot;
comma
id|rt-&gt;rt_dst
comma
id|rt-&gt;key.tos
)paren
suffix:semicolon
macro_line|#endif
op_star
id|rp
op_assign
l_int|NULL
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Algorithm:&n; *&t;1. The first RT_REDIRECT_NUMBER redirects are sent&n; *&t;   with exponential backoff, then we stop sending them at all,&n; *&t;   assuming that the host ignores our redirects.&n; *&t;2. If we did not see a packets requiring redirects&n; *&t;   during RT_REDIRECT_SILENCE, we assume that the host&n; *&t;   forgot redirected route and start to send redirects again.&n; *&n; * This algorithm is much cheaper and more intelligent than dumb load limiting&n; * in icmp.c.&n; *&n; * NOTE. Do not forget to inhibit load limiting for redirects (redundant)&n; * and &quot;frag. need&quot; (breaks PMTU discovery) in icmp.c.&n; */
DECL|function|ip_rt_send_redirect
r_void
id|ip_rt_send_redirect
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
multiline_comment|/* No redirected packets during RT_REDIRECT_SILENCE;&n;&t; * reset the algorithm.&n;&t; */
r_if
c_cond
(paren
id|jiffies
op_minus
id|rt-&gt;last_error
OG
id|RT_REDIRECT_SILENCE
)paren
id|rt-&gt;errors
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Too many ignored redirects; do not send anything&n;&t; * set last_error to the last seen redirected packet.&n;&t; */
r_if
c_cond
(paren
id|rt-&gt;errors
op_ge
id|RT_REDIRECT_NUMBER
)paren
(brace
id|rt-&gt;last_error
op_assign
id|jiffies
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Check for load limit; set last_error to the latest sent&n;&t; * redirect.&n;&t; */
r_if
c_cond
(paren
id|jiffies
op_minus
id|rt-&gt;last_error
OG
(paren
id|RT_REDIRECT_LOAD
op_lshift
id|rt-&gt;errors
)paren
)paren
(brace
id|icmp_send
c_func
(paren
id|skb
comma
id|ICMP_REDIRECT
comma
id|ICMP_REDIR_HOST
comma
id|rt-&gt;rt_gateway
)paren
suffix:semicolon
id|rt-&gt;last_error
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|ipv4_config.log_martians
op_logical_and
op_increment
id|rt-&gt;errors
op_eq
id|RT_REDIRECT_NUMBER
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;host %08x/%s ignores redirects.&bslash;n&quot;
comma
id|rt-&gt;rt_src
comma
id|rt-&gt;rt_src_dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
DECL|function|ip_error
r_static
r_int
id|ip_error
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
r_int
id|code
suffix:semicolon
r_switch
c_cond
(paren
id|rt-&gt;u.dst.error
)paren
(brace
r_case
id|EINVAL
suffix:colon
r_default
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ENETUNREACH
suffix:colon
id|code
op_assign
id|ICMP_NET_UNREACH
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EACCES
suffix:colon
id|code
op_assign
id|ICMP_PKT_FILTERED
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|rt-&gt;last_error
OG
id|RT_ERROR_LOAD
)paren
(brace
id|icmp_send
c_func
(paren
id|skb
comma
id|ICMP_DEST_UNREACH
comma
id|code
comma
l_int|0
)paren
suffix:semicolon
id|rt-&gt;last_error
op_assign
id|jiffies
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|guess_mtu
r_static
id|__inline__
r_int
r_int
id|guess_mtu
c_func
(paren
r_int
r_int
id|old_mtu
)paren
(brace
r_if
c_cond
(paren
id|old_mtu
OG
l_int|32000
)paren
r_return
l_int|32000
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|17914
)paren
r_return
l_int|17914
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|8166
)paren
r_return
l_int|8166
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|4352
)paren
r_return
l_int|4352
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|2002
)paren
r_return
l_int|2002
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|1492
)paren
r_return
l_int|1492
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|576
)paren
r_return
l_int|576
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|296
)paren
r_return
l_int|296
suffix:semicolon
multiline_comment|/*&n;&t; *&t;These two are not from the RFC but&n;&t; *&t;are needed for AMPRnet AX.25 paths.&n;&t; */
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|216
)paren
r_return
l_int|216
suffix:semicolon
r_else
r_if
c_cond
(paren
id|old_mtu
OG
l_int|128
)paren
r_return
l_int|128
suffix:semicolon
r_return
l_int|68
suffix:semicolon
)brace
DECL|function|ip_rt_frag_needed
r_int
r_int
id|ip_rt_frag_needed
c_func
(paren
r_struct
id|iphdr
op_star
id|iph
comma
r_int
r_int
id|new_mtu
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|old_mtu
op_assign
id|ntohs
c_func
(paren
id|iph-&gt;tot_len
)paren
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
id|u32
id|skeys
(braket
l_int|2
)braket
op_assign
(brace
id|iph-&gt;saddr
comma
l_int|0
comma
)brace
suffix:semicolon
id|u32
id|daddr
op_assign
id|iph-&gt;daddr
suffix:semicolon
id|u8
id|tos
op_assign
id|iph-&gt;tos
op_amp
id|IPTOS_TOS_MASK
suffix:semicolon
r_int
r_int
id|est_mtu
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ipv4_config.no_pmtu_disc
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|skeys
(braket
id|i
)braket
comma
id|tos
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rth
op_assign
id|rt_hash_table
(braket
id|hash
)braket
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|rth-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_eq
id|daddr
op_logical_and
id|rth-&gt;key.src
op_eq
id|skeys
(braket
id|i
)braket
op_logical_and
id|rth-&gt;rt_dst
op_eq
id|daddr
op_logical_and
id|rth-&gt;rt_src
op_eq
id|iph-&gt;saddr
op_logical_and
id|rth-&gt;key.tos
op_eq
id|tos
op_logical_and
op_logical_neg
id|rth-&gt;key.src_dev
op_logical_and
op_logical_neg
(paren
id|rth-&gt;rt_flags
op_amp
id|RTF_NOPMTUDISC
)paren
)paren
(brace
r_int
r_int
id|mtu
op_assign
id|new_mtu
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
OL
l_int|68
op_logical_or
id|new_mtu
op_ge
id|old_mtu
)paren
(brace
multiline_comment|/* BSD 4.2 compatibility hack :-( */
r_if
c_cond
(paren
id|mtu
op_eq
l_int|0
op_logical_and
id|old_mtu
op_ge
id|rth-&gt;u.dst.pmtu
op_logical_and
id|old_mtu
op_ge
l_int|68
op_plus
(paren
id|iph-&gt;ihl
op_lshift
l_int|2
)paren
)paren
id|old_mtu
op_sub_assign
id|iph-&gt;ihl
op_lshift
l_int|2
suffix:semicolon
id|mtu
op_assign
id|guess_mtu
c_func
(paren
id|old_mtu
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mtu
OL
id|rth-&gt;u.dst.pmtu
)paren
(brace
id|rth-&gt;u.dst.pmtu
op_assign
id|mtu
suffix:semicolon
id|est_mtu
op_assign
id|mtu
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
id|est_mtu
suffix:semicolon
)brace
DECL|function|ipv4_dst_destroy
r_static
r_void
id|ipv4_dst_destroy
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|dst
suffix:semicolon
r_struct
id|hh_cache
op_star
id|hh
op_assign
id|rt-&gt;u.dst.hh
suffix:semicolon
id|rt-&gt;u.dst.hh
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|hh
op_logical_and
id|atomic_dec_and_test
c_func
(paren
op_amp
id|hh-&gt;hh_refcnt
)paren
)paren
(brace
macro_line|#if RT_CACHE_DEBUG &gt;= 2
r_extern
id|atomic_t
id|hh_count
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|hh_count
)paren
suffix:semicolon
macro_line|#endif
id|kfree
c_func
(paren
id|hh
)paren
suffix:semicolon
)brace
)brace
DECL|function|ipv4_dst_check
r_static
r_struct
id|dst_entry
op_star
id|ipv4_dst_check
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ipv4_dst_reroute
r_static
r_struct
id|dst_entry
op_star
id|ipv4_dst_reroute
c_func
(paren
r_struct
id|dst_entry
op_star
id|dst
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_int
DECL|function|ip_check_mc
id|ip_check_mc
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|mc_addr
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|ip_mc
suffix:semicolon
r_if
c_cond
(paren
id|mc_addr
op_eq
id|htonl
c_func
(paren
id|INADDR_ALLHOSTS_GROUP
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|ip_mc
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|ip_mc
suffix:semicolon
id|ip_mc
op_assign
id|ip_mc-&gt;next
)paren
r_if
c_cond
(paren
id|ip_mc-&gt;multiaddr
op_eq
id|mc_addr
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ip_rt_bug
r_static
r_int
id|ip_rt_bug
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_WRITE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ip_rt_bug: %08x -&gt; %08x, %s&bslash;n&quot;
comma
id|skb-&gt;nh.iph-&gt;saddr
comma
id|skb-&gt;nh.iph-&gt;daddr
comma
id|skb-&gt;dev
ques
c_cond
id|skb-&gt;dev-&gt;name
suffix:colon
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This function is called ONLY FROM NET BH. No locking!&n; *&n; *&t;NOTE. We drop all the packets that has local source&n; *&t;addresses, because every properly looped back packet&n; *&t;must have correct destination already attached by output routine.&n; *&n; *&t;Such approach solves two big problems:&n; *&t;1. Not simplex devices (if they exist 8)) are handled properly.&n; *&t;2. IP spoofing attempts are filtered with 100% of guarantee.&n; */
DECL|function|ip_route_input_slow
r_int
id|ip_route_input_slow
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|device
op_star
id|pdev
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|pdev
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fib_info
op_star
id|src_fi
op_assign
l_int|NULL
suffix:semicolon
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
r_struct
id|device
op_star
id|devout
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_struct
id|fib_result
id|res
suffix:semicolon
id|u32
id|src_key
op_assign
id|saddr
suffix:semicolon
id|u32
id|dst_key
op_assign
id|daddr
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
id|log
op_assign
l_int|0
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|saddr
op_xor
(paren
r_int
r_int
)paren
id|pdev
comma
id|tos
)paren
suffix:semicolon
multiline_comment|/*&t;Check for martians... */
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|saddr
)paren
op_logical_or
id|BADCLASS
c_func
(paren
id|saddr
)paren
op_logical_or
id|LOOPBACK
c_func
(paren
id|saddr
)paren
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|daddr
)paren
op_logical_or
id|daddr
op_eq
l_int|0xFFFFFFFF
)paren
r_goto
id|mc_input
suffix:semicolon
multiline_comment|/* Accept zero addresses only to limited broadcast/multicasts;&n;&t; * I even do not know to fix it or not.&n;&t; */
r_if
c_cond
(paren
id|ZERONET
c_func
(paren
id|saddr
)paren
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
id|BADCLASS
c_func
(paren
id|daddr
)paren
op_logical_or
id|ZERONET
c_func
(paren
id|daddr
)paren
op_logical_or
id|LOOPBACK
c_func
(paren
id|daddr
)paren
)paren
r_goto
id|martian_destination
suffix:semicolon
multiline_comment|/*&n;&t; * Device is not yet initialized, accept all addresses as ours.&n;&t; */
r_if
c_cond
(paren
id|ZERONET
c_func
(paren
id|dev-&gt;pa_addr
)paren
)paren
r_goto
id|promisc_ip
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now we are able to route packet.&n;&t; */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|fib_lookup
c_func
(paren
op_amp
id|res
comma
id|daddr
comma
id|saddr
comma
id|tos
comma
id|pdev
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IS_ROUTER
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|no_route
suffix:semicolon
)brace
id|fi
op_assign
id|res.f-&gt;fib_info
suffix:semicolon
id|flags
op_assign
id|fi-&gt;fib_flags
suffix:semicolon
id|devout
op_assign
id|fi-&gt;fib_dev
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_NAT
)paren
(brace
id|daddr
op_assign
id|htonl
c_func
(paren
(paren
id|ntohl
c_func
(paren
id|daddr
)paren
op_amp
(paren
(paren
l_int|1
op_lshift
id|res.fm
)paren
op_minus
l_int|1
)paren
)paren
)paren
op_or
id|fi-&gt;fib_gateway
suffix:semicolon
id|fi
op_assign
id|fib_lookup_info
c_func
(paren
id|daddr
comma
id|saddr
comma
id|tos
comma
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
op_logical_or
id|fi-&gt;fib_flags
op_amp
(paren
id|RTF_NAT
op_or
id|RTF_LOCAL
op_or
id|RTF_MULTICAST
op_or
id|RTF_BROADCAST
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|devout
op_assign
id|fi-&gt;fib_dev
suffix:semicolon
id|flags
op_assign
id|fi-&gt;fib_flags
op_or
id|RTCF_NAT
op_or
id|RTF_NAT
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|res.fr-&gt;cl_action
)paren
(brace
r_case
id|RTP_NAT
suffix:colon
multiline_comment|/* Packet is from  translated source; remember it */
id|saddr
op_assign
(paren
id|saddr
op_amp
op_complement
id|res.fr-&gt;cl_srcmask
)paren
op_or
id|res.fr-&gt;cl_srcmap
suffix:semicolon
id|flags
op_or_assign
id|RTCF_NAT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTP_MASQUERADE
suffix:colon
multiline_comment|/* Packet is from masqueraded source; remember it */
id|flags
op_or_assign
id|RTCF_MASQ
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
)brace
id|log
op_assign
id|res.fr-&gt;cl_flags
op_amp
id|RTRF_LOG
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IS_ROUTER
op_logical_or
id|flags
op_amp
id|RTF_NOFORWARD
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|fi
op_assign
l_int|NULL
suffix:semicolon
id|devout
op_assign
op_amp
id|loopback_dev
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_BROADCAST
)paren
r_goto
id|mc_input
suffix:semicolon
)brace
macro_line|#ifndef CONFIG_IP_LOCAL_RT_POLICY
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
id|src_fi
op_assign
id|fib_lookup_info
c_func
(paren
id|src_key
comma
l_int|0
comma
id|tos
comma
op_amp
id|loopback_dev
comma
l_int|NULL
)paren
suffix:semicolon
r_else
macro_line|#endif
r_if
c_cond
(paren
id|fib_lookup
c_func
(paren
op_amp
id|res
comma
id|src_key
comma
id|daddr
comma
id|tos
comma
id|net_alias_main_dev
c_func
(paren
id|devout
)paren
comma
l_int|NULL
)paren
op_eq
l_int|0
)paren
(brace
id|src_fi
op_assign
id|res.f-&gt;fib_info
suffix:semicolon
multiline_comment|/* Destination is on masqueraded network:&n;&t;&t; * if it is real incoming frame, ip_forward will drop it.&n;&t;&t; */
r_if
c_cond
(paren
id|res.fr-&gt;cl_flags
op_amp
id|RTRF_VALVE
)paren
id|flags
op_or_assign
id|RTCF_VALVE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|src_fi
)paren
(brace
r_if
c_cond
(paren
id|src_fi-&gt;fib_flags
op_amp
(paren
id|RTF_LOCAL
op_or
id|RTF_BROADCAST
op_or
id|RTF_MULTICAST
op_or
id|RTF_NAT
)paren
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|src_fi-&gt;fib_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
id|flags
op_or_assign
id|RTCF_DIRECTSRC
suffix:semicolon
r_if
c_cond
(paren
id|net_alias_main_dev
c_func
(paren
id|src_fi-&gt;fib_dev
)paren
op_eq
id|pdev
)paren
id|skb-&gt;dev
op_assign
id|dev
op_assign
id|src_fi-&gt;fib_dev
suffix:semicolon
r_else
(brace
multiline_comment|/* Route to packet source goes via&n;&t;&t;&t;   different interface; rfc1812 proposes&n;&t;&t;&t;   to drop them.&n;&t;&t;&t;   It is dangerous on not-stub/transit networks&n;&t;&t;&t;   because of path asymmetry.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|ipv4_config.rfc1812_filter
op_ge
l_int|2
)paren
r_goto
id|martian_source
suffix:semicolon
multiline_comment|/* Weaker form of rfc1812 filtering.&n;&t;&t;&t;   If source is on directly connected network,&n;&t;&t;&t;   it can mean either local network configuration error&n;&t;&t;&t;   (the most probable case) or real IP spoofing attempt.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|ipv4_config.rfc1812_filter
op_ge
l_int|1
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
id|RTCF_DIRECTSRC
)paren
)paren
r_goto
id|martian_source
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ipv4_config.rfc1812_filter
op_ge
l_int|1
)paren
r_goto
id|martian_source
suffix:semicolon
id|make_route
suffix:colon
r_if
c_cond
(paren
id|skb-&gt;protocol
op_ne
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
(brace
multiline_comment|/* ARP request. Do not make route for invalid destination or&n;&t;&t; * if it is redirected.&n;&t;&t; */
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RTF_REJECT
op_or
id|RTF_BROADCAST
op_or
id|RTF_MULTICAST
)paren
op_logical_or
id|skb-&gt;pkt_type
op_eq
id|PACKET_OTHERHOST
op_logical_or
(paren
id|devout
op_eq
id|dev
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
(paren
id|RTF_LOCAL
op_or
id|RTCF_NAT
)paren
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rth
op_assign
id|dst_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rtable
)paren
comma
op_amp
id|ipv4_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rth
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_rt_bug
suffix:semicolon
id|rth-&gt;u.dst.use
op_assign
l_int|1
suffix:semicolon
id|rth-&gt;key.dst
op_assign
id|dst_key
suffix:semicolon
id|rth-&gt;rt_dst
op_assign
id|dst_key
suffix:semicolon
id|rth-&gt;rt_dst_map
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;key.tos
op_assign
id|tos
suffix:semicolon
id|rth-&gt;key.src
op_assign
id|src_key
suffix:semicolon
id|rth-&gt;rt_src
op_assign
id|src_key
suffix:semicolon
id|rth-&gt;rt_src_map
op_assign
id|saddr
suffix:semicolon
id|rth-&gt;rt_src_dev
op_assign
id|dev
suffix:semicolon
id|rth-&gt;key.src_dev
op_assign
id|pdev
suffix:semicolon
id|rth-&gt;u.dst.dev
op_assign
id|devout
suffix:semicolon
id|rth-&gt;key.dst_dev
op_assign
l_int|NULL
suffix:semicolon
id|rth-&gt;rt_gateway
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;rt_spec_dst
op_assign
id|daddr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|RTF_REJECT
)paren
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
id|rth-&gt;u.dst.input
op_assign
id|ip_local_deliver
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
(paren
id|RTF_NOFORWARD
op_or
id|RTF_BROADCAST
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_MULTICAST
)paren
(brace
macro_line|#ifdef CONFIG_IP_MROUTE
r_if
c_cond
(paren
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|daddr
)paren
op_logical_and
id|ipv4_config.multicast_route
)paren
(brace
id|rth-&gt;u.dst.input
op_assign
id|ip_mr_input
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_output
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
)paren
(brace
id|rth-&gt;u.dst.input
op_assign
id|ip_forward
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_output
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|IS_ROUTER
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
(paren
id|RTF_MULTICAST
op_or
id|RTF_BROADCAST
)paren
)paren
)paren
(brace
id|rth-&gt;u.dst.input
op_assign
id|ip_error
suffix:semicolon
id|rth-&gt;u.dst.error
op_assign
op_minus
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|flags
op_amp
(paren
id|RTF_BROADCAST
op_or
id|RTF_MULTICAST
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
)paren
id|rth-&gt;rt_spec_dst
op_assign
id|dev-&gt;pa_addr
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
(brace
id|rth-&gt;u.dst.pmtu
op_assign
id|fi-&gt;fib_mtu
suffix:semicolon
id|rth-&gt;u.dst.window
op_assign
id|fi-&gt;fib_window
suffix:semicolon
id|rth-&gt;u.dst.rtt
op_assign
id|fi-&gt;fib_irtt
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_GATEWAY
)paren
id|rth-&gt;rt_gateway
op_assign
id|fi-&gt;fib_gateway
suffix:semicolon
)brace
r_else
(brace
id|rth-&gt;u.dst.pmtu
op_assign
id|devout-&gt;mtu
suffix:semicolon
id|rth-&gt;u.dst.window
op_assign
l_int|0
suffix:semicolon
id|rth-&gt;u.dst.rtt
op_assign
id|TCP_TIMEOUT_INIT
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
(paren
id|RTF_LOCAL
op_or
id|RTF_BROADCAST
op_or
id|RTF_MULTICAST
op_or
id|RTCF_NAT
)paren
)paren
op_logical_and
id|flags
op_amp
id|RTCF_DIRECTSRC
op_logical_and
(paren
id|devout
op_eq
id|dev
op_logical_or
(paren
id|ipv4_config.rfc1620_redirects
op_logical_and
id|net_alias_main_dev
c_func
(paren
id|devout
)paren
op_eq
id|pdev
)paren
)paren
)paren
id|flags
op_or_assign
id|RTCF_DOREDIRECT
suffix:semicolon
id|rth-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|log
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;installing route %08lX -&gt; %08lX&bslash;n&quot;
comma
id|ntohl
c_func
(paren
id|rth-&gt;rt_src
)paren
comma
id|ntohl
c_func
(paren
id|rth-&gt;rt_dst
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RTF_LOCAL
op_or
id|RTF_MULTICAST
op_or
id|RTF_BROADCAST
op_or
id|RTF_REJECT
)paren
)paren
(brace
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt_intern_hash
c_func
(paren
id|hash
comma
id|rth
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rt_intern_hash
c_func
(paren
id|hash
comma
id|rth
comma
id|__constant_ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|mc_input
suffix:colon
r_if
c_cond
(paren
id|skb-&gt;protocol
op_ne
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ZERONET
c_func
(paren
id|saddr
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipv4_config.bootp_agent
)paren
r_goto
id|martian_source
suffix:semicolon
id|flags
op_or_assign
id|RTF_NOFORWARD
op_or
id|RTF_LOCAL
suffix:semicolon
)brace
r_else
(brace
id|src_fi
op_assign
id|fib_lookup_info
c_func
(paren
id|saddr
comma
l_int|0
comma
id|tos
comma
op_amp
id|loopback_dev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|src_fi
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
id|src_fi-&gt;fib_flags
op_amp
(paren
id|RTF_LOCAL
op_or
id|RTF_BROADCAST
op_or
id|RTF_MULTICAST
op_or
id|RTF_NAT
)paren
)paren
r_goto
id|martian_source
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|src_fi-&gt;fib_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
id|flags
op_or_assign
id|RTCF_DIRECTSRC
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|daddr
)paren
op_logical_or
op_logical_neg
id|ipv4_config.multicast_route
op_logical_or
id|LOCAL_MCAST
c_func
(paren
id|daddr
)paren
)paren
(brace
r_if
c_cond
(paren
id|net_alias_main_dev
c_func
(paren
id|src_fi-&gt;fib_dev
)paren
op_eq
id|pdev
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
op_assign
id|src_fi-&gt;fib_dev
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Fascist not-unicast filtering 8) */
r_goto
id|martian_source
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|daddr
)paren
)paren
(brace
id|flags
op_or_assign
id|RTF_LOCAL
op_or
id|RTF_BROADCAST
op_or
id|RTF_NOFORWARD
suffix:semicolon
id|devout
op_assign
id|dev
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
)brace
id|flags
op_or_assign
id|RTF_MULTICAST
op_or
id|RTF_LOCAL
suffix:semicolon
r_if
c_cond
(paren
id|ip_check_mc
c_func
(paren
id|dev
comma
id|daddr
)paren
op_eq
l_int|0
)paren
(brace
id|flags
op_and_assign
op_complement
id|RTF_LOCAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipv4_config.multicast_route
op_logical_or
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
r_goto
id|no_route
suffix:semicolon
)brace
id|devout
op_assign
id|dev
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
id|promisc_ip
suffix:colon
id|flags
op_or_assign
id|RTF_LOCAL
op_or
id|RTF_NOFORWARD
suffix:semicolon
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|daddr
)paren
)paren
id|flags
op_or_assign
id|RTF_MULTICAST
suffix:semicolon
r_else
id|flags
op_or_assign
id|RTF_BROADCAST
suffix:semicolon
id|devout
op_assign
id|dev
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
id|no_route
suffix:colon
id|flags
op_or_assign
id|RTF_REJECT
suffix:semicolon
id|devout
op_assign
id|dev
suffix:semicolon
r_goto
id|make_route
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Do not cache martian addresses: they should be logged (RFC1812)&n;&t; */
id|martian_destination
suffix:colon
r_if
c_cond
(paren
id|ipv4_config.log_martians
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;martian destination %08x from %08x, dev %s&bslash;n&quot;
comma
id|daddr
comma
id|saddr
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
id|martian_source
suffix:colon
r_if
c_cond
(paren
id|ipv4_config.log_martians
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;RFC1812 recommenadtion, if source is martian,&n;&t;&t; *&t;the only hint is MAC header.&n;&t;&t; */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;martian source %08x for %08x, dev %s&bslash;n&quot;
comma
id|saddr
comma
id|daddr
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;hard_header_len
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
id|skb-&gt;mac.raw
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ll header:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;hard_header_len
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
id|p
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|ip_route_input
r_int
id|ip_route_input
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;dst
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 1
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ip_route_input: bug: packet is looped back&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|net_alias_main_dev
c_func
(paren
id|dev
)paren
op_ne
id|dev
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ip_route_input: bug: packet is received on alias %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|tos
op_and_assign
id|IPTOS_TOS_MASK
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|saddr
op_xor
(paren
r_int
r_int
)paren
id|dev
comma
id|tos
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|rth
op_assign
id|rt_hash_table
(braket
id|hash
)braket
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|rth-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_eq
id|daddr
op_logical_and
id|rth-&gt;key.src
op_eq
id|saddr
op_logical_and
id|rth-&gt;key.src_dev
op_eq
id|dev
op_logical_and
id|rth-&gt;key.dst_dev
op_eq
l_int|NULL
op_logical_and
id|rth-&gt;key.tos
op_eq
id|tos
)paren
(brace
id|rth-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rth-&gt;u.dst.use
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rth-&gt;u.dst.refcnt
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
(paren
r_struct
id|dst_entry
op_star
)paren
id|rth
suffix:semicolon
id|skb-&gt;dev
op_assign
id|rth-&gt;rt_src_dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|ip_route_input_slow
c_func
(paren
id|skb
comma
id|daddr
comma
id|saddr
comma
id|tos
comma
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Major route resolver routine.&n; */
DECL|function|ip_route_output_slow
r_int
id|ip_route_output_slow
c_func
(paren
r_struct
id|rtable
op_star
op_star
id|rp
comma
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|device
op_star
id|dev_out
)paren
(brace
id|u32
id|src_key
op_assign
id|saddr
suffix:semicolon
id|u32
id|dst_key
op_assign
id|daddr
suffix:semicolon
id|u32
id|dst_map
suffix:semicolon
r_struct
id|device
op_star
id|dst_dev_key
op_assign
id|dev_out
suffix:semicolon
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
macro_line|#ifdef CONFIG_IP_LOCAL_RT_POLICY
r_struct
id|fib_result
id|res
suffix:semicolon
macro_line|#endif
r_int
id|hash
suffix:semicolon
id|tos
op_and_assign
id|IPTOS_TOS_MASK
op_or
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|saddr
)paren
(brace
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|saddr
)paren
op_logical_or
id|BADCLASS
c_func
(paren
id|saddr
)paren
op_logical_or
id|ZERONET
c_func
(paren
id|saddr
)paren
op_logical_or
id|__ip_chk_addr
c_func
(paren
id|saddr
)paren
op_ne
id|IS_MYADDR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
op_eq
l_int|NULL
op_logical_and
(paren
id|MULTICAST
c_func
(paren
id|daddr
)paren
op_logical_or
id|daddr
op_eq
l_int|0xFFFFFFFF
)paren
)paren
id|dev_out
op_assign
id|ip_dev_find
c_func
(paren
id|saddr
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|daddr
)paren
id|daddr
op_assign
id|saddr
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|saddr
)paren
(brace
id|saddr
op_assign
id|dev_out-&gt;pa_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|daddr
)paren
id|daddr
op_assign
id|saddr
suffix:semicolon
)brace
id|dst_map
op_assign
id|daddr
suffix:semicolon
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|daddr
)paren
op_logical_or
id|daddr
op_eq
l_int|0xFFFFFFFF
)paren
r_goto
id|make_route
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|daddr
)paren
id|daddr
op_assign
id|htonl
c_func
(paren
id|INADDR_LOOPBACK
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IP_LOCAL_RT_POLICY
r_if
c_cond
(paren
id|fib_lookup
c_func
(paren
op_amp
id|res
comma
id|daddr
comma
id|saddr
comma
id|tos
comma
op_amp
id|loopback_dev
comma
id|dev_out
)paren
)paren
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
id|fi
op_assign
id|res.f-&gt;fib_info
suffix:semicolon
id|dst_map
op_assign
id|daddr
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_flags
op_amp
id|RTF_NAT
)paren
(brace
id|dst_map
op_assign
id|htonl
c_func
(paren
(paren
id|ntohl
c_func
(paren
id|daddr
)paren
op_amp
(paren
(paren
l_int|1
op_lshift
id|res.fm
)paren
op_minus
l_int|1
)paren
)paren
)paren
op_or
id|fi-&gt;fib_gateway
suffix:semicolon
id|fi
op_assign
id|fib_lookup_info
c_func
(paren
id|dst_map
comma
id|saddr
comma
id|tos
comma
op_amp
id|loopback_dev
comma
id|dev_out
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
op_logical_or
id|fi-&gt;fib_flags
op_amp
(paren
id|RTF_NAT
op_or
id|RTF_LOCAL
op_or
id|RTF_MULTICAST
op_or
id|RTF_BROADCAST
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|flags
op_assign
id|RTCF_NAT
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|saddr
)paren
(brace
id|saddr
op_assign
id|fi-&gt;fib_dev-&gt;pa_addr
suffix:semicolon
multiline_comment|/*&n;&t;&t; * &quot;Stabilization&quot; of route.&n;&t;&t; * This step is necessary, if locally originated packets&n;&t;&t; * are subjected to source routing, else we could get&n;&t;&t; * route flapping.&n;&t;&t; */
id|fi
op_assign
id|fib_lookup_info
c_func
(paren
id|dst_map
comma
id|saddr
comma
id|tos
comma
op_amp
id|loopback_dev
comma
id|dev_out
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
)paren
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
macro_line|#else
id|fi
op_assign
id|fib_lookup_info
c_func
(paren
id|daddr
comma
l_int|0
comma
id|tos
comma
op_amp
id|loopback_dev
comma
id|dev_out
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
)paren
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_flags
op_amp
id|RTF_NAT
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dst_map
op_assign
id|daddr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|saddr
)paren
id|saddr
op_assign
id|fi-&gt;fib_dev-&gt;pa_addr
suffix:semicolon
macro_line|#endif
id|flags
op_or_assign
id|fi-&gt;fib_flags
suffix:semicolon
id|dev_out
op_assign
id|fi-&gt;fib_dev
suffix:semicolon
r_if
c_cond
(paren
id|RT_LOCALADDR
c_func
(paren
id|flags
)paren
)paren
(brace
id|dev_out
op_assign
op_amp
id|loopback_dev
suffix:semicolon
id|fi
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dst_dev_key
op_logical_and
id|dev_out
op_ne
id|dst_dev_key
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|make_route
suffix:colon
r_if
c_cond
(paren
id|LOOPBACK
c_func
(paren
id|saddr
)paren
op_logical_and
op_logical_neg
(paren
id|dev_out-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;this guy talks to %08x from loopback&bslash;n&quot;
comma
id|daddr
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|daddr
op_eq
l_int|0xFFFFFFFF
)paren
id|flags
op_or_assign
id|RTF_BROADCAST
suffix:semicolon
r_else
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|daddr
)paren
)paren
id|flags
op_or_assign
id|RTF_MULTICAST
suffix:semicolon
r_else
r_if
c_cond
(paren
id|BADCLASS
c_func
(paren
id|daddr
)paren
op_logical_or
id|ZERONET
c_func
(paren
id|daddr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_BROADCAST
op_logical_and
(paren
id|dev_out-&gt;flags
op_amp
id|IFF_LOOPBACK
op_logical_or
op_logical_neg
(paren
id|dev_out-&gt;flags
op_amp
id|IFF_BROADCAST
)paren
)paren
)paren
id|flags
op_and_assign
op_complement
id|RTF_LOCAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_MULTICAST
)paren
(brace
r_if
c_cond
(paren
id|ip_check_mc
c_func
(paren
id|dev_out
comma
id|daddr
)paren
)paren
id|flags
op_or_assign
id|RTF_LOCAL
suffix:semicolon
)brace
id|rth
op_assign
id|dst_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rtable
)paren
comma
op_amp
id|ipv4_dst_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rth
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|rth-&gt;u.dst.use
op_assign
l_int|1
suffix:semicolon
id|rth-&gt;key.dst
op_assign
id|dst_key
suffix:semicolon
id|rth-&gt;key.tos
op_assign
id|tos
suffix:semicolon
id|rth-&gt;key.src
op_assign
id|src_key
suffix:semicolon
id|rth-&gt;key.src_dev
op_assign
l_int|NULL
suffix:semicolon
id|rth-&gt;key.dst_dev
op_assign
id|dst_dev_key
suffix:semicolon
id|rth-&gt;rt_dst
op_assign
id|daddr
suffix:semicolon
id|rth-&gt;rt_dst_map
op_assign
id|dst_map
suffix:semicolon
id|rth-&gt;rt_src
op_assign
id|saddr
suffix:semicolon
id|rth-&gt;rt_src_map
op_assign
id|saddr
suffix:semicolon
id|rth-&gt;rt_src_dev
op_assign
id|dev_out
suffix:semicolon
id|rth-&gt;u.dst.dev
op_assign
id|dev_out
suffix:semicolon
id|rth-&gt;rt_gateway
op_assign
id|dst_map
suffix:semicolon
id|rth-&gt;rt_spec_dst
op_assign
id|dev_out-&gt;pa_addr
suffix:semicolon
id|rth-&gt;u.dst.output
op_assign
id|ip_output
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
(brace
id|rth-&gt;u.dst.input
op_assign
id|ip_local_deliver
suffix:semicolon
id|rth-&gt;rt_spec_dst
op_assign
id|daddr
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
(paren
id|RTF_BROADCAST
op_or
id|RTF_MULTICAST
)paren
)paren
(brace
id|rth-&gt;rt_spec_dst
op_assign
id|dev_out-&gt;pa_addr
suffix:semicolon
id|flags
op_and_assign
op_complement
id|RTF_GATEWAY
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
id|rth-&gt;u.dst.output
op_assign
id|ip_mc_output
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_MULTICAST
)paren
(brace
r_if
c_cond
(paren
id|dev_out-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
id|rth-&gt;u.dst.output
op_assign
id|ip_mc_output
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MROUTE
r_if
c_cond
(paren
id|ipv4_config.multicast_route
op_logical_and
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|daddr
)paren
)paren
id|rth-&gt;u.dst.input
op_assign
id|ip_mr_input
suffix:semicolon
macro_line|#endif
)brace
)brace
r_if
c_cond
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_GATEWAY
)paren
id|rth-&gt;rt_gateway
op_assign
id|fi-&gt;fib_gateway
suffix:semicolon
id|rth-&gt;u.dst.pmtu
op_assign
id|fi-&gt;fib_mtu
suffix:semicolon
id|rth-&gt;u.dst.window
op_assign
id|fi-&gt;fib_window
suffix:semicolon
id|rth-&gt;u.dst.rtt
op_assign
id|fi-&gt;fib_irtt
suffix:semicolon
)brace
r_else
(brace
id|rth-&gt;u.dst.pmtu
op_assign
id|dev_out-&gt;mtu
suffix:semicolon
id|rth-&gt;u.dst.window
op_assign
l_int|0
suffix:semicolon
id|rth-&gt;u.dst.rtt
op_assign
id|TCP_TIMEOUT_INIT
suffix:semicolon
)brace
id|rth-&gt;rt_flags
op_assign
id|flags
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|dst_key
comma
id|src_key
comma
id|tos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst_dev_key
)paren
id|hash
op_xor_assign
id|dev_hash_name
c_func
(paren
id|dst_dev_key-&gt;name
)paren
suffix:semicolon
op_star
id|rp
op_assign
id|rt_intern_hash
c_func
(paren
id|hash
comma
id|rth
comma
id|ETH_P_IP
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ip_route_output
r_int
id|ip_route_output
c_func
(paren
r_struct
id|rtable
op_star
op_star
id|rp
comma
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_struct
id|device
op_star
id|dev_out
)paren
(brace
r_int
id|hash
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|saddr
comma
id|tos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_out
)paren
id|hash
op_xor_assign
id|dev_out-&gt;hash
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rth
op_assign
id|rt_hash_table
(braket
id|hash
)braket
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|rth-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_eq
id|daddr
op_logical_and
id|rth-&gt;key.src
op_eq
id|saddr
op_logical_and
id|rth-&gt;key.src_dev
op_eq
l_int|NULL
op_logical_and
id|rth-&gt;key.dst_dev
op_eq
id|dev_out
op_logical_and
id|rth-&gt;key.tos
op_eq
id|tos
)paren
(brace
id|rth-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rth-&gt;u.dst.use
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rth-&gt;u.dst.refcnt
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
op_star
id|rp
op_assign
id|rth
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
id|ip_route_output_slow
c_func
(paren
id|rp
comma
id|daddr
comma
id|saddr
comma
id|tos
comma
id|dev_out
)paren
suffix:semicolon
)brace
DECL|function|ip_route_output_dev
r_int
id|ip_route_output_dev
c_func
(paren
r_struct
id|rtable
op_star
op_star
id|rp
comma
id|u32
id|daddr
comma
id|u32
id|saddr
comma
id|u8
id|tos
comma
r_char
op_star
id|devname
)paren
(brace
r_int
id|hash
suffix:semicolon
r_struct
id|rtable
op_star
id|rth
suffix:semicolon
r_struct
id|device
op_star
id|dev_out
suffix:semicolon
id|hash
op_assign
id|rt_hash_code
c_func
(paren
id|daddr
comma
id|saddr
comma
id|tos
)paren
op_xor
id|dev_hash_mc_name
c_func
(paren
id|devname
)paren
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rth
op_assign
id|rt_hash_table
(braket
id|hash
)braket
suffix:semicolon
id|rth
suffix:semicolon
id|rth
op_assign
id|rth-&gt;u.rt_next
)paren
(brace
r_if
c_cond
(paren
id|rth-&gt;key.dst
op_eq
id|daddr
op_logical_and
id|rth-&gt;key.src
op_eq
id|saddr
op_logical_and
id|rth-&gt;key.src_dev
op_eq
l_int|NULL
op_logical_and
id|rth-&gt;key.tos
op_eq
id|tos
op_logical_and
id|rth-&gt;key.dst_dev
op_logical_and
id|strcmp
c_func
(paren
id|rth-&gt;key.dst_dev-&gt;name
comma
id|devname
)paren
op_eq
l_int|0
)paren
(brace
id|rth-&gt;u.dst.lastuse
op_assign
id|jiffies
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rth-&gt;u.dst.use
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|rth-&gt;u.dst.refcnt
)paren
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
op_star
id|rp
op_assign
id|rth
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|dev_out
op_assign
id|dev_get
c_func
(paren
id|devname
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_out
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
id|ip_route_output_slow
c_func
(paren
id|rp
comma
id|daddr
comma
id|saddr
comma
id|tos
comma
id|dev_out
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_multicast_event
r_void
id|ip_rt_multicast_event
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_init
r_void
id|ip_rt_init
c_func
(paren
)paren
(brace
id|ip_fib_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_register
c_func
(paren
op_amp
(paren
r_struct
id|proc_dir_entry
)paren
(brace
id|PROC_NET_RTCACHE
comma
l_int|8
comma
l_string|&quot;rt_cache&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|rt_cache_get_info
)brace
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
