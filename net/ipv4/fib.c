multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;IPv4 Forwarding Information Base.&n; *&n; * Authors:&t;Alexey Kuznetsov, &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; *&n; *&t;NOTE:&t;This file is scheduled to be removed from kernel.&n; *&t;&t;The natural place for router FIB is user level&n; *&t;&t;routing daemon (it has to keep its copy in any case)&n; *&t;&t;&n; *&t;&t;Kernel should keep only interface routes and,&n; *&t;&t;if host is not router, default gateway.&n; *&n; *&t;&t;We have good proof that it is feasible and efficient -&n; *&t;&t;multicast routing.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/netlink.h&gt;
macro_line|#include &lt;net/ip_fib.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;linux/net_alias.h&gt;
DECL|variable|local_class
r_static
r_struct
id|fib_class
id|local_class
op_assign
(brace
id|RT_CLASS_LOCAL
comma
)brace
suffix:semicolon
DECL|variable|default_class
r_static
r_struct
id|fib_class
id|default_class
op_assign
(brace
id|RT_CLASS_DEFAULT
comma
)brace
suffix:semicolon
DECL|variable|main_class
r_static
r_struct
id|fib_class
id|main_class
op_assign
(brace
id|RT_CLASS_MAIN
comma
)brace
suffix:semicolon
DECL|variable|fib_classes
r_static
r_struct
id|fib_class
op_star
id|fib_classes
(braket
id|RT_CLASS_MAX
op_plus
l_int|1
)braket
suffix:semicolon
DECL|variable|fib_rules
r_static
r_struct
id|fib_rule
op_star
id|fib_rules
suffix:semicolon
DECL|variable|fib_info_list
r_static
r_struct
id|fib_info
op_star
id|fib_info_list
suffix:semicolon
DECL|variable|fib_stamp
r_static
r_int
id|fib_stamp
suffix:semicolon
r_static
r_int
id|rtmsg_process
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|in_rtmsg
op_star
id|r
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
DECL|variable|rt_nl_flags
r_static
r_int
id|rt_nl_flags
suffix:semicolon
DECL|variable|rt_nl_owner
r_static
r_int
id|rt_nl_owner
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n; *&t;Default mode is delayed for 0.5sec batch delivery.&n; *&t;If someone starts to use user-&gt;level calls,&n; *&t;we turn on synchronous message passing.&n; */
DECL|macro|RTMSG_DELAY
mdefine_line|#define RTMSG_DELAY (HZ/2)
DECL|variable|rtmsg_ctl
r_static
r_struct
id|nlmsg_ctl
id|rtmsg_ctl
op_assign
(brace
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|0L
comma
l_int|NULL
)brace
comma
l_int|NULL
comma
id|NETLINK_ROUTE
comma
id|RTMSG_DELAY
comma
id|NLMSG_GOODSIZE
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_static
r_void
id|__rtmsg_ack
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|n
comma
r_int
id|err
)paren
suffix:semicolon
DECL|function|rtmsg_ack
r_static
id|__inline__
r_void
id|rtmsg_ack
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|n
comma
r_int
id|err
)paren
(brace
r_if
c_cond
(paren
id|n-&gt;nlmsg_seq
op_logical_and
id|rt_nl_flags
op_amp
id|RTCTL_ACK
)paren
id|__rtmsg_ack
c_func
(paren
id|n
comma
id|err
)paren
suffix:semicolon
)brace
r_static
r_void
id|rtmsg_fib
c_func
(paren
r_int
r_int
id|type
comma
r_struct
id|fib_node
op_star
id|f
comma
r_int
id|logmask
comma
r_struct
id|fib_class
op_star
r_class
comma
r_struct
id|nlmsghdr
op_star
id|n
)paren
suffix:semicolon
r_static
r_void
id|rtmsg_dev
c_func
(paren
r_int
r_int
id|type
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|nlmsghdr
op_star
id|n
)paren
suffix:semicolon
DECL|macro|rtmsg_kick
mdefine_line|#define rtmsg_kick() ({ if (rtmsg_ctl.nlmsg_skb) nlmsg_transmit(&amp;rtmsg_ctl); })
macro_line|#else
DECL|macro|rtmsg_fib
mdefine_line|#define rtmsg_fib(a,b,c,d,e)
DECL|macro|rtmsg_dev
mdefine_line|#define rtmsg_dev(a,b,c)
DECL|macro|rtmsg_ack
mdefine_line|#define rtmsg_ack(a,b)
DECL|macro|rtmsg_kick
mdefine_line|#define rtmsg_kick()
macro_line|#endif
multiline_comment|/*&n; *&t;FIB locking.&n; */
DECL|variable|fib_wait
r_static
r_struct
id|wait_queue
op_star
id|fib_wait
suffix:semicolon
DECL|variable|fib_users
id|atomic_t
id|fib_users
suffix:semicolon
DECL|function|fib_lock
r_static
r_void
id|fib_lock
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|fib_users
)paren
id|sleep_on
c_func
(paren
op_amp
id|fib_wait
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|fib_users
)paren
suffix:semicolon
id|dev_lock_list
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|fib_unlock
r_static
r_void
id|fib_unlock
c_func
(paren
r_void
)paren
(brace
id|dev_unlock_list
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|fib_users
)paren
)paren
(brace
id|rtmsg_kick
c_func
(paren
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|fib_wait
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Check if a mask is acceptable.&n; */
DECL|function|bad_mask
r_static
id|__inline__
r_int
id|bad_mask
c_func
(paren
id|u32
id|mask
comma
id|u32
id|addr
)paren
(brace
r_if
c_cond
(paren
id|addr
op_amp
(paren
id|mask
op_assign
op_complement
id|mask
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|mask
op_assign
id|ntohl
c_func
(paren
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
(paren
id|mask
op_plus
l_int|1
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; * Evaluate mask length.&n; */
DECL|function|fib_logmask
r_static
id|__inline__
r_int
id|fib_logmask
c_func
(paren
id|u32
id|mask
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|mask
op_assign
id|ntohl
c_func
(paren
id|mask
)paren
)paren
)paren
r_return
l_int|32
suffix:semicolon
r_return
id|ffz
c_func
(paren
op_complement
id|mask
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * Create mask from mask length.&n; */
DECL|function|fib_mask
r_static
id|__inline__
id|u32
id|fib_mask
c_func
(paren
r_int
id|logmask
)paren
(brace
r_if
c_cond
(paren
id|logmask
op_ge
l_int|32
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|htonl
c_func
(paren
op_complement
(paren
(paren
l_int|1
op_lshift
id|logmask
)paren
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|fib_netmask
r_static
id|__inline__
id|u32
id|fib_netmask
c_func
(paren
r_int
id|logmask
)paren
(brace
r_return
id|fib_mask
c_func
(paren
l_int|32
op_minus
id|logmask
)paren
suffix:semicolon
)brace
DECL|function|fib_alloc_class
r_static
r_struct
id|fib_class
op_star
id|fib_alloc_class
c_func
(paren
r_int
id|id
)paren
(brace
r_struct
id|fib_class
op_star
r_class
suffix:semicolon
r_if
c_cond
(paren
id|fib_classes
(braket
id|id
)braket
)paren
r_return
id|fib_classes
(braket
id|id
)braket
suffix:semicolon
r_class
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
r_class
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
r_class
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
r_class
comma
l_int|0
comma
r_sizeof
(paren
op_star
r_class
)paren
)paren
suffix:semicolon
r_class
op_member_access_from_pointer
id|cl_id
op_assign
id|id
suffix:semicolon
id|fib_classes
(braket
id|id
)braket
op_assign
r_class
suffix:semicolon
r_return
r_class
suffix:semicolon
)brace
DECL|function|fib_empty_class
r_static
r_struct
id|fib_class
op_star
id|fib_empty_class
c_func
(paren
r_void
)paren
(brace
r_int
id|id
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
l_int|1
suffix:semicolon
id|id
op_le
id|RT_CLASS_MAX
suffix:semicolon
id|id
op_increment
)paren
r_if
c_cond
(paren
id|fib_classes
(braket
id|id
)braket
op_eq
l_int|NULL
)paren
r_return
id|fib_alloc_class
c_func
(paren
id|id
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|fib_rule_delete
r_static
r_int
id|fib_rule_delete
c_func
(paren
r_struct
id|in_rtrulemsg
op_star
id|r
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|nlmsghdr
op_star
id|n
)paren
(brace
id|u32
id|src
op_assign
id|r-&gt;rtrmsg_src.s_addr
suffix:semicolon
id|u32
id|dst
op_assign
id|r-&gt;rtrmsg_dst.s_addr
suffix:semicolon
id|u32
id|srcmask
op_assign
id|fib_netmask
c_func
(paren
id|r-&gt;rtrmsg_srclen
)paren
suffix:semicolon
id|u32
id|dstmask
op_assign
id|fib_netmask
c_func
(paren
id|r-&gt;rtrmsg_dstlen
)paren
suffix:semicolon
r_struct
id|fib_rule
op_star
id|cl
comma
op_star
op_star
id|clp
suffix:semicolon
r_for
c_loop
(paren
id|clp
op_assign
op_amp
id|fib_rules
suffix:semicolon
(paren
id|cl
op_assign
op_star
id|clp
)paren
op_ne
l_int|NULL
suffix:semicolon
id|clp
op_assign
op_amp
id|cl-&gt;cl_next
)paren
(brace
r_if
c_cond
(paren
id|src
op_eq
id|cl-&gt;cl_src
op_logical_and
id|srcmask
op_eq
id|cl-&gt;cl_srcmask
op_logical_and
id|dst
op_eq
id|cl-&gt;cl_dst
op_logical_and
id|dstmask
op_eq
id|cl-&gt;cl_dstmask
op_logical_and
id|r-&gt;rtrmsg_tos
op_eq
id|cl-&gt;cl_tos
op_logical_and
id|dev
op_eq
id|cl-&gt;cl_dev
op_logical_and
id|r-&gt;rtrmsg_action
op_eq
id|cl-&gt;cl_action
op_logical_and
(paren
op_logical_neg
id|r-&gt;rtrmsg_preference
op_logical_or
id|r-&gt;rtrmsg_preference
op_eq
id|cl-&gt;cl_preference
)paren
op_logical_and
(paren
op_logical_neg
id|r-&gt;rtrmsg_class
op_logical_or
(paren
id|cl
op_logical_and
id|r-&gt;rtrmsg_class
op_eq
id|cl-&gt;cl_class-&gt;cl_id
)paren
)paren
)paren
(brace
id|cli
c_func
(paren
)paren
suffix:semicolon
op_star
id|clp
op_assign
id|cl-&gt;cl_next
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cl-&gt;cl_class
)paren
id|cl-&gt;cl_class-&gt;cl_users
op_decrement
suffix:semicolon
id|kfree
c_func
(paren
id|cl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
DECL|function|fib_rule_add
r_static
r_int
id|fib_rule_add
c_func
(paren
r_struct
id|in_rtrulemsg
op_star
id|r
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|nlmsghdr
op_star
id|n
)paren
(brace
id|u32
id|src
op_assign
id|r-&gt;rtrmsg_src.s_addr
suffix:semicolon
id|u32
id|dst
op_assign
id|r-&gt;rtrmsg_dst.s_addr
suffix:semicolon
id|u32
id|srcmask
op_assign
id|fib_netmask
c_func
(paren
id|r-&gt;rtrmsg_srclen
)paren
suffix:semicolon
id|u32
id|dstmask
op_assign
id|fib_netmask
c_func
(paren
id|r-&gt;rtrmsg_dstlen
)paren
suffix:semicolon
r_struct
id|fib_rule
op_star
id|cl
comma
op_star
id|new_cl
comma
op_star
op_star
id|clp
suffix:semicolon
r_struct
id|fib_class
op_star
r_class
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|src
op_amp
op_complement
id|srcmask
)paren
op_logical_or
(paren
id|dst
op_amp
op_complement
id|dstmask
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|net_alias_main_dev
c_func
(paren
id|dev
)paren
op_ne
id|dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r-&gt;rtrmsg_class
)paren
(brace
r_if
c_cond
(paren
id|r-&gt;rtrmsg_action
op_eq
id|RTP_GO
op_logical_or
id|r-&gt;rtrmsg_action
op_eq
id|RTP_NAT
op_logical_or
id|r-&gt;rtrmsg_action
op_eq
id|RTP_MASQUERADE
)paren
(brace
r_if
c_cond
(paren
(paren
r_class
op_assign
id|fib_empty_class
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_class
op_member_access_from_pointer
id|cl_auto
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|r-&gt;rtrmsg_rtmsgs
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
r_class
op_assign
id|fib_alloc_class
c_func
(paren
id|r-&gt;rtrmsg_class
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|new_cl
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|new_cl
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_cl
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|new_cl-&gt;cl_src
op_assign
id|src
suffix:semicolon
id|new_cl-&gt;cl_srcmask
op_assign
id|srcmask
suffix:semicolon
id|new_cl-&gt;cl_dst
op_assign
id|dst
suffix:semicolon
id|new_cl-&gt;cl_dstmask
op_assign
id|dstmask
suffix:semicolon
id|new_cl-&gt;cl_dev
op_assign
id|dev
suffix:semicolon
id|new_cl-&gt;cl_srcmap
op_assign
id|r-&gt;rtrmsg_srcmap.s_addr
suffix:semicolon
id|new_cl-&gt;cl_tos
op_assign
id|r-&gt;rtrmsg_tos
suffix:semicolon
id|new_cl-&gt;cl_action
op_assign
id|r-&gt;rtrmsg_action
suffix:semicolon
id|new_cl-&gt;cl_flags
op_assign
id|r-&gt;rtrmsg_flags
suffix:semicolon
id|new_cl-&gt;cl_preference
op_assign
id|r-&gt;rtrmsg_preference
suffix:semicolon
id|new_cl-&gt;cl_class
op_assign
r_class
suffix:semicolon
r_if
c_cond
(paren
r_class
)paren
r_class
op_member_access_from_pointer
id|cl_users
op_increment
suffix:semicolon
id|clp
op_assign
op_amp
id|fib_rules
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_cl-&gt;cl_preference
)paren
(brace
id|cl
op_assign
id|fib_rules
suffix:semicolon
r_if
c_cond
(paren
id|cl
op_logical_and
(paren
id|cl
op_assign
id|cl-&gt;cl_next
)paren
op_ne
l_int|NULL
)paren
(brace
id|clp
op_assign
op_amp
id|fib_rules-&gt;cl_next
suffix:semicolon
r_if
c_cond
(paren
id|cl-&gt;cl_preference
)paren
id|new_cl-&gt;cl_preference
op_assign
id|cl-&gt;cl_preference
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|cl
op_assign
op_star
id|clp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|cl-&gt;cl_preference
op_ge
id|new_cl-&gt;cl_preference
)paren
r_break
suffix:semicolon
id|clp
op_assign
op_amp
id|cl-&gt;cl_next
suffix:semicolon
)brace
id|new_cl-&gt;cl_next
op_assign
id|cl
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
op_star
id|clp
op_assign
id|new_cl
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r-&gt;rtrmsg_rtmsgs
)paren
(brace
id|n-&gt;nlmsg_type
op_assign
id|RTMSG_NEWROUTE
suffix:semicolon
id|r-&gt;rtrmsg_rtmsg-&gt;rtmsg_class
op_assign
r_class
op_member_access_from_pointer
id|cl_id
suffix:semicolon
r_return
id|rtmsg_process
c_func
(paren
id|n
comma
id|r-&gt;rtrmsg_rtmsg
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|FZ_MAX_DIVISOR
mdefine_line|#define FZ_MAX_DIVISOR 1024
DECL|function|fib_hash
r_static
id|__inline__
id|u32
id|fib_hash
c_func
(paren
id|u32
id|key
comma
id|u32
id|mask
)paren
(brace
id|u32
id|h
suffix:semicolon
id|h
op_assign
id|key
op_xor
(paren
id|key
op_rshift
l_int|20
)paren
suffix:semicolon
id|h
op_assign
id|h
op_xor
(paren
id|h
op_rshift
l_int|10
)paren
suffix:semicolon
id|h
op_assign
id|h
op_xor
(paren
id|h
op_rshift
l_int|5
)paren
suffix:semicolon
r_return
id|h
op_amp
id|mask
suffix:semicolon
)brace
DECL|function|fz_hash_p
r_static
id|__inline__
r_struct
id|fib_node
op_star
op_star
id|fz_hash_p
c_func
(paren
id|u32
id|key
comma
r_struct
id|fib_zone
op_star
id|fz
)paren
(brace
r_return
op_amp
id|fz-&gt;fz_hash
(braket
id|fib_hash
c_func
(paren
id|key
comma
id|fz-&gt;fz_hashmask
)paren
)braket
suffix:semicolon
)brace
DECL|function|fz_hash
r_static
id|__inline__
r_struct
id|fib_node
op_star
id|fz_hash
c_func
(paren
id|u32
id|key
comma
r_struct
id|fib_zone
op_star
id|fz
)paren
(brace
r_return
id|fz-&gt;fz_hash
(braket
id|fib_hash
c_func
(paren
id|key
comma
id|fz-&gt;fz_hashmask
)paren
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * Free FIB node.&n; */
DECL|function|fib_free_node
r_static
r_void
id|fib_free_node
c_func
(paren
r_struct
id|fib_node
op_star
id|f
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
op_assign
id|f-&gt;fib_info
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_logical_and
op_logical_neg
op_decrement
id|fi-&gt;fib_refcnt
)paren
(brace
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
l_string|&quot;fib_free_node: fi %08x/%s is free&bslash;n&quot;
comma
id|fi-&gt;fib_gateway
comma
id|fi-&gt;fib_dev
ques
c_cond
id|fi-&gt;fib_dev-&gt;name
suffix:colon
l_string|&quot;null&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|fi-&gt;fib_next
)paren
id|fi-&gt;fib_next-&gt;fib_prev
op_assign
id|fi-&gt;fib_prev
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_prev
)paren
id|fi-&gt;fib_prev-&gt;fib_next
op_assign
id|fi-&gt;fib_next
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_eq
id|fib_info_list
)paren
id|fib_info_list
op_assign
id|fi-&gt;fib_next
suffix:semicolon
)brace
id|kfree_s
c_func
(paren
id|f
comma
r_sizeof
(paren
r_struct
id|fib_node
)paren
)paren
suffix:semicolon
)brace
DECL|function|fib_flags_trans
r_static
id|__inline__
r_int
id|fib_flags_trans
c_func
(paren
r_int
id|flags
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_BROADCAST
)paren
r_return
id|IS_BROADCAST
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_MULTICAST
)paren
r_return
id|IS_MULTICAST
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
r_return
id|IS_MYADDR
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ip_fib_chk_addr
r_int
id|ip_fib_chk_addr
c_func
(paren
id|u32
id|addr
)paren
(brace
r_struct
id|fib_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
multiline_comment|/* &n;&t; *&t;Accept both `all ones&squot; and `all zeros&squot; as BROADCAST. &n;&t; *&t;(Support old BSD in other words). This old BSD &n;&t; *&t;support will go very soon as it messes other things&n;&t; *&t;up.&n;&t; */
r_if
c_cond
(paren
id|addr
op_eq
id|INADDR_ANY
op_logical_or
id|addr
op_eq
l_int|0xFFFFFFFF
)paren
r_return
id|RTF_LOCAL
op_or
id|RTF_BROADCAST
suffix:semicolon
r_if
c_cond
(paren
(paren
id|addr
op_amp
id|htonl
c_func
(paren
l_int|0x7F000000L
)paren
)paren
op_eq
id|htonl
c_func
(paren
l_int|0x7F000000L
)paren
)paren
r_return
id|RTF_LOCAL
op_or
id|RTF_INTERFACE
suffix:semicolon
r_if
c_cond
(paren
id|MULTICAST
c_func
(paren
id|addr
)paren
)paren
r_return
id|RTF_MULTICAST
suffix:semicolon
id|addr
op_assign
id|ntohl
c_func
(paren
id|addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|local_class.fib_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
id|u32
id|key
op_assign
(paren
id|addr
op_amp
id|fz-&gt;fz_mask
)paren
op_rshift
id|fz-&gt;fz_logmask
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
id|fz_hash
c_func
(paren
id|key
comma
id|fz
)paren
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fib_next
)paren
(brace
r_if
c_cond
(paren
id|key
op_ne
id|f-&gt;fib_key
op_logical_or
(paren
id|f-&gt;fib_flag
op_amp
id|FIBFLG_DOWN
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|f-&gt;fib_info
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|f-&gt;fib_info-&gt;fib_flags
op_amp
id|RTF_ADDRCLASSMASK
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__ip_chk_addr
r_int
id|__ip_chk_addr
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_return
id|fib_flags_trans
c_func
(paren
id|ip_fib_chk_addr
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Find the first device with a given source address.&n; */
DECL|function|ip_dev_find
r_struct
id|device
op_star
id|ip_dev_find
c_func
(paren
r_int
r_int
id|addr
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|fib_zone
op_star
id|fz
op_assign
id|local_class.fib_zones
(braket
l_int|0
)braket
suffix:semicolon
id|u32
id|key
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
id|key
op_assign
(paren
id|ntohl
c_func
(paren
id|addr
)paren
op_amp
id|fz-&gt;fz_mask
)paren
op_rshift
id|fz-&gt;fz_logmask
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
id|fz_hash
c_func
(paren
id|key
comma
id|fz
)paren
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fib_next
)paren
(brace
r_if
c_cond
(paren
id|key
op_eq
id|f-&gt;fib_key
op_logical_and
op_logical_neg
(paren
id|f-&gt;fib_flag
op_amp
(paren
id|FIBFLG_DOWN
op_or
id|FIBFLG_REJECT
op_or
id|FIBFLG_THROW
)paren
)paren
op_logical_and
id|f-&gt;fib_info-&gt;fib_flags
op_eq
(paren
id|RTF_IFLOCAL
op_amp
op_complement
id|RTF_UP
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|name
op_logical_or
id|strcmp
c_func
(paren
id|name
comma
id|f-&gt;fib_info-&gt;fib_dev-&gt;name
)paren
op_eq
l_int|0
)paren
r_return
id|f-&gt;fib_info-&gt;fib_dev
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Find tunnel with a given source and destination.&n; */
DECL|function|ip_dev_find_tunnel
r_struct
id|device
op_star
id|ip_dev_find_tunnel
c_func
(paren
id|u32
id|daddr
comma
id|u32
id|saddr
)paren
(brace
r_struct
id|fib_zone
op_star
id|fz
op_assign
id|local_class.fib_zones
(braket
l_int|0
)braket
suffix:semicolon
id|u32
id|key
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
id|key
op_assign
(paren
id|ntohl
c_func
(paren
id|daddr
)paren
op_amp
id|fz-&gt;fz_mask
)paren
op_rshift
id|fz-&gt;fz_logmask
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
id|fz_hash
c_func
(paren
id|key
comma
id|fz
)paren
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fib_next
)paren
(brace
r_if
c_cond
(paren
id|key
op_eq
id|f-&gt;fib_key
op_logical_and
op_logical_neg
(paren
id|f-&gt;fib_flag
op_amp
(paren
id|FIBFLG_DOWN
op_or
id|FIBFLG_REJECT
op_or
id|FIBFLG_THROW
)paren
)paren
op_logical_and
id|f-&gt;fib_info-&gt;fib_flags
op_eq
(paren
id|RTF_IFLOCAL
op_amp
op_complement
id|RTF_UP
)paren
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|f-&gt;fib_info-&gt;fib_dev
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_TUNNEL
op_logical_and
id|dev-&gt;pa_dstaddr
op_eq
id|saddr
)paren
r_return
id|dev
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|f-&gt;fib_info
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ip_fib_chk_default_gw
r_int
id|ip_fib_chk_default_gw
c_func
(paren
id|u32
id|addr
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|fib_rule
op_star
id|cl
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_for
c_loop
(paren
id|cl
op_assign
id|fib_rules
suffix:semicolon
id|cl
suffix:semicolon
id|cl
op_assign
id|cl-&gt;cl_next
)paren
(brace
r_if
c_cond
(paren
id|cl-&gt;cl_srcmask
op_logical_or
id|cl-&gt;cl_dstmask
op_logical_or
id|cl-&gt;cl_tos
op_logical_or
id|cl-&gt;cl_dev
op_logical_or
id|cl-&gt;cl_action
op_ne
id|RTP_GO
op_logical_or
op_logical_neg
id|cl-&gt;cl_class
op_logical_or
op_logical_neg
id|cl-&gt;cl_class-&gt;fib_zones
(braket
l_int|32
)braket
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
id|cl-&gt;cl_class-&gt;fib_zones
(braket
l_int|32
)braket
op_member_access_from_pointer
id|fz_hash
(braket
l_int|0
)braket
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fib_next
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
op_assign
id|f-&gt;fib_info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|f-&gt;fib_flag
op_amp
(paren
id|FIBFLG_DOWN
op_or
id|FIBFLG_REJECT
op_or
id|FIBFLG_THROW
)paren
)paren
op_logical_and
id|fi-&gt;fib_gateway
op_eq
id|addr
op_logical_and
id|fi-&gt;fib_dev
op_eq
id|dev
op_logical_and
id|fi-&gt;fib_flags
op_amp
id|RTF_GATEWAY
)paren
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Main lookup routine.&n; */
r_int
DECL|function|fib_lookup
id|fib_lookup
c_func
(paren
r_struct
id|fib_result
op_star
id|res
comma
id|u32
id|daddr
comma
id|u32
id|src
comma
id|u8
id|tos
comma
r_struct
id|device
op_star
id|devin
comma
r_struct
id|device
op_star
id|devout
)paren
(brace
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_struct
id|fib_rule
op_star
id|cl
suffix:semicolon
id|u32
id|dst
suffix:semicolon
r_int
id|local
op_assign
id|tos
op_amp
l_int|1
suffix:semicolon
id|tos
op_and_assign
id|IPTOS_TOS_MASK
suffix:semicolon
id|dst
op_assign
id|ntohl
c_func
(paren
id|daddr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cl
op_assign
id|fib_rules
suffix:semicolon
id|cl
suffix:semicolon
id|cl
op_assign
id|cl-&gt;cl_next
)paren
(brace
r_struct
id|fib_zone
op_star
id|fz
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|src
op_xor
id|cl-&gt;cl_src
)paren
op_amp
id|cl-&gt;cl_srcmask
)paren
op_logical_or
(paren
(paren
id|dst
op_xor
id|cl-&gt;cl_dst
)paren
op_amp
id|cl-&gt;cl_dstmask
)paren
op_logical_or
(paren
id|cl-&gt;cl_tos
op_logical_and
id|cl-&gt;cl_tos
op_ne
id|tos
)paren
op_logical_or
(paren
id|cl-&gt;cl_dev
op_logical_and
id|cl-&gt;cl_dev
op_ne
id|devin
)paren
)paren
r_continue
suffix:semicolon
r_switch
c_cond
(paren
id|cl-&gt;cl_action
)paren
(brace
r_case
id|RTP_GO
suffix:colon
r_case
id|RTP_NAT
suffix:colon
r_case
id|RTP_MASQUERADE
suffix:colon
r_default
suffix:colon
r_break
suffix:semicolon
r_case
id|RTP_UNREACHABLE
suffix:colon
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
r_case
id|RTP_DROP
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|RTP_PROHIBIT
suffix:colon
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
r_for
c_loop
(paren
id|fz
op_assign
id|cl-&gt;cl_class-&gt;fib_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
id|u32
id|key
op_assign
(paren
id|dst
op_amp
id|fz-&gt;fz_mask
)paren
op_rshift
id|fz-&gt;fz_logmask
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
id|fz_hash
c_func
(paren
id|key
comma
id|fz
)paren
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fib_next
)paren
(brace
r_if
c_cond
(paren
id|key
op_ne
id|f-&gt;fib_key
op_logical_or
(paren
id|f-&gt;fib_flag
op_amp
id|FIBFLG_DOWN
)paren
op_logical_or
(paren
id|f-&gt;fib_tos
op_logical_and
id|f-&gt;fib_tos
op_ne
id|tos
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fib_flag
op_amp
id|FIBFLG_THROW
)paren
r_goto
id|next_class
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fib_flag
op_amp
id|FIBFLG_REJECT
)paren
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
r_if
c_cond
(paren
id|devout
op_logical_and
id|f-&gt;fib_info-&gt;fib_dev
op_ne
id|devout
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|local
op_logical_or
op_logical_neg
(paren
id|f-&gt;fib_info-&gt;fib_flags
op_amp
id|RTF_GATEWAY
)paren
)paren
(brace
id|res-&gt;f
op_assign
id|f
suffix:semicolon
id|res-&gt;fr
op_assign
id|cl
suffix:semicolon
id|res-&gt;fm
op_assign
id|fz-&gt;fz_logmask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
id|next_class
suffix:colon
)brace
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
DECL|function|fib_autopublish
r_static
r_int
id|fib_autopublish
c_func
(paren
r_int
id|op
comma
r_struct
id|fib_node
op_star
id|f
comma
r_int
id|logmask
)paren
(brace
r_struct
id|fib_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fib_node
op_star
id|f1
suffix:semicolon
r_struct
id|arpreq
id|r
suffix:semicolon
id|u32
id|addr
op_assign
id|htonl
c_func
(paren
id|f-&gt;fib_key
op_lshift
id|logmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fib_flag
op_logical_or
id|LOOPBACK
c_func
(paren
id|addr
)paren
op_logical_or
(paren
op_logical_neg
id|RT_LOCALADDR
c_func
(paren
id|f-&gt;fib_info-&gt;fib_flags
)paren
op_logical_and
op_logical_neg
(paren
id|f-&gt;fib_info-&gt;fib_flags
op_amp
id|RTF_NAT
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|r
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|arpreq
)paren
)paren
suffix:semicolon
id|r.arp_flags
op_assign
id|ATF_PUBL
op_or
id|ATF_PERM
op_or
id|ATF_MAGIC
suffix:semicolon
r_if
c_cond
(paren
id|logmask
)paren
id|r.arp_flags
op_or_assign
id|ATF_NETMASK
suffix:semicolon
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|r.arp_pa
)paren
op_member_access_from_pointer
id|sin_family
op_assign
id|AF_INET
suffix:semicolon
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|r.arp_pa
)paren
op_member_access_from_pointer
id|sin_addr.s_addr
op_assign
id|addr
suffix:semicolon
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|r.arp_netmask
)paren
op_member_access_from_pointer
id|sin_family
op_assign
id|AF_INET
suffix:semicolon
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|r.arp_netmask
)paren
op_member_access_from_pointer
id|sin_addr.s_addr
op_assign
id|fib_netmask
c_func
(paren
id|logmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
)paren
r_return
id|arp_req_set
c_func
(paren
op_amp
id|r
comma
l_int|NULL
)paren
suffix:semicolon
id|fz
op_assign
op_amp
id|local_class.fib_zone_list
(braket
id|logmask
)braket
suffix:semicolon
r_for
c_loop
(paren
id|f1
op_assign
id|fz_hash
c_func
(paren
id|f-&gt;fib_key
comma
id|fz
)paren
suffix:semicolon
id|f1
suffix:semicolon
id|f1
op_assign
id|f1-&gt;fib_next
)paren
(brace
r_if
c_cond
(paren
id|f-&gt;fib_key
op_ne
id|f1-&gt;fib_key
op_logical_or
id|f1-&gt;fib_flag
op_logical_or
id|f-&gt;fib_info-&gt;fib_flags
op_ne
id|f1-&gt;fib_info-&gt;fib_flags
)paren
r_continue
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|arp_req_delete
c_func
(paren
op_amp
id|r
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|macro|FIB_SCAN
mdefine_line|#define FIB_SCAN(f, fp) &bslash;&n;for ( ; ((f) = *(fp)) != NULL; (fp) = &amp;(f)-&gt;fib_next)
DECL|macro|FIB_SCAN_KEY
mdefine_line|#define FIB_SCAN_KEY(f, fp, key) &bslash;&n;for ( ; ((f) = *(fp)) != NULL &amp;&amp; (f)-&gt;fib_key == (key); (fp) = &amp;(f)-&gt;fib_next)
DECL|macro|FIB_CONTINUE
mdefine_line|#define FIB_CONTINUE(f, fp) &bslash;&n;{ &bslash;&n;&t;fp = &amp;f-&gt;fib_next; &bslash;&n;&t;continue; &bslash;&n;}
DECL|function|fib_delete
r_static
r_int
id|fib_delete
c_func
(paren
r_struct
id|in_rtmsg
op_star
id|r
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|fib_class
op_star
r_class
comma
r_struct
id|nlmsghdr
op_star
id|n
)paren
(brace
r_struct
id|fib_node
op_star
op_star
id|fp
comma
op_star
id|f
suffix:semicolon
r_struct
id|fib_zone
op_star
id|fz
op_assign
r_class
op_member_access_from_pointer
id|fib_zones
(braket
l_int|32
op_minus
id|r-&gt;rtmsg_prefixlen
)braket
suffix:semicolon
r_int
id|logmask
op_assign
l_int|32
op_minus
id|r-&gt;rtmsg_prefixlen
suffix:semicolon
id|u32
id|dst
op_assign
id|ntohl
c_func
(paren
id|r-&gt;rtmsg_prefix.s_addr
)paren
suffix:semicolon
id|u32
id|gw
op_assign
id|r-&gt;rtmsg_gateway.s_addr
suffix:semicolon
r_int
id|metric
op_assign
id|r-&gt;rtmsg_metric
suffix:semicolon
id|u8
id|tos
op_assign
id|r-&gt;rtmsg_tos
suffix:semicolon
id|u8
id|fibflg
op_assign
l_int|0
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|u32
id|key
suffix:semicolon
id|flags
op_assign
id|r-&gt;rtmsg_flags
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_REJECT
)paren
id|fibflg
op_or_assign
id|FIBFLG_REJECT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_THROW
)paren
id|fibflg
op_or_assign
id|FIBFLG_THROW
suffix:semicolon
id|flags
op_and_assign
op_complement
(paren
id|RTF_UP
op_or
id|RTF_REJECT
op_or
id|RTF_THROW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fz
op_ne
l_int|NULL
)paren
(brace
id|key
op_assign
(paren
id|dst
op_amp
id|fz-&gt;fz_mask
)paren
op_rshift
id|logmask
suffix:semicolon
id|fp
op_assign
id|fz_hash_p
c_func
(paren
id|key
comma
id|fz
)paren
suffix:semicolon
id|FIB_SCAN
c_func
(paren
id|f
comma
id|fp
)paren
(brace
r_if
c_cond
(paren
id|f-&gt;fib_key
op_eq
id|key
)paren
r_break
suffix:semicolon
)brace
id|FIB_SCAN_KEY
c_func
(paren
id|f
comma
id|fp
comma
id|key
)paren
(brace
r_if
c_cond
(paren
id|f-&gt;fib_tos
op_eq
id|tos
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|f
op_assign
op_star
id|fp
)paren
op_ne
l_int|NULL
op_logical_and
id|f-&gt;fib_key
op_eq
id|key
op_logical_and
id|f-&gt;fib_tos
op_eq
id|tos
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
op_assign
id|f-&gt;fib_info
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * If metric was not specified (&lt;0), match all metrics.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|metric
op_ge
l_int|0
op_logical_and
id|f-&gt;fib_metric
op_ne
id|metric
)paren
id|FIB_CONTINUE
c_func
(paren
id|f
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_MAGIC
)paren
(brace
multiline_comment|/* &quot;Magic&quot; deletions require exact match */
r_if
c_cond
(paren
op_logical_neg
id|fi
op_logical_or
(paren
id|fi-&gt;fib_flags
op_xor
id|flags
)paren
op_logical_or
id|fi-&gt;fib_dev
op_ne
id|dev
op_logical_or
id|fi-&gt;fib_gateway
op_ne
id|gw
)paren
id|FIB_CONTINUE
c_func
(paren
id|f
comma
id|fp
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Device, gateway, reject and throw are&n;&t;&t;&t;&t; * also checked if specified.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|dev
op_logical_and
id|fi
op_logical_and
id|fi-&gt;fib_dev
op_ne
id|dev
)paren
op_logical_or
(paren
id|gw
op_logical_and
id|fi
op_logical_and
id|fi-&gt;fib_gateway
op_ne
id|gw
)paren
op_logical_or
(paren
id|fibflg
op_logical_and
(paren
id|f-&gt;fib_flag
op_xor
id|fibflg
)paren
op_amp
op_complement
id|FIBFLG_DOWN
)paren
)paren
id|FIB_CONTINUE
c_func
(paren
id|f
comma
id|fp
)paren
suffix:semicolon
)brace
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* It&squot;s interesting, can this operation be not atomic? */
op_star
id|fp
op_assign
id|f-&gt;fib_next
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
r_class
op_eq
op_amp
id|local_class
)paren
id|fib_autopublish
c_func
(paren
l_int|0
comma
id|f
comma
id|logmask
)paren
suffix:semicolon
id|rtmsg_fib
c_func
(paren
id|RTMSG_DELROUTE
comma
id|f
comma
id|logmask
comma
r_class
comma
id|n
)paren
suffix:semicolon
id|fib_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|found
op_increment
suffix:semicolon
)brace
id|fz-&gt;fz_nent
op_sub_assign
id|found
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
)paren
(brace
id|fib_stamp
op_increment
suffix:semicolon
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|rtmsg_ack
c_func
(paren
id|n
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|ESRCH
)paren
suffix:semicolon
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
DECL|function|fib_create_info
r_static
r_struct
id|fib_info
op_star
id|fib_create_info
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|in_rtmsg
op_star
id|r
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
r_int
id|flags
op_assign
id|r-&gt;rtmsg_flags
suffix:semicolon
id|u32
id|gw
op_assign
id|r-&gt;rtmsg_gateway.s_addr
suffix:semicolon
r_int
r_int
id|mtu
suffix:semicolon
r_int
r_int
id|irtt
suffix:semicolon
r_int
r_int
id|window
suffix:semicolon
id|mtu
op_assign
id|dev
ques
c_cond
id|dev-&gt;mtu
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_MSS
op_logical_and
id|r-&gt;rtmsg_mtu
OL
id|mtu
op_logical_and
id|r-&gt;rtmsg_mtu
op_ge
l_int|68
)paren
id|mtu
op_assign
id|r-&gt;rtmsg_mtu
suffix:semicolon
id|window
op_assign
(paren
id|flags
op_amp
id|RTF_WINDOW
)paren
ques
c_cond
id|r-&gt;rtmsg_window
suffix:colon
l_int|0
suffix:semicolon
id|irtt
op_assign
(paren
id|flags
op_amp
id|RTF_IRTT
)paren
ques
c_cond
id|r-&gt;rtmsg_rtt
suffix:colon
id|TCP_TIMEOUT_INIT
suffix:semicolon
id|flags
op_and_assign
id|RTF_FIB
suffix:semicolon
r_for
c_loop
(paren
id|fi
op_assign
id|fib_info_list
suffix:semicolon
id|fi
suffix:semicolon
id|fi
op_assign
id|fi-&gt;fib_next
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_gateway
op_ne
id|gw
op_logical_or
id|fi-&gt;fib_dev
op_ne
id|dev
op_logical_or
id|fi-&gt;fib_flags
op_ne
id|flags
op_logical_or
id|fi-&gt;fib_mtu
op_ne
id|mtu
op_logical_or
id|fi-&gt;fib_window
op_ne
id|window
op_logical_or
id|fi-&gt;fib_irtt
op_ne
id|irtt
)paren
r_continue
suffix:semicolon
id|fi-&gt;fib_refcnt
op_increment
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
l_string|&quot;fib_create_info: fi %08x/%s/%04x is duplicate&bslash;n&quot;
comma
id|fi-&gt;fib_gateway
comma
id|fi-&gt;fib_dev
ques
c_cond
id|fi-&gt;fib_dev-&gt;name
suffix:colon
l_string|&quot;null&quot;
comma
id|fi-&gt;fib_flags
)paren
suffix:semicolon
macro_line|#endif
r_return
id|fi
suffix:semicolon
)brace
id|fi
op_assign
(paren
r_struct
id|fib_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fi
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|fi
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fib_info
)paren
)paren
suffix:semicolon
id|fi-&gt;fib_flags
op_assign
id|flags
suffix:semicolon
id|fi-&gt;fib_dev
op_assign
id|dev
suffix:semicolon
id|fi-&gt;fib_gateway
op_assign
id|gw
suffix:semicolon
id|fi-&gt;fib_mtu
op_assign
id|mtu
suffix:semicolon
id|fi-&gt;fib_window
op_assign
id|window
suffix:semicolon
id|fi-&gt;fib_refcnt
op_increment
suffix:semicolon
id|fi-&gt;fib_next
op_assign
id|fib_info_list
suffix:semicolon
id|fi-&gt;fib_prev
op_assign
l_int|NULL
suffix:semicolon
id|fi-&gt;fib_irtt
op_assign
id|irtt
suffix:semicolon
r_if
c_cond
(paren
id|fib_info_list
)paren
id|fib_info_list-&gt;fib_prev
op_assign
id|fi
suffix:semicolon
id|fib_info_list
op_assign
id|fi
suffix:semicolon
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
l_string|&quot;fib_create_info: fi %08x/%s/%04x is created&bslash;n&quot;
comma
id|fi-&gt;fib_gateway
comma
id|fi-&gt;fib_dev
ques
c_cond
id|fi-&gt;fib_dev-&gt;name
suffix:colon
l_string|&quot;null&quot;
comma
id|fi-&gt;fib_flags
)paren
suffix:semicolon
macro_line|#endif
r_return
id|fi
suffix:semicolon
)brace
DECL|function|fib_rebuild_zone
r_static
id|__inline__
r_void
id|fib_rebuild_zone
c_func
(paren
r_struct
id|fib_zone
op_star
id|fz
comma
r_struct
id|fib_node
op_star
op_star
id|old_ht
comma
r_int
id|old_divisor
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|fib_node
op_star
op_star
id|ht
op_assign
id|fz-&gt;fz_hash
suffix:semicolon
id|u32
id|hashmask
op_assign
id|fz-&gt;fz_hashmask
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
comma
op_star
op_star
id|fp
comma
op_star
id|next
suffix:semicolon
r_int
id|hash
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|old_divisor
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|f
op_assign
id|old_ht
(braket
id|i
)braket
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|next
)paren
(brace
id|next
op_assign
id|f-&gt;fib_next
suffix:semicolon
id|f-&gt;fib_next
op_assign
l_int|NULL
suffix:semicolon
id|hash
op_assign
id|fib_hash
c_func
(paren
id|f-&gt;fib_key
comma
id|hashmask
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fp
op_assign
op_amp
id|ht
(braket
id|hash
)braket
suffix:semicolon
op_star
id|fp
suffix:semicolon
id|fp
op_assign
op_amp
(paren
op_star
id|fp
)paren
op_member_access_from_pointer
id|fib_next
)paren
multiline_comment|/* NONE */
suffix:semicolon
op_star
id|fp
op_assign
id|f
suffix:semicolon
)brace
)brace
)brace
DECL|function|fib_rehash_zone
r_static
r_void
id|fib_rehash_zone
c_func
(paren
r_struct
id|fib_zone
op_star
id|fz
)paren
(brace
r_struct
id|fib_node
op_star
op_star
id|ht
comma
op_star
op_star
id|old_ht
suffix:semicolon
r_int
id|old_divisor
comma
id|new_divisor
suffix:semicolon
id|u32
id|new_hashmask
suffix:semicolon
id|old_divisor
op_assign
id|fz-&gt;fz_divisor
suffix:semicolon
r_switch
c_cond
(paren
id|old_divisor
)paren
(brace
r_case
l_int|16
suffix:colon
id|new_divisor
op_assign
l_int|256
suffix:semicolon
id|new_hashmask
op_assign
l_int|0xFF
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|256
suffix:colon
id|new_divisor
op_assign
l_int|1024
suffix:semicolon
id|new_hashmask
op_assign
l_int|0x3FF
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;route.c: bad divisor %d!&bslash;n&quot;
comma
id|old_divisor
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
l_string|&quot;fib_rehash_zone: hash for zone %d grows from %d&bslash;n&quot;
comma
id|fz-&gt;fz_logmask
comma
id|old_divisor
)paren
suffix:semicolon
macro_line|#endif
id|ht
op_assign
id|kmalloc
c_func
(paren
id|new_divisor
op_star
r_sizeof
(paren
r_struct
id|rtable
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ht
)paren
(brace
id|memset
c_func
(paren
id|ht
comma
l_int|0
comma
id|new_divisor
op_star
r_sizeof
(paren
r_struct
id|fib_node
op_star
)paren
)paren
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|old_ht
op_assign
id|fz-&gt;fz_hash
suffix:semicolon
id|fz-&gt;fz_hash
op_assign
id|ht
suffix:semicolon
id|fz-&gt;fz_hashmask
op_assign
id|new_hashmask
suffix:semicolon
id|fz-&gt;fz_divisor
op_assign
id|new_divisor
suffix:semicolon
id|fib_rebuild_zone
c_func
(paren
id|fz
comma
id|old_ht
comma
id|old_divisor
)paren
suffix:semicolon
id|fib_stamp
op_increment
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|old_ht
)paren
suffix:semicolon
)brace
)brace
r_static
r_struct
id|fib_zone
op_star
DECL|function|fib_new_zone
id|fib_new_zone
c_func
(paren
r_struct
id|fib_class
op_star
r_class
comma
r_int
id|logmask
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|fib_zone
op_star
id|fz
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib_zone
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|fz
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fib_zone
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|logmask
OL
l_int|32
)paren
(brace
id|fz-&gt;fz_divisor
op_assign
l_int|16
suffix:semicolon
id|fz-&gt;fz_hashmask
op_assign
l_int|0xF
suffix:semicolon
)brace
r_else
(brace
id|fz-&gt;fz_divisor
op_assign
l_int|1
suffix:semicolon
id|fz-&gt;fz_hashmask
op_assign
l_int|0
suffix:semicolon
)brace
id|fz-&gt;fz_hash
op_assign
id|kmalloc
c_func
(paren
id|fz-&gt;fz_divisor
op_star
r_sizeof
(paren
r_struct
id|fib_node
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz-&gt;fz_hash
)paren
(brace
id|kfree
c_func
(paren
id|fz
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|fz-&gt;fz_hash
comma
l_int|0
comma
id|fz-&gt;fz_divisor
op_star
r_sizeof
(paren
r_struct
id|fib_node
op_star
)paren
)paren
suffix:semicolon
id|fz-&gt;fz_logmask
op_assign
id|logmask
suffix:semicolon
id|fz-&gt;fz_mask
op_assign
id|ntohl
c_func
(paren
id|fib_mask
c_func
(paren
id|logmask
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|logmask
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
r_class
op_member_access_from_pointer
id|fib_zones
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|fz-&gt;fz_next
op_assign
r_class
op_member_access_from_pointer
id|fib_zone_list
suffix:semicolon
r_class
op_member_access_from_pointer
id|fib_zone_list
op_assign
id|fz
suffix:semicolon
)brace
r_else
(brace
id|fz-&gt;fz_next
op_assign
r_class
op_member_access_from_pointer
id|fib_zones
(braket
id|i
)braket
op_member_access_from_pointer
id|fz_next
suffix:semicolon
r_class
op_member_access_from_pointer
id|fib_zones
(braket
id|i
)braket
op_member_access_from_pointer
id|fz_next
op_assign
id|fz
suffix:semicolon
)brace
r_class
op_member_access_from_pointer
id|fib_zones
(braket
id|logmask
)braket
op_assign
id|fz
suffix:semicolon
id|fib_stamp
op_increment
suffix:semicolon
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
r_return
id|fz
suffix:semicolon
)brace
DECL|function|fib_create
r_static
r_int
id|fib_create
c_func
(paren
r_struct
id|in_rtmsg
op_star
id|r
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|fib_class
op_star
r_class
comma
r_struct
id|nlmsghdr
op_star
id|n
)paren
(brace
r_struct
id|fib_node
op_star
id|f
comma
op_star
id|f1
comma
op_star
op_star
id|fp
suffix:semicolon
r_struct
id|fib_node
op_star
op_star
id|dup_fp
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fib_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
r_int
id|logmask
op_assign
l_int|32
op_minus
id|r-&gt;rtmsg_prefixlen
suffix:semicolon
id|u32
id|dst
op_assign
id|ntohl
c_func
(paren
id|r-&gt;rtmsg_prefix.s_addr
)paren
suffix:semicolon
id|u32
id|gw
op_assign
id|r-&gt;rtmsg_gateway.s_addr
suffix:semicolon
r_int
id|metric
op_assign
id|r-&gt;rtmsg_metric
suffix:semicolon
r_int
id|flags
op_assign
id|r-&gt;rtmsg_flags
suffix:semicolon
id|u8
id|tos
op_assign
id|r-&gt;rtmsg_tos
suffix:semicolon
id|u8
id|fibflg
op_assign
l_int|0
suffix:semicolon
id|u32
id|key
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Allocate an entry and fill it in.&n;&t; */
id|f
op_assign
(paren
r_struct
id|fib_node
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib_node
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f
op_eq
l_int|NULL
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|ENOMEM
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|f
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fib_node
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|RTF_UP
)paren
)paren
id|fibflg
op_assign
id|FIBFLG_DOWN
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_REJECT
)paren
id|fibflg
op_or_assign
id|FIBFLG_REJECT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_THROW
)paren
id|fibflg
op_or_assign
id|FIBFLG_THROW
suffix:semicolon
id|flags
op_and_assign
op_complement
(paren
id|RTF_UP
op_or
id|RTF_REJECT
op_or
id|RTF_THROW
)paren
suffix:semicolon
id|r-&gt;rtmsg_flags
op_assign
id|flags
suffix:semicolon
id|fi
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fibflg
op_amp
(paren
id|FIBFLG_REJECT
op_or
id|FIBFLG_THROW
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|fi
op_assign
id|fib_create_info
c_func
(paren
id|dev
comma
id|r
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree_s
c_func
(paren
id|f
comma
r_sizeof
(paren
r_struct
id|fib_node
)paren
)paren
suffix:semicolon
id|rtmsg_ack
c_func
(paren
id|n
comma
id|ENOMEM
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|f-&gt;fib_info
op_assign
id|fi
suffix:semicolon
id|flags
op_assign
id|fi-&gt;fib_flags
suffix:semicolon
)brace
id|f-&gt;fib_key
op_assign
id|key
op_assign
id|dst
op_rshift
id|logmask
suffix:semicolon
id|f-&gt;fib_metric
op_assign
id|metric
suffix:semicolon
id|f-&gt;fib_tos
op_assign
id|tos
suffix:semicolon
id|f-&gt;fib_flag
op_assign
id|fibflg
suffix:semicolon
id|fz
op_assign
r_class
op_member_access_from_pointer
id|fib_zones
(braket
id|logmask
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz
op_logical_and
op_logical_neg
(paren
id|fz
op_assign
id|fib_new_zone
c_func
(paren
r_class
comma
id|logmask
)paren
)paren
)paren
(brace
id|fib_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|rtmsg_ack
c_func
(paren
id|n
comma
id|ENOMEM
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fz-&gt;fz_nent
OG
(paren
id|fz-&gt;fz_divisor
op_lshift
l_int|2
)paren
op_logical_and
id|fz-&gt;fz_divisor
OL
id|FZ_MAX_DIVISOR
op_logical_and
(paren
op_logical_neg
id|logmask
op_logical_or
(paren
l_int|1
op_lshift
(paren
l_int|32
op_minus
id|logmask
)paren
)paren
OG
id|fz-&gt;fz_divisor
)paren
)paren
id|fib_rehash_zone
c_func
(paren
id|fz
)paren
suffix:semicolon
id|fp
op_assign
id|fz_hash_p
c_func
(paren
id|key
comma
id|fz
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Scan list to find the first route with the same destination&n;&t; */
id|FIB_SCAN
c_func
(paren
id|f1
comma
id|fp
)paren
(brace
r_if
c_cond
(paren
id|f1-&gt;fib_key
op_eq
id|key
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Find route with the same destination and tos.&n;&t; */
id|FIB_SCAN_KEY
c_func
(paren
id|f1
comma
id|fp
comma
id|dst
)paren
(brace
r_if
c_cond
(paren
id|f1-&gt;fib_tos
op_le
id|tos
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Find route with the same destination/tos and less (or equal) metric.&n;&t; * &quot;Magic&quot; additions go to the end of list.&n;&t; */
r_for
c_loop
(paren
suffix:semicolon
(paren
id|f1
op_assign
op_star
id|fp
)paren
op_ne
l_int|NULL
op_logical_and
id|f1-&gt;fib_key
op_eq
id|key
op_logical_and
id|f1-&gt;fib_tos
op_eq
id|tos
suffix:semicolon
id|fp
op_assign
op_amp
id|f1-&gt;fib_next
)paren
(brace
r_if
c_cond
(paren
id|f1-&gt;fib_metric
op_ge
id|metric
op_logical_and
id|metric
op_ne
id|MAGIC_METRIC
)paren
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Record route with the same destination/tos/gateway/dev,&n;&t;&t; *&t;but less metric.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|dup_fp
)paren
(brace
r_struct
id|fib_info
op_star
id|fi1
op_assign
id|f1-&gt;fib_info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fibflg
op_xor
id|f1-&gt;fib_flag
)paren
op_amp
op_complement
id|FIBFLG_DOWN
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_eq
id|fi1
op_logical_or
(paren
id|fi
op_logical_and
id|fi1
op_logical_and
id|fi-&gt;fib_dev
op_eq
id|fi1-&gt;fib_dev
op_logical_and
id|fi-&gt;fib_gateway
op_eq
id|fi1-&gt;fib_gateway
op_logical_and
op_logical_neg
(paren
id|flags
op_amp
id|RTF_MAGIC
)paren
)paren
)paren
id|dup_fp
op_assign
id|fp
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Is it already present?&n;&t; */
r_if
c_cond
(paren
id|f1
op_logical_and
id|f1-&gt;fib_key
op_eq
id|key
op_logical_and
id|f1-&gt;fib_tos
op_eq
id|tos
op_logical_and
id|f1-&gt;fib_metric
op_eq
id|metric
op_logical_and
id|f1-&gt;fib_info
op_eq
id|fi
)paren
(brace
id|fib_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fibflg
op_eq
id|f1-&gt;fib_flag
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|EEXIST
)paren
suffix:semicolon
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
r_else
(brace
id|fib_stamp
op_increment
suffix:semicolon
id|f1-&gt;fib_flag
op_assign
id|fibflg
suffix:semicolon
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|rtmsg_ack
c_func
(paren
id|n
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Do not add &quot;magic&quot; route, if better one is already present.&n;&t; */
r_if
c_cond
(paren
(paren
id|flags
op_amp
id|RTF_MAGIC
)paren
op_logical_and
id|dup_fp
)paren
(brace
id|fib_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|rtmsg_ack
c_func
(paren
id|n
comma
id|EEXIST
)paren
suffix:semicolon
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Insert new entry to the list.&n;&t; */
id|cli
c_func
(paren
)paren
suffix:semicolon
id|f-&gt;fib_next
op_assign
id|f1
suffix:semicolon
op_star
id|fp
op_assign
id|f
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_increment
suffix:semicolon
r_if
c_cond
(paren
r_class
op_eq
op_amp
id|local_class
op_logical_and
op_logical_neg
id|dup_fp
)paren
id|fib_autopublish
c_func
(paren
l_int|1
comma
id|f
comma
id|logmask
)paren
suffix:semicolon
id|rtmsg_fib
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|f
comma
id|logmask
comma
r_class
comma
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|RTF_MAGIC
)paren
(brace
id|fib_stamp
op_increment
suffix:semicolon
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|rtmsg_ack
c_func
(paren
id|n
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Clean routes with the same destination,tos,gateway and device,&n;&t; *&t;but different metric.&n;&t; */
id|fp
op_assign
id|dup_fp
ques
c_cond
suffix:colon
op_amp
id|f-&gt;fib_next
suffix:semicolon
r_while
c_loop
(paren
(paren
id|f1
op_assign
op_star
id|fp
)paren
op_ne
l_int|NULL
op_logical_and
id|f1-&gt;fib_key
op_eq
id|key
op_logical_and
id|f1-&gt;fib_tos
op_eq
id|tos
)paren
(brace
r_if
c_cond
(paren
id|f1
op_eq
id|f
op_logical_or
(paren
(paren
id|f1-&gt;fib_flag
op_xor
id|fibflg
)paren
op_amp
op_complement
id|FIBFLG_DOWN
)paren
)paren
id|FIB_CONTINUE
c_func
(paren
id|f1
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f1-&gt;fib_info
op_ne
id|fi
op_logical_and
(paren
op_logical_neg
id|fi
op_logical_or
op_logical_neg
id|f1-&gt;fib_info
op_logical_or
id|f1-&gt;fib_info-&gt;fib_gateway
op_ne
id|gw
op_logical_or
id|f1-&gt;fib_info-&gt;fib_dev
op_ne
id|dev
)paren
)paren
id|FIB_CONTINUE
c_func
(paren
id|f1
comma
id|fp
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
op_star
id|fp
op_assign
id|f1-&gt;fib_next
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_decrement
suffix:semicolon
id|rtmsg_fib
c_func
(paren
id|RTMSG_DELROUTE
comma
id|f1
comma
id|logmask
comma
r_class
comma
id|n
)paren
suffix:semicolon
id|fib_free_node
c_func
(paren
id|f1
)paren
suffix:semicolon
)brace
id|fib_stamp
op_increment
suffix:semicolon
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|rtmsg_ack
c_func
(paren
id|n
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fib_flush_list
r_static
r_int
id|fib_flush_list
c_func
(paren
r_struct
id|fib_node
op_star
op_star
id|fp
comma
r_struct
id|device
op_star
id|dev
comma
r_int
id|logmask
comma
r_struct
id|fib_class
op_star
r_class
)paren
(brace
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_while
c_loop
(paren
(paren
id|f
op_assign
op_star
id|fp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|f-&gt;fib_info
op_logical_or
id|f-&gt;fib_info-&gt;fib_dev
op_ne
id|dev
)paren
id|FIB_CONTINUE
c_func
(paren
id|f
comma
id|fp
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
op_star
id|fp
op_assign
id|f-&gt;fib_next
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
r_if
c_cond
(paren
id|rt_nl_flags
op_amp
id|RTCTL_FLUSH
)paren
id|rtmsg_fib
c_func
(paren
id|RTMSG_DELROUTE
comma
id|f
comma
id|logmask
comma
r_class
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|fib_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|found
op_increment
suffix:semicolon
)brace
r_return
id|found
suffix:semicolon
)brace
DECL|function|fib_flush
r_static
r_void
id|fib_flush
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|fib_class
op_star
r_class
suffix:semicolon
r_struct
id|fib_rule
op_star
id|cl
comma
op_star
op_star
id|clp
suffix:semicolon
r_struct
id|fib_zone
op_star
id|fz
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|tmp
comma
id|cl_id
suffix:semicolon
r_for
c_loop
(paren
id|cl_id
op_assign
id|RT_CLASS_MAX
suffix:semicolon
id|cl_id
op_ge
l_int|0
suffix:semicolon
id|cl_id
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
r_class
op_assign
id|fib_classes
(braket
id|cl_id
)braket
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
r_class
op_member_access_from_pointer
id|fib_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
id|tmp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|fz-&gt;fz_divisor
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|tmp
op_add_assign
id|fib_flush_list
c_func
(paren
op_amp
id|fz-&gt;fz_hash
(braket
id|i
)braket
comma
id|dev
comma
id|fz-&gt;fz_logmask
comma
r_class
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_sub_assign
id|tmp
suffix:semicolon
id|found
op_add_assign
id|tmp
suffix:semicolon
)brace
)brace
id|clp
op_assign
op_amp
id|fib_rules
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cl
op_assign
op_star
id|clp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|cl-&gt;cl_dev
op_ne
id|dev
)paren
(brace
id|clp
op_assign
op_amp
id|cl-&gt;cl_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|found
op_increment
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
op_star
id|clp
op_assign
id|cl-&gt;cl_next
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cl
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
)paren
(brace
id|fib_stamp
op_increment
suffix:semicolon
id|rt_cache_flush
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|fib_flag_trans
r_static
r_int
id|__inline__
id|fib_flag_trans
c_func
(paren
id|u8
id|fibflg
)paren
(brace
r_int
id|ret
op_assign
id|RTF_UP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fibflg
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|fibflg
op_amp
id|FIBFLG_DOWN
)paren
id|ret
op_and_assign
op_complement
id|RTF_UP
suffix:semicolon
r_if
c_cond
(paren
id|fibflg
op_amp
id|FIBFLG_REJECT
)paren
id|ret
op_or_assign
id|RTF_REJECT
suffix:semicolon
r_if
c_cond
(paren
id|fibflg
op_amp
id|FIBFLG_THROW
)paren
id|ret
op_or_assign
id|RTF_THROW
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* &n; *&t;Called from the PROCfs module. This outputs /proc/net/route.&n; *&n; *&t;We preserve the old format but pad the buffers out. This means that&n; *&t;we can spin over the other entries as we read them. Remember the&n; *&t;gated BGP4 code could need to read 60,000+ routes on occasion (that&squot;s&n; *&t;about 7Mb of data). To do that ok we will need to also cache the&n; *&t;last route we got to (reads will generally be following on from&n; *&t;one another without gaps).&n; */
DECL|function|fib_get_info
r_static
r_int
id|fib_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_struct
id|fib_class
op_star
r_class
suffix:semicolon
r_struct
id|fib_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_char
id|temp
(braket
l_int|129
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|cl_id
suffix:semicolon
id|pos
op_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|offset
OL
l_int|128
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
l_string|&quot;Iface&bslash;tDestination&bslash;tGateway &bslash;tFlags&bslash;tRefCnt&bslash;tUse&bslash;tMetric&bslash;tMask&bslash;t&bslash;tMTU&bslash;tWindow&bslash;tIRTT&bslash;tTOS&bslash;tClass&quot;
)paren
suffix:semicolon
id|len
op_assign
l_int|128
suffix:semicolon
)brace
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cl_id
op_assign
id|RT_CLASS_MAX
op_minus
l_int|1
suffix:semicolon
id|cl_id
op_ge
l_int|0
suffix:semicolon
id|cl_id
op_decrement
)paren
(brace
r_class
op_assign
id|fib_classes
(braket
id|cl_id
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
r_class
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
r_class
op_member_access_from_pointer
id|fib_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
r_int
id|maxslot
suffix:semicolon
r_struct
id|fib_node
op_star
op_star
id|fp
suffix:semicolon
r_if
c_cond
(paren
id|fz-&gt;fz_nent
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_plus
l_int|128
op_star
id|fz-&gt;fz_nent
op_le
id|offset
)paren
(brace
id|pos
op_add_assign
l_int|128
op_star
id|fz-&gt;fz_nent
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|maxslot
op_assign
id|fz-&gt;fz_divisor
suffix:semicolon
id|fp
op_assign
id|fz-&gt;fz_hash
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|maxslot
suffix:semicolon
id|i
op_increment
comma
id|fp
op_increment
)paren
(brace
r_for
c_loop
(paren
id|f
op_assign
op_star
id|fp
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fib_next
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
r_int
id|flags
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; *&t;Spin through entries until we are ready&n;&t;&t;&t;&t; */
id|pos
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_le
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|fi
op_assign
id|f-&gt;fib_info
suffix:semicolon
id|flags
op_assign
id|fib_flag_trans
c_func
(paren
id|f-&gt;fib_flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
id|flags
op_or_assign
id|fi-&gt;fib_flags
suffix:semicolon
id|sprintf
c_func
(paren
id|temp
comma
l_string|&quot;%s&bslash;t%08lX&bslash;t%08X&bslash;t%04X&bslash;t%d&bslash;t%u&bslash;t%d&bslash;t%08lX&bslash;t%d&bslash;t%lu&bslash;t%u&bslash;t%02x&bslash;t%02x&quot;
comma
id|fi
op_logical_and
id|fi-&gt;fib_dev
ques
c_cond
id|fi-&gt;fib_dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
id|htonl
c_func
(paren
id|f-&gt;fib_key
op_lshift
id|fz-&gt;fz_logmask
)paren
comma
id|fi
ques
c_cond
id|fi-&gt;fib_gateway
suffix:colon
l_int|0
comma
id|flags
comma
l_int|0
comma
l_int|0
comma
id|f-&gt;fib_metric
comma
id|htonl
c_func
(paren
id|fz-&gt;fz_mask
)paren
comma
id|fi
ques
c_cond
(paren
r_int
)paren
id|fi-&gt;fib_mtu
suffix:colon
l_int|0
comma
id|fi
ques
c_cond
id|fi-&gt;fib_window
suffix:colon
l_int|0
comma
id|fi
ques
c_cond
(paren
r_int
)paren
id|fi-&gt;fib_irtt
suffix:colon
l_int|0
comma
id|f-&gt;fib_tos
comma
r_class
op_member_access_from_pointer
id|cl_id
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
id|len
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|offset
op_plus
id|length
)paren
r_goto
id|done
suffix:semicolon
)brace
)brace
)brace
)brace
id|done
suffix:colon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
id|len
op_minus
(paren
id|pos
op_minus
id|offset
)paren
suffix:semicolon
id|len
op_assign
id|pos
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|fib_local_get_info
r_static
r_int
id|fib_local_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_struct
id|fib_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_char
id|temp
(braket
l_int|129
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pos
op_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|offset
OL
l_int|128
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
l_string|&quot;Iface&bslash;tDestination&bslash;tGateway &bslash;tFlags&bslash;tRefCnt&bslash;tUse&bslash;tMetric&bslash;tMask&bslash;t&bslash;tMTU&bslash;tWindow&bslash;tIRTT&bslash;tTOS&bslash;tClass&quot;
)paren
suffix:semicolon
id|len
op_assign
l_int|128
suffix:semicolon
)brace
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|local_class.fib_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
r_int
id|maxslot
suffix:semicolon
r_struct
id|fib_node
op_star
op_star
id|fp
suffix:semicolon
r_if
c_cond
(paren
id|fz-&gt;fz_nent
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_plus
l_int|128
op_star
id|fz-&gt;fz_nent
op_le
id|offset
)paren
(brace
id|pos
op_add_assign
l_int|128
op_star
id|fz-&gt;fz_nent
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|maxslot
op_assign
id|fz-&gt;fz_divisor
suffix:semicolon
id|fp
op_assign
id|fz-&gt;fz_hash
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|maxslot
suffix:semicolon
id|i
op_increment
comma
id|fp
op_increment
)paren
(brace
r_for
c_loop
(paren
id|f
op_assign
op_star
id|fp
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fib_next
)paren
(brace
r_int
id|flags
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; *&t;Spin through entries until we are ready&n;&t;&t;&t;&t; */
id|pos
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_le
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|fi
op_assign
id|f-&gt;fib_info
suffix:semicolon
id|flags
op_assign
id|fib_flag_trans
c_func
(paren
id|f-&gt;fib_flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
id|flags
op_or_assign
id|fi-&gt;fib_flags
suffix:semicolon
id|sprintf
c_func
(paren
id|temp
comma
l_string|&quot;%s&bslash;t%08lX&bslash;t%08X&bslash;t%X&bslash;t%d&bslash;t%u&bslash;t%d&bslash;t%08lX&bslash;t%d&bslash;t%lu&bslash;t%u&bslash;t%02x&bslash;t%02x&quot;
comma
id|fi
op_logical_and
id|fi-&gt;fib_dev
ques
c_cond
id|fi-&gt;fib_dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
id|htonl
c_func
(paren
id|f-&gt;fib_key
op_lshift
id|fz-&gt;fz_logmask
)paren
comma
id|fi
ques
c_cond
id|fi-&gt;fib_gateway
suffix:colon
l_int|0
comma
id|flags
comma
l_int|0
comma
l_int|0
comma
id|f-&gt;fib_metric
comma
id|htonl
c_func
(paren
id|fz-&gt;fz_mask
)paren
comma
id|fi
ques
c_cond
(paren
r_int
)paren
id|fi-&gt;fib_mtu
suffix:colon
l_int|0
comma
id|fi
ques
c_cond
id|fi-&gt;fib_window
suffix:colon
l_int|0
comma
id|fi
ques
c_cond
(paren
r_int
)paren
id|fi-&gt;fib_irtt
suffix:colon
l_int|0
comma
id|f-&gt;fib_tos
comma
id|RT_CLASS_LOCAL
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
id|len
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|offset
op_plus
id|length
)paren
r_goto
id|done
suffix:semicolon
)brace
)brace
)brace
id|done
suffix:colon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
id|len
op_minus
(paren
id|pos
op_minus
id|offset
)paren
suffix:semicolon
id|len
op_assign
id|pos
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|fib_rules_get_info
r_static
r_int
id|fib_rules_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_char
id|temp
(braket
l_int|129
)braket
suffix:semicolon
r_struct
id|fib_rule
op_star
id|cl
suffix:semicolon
id|pos
op_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|offset
OL
l_int|128
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
l_string|&quot;Pref&bslash;tSource&bslash;t&bslash;tSrcMask&bslash;t&bslash;tDst&bslash;t&bslash;tDstMask&bslash;t&bslash;tIface&bslash;tTOS&bslash;tClass&bslash;tFlags&bslash;tSrcMap&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_assign
l_int|128
suffix:semicolon
)brace
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cl
op_assign
id|fib_rules
suffix:semicolon
id|cl
suffix:semicolon
id|cl
op_assign
id|cl-&gt;cl_next
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;Spin through entries until we are ready&n;&t;&t; */
id|pos
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_le
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|temp
comma
l_string|&quot;%d&bslash;t%08X&bslash;t%08X&bslash;t%08X&bslash;t%08X&bslash;t%s&bslash;t%02X&bslash;t%02x&bslash;t%02X&bslash;t%02X&bslash;t%08X&quot;
comma
id|cl-&gt;cl_preference
comma
id|cl-&gt;cl_src
comma
id|cl-&gt;cl_srcmask
comma
id|cl-&gt;cl_dst
comma
id|cl-&gt;cl_dstmask
comma
id|cl-&gt;cl_dev
ques
c_cond
id|cl-&gt;cl_dev-&gt;name
suffix:colon
l_string|&quot;*&quot;
comma
id|cl-&gt;cl_tos
comma
id|cl-&gt;cl_class
ques
c_cond
id|cl-&gt;cl_class-&gt;cl_id
suffix:colon
l_int|0
comma
id|cl-&gt;cl_flags
comma
id|cl-&gt;cl_action
comma
id|cl-&gt;cl_srcmap
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
id|len
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|offset
op_plus
id|length
)paren
r_goto
id|done
suffix:semicolon
)brace
id|done
suffix:colon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
id|len
op_minus
(paren
id|pos
op_minus
id|offset
)paren
suffix:semicolon
id|len
op_assign
id|pos
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|fib_class_get_info
r_static
r_int
id|fib_class_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
r_char
id|temp
(braket
l_int|129
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|fib_class
op_star
id|cl
suffix:semicolon
id|pos
op_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|offset
OL
l_int|128
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
l_string|&quot;Class&bslash;tSize&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_assign
l_int|128
suffix:semicolon
)brace
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|RT_CLASS_MAX
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|sz
op_assign
l_int|0
suffix:semicolon
r_struct
id|fib_zone
op_star
id|fz
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cl
op_assign
id|fib_classes
(braket
id|i
)braket
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|cl-&gt;fib_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
id|sz
op_add_assign
id|fz-&gt;fz_nent
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Spin through entries until we are ready&n;&t;&t; */
id|pos
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_le
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|temp
comma
l_string|&quot;%d&bslash;t%d&bslash;n&quot;
comma
id|cl-&gt;cl_id
comma
id|sz
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-127s&bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
id|len
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
id|offset
op_plus
id|length
)paren
r_goto
id|done
suffix:semicolon
)brace
id|done
suffix:colon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
id|len
op_minus
(paren
id|pos
op_minus
id|offset
)paren
suffix:semicolon
id|len
op_assign
id|pos
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
DECL|function|rtmsg_process
r_static
r_int
id|rtmsg_process
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|in_rtmsg
op_star
id|r
)paren
(brace
r_int
r_int
id|cmd
op_assign
id|n-&gt;nlmsg_type
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fib_class
op_star
r_class
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cmd
op_ne
id|RTMSG_NEWROUTE
op_logical_and
id|cmd
op_ne
id|RTMSG_DELROUTE
)paren
op_logical_or
(paren
id|r-&gt;rtmsg_flags
op_amp
(paren
id|RTF_MAGIC
op_or
id|RTF_XRESOLVE
op_or
id|RTF_REINSTATE
)paren
)paren
op_logical_or
id|r-&gt;rtmsg_prefixlen
OG
l_int|32
op_logical_or
(paren
id|r-&gt;rtmsg_tos
op_amp
op_complement
id|IPTOS_TOS_MASK
)paren
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|EINVAL
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Reject/throw directives have no interface/gateway specification */
r_if
c_cond
(paren
id|r-&gt;rtmsg_flags
op_amp
(paren
id|RTF_REJECT
op_or
id|RTF_THROW
)paren
)paren
(brace
id|r-&gt;rtmsg_device
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtmsg_gateway.s_addr
op_assign
l_int|0
suffix:semicolon
id|r-&gt;rtmsg_flags
op_and_assign
op_complement
id|RTF_GATEWAY
suffix:semicolon
)brace
multiline_comment|/* Silly metric hack, it is preserved for &quot;compatibility&quot;,&n;&t; * though I do not know any program using it.&n;&t; */
id|r-&gt;rtmsg_metric
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|RTMSG_NEWROUTE
op_logical_and
id|r-&gt;rtmsg_metric
OL
l_int|0
)paren
id|r-&gt;rtmsg_metric
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|RTMSG_DELROUTE
)paren
id|r-&gt;rtmsg_flags
op_and_assign
id|RTF_FIB
suffix:semicolon
r_if
c_cond
(paren
id|r-&gt;rtmsg_device
(braket
l_int|0
)braket
)paren
(brace
id|dev
op_assign
id|dev_get
c_func
(paren
id|r-&gt;rtmsg_device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|ENODEV
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|r-&gt;rtmsg_gateway.s_addr
op_logical_and
op_logical_neg
(paren
id|r-&gt;rtmsg_flags
op_amp
id|RTF_NAT
)paren
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
id|fi
op_assign
id|fib_lookup_info
c_func
(paren
id|r-&gt;rtmsg_gateway.s_addr
comma
l_int|0
comma
l_int|1
comma
op_amp
id|loopback_dev
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_flags
op_amp
(paren
id|RTF_BROADCAST
op_or
id|RTF_MULTICAST
)paren
op_logical_and
id|cmd
op_ne
id|RTMSG_DELROUTE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev
op_assign
id|fi-&gt;fib_dev
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_flags
op_amp
id|RTF_LOCAL
)paren
(brace
id|r-&gt;rtmsg_flags
op_and_assign
op_complement
id|RTF_GATEWAY
suffix:semicolon
id|r-&gt;rtmsg_gateway.s_addr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_ne
id|RTMSG_DELROUTE
)paren
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
multiline_comment|/* If gateway is not found in routing table,&n;&t;&t; * we could assume that user knows that he does.&n;&t;&t; * It is link layer problem to decide reachable&n;&t;&t; * this gateway or not. Good example is tunnel interface.&n;&t;&t; * Another example is ethernet, ARP could (in theory)&n;&t;&t; * resolve addresses, even if we had no routes.&n;&t;&t; */
)brace
r_if
c_cond
(paren
id|dev
op_logical_and
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
)paren
(brace
r_if
c_cond
(paren
id|r-&gt;rtmsg_flags
op_amp
id|RTF_GATEWAY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Loopback routes: we declare them local addresses.&n;&t;&t; * It is the only reasonable solution to avoid&n;&t;&t; * loopback routing loops.&n;&t;&t; */
id|r-&gt;rtmsg_flags
op_or_assign
id|RTF_LOCAL
op_or
id|RTF_INTERFACE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r-&gt;rtmsg_flags
op_amp
id|RTF_GATEWAY
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_and
id|cmd
op_ne
id|RTMSG_DELROUTE
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|ENETUNREACH
)paren
suffix:semicolon
r_return
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_and
op_logical_neg
(paren
id|r-&gt;rtmsg_flags
op_amp
(paren
id|RTF_NAT
op_or
id|RTF_REJECT
op_or
id|RTF_THROW
)paren
)paren
op_logical_and
id|cmd
op_ne
id|RTMSG_DELROUTE
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|ENODEV
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dev
op_logical_and
id|dev-&gt;family
op_ne
id|AF_INET
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|ENODEV
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r-&gt;rtmsg_class
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|r-&gt;rtmsg_flags
op_amp
(paren
id|RTF_LOCAL
op_or
id|RTF_NAT
)paren
)paren
id|r-&gt;rtmsg_class
op_assign
id|RT_CLASS_LOCAL
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|r-&gt;rtmsg_flags
op_amp
id|RTF_GATEWAY
)paren
op_logical_and
(paren
id|ipv4_config.fib_model
op_eq
l_int|2
op_logical_or
(paren
id|ipv4_config.fib_model
op_eq
l_int|1
op_logical_and
op_logical_neg
id|r-&gt;rtmsg_prefixlen
)paren
)paren
)paren
id|r-&gt;rtmsg_class
op_assign
id|RT_CLASS_DEFAULT
suffix:semicolon
r_else
id|r-&gt;rtmsg_class
op_assign
id|RT_CLASS_MAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
r_class
op_assign
id|fib_classes
(braket
id|r-&gt;rtmsg_class
)braket
)paren
op_eq
l_int|NULL
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|EINVAL
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
(paren
id|cmd
op_eq
id|RTMSG_NEWROUTE
ques
c_cond
id|fib_create
suffix:colon
id|fib_delete
)paren
(paren
id|r
comma
id|dev
comma
r_class
comma
id|n
)paren
suffix:semicolon
)brace
DECL|function|rtrulemsg_process
r_static
r_int
id|rtrulemsg_process
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|in_rtrulemsg
op_star
id|r
)paren
(brace
r_int
r_int
id|cmd
op_assign
id|n-&gt;nlmsg_type
suffix:semicolon
r_struct
id|device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cmd
op_ne
id|RTMSG_NEWRULE
op_logical_and
id|cmd
op_ne
id|RTMSG_DELRULE
)paren
op_logical_or
id|r-&gt;rtrmsg_srclen
OG
l_int|32
op_logical_or
id|r-&gt;rtrmsg_dstlen
OG
l_int|32
op_logical_or
(paren
id|r-&gt;rtrmsg_tos
op_amp
op_complement
id|IPTOS_TOS_MASK
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|r-&gt;rtrmsg_device
(braket
l_int|0
)braket
)paren
(brace
id|dev
op_assign
id|dev_get
c_func
(paren
id|r-&gt;rtrmsg_device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|RTMSG_DELRULE
)paren
r_return
id|fib_rule_delete
c_func
(paren
id|r
comma
id|dev
comma
id|n
)paren
suffix:semicolon
r_return
id|fib_rule_add
c_func
(paren
id|r
comma
id|dev
comma
id|n
)paren
suffix:semicolon
)brace
DECL|function|ifmsg_process
r_static
r_int
id|ifmsg_process
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|in_ifmsg
op_star
id|r
)paren
(brace
r_int
r_int
id|cmd
op_assign
id|n-&gt;nlmsg_type
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ne
id|RTMSG_NEWDEVICE
op_logical_and
id|cmd
op_ne
id|RTMSG_DELDEVICE
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|EINVAL
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rtmsg_ack
c_func
(paren
id|n
comma
id|EINVAL
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|rtcmsg_process
r_static
r_int
id|rtcmsg_process
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|in_rtctlmsg
op_star
id|r
)paren
(brace
macro_line|#ifdef CONFIG_RTNETLINK
r_if
c_cond
(paren
id|r-&gt;rtcmsg_flags
op_amp
id|RTCTL_DELAY
)paren
id|rtmsg_ctl.nlmsg_delay
op_assign
id|r-&gt;rtcmsg_delay
suffix:semicolon
r_if
c_cond
(paren
id|r-&gt;rtcmsg_flags
op_amp
id|RTCTL_OWNER
)paren
id|rt_nl_owner
op_assign
id|n-&gt;nlmsg_pid
suffix:semicolon
id|rt_nl_flags
op_assign
id|r-&gt;rtcmsg_flags
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif
)brace
DECL|function|get_rt_from_user
r_static
r_int
id|get_rt_from_user
c_func
(paren
r_struct
id|in_rtmsg
op_star
id|rtm
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|rtentry
id|r
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|r
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|rtentry
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|r.rt_dev
)paren
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|rtm-&gt;rtmsg_device
comma
id|r.rt_dev
comma
l_int|15
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|rtm-&gt;rtmsg_flags
op_assign
id|r.rt_flags
suffix:semicolon
r_if
c_cond
(paren
id|r.rt_dst.sa_family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|EAFNOSUPPORT
suffix:semicolon
id|rtm-&gt;rtmsg_prefix
op_assign
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|r.rt_dst
)paren
op_member_access_from_pointer
id|sin_addr
suffix:semicolon
r_if
c_cond
(paren
id|rtm-&gt;rtmsg_flags
op_amp
id|RTF_HOST
)paren
(brace
id|rtm-&gt;rtmsg_flags
op_and_assign
op_complement
id|RTF_HOST
suffix:semicolon
id|rtm-&gt;rtmsg_prefixlen
op_assign
l_int|32
suffix:semicolon
)brace
r_else
(brace
id|u32
id|mask
op_assign
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|r.rt_genmask
)paren
op_member_access_from_pointer
id|sin_addr.s_addr
suffix:semicolon
r_if
c_cond
(paren
id|r.rt_genmask.sa_family
op_ne
id|AF_INET
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s forgot to specify route netmask.&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r.rt_genmask.sa_family
)paren
r_return
op_minus
id|EAFNOSUPPORT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bad_mask
c_func
(paren
id|mask
comma
id|rtm-&gt;rtmsg_prefix.s_addr
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rtm-&gt;rtmsg_prefixlen
op_assign
l_int|32
op_minus
id|fib_logmask
c_func
(paren
id|mask
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rtm-&gt;rtmsg_flags
op_amp
id|RTF_GATEWAY
)paren
op_logical_and
id|r.rt_gateway.sa_family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|EAFNOSUPPORT
suffix:semicolon
id|rtm-&gt;rtmsg_gateway
op_assign
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|r.rt_gateway
)paren
op_member_access_from_pointer
id|sin_addr
suffix:semicolon
id|rtm-&gt;rtmsg_rtt
op_assign
id|r.rt_irtt
suffix:semicolon
id|rtm-&gt;rtmsg_window
op_assign
id|r.rt_window
suffix:semicolon
id|rtm-&gt;rtmsg_mtu
op_assign
id|r.rt_mtu
suffix:semicolon
id|rtm-&gt;rtmsg_class
op_assign
id|r.rt_class
suffix:semicolon
id|rtm-&gt;rtmsg_metric
op_assign
id|r.rt_metric
suffix:semicolon
id|rtm-&gt;rtmsg_tos
op_assign
id|r.rt_tos
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle IP routing ioctl calls. These are used to manipulate the routing tables&n; */
DECL|function|ip_rt_ioctl
r_int
id|ip_rt_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|err
suffix:semicolon
r_union
(brace
r_struct
id|in_rtmsg
id|rtmsg
suffix:semicolon
r_struct
id|in_ifmsg
id|ifmsg
suffix:semicolon
r_struct
id|in_rtrulemsg
id|rtrmsg
suffix:semicolon
r_struct
id|in_rtctlmsg
id|rtcmsg
suffix:semicolon
)brace
id|m
suffix:semicolon
r_struct
id|nlmsghdr
id|dummy_nlh
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|m
comma
l_int|0
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
id|dummy_nlh.nlmsg_seq
op_assign
l_int|0
suffix:semicolon
id|dummy_nlh.nlmsg_pid
op_assign
id|current-&gt;pid
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCADDRT
suffix:colon
multiline_comment|/* Add a route */
r_case
id|SIOCDELRT
suffix:colon
multiline_comment|/* Delete a route */
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|err
op_assign
id|get_rt_from_user
c_func
(paren
op_amp
id|m.rtmsg
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
id|dummy_nlh.nlmsg_type
op_assign
id|cmd
op_eq
id|SIOCDELRT
ques
c_cond
id|RTMSG_DELROUTE
suffix:colon
id|RTMSG_NEWROUTE
suffix:semicolon
id|err
op_assign
id|rtmsg_process
c_func
(paren
op_amp
id|dummy_nlh
comma
op_amp
id|m.rtmsg
)paren
suffix:semicolon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_case
id|SIOCRTMSG
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|dummy_nlh
comma
id|arg
comma
r_sizeof
(paren
id|dummy_nlh
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|dummy_nlh.nlmsg_type
)paren
(brace
r_case
id|RTMSG_NEWROUTE
suffix:colon
r_case
id|RTMSG_DELROUTE
suffix:colon
r_if
c_cond
(paren
id|dummy_nlh.nlmsg_len
OL
r_sizeof
(paren
id|m.rtmsg
)paren
op_plus
r_sizeof
(paren
id|dummy_nlh
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|m.rtmsg
comma
id|arg
op_plus
r_sizeof
(paren
id|dummy_nlh
)paren
comma
r_sizeof
(paren
id|m.rtmsg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|rtmsg_process
c_func
(paren
op_amp
id|dummy_nlh
comma
op_amp
id|m.rtmsg
)paren
suffix:semicolon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_case
id|RTMSG_NEWRULE
suffix:colon
r_case
id|RTMSG_DELRULE
suffix:colon
r_if
c_cond
(paren
id|dummy_nlh.nlmsg_len
OL
r_sizeof
(paren
id|m.rtrmsg
)paren
op_plus
r_sizeof
(paren
id|dummy_nlh
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|m.rtrmsg
comma
id|arg
op_plus
r_sizeof
(paren
id|dummy_nlh
)paren
comma
r_sizeof
(paren
id|m.rtrmsg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|rtrulemsg_process
c_func
(paren
op_amp
id|dummy_nlh
comma
op_amp
id|m.rtrmsg
)paren
suffix:semicolon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_case
id|RTMSG_NEWDEVICE
suffix:colon
r_case
id|RTMSG_DELDEVICE
suffix:colon
r_if
c_cond
(paren
id|dummy_nlh.nlmsg_len
OL
r_sizeof
(paren
id|m.ifmsg
)paren
op_plus
r_sizeof
(paren
id|dummy_nlh
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|m.ifmsg
comma
id|arg
op_plus
r_sizeof
(paren
id|dummy_nlh
)paren
comma
r_sizeof
(paren
id|m.ifmsg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|ifmsg_process
c_func
(paren
op_amp
id|dummy_nlh
comma
op_amp
id|m.ifmsg
)paren
suffix:semicolon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_case
id|RTMSG_CONTROL
suffix:colon
r_if
c_cond
(paren
id|dummy_nlh.nlmsg_len
OL
r_sizeof
(paren
id|m.rtcmsg
)paren
op_plus
r_sizeof
(paren
id|dummy_nlh
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
id|copy_from_user
c_func
(paren
op_amp
id|m.rtcmsg
comma
id|arg
op_plus
r_sizeof
(paren
id|dummy_nlh
)paren
comma
r_sizeof
(paren
id|m.rtcmsg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|rtcmsg_process
c_func
(paren
op_amp
id|dummy_nlh
comma
op_amp
id|m.rtcmsg
)paren
suffix:semicolon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RTNETLINK
multiline_comment|/*&n; *&t;Netlink hooks for IP&n; */
r_static
r_void
DECL|function|rtmsg_fib
id|rtmsg_fib
c_func
(paren
r_int
r_int
id|type
comma
r_struct
id|fib_node
op_star
id|f
comma
r_int
id|logmask
comma
r_struct
id|fib_class
op_star
r_class
comma
r_struct
id|nlmsghdr
op_star
id|n
)paren
(brace
r_struct
id|in_rtmsg
op_star
id|r
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
r_if
c_cond
(paren
id|n
op_logical_and
op_logical_neg
(paren
id|rt_nl_flags
op_amp
id|RTCTL_ECHO
)paren
op_logical_and
id|rt_nl_owner
op_eq
id|n-&gt;nlmsg_pid
)paren
r_return
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|r
op_assign
id|nlmsg_send
c_func
(paren
op_amp
id|rtmsg_ctl
comma
id|type
comma
r_sizeof
(paren
op_star
id|r
)paren
comma
id|n
ques
c_cond
id|n-&gt;nlmsg_seq
suffix:colon
l_int|0
comma
id|n
ques
c_cond
id|n-&gt;nlmsg_pid
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
(brace
id|r-&gt;rtmsg_prefix.s_addr
op_assign
id|htonl
c_func
(paren
id|f-&gt;fib_key
op_lshift
id|logmask
)paren
suffix:semicolon
id|r-&gt;rtmsg_prefixlen
op_assign
l_int|32
op_minus
id|logmask
suffix:semicolon
id|r-&gt;rtmsg_metric
op_assign
id|f-&gt;fib_metric
suffix:semicolon
id|r-&gt;rtmsg_tos
op_assign
id|f-&gt;fib_tos
suffix:semicolon
id|r-&gt;rtmsg_class
op_assign
r_class
op_member_access_from_pointer
id|cl_id
suffix:semicolon
id|r-&gt;rtmsg_flags
op_assign
id|fib_flag_trans
c_func
(paren
id|f-&gt;fib_flag
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fi
op_assign
id|f-&gt;fib_info
)paren
op_ne
l_int|NULL
)paren
(brace
id|r-&gt;rtmsg_gateway.s_addr
op_assign
id|fi-&gt;fib_gateway
suffix:semicolon
id|r-&gt;rtmsg_flags
op_or_assign
id|fi-&gt;fib_flags
suffix:semicolon
id|r-&gt;rtmsg_mtu
op_assign
id|fi-&gt;fib_mtu
suffix:semicolon
id|r-&gt;rtmsg_window
op_assign
id|fi-&gt;fib_window
suffix:semicolon
id|r-&gt;rtmsg_rtt
op_assign
id|fi-&gt;fib_irtt
suffix:semicolon
id|memset
c_func
(paren
id|r-&gt;rtmsg_device
comma
l_int|0
comma
r_sizeof
(paren
id|r-&gt;rtmsg_device
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi-&gt;fib_dev
)paren
id|strcpy
c_func
(paren
id|r-&gt;rtmsg_device
comma
id|fi-&gt;fib_dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|__rtmsg_ack
id|__rtmsg_ack
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|n
comma
r_int
id|err
)paren
(brace
id|nlmsg_ack
c_func
(paren
op_amp
id|rtmsg_ctl
comma
id|n-&gt;nlmsg_seq
comma
id|n-&gt;nlmsg_pid
comma
id|err
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|rtmsg_dev
id|rtmsg_dev
c_func
(paren
r_int
r_int
id|type
comma
r_struct
id|device
op_star
id|dev
comma
r_struct
id|nlmsghdr
op_star
id|n
)paren
(brace
r_struct
id|in_ifmsg
op_star
id|r
suffix:semicolon
id|start_bh_atomic
c_func
(paren
)paren
suffix:semicolon
id|r
op_assign
id|nlmsg_send
c_func
(paren
op_amp
id|rtmsg_ctl
comma
id|type
comma
r_sizeof
(paren
op_star
id|r
)paren
comma
id|n
ques
c_cond
id|n-&gt;nlmsg_seq
suffix:colon
l_int|0
comma
id|n
ques
c_cond
id|n-&gt;nlmsg_pid
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
(brace
id|memset
c_func
(paren
id|r
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|r
)paren
)paren
suffix:semicolon
id|r-&gt;ifmsg_lladdr.sa_family
op_assign
id|dev-&gt;type
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|r-&gt;ifmsg_lladdr.sa_data
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|r-&gt;ifmsg_prefix.s_addr
op_assign
id|dev-&gt;pa_addr
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
op_logical_or
id|dev-&gt;type
op_eq
id|ARPHRD_TUNNEL
)paren
id|r-&gt;ifmsg_brd.s_addr
op_assign
id|dev-&gt;pa_dstaddr
suffix:semicolon
r_else
id|r-&gt;ifmsg_brd.s_addr
op_assign
id|dev-&gt;pa_brdaddr
suffix:semicolon
id|r-&gt;ifmsg_flags
op_assign
id|dev-&gt;flags
suffix:semicolon
id|r-&gt;ifmsg_mtu
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|r-&gt;ifmsg_metric
op_assign
id|dev-&gt;metric
suffix:semicolon
id|r-&gt;ifmsg_prefixlen
op_assign
l_int|32
op_minus
id|fib_logmask
c_func
(paren
id|dev-&gt;pa_mask
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|r-&gt;ifmsg_device
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|end_bh_atomic
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|fib_netlink_call
r_static
r_int
id|fib_netlink_call
c_func
(paren
r_int
id|minor
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
id|totlen
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|skb-&gt;len
op_ge
r_sizeof
(paren
op_star
id|nlh
)paren
)paren
(brace
r_int
id|rlen
suffix:semicolon
id|nlh
op_assign
(paren
r_struct
id|nlmsghdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|rlen
op_assign
id|NLMSG_ALIGN
c_func
(paren
id|nlh-&gt;nlmsg_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
id|rlen
)paren
r_break
suffix:semicolon
id|totlen
op_add_assign
id|rlen
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|rlen
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|nlh-&gt;nlmsg_type
)paren
(brace
r_case
id|RTMSG_NEWROUTE
suffix:colon
r_case
id|RTMSG_DELROUTE
suffix:colon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_len
OL
r_sizeof
(paren
op_star
id|nlh
)paren
op_plus
r_sizeof
(paren
r_struct
id|in_rtmsg
)paren
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|nlh
comma
id|EINVAL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|rtmsg_process
c_func
(paren
id|nlh
comma
(paren
r_struct
id|in_rtmsg
op_star
)paren
id|nlh-&gt;nlmsg_data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTMSG_NEWRULE
suffix:colon
r_case
id|RTMSG_DELRULE
suffix:colon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_len
OL
r_sizeof
(paren
op_star
id|nlh
)paren
op_plus
r_sizeof
(paren
r_struct
id|in_rtrulemsg
)paren
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|nlh
comma
id|EINVAL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|rtrulemsg_process
c_func
(paren
id|nlh
comma
(paren
r_struct
id|in_rtrulemsg
op_star
)paren
id|nlh-&gt;nlmsg_data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTMSG_NEWDEVICE
suffix:colon
r_case
id|RTMSG_DELDEVICE
suffix:colon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_len
OL
r_sizeof
(paren
op_star
id|nlh
)paren
op_plus
r_sizeof
(paren
r_struct
id|in_ifmsg
)paren
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|nlh
comma
id|EINVAL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|ifmsg_process
c_func
(paren
id|nlh
comma
(paren
r_struct
id|in_ifmsg
op_star
)paren
id|nlh-&gt;nlmsg_data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RTMSG_CONTROL
suffix:colon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_len
OL
r_sizeof
(paren
op_star
id|nlh
)paren
op_plus
r_sizeof
(paren
r_struct
id|in_rtctlmsg
)paren
)paren
(brace
id|rtmsg_ack
c_func
(paren
id|nlh
comma
id|EINVAL
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|rtcmsg_process
c_func
(paren
id|nlh
comma
(paren
r_struct
id|in_rtctlmsg
op_star
)paren
id|nlh-&gt;nlmsg_data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_or
id|rt_nl_flags
op_amp
id|RTCTL_ACK
)paren
r_return
id|totlen
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
DECL|function|fib_magic
r_static
r_int
id|fib_magic
c_func
(paren
r_int
id|op
comma
r_int
id|flags
comma
id|u32
id|dst
comma
id|u32
id|mask
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|nlmsghdr
id|n
suffix:semicolon
r_struct
id|in_rtmsg
id|r
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|r
comma
l_int|0
comma
r_sizeof
(paren
id|r
)paren
)paren
suffix:semicolon
id|n.nlmsg_seq
op_assign
l_int|0
suffix:semicolon
id|n.nlmsg_pid
op_assign
l_int|0
suffix:semicolon
id|r.rtmsg_metric
op_assign
id|MAGIC_METRIC
suffix:semicolon
id|r.rtmsg_prefix.s_addr
op_assign
id|dst
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
id|flags
op_or_assign
id|RTF_LOCAL
suffix:semicolon
id|r.rtmsg_flags
op_assign
id|flags
suffix:semicolon
id|r.rtmsg_prefixlen
op_assign
l_int|32
op_minus
id|fib_logmask
c_func
(paren
id|mask
)paren
suffix:semicolon
r_return
(paren
id|op
op_eq
id|RTMSG_NEWROUTE
ques
c_cond
id|fib_create
suffix:colon
id|fib_delete
)paren
(paren
op_amp
id|r
comma
id|dev
comma
(paren
id|flags
op_amp
id|RTF_LOCAL
)paren
ques
c_cond
op_amp
id|local_class
suffix:colon
op_amp
id|main_class
comma
op_amp
id|n
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_change_broadcast
r_void
id|ip_rt_change_broadcast
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|new_brd
)paren
(brace
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s changes brd %08lX -&gt; %08X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;pa_brdaddr
comma
id|new_brd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ZERONET
c_func
(paren
id|dev-&gt;pa_addr
)paren
op_logical_and
id|dev-&gt;flags
op_amp
id|IFF_BROADCAST
)paren
(brace
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFBRD
comma
id|dev-&gt;pa_brdaddr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
id|rtmsg_dev
c_func
(paren
id|RTMSG_DELDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|rtmsg_dev
c_func
(paren
id|RTMSG_NEWDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFBRD
comma
id|new_brd
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
)brace
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_change_dstaddr
r_void
id|ip_rt_change_dstaddr
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|dstaddr
)paren
(brace
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ZERONET
c_func
(paren
id|dev-&gt;pa_addr
)paren
op_logical_and
(paren
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
)paren
op_logical_and
id|dev-&gt;type
op_ne
id|ARPHRD_TUNNEL
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s changes dst %08lX -&gt; %08X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;pa_dstaddr
comma
id|dstaddr
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFPREFIX
comma
id|dev-&gt;pa_dstaddr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
id|rtmsg_dev
c_func
(paren
id|RTMSG_DELDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|rtmsg_dev
c_func
(paren
id|RTMSG_NEWDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dstaddr
)paren
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFPREFIX
comma
id|dstaddr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
)brace
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_change_netmask
r_void
id|ip_rt_change_netmask
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|mask
)paren
(brace
id|u32
id|net
suffix:semicolon
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s changes netmask %08lX -&gt; %08X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;pa_mask
comma
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ZERONET
c_func
(paren
id|dev-&gt;pa_addr
)paren
)paren
(brace
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|net
op_assign
id|dev-&gt;pa_addr
op_amp
id|dev-&gt;pa_mask
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFPREFIX
comma
id|net
comma
id|dev-&gt;pa_mask
comma
id|dev
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFBRD
comma
id|net
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFBRD
comma
id|net
op_or
op_complement
id|dev-&gt;pa_mask
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_ne
l_int|0xFFFFFFFF
op_logical_and
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
)paren
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFPREFIX
comma
id|dev-&gt;pa_dstaddr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
id|rtmsg_dev
c_func
(paren
id|RTMSG_DELDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_POINTOPOINT
suffix:semicolon
id|rtmsg_dev
c_func
(paren
id|RTMSG_NEWDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|net
op_assign
id|dev-&gt;pa_addr
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|net
)paren
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFPREFIX
comma
id|net
comma
id|mask
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net
op_logical_and
id|mask
op_ne
l_int|0xFFFFFFFF
)paren
(brace
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFBRD
comma
id|net
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFBRD
comma
id|net
op_or
op_complement
id|mask
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
)brace
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ip_rt_event
r_int
id|ip_rt_event
c_func
(paren
r_int
id|event
comma
r_struct
id|device
op_star
id|dev
)paren
(brace
id|fib_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|event
op_eq
id|NETDEV_DOWN
)paren
(brace
id|fib_flush
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rtmsg_dev
c_func
(paren
id|RTMSG_DELDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|event
op_eq
id|NETDEV_CHANGE
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s(%s) changes state fl=%08x pa=%08lX/%08lX brd=%08lX dst=%08lX&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|current-&gt;comm
comma
id|dev-&gt;flags
comma
id|dev-&gt;pa_addr
comma
id|dev-&gt;pa_mask
comma
id|dev-&gt;pa_brdaddr
comma
id|dev-&gt;pa_dstaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_BROADCAST
)paren
)paren
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFBRD
comma
id|dev-&gt;pa_brdaddr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
)paren
)paren
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFPREFIX
comma
id|dev-&gt;pa_dstaddr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
r_else
(brace
id|u32
id|net
op_assign
id|dev-&gt;pa_addr
op_amp
id|dev-&gt;pa_mask
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFPREFIX
comma
id|net
comma
id|dev-&gt;pa_mask
comma
id|dev
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFBRD
comma
id|net
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_DELROUTE
comma
id|RTF_IFBRD
comma
id|net
op_or
op_complement
id|dev-&gt;pa_mask
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
)brace
id|rtmsg_dev
c_func
(paren
id|RTMSG_DELDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|event
op_eq
id|NETDEV_UP
op_logical_or
id|event
op_eq
id|NETDEV_CHANGE
)paren
op_logical_and
op_logical_neg
id|ZERONET
c_func
(paren
id|dev-&gt;pa_addr
)paren
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
)paren
(brace
id|dev-&gt;pa_mask
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|dev-&gt;ip_flags
op_and_assign
op_complement
id|IFF_IP_MASK_OK
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_BROADCAST
suffix:semicolon
id|dev-&gt;pa_brdaddr
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|event
op_eq
id|NETDEV_UP
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s UP fl=%08x pa=%08lX/%08lX brd=%08lX dst=%08lX&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;flags
comma
id|dev-&gt;pa_addr
comma
id|dev-&gt;pa_mask
comma
id|dev-&gt;pa_brdaddr
comma
id|dev-&gt;pa_dstaddr
)paren
suffix:semicolon
id|rtmsg_dev
c_func
(paren
id|RTMSG_NEWDEVICE
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;pa_dstaddr
op_logical_and
id|dev-&gt;type
op_ne
id|ARPHRD_TUNNEL
)paren
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFPREFIX
comma
id|dev-&gt;pa_dstaddr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;pa_addr
op_amp
id|dev-&gt;pa_mask
)paren
(brace
id|u32
id|net
op_assign
id|dev-&gt;pa_addr
op_amp
id|dev-&gt;pa_mask
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFPREFIX
comma
id|net
comma
id|dev-&gt;pa_mask
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;pa_mask
op_ne
l_int|0xFFFFFFFF
)paren
(brace
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFBRD
comma
id|net
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFBRD
comma
id|net
op_or
op_complement
id|dev-&gt;pa_mask
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFLOCAL
comma
id|dev-&gt;pa_addr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
op_amp
id|loopback_dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;pa_addr
op_ne
id|htonl
c_func
(paren
id|INADDR_LOOPBACK
)paren
)paren
(brace
id|u32
id|mask
op_assign
id|htonl
c_func
(paren
l_int|0xFF000000
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFPREFIX
comma
id|htonl
c_func
(paren
id|INADDR_LOOPBACK
)paren
op_amp
id|mask
comma
id|mask
comma
id|dev
)paren
suffix:semicolon
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFLOCAL
comma
id|htonl
c_func
(paren
id|INADDR_LOOPBACK
)paren
comma
id|mask
comma
id|dev
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_BROADCAST
)paren
id|fib_magic
c_func
(paren
id|RTMSG_NEWROUTE
comma
id|RTF_IFBRD
comma
id|dev-&gt;pa_brdaddr
comma
op_complement
l_int|0
comma
id|dev
)paren
suffix:semicolon
)brace
id|fib_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|function|ip_fib_init
r_void
id|ip_fib_init
c_func
(paren
)paren
(brace
r_struct
id|in_rtrulemsg
id|r
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_register
c_func
(paren
op_amp
(paren
r_struct
id|proc_dir_entry
)paren
(brace
id|PROC_NET_ROUTE
comma
l_int|5
comma
l_string|&quot;route&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|fib_get_info
)brace
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
(paren
r_struct
id|proc_dir_entry
)paren
(brace
id|PROC_NET_RTCLASSES
comma
l_int|10
comma
l_string|&quot;rt_classes&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|fib_class_get_info
)brace
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
(paren
r_struct
id|proc_dir_entry
)paren
(brace
id|PROC_NET_RTRULES
comma
l_int|8
comma
l_string|&quot;rt_local&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|fib_local_get_info
)brace
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
(paren
r_struct
id|proc_dir_entry
)paren
(brace
id|PROC_NET_RTRULES
comma
l_int|8
comma
l_string|&quot;rt_rules&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|fib_rules_get_info
)brace
)paren
suffix:semicolon
macro_line|#endif&t;&t;/* CONFIG_PROC_FS */
id|fib_classes
(braket
id|RT_CLASS_LOCAL
)braket
op_assign
op_amp
id|local_class
suffix:semicolon
id|fib_classes
(braket
id|RT_CLASS_MAIN
)braket
op_assign
op_amp
id|main_class
suffix:semicolon
id|fib_classes
(braket
id|RT_CLASS_DEFAULT
)braket
op_assign
op_amp
id|default_class
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|r
comma
l_int|0
comma
r_sizeof
(paren
id|r
)paren
)paren
suffix:semicolon
id|r.rtrmsg_class
op_assign
id|RT_CLASS_LOCAL
suffix:semicolon
id|r.rtrmsg_preference
op_assign
l_int|0
suffix:semicolon
id|fib_rule_add
c_func
(paren
op_amp
id|r
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|r
comma
l_int|0
comma
r_sizeof
(paren
id|r
)paren
)paren
suffix:semicolon
id|r.rtrmsg_class
op_assign
id|RT_CLASS_DEFAULT
suffix:semicolon
id|r.rtrmsg_preference
op_assign
l_int|255
suffix:semicolon
id|fib_rule_add
c_func
(paren
op_amp
id|r
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|r
comma
l_int|0
comma
r_sizeof
(paren
id|r
)paren
)paren
suffix:semicolon
id|r.rtrmsg_class
op_assign
id|RT_CLASS_MAIN
suffix:semicolon
id|r.rtrmsg_preference
op_assign
l_int|254
suffix:semicolon
id|fib_rule_add
c_func
(paren
op_amp
id|r
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#ifdef  CONFIG_RTNETLINK
id|netlink_attach
c_func
(paren
id|NETLINK_ROUTE
comma
id|fib_netlink_call
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
