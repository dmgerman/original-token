multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;PF_INET protocol family socket handler.&n; *&n; * Version:&t;$Id: af_inet.c,v 1.72 1998/05/03 14:30:49 alan Exp $&n; *&n; * Authors:&t;Ross Biro, &lt;bir7@leland.Stanford.Edu&gt;&n; *&t;&t;Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;&n; *&t;&t;Florian La Roche, &lt;flla@stud.uni-sb.de&gt;&n; *&t;&t;Alan Cox, &lt;A.Cox@swansea.ac.uk&gt;&n; *&n; * Changes (see also sock.c)&n; *&n; *&t;&t;A.N.Kuznetsov&t;:&t;Socket death error in accept().&n; *&t;&t;John Richardson :&t;Fix non blocking error in connect()&n; *&t;&t;&t;&t;&t;so sockets that fail to connect&n; *&t;&t;&t;&t;&t;don&squot;t return -EINPROGRESS.&n; *&t;&t;Alan Cox&t;:&t;Asynchronous I/O support&n; *&t;&t;Alan Cox&t;:&t;Keep correct socket pointer on sock structures&n; *&t;&t;&t;&t;&t;when accept() ed&n; *&t;&t;Alan Cox&t;:&t;Semantics of SO_LINGER aren&squot;t state moved&n; *&t;&t;&t;&t;&t;to close when you look carefully. With&n; *&t;&t;&t;&t;&t;this fixed and the accept bug fixed &n; *&t;&t;&t;&t;&t;some RPC stuff seems happier.&n; *&t;&t;Niibe Yutaka&t;:&t;4.4BSD style write async I/O&n; *&t;&t;Alan Cox, &n; *&t;&t;Tony Gale &t;:&t;Fixed reuse semantics.&n; *&t;&t;Alan Cox&t;:&t;bind() shouldn&squot;t abort existing but dead&n; *&t;&t;&t;&t;&t;sockets. Stops FTP netin:.. I hope.&n; *&t;&t;Alan Cox&t;:&t;bind() works correctly for RAW sockets. Note&n; *&t;&t;&t;&t;&t;that FreeBSD at least was broken in this respect&n; *&t;&t;&t;&t;&t;so be careful with compatibility tests...&n; *&t;&t;Alan Cox&t;:&t;routing cache support&n; *&t;&t;Alan Cox&t;:&t;memzero the socket structure for compactness.&n; *&t;&t;Matt Day&t;:&t;nonblock connect error handler&n; *&t;&t;Alan Cox&t;:&t;Allow large numbers of pending sockets&n; *&t;&t;&t;&t;&t;(eg for big web sites), but only if&n; *&t;&t;&t;&t;&t;specifically application requested.&n; *&t;&t;Alan Cox&t;:&t;New buffering throughout IP. Used dumbly.&n; *&t;&t;Alan Cox&t;:&t;New buffering now used smartly.&n; *&t;&t;Alan Cox&t;:&t;BSD rather than common sense interpretation of&n; *&t;&t;&t;&t;&t;listen.&n; *&t;&t;Germano Caronni&t;:&t;Assorted small races.&n; *&t;&t;Alan Cox&t;:&t;sendmsg/recvmsg basic support.&n; *&t;&t;Alan Cox&t;:&t;Only sendmsg/recvmsg now supported.&n; *&t;&t;Alan Cox&t;:&t;Locked down bind (see security list).&n; *&t;&t;Alan Cox&t;:&t;Loosened bind a little.&n; *&t;&t;Mike McLagan&t;:&t;ADD/DEL DLCI Ioctls&n; *&t;Willy Konynenberg&t;:&t;Transparent proxying support.&n; *&t;&t;David S. Miller&t;:&t;New socket lookup architecture.&n; *&t;&t;&t;&t;&t;Some other random speedups.&n; *&t;&t;Cyrus Durgin&t;:&t;Cleaned up file for kmod hacks.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/rarp.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/udp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/raw.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;net/ipip.h&gt;
macro_line|#include &lt;net/inet_common.h&gt;
macro_line|#include &lt;linux/ip_fw.h&gt;
macro_line|#ifdef CONFIG_IP_MROUTE
macro_line|#include &lt;linux/mroute.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_IP_MASQUERADE
macro_line|#include &lt;net/ip_masq.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_BRIDGE
macro_line|#include &lt;net/br.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_KMOD
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_NET_RADIO
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#endif&t;/* CONFIG_NET_RADIO */
DECL|macro|min
mdefine_line|#define min(a,b)&t;((a)&lt;(b)?(a):(b))
DECL|variable|net_statistics
r_struct
id|linux_mib
id|net_statistics
suffix:semicolon
r_extern
r_int
id|sysctl_core_destroy_delay
suffix:semicolon
r_extern
r_int
id|raw_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|snmp_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|netstat_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|afinet_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|tcp_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_int
id|udp_get_info
c_func
(paren
r_char
op_star
comma
r_char
op_star
op_star
comma
id|off_t
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_extern
r_void
id|ip_mc_drop_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_DLCI
r_extern
r_int
id|dlci_ioctl
c_func
(paren
r_int
r_int
comma
r_void
op_star
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_DLCI_MODULE
DECL|variable|dlci_ioctl_hook
r_int
(paren
op_star
id|dlci_ioctl_hook
)paren
(paren
r_int
r_int
comma
r_void
op_star
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
DECL|variable|rarp_ioctl_hook
r_int
(paren
op_star
id|rarp_ioctl_hook
)paren
(paren
r_int
r_int
comma
r_void
op_star
)paren
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n; *&t;Destroy an AF_INET socket&n; */
DECL|function|kill_sk_queues
r_static
id|__inline__
r_void
id|kill_sk_queues
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* First the read buffer. */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* This will take care of closing sockets that were&n;&t;&t; * listening and didn&squot;t accept everything.&n;&t;&t; */
r_if
c_cond
(paren
id|skb-&gt;sk
op_ne
l_int|NULL
op_logical_and
id|skb-&gt;sk
op_ne
id|sk
)paren
id|skb-&gt;sk-&gt;prot
op_member_access_from_pointer
id|close
c_func
(paren
id|skb-&gt;sk
comma
l_int|0
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Next, the error queue. */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;error_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Now the backlog. */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;back_log
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
DECL|function|kill_sk_now
r_static
id|__inline__
r_void
id|kill_sk_now
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
multiline_comment|/* No longer exists. */
id|del_from_prot_sklist
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Remove from protocol hash chains. */
id|sk-&gt;prot
op_member_access_from_pointer
id|unhash
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;opt
)paren
(brace
id|kfree
c_func
(paren
id|sk-&gt;opt
)paren
suffix:semicolon
)brace
id|dst_release
c_func
(paren
id|sk-&gt;dst_cache
)paren
suffix:semicolon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
DECL|function|kill_sk_later
r_static
id|__inline__
r_void
id|kill_sk_later
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
multiline_comment|/* this should never happen. */
multiline_comment|/* actually it can if an ack has just been sent. */
multiline_comment|/* &n;&t; * It&squot;s more normal than that...&n;&t; * It can happen because a skb is still in the device queues&n;&t; * [PR]&n;&t; */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Socket destroy delayed (r=%d w=%d)&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
)paren
suffix:semicolon
id|sk-&gt;destroy
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;ack_backlog
op_assign
l_int|0
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|net_reset_timer
c_func
(paren
id|sk
comma
id|TIME_DESTROY
comma
id|sysctl_core_destroy_delay
)paren
suffix:semicolon
)brace
DECL|function|destroy_sock
r_void
id|destroy_sock
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* just to be safe. */
multiline_comment|/* Now we can no longer get new packets or once the&n;  &t; * timers are killed, send them.&n;  &t; */
id|net_delete_timer
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;destroy
)paren
id|sk-&gt;prot
op_member_access_from_pointer
id|destroy
c_func
(paren
id|sk
)paren
suffix:semicolon
id|kill_sk_queues
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Now if it has a half accepted/ closed socket. */
r_if
c_cond
(paren
id|sk-&gt;pair
)paren
(brace
id|sk-&gt;pair-&gt;prot
op_member_access_from_pointer
id|close
c_func
(paren
id|sk-&gt;pair
comma
l_int|0
)paren
suffix:semicolon
id|sk-&gt;pair
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Now if everything is gone we can free the socket&n;&t; * structure, otherwise we need to keep it around until&n;&t; * everything is gone.&n;&t; */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_eq
l_int|0
op_logical_and
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
op_eq
l_int|0
)paren
id|kill_sk_now
c_func
(paren
id|sk
)paren
suffix:semicolon
r_else
id|kill_sk_later
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;The routines beyond this point handle the behaviour of an AF_INET&n; *&t;socket object. Mostly it punts to the subprotocols of IP to do&n; *&t;the work.&n; */
multiline_comment|/*&n; *&t;Set socket options on an inet socket.&n; */
DECL|function|inet_setsockopt
r_int
id|inet_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;setsockopt
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_return
id|sk-&gt;prot
op_member_access_from_pointer
id|setsockopt
c_func
(paren
id|sk
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Get a socket option on an AF_INET socket.&n; *&n; *&t;FIX: POSIX 1003.1g is very ambiguous here. It states that&n; *&t;asynchronous errors should be reported by getsockopt. We assume&n; *&t;this means if you specify SO_ERROR (otherwise whats the point of it).&n; */
DECL|function|inet_getsockopt
r_int
id|inet_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;getsockopt
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_return
id|sk-&gt;prot
op_member_access_from_pointer
id|getsockopt
c_func
(paren
id|sk
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Automatically bind an unbound socket.&n; */
DECL|function|inet_autobind
r_static
r_int
id|inet_autobind
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
multiline_comment|/* We may need to bind the socket. */
r_if
c_cond
(paren
id|sk-&gt;num
op_eq
l_int|0
)paren
(brace
id|sk-&gt;num
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|good_socknum
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;num
op_eq
l_int|0
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|sk-&gt;sport
op_assign
id|htons
c_func
(paren
id|sk-&gt;num
)paren
suffix:semicolon
id|sk-&gt;prot
op_member_access_from_pointer
id|hash
c_func
(paren
id|sk
)paren
suffix:semicolon
id|add_to_prot_sklist
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Move a socket into listening state.&n; */
DECL|function|inet_listen
r_int
id|inet_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
op_logical_or
id|sock-&gt;type
op_ne
id|SOCK_STREAM
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|inet_autobind
c_func
(paren
id|sk
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
multiline_comment|/* We might as well re use these. */
r_if
c_cond
(paren
(paren
r_int
)paren
id|backlog
op_eq
l_int|0
)paren
multiline_comment|/* BSDism */
id|backlog
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
id|backlog
OG
id|SOMAXCONN
)paren
id|backlog
op_assign
id|SOMAXCONN
suffix:semicolon
id|sk-&gt;max_ack_backlog
op_assign
id|backlog
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_LISTEN
)paren
(brace
id|sk-&gt;ack_backlog
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_LISTEN
suffix:semicolon
id|dst_release
c_func
(paren
id|xchg
c_func
(paren
op_amp
id|sk-&gt;dst_cache
comma
l_int|NULL
)paren
)paren
suffix:semicolon
id|sk-&gt;prot
op_member_access_from_pointer
id|rehash
c_func
(paren
id|sk
)paren
suffix:semicolon
id|add_to_prot_sklist
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|sk-&gt;socket-&gt;flags
op_or_assign
id|SO_ACCEPTCON
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Create an inet socket.&n; *&n; *&t;FIXME: Gcc would generate much better code if we set the parameters&n; *&t;up in in-memory structure order. Gcc68K even more so&n; */
DECL|function|inet_create
r_static
r_int
id|inet_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|proto
op_star
id|prot
suffix:semicolon
multiline_comment|/* Compatibility */
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_PACKET
)paren
(brace
r_static
r_int
id|warned
suffix:semicolon
r_if
c_cond
(paren
id|net_families
(braket
id|PF_PACKET
)braket
op_eq
l_int|NULL
)paren
(brace
macro_line|#if defined(CONFIG_KMOD) &amp;&amp; defined(CONFIG_PACKET_MODULE)
r_char
id|module_name
(braket
l_int|30
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|module_name
comma
l_string|&quot;net-pf-%d&quot;
comma
id|PF_PACKET
)paren
suffix:semicolon
id|request_module
c_func
(paren
id|module_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|net_families
(braket
id|PF_PACKET
)braket
op_eq
l_int|NULL
)paren
macro_line|#endif
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|warned
op_increment
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s uses obsolete (PF_INET,SOCK_PACKET)&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
r_return
id|net_families
(braket
id|PF_PACKET
)braket
op_member_access_from_pointer
id|create
c_func
(paren
id|sock
comma
id|protocol
)paren
suffix:semicolon
)brace
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_INET
comma
id|GFP_KERNEL
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_goto
id|do_oom
suffix:semicolon
r_switch
c_cond
(paren
id|sock-&gt;type
)paren
(brace
r_case
id|SOCK_STREAM
suffix:colon
r_if
c_cond
(paren
id|protocol
op_logical_and
id|protocol
op_ne
id|IPPROTO_TCP
)paren
r_goto
id|free_and_noproto
suffix:semicolon
id|protocol
op_assign
id|IPPROTO_TCP
suffix:semicolon
r_if
c_cond
(paren
id|ipv4_config.no_pmtu_disc
)paren
id|sk-&gt;ip_pmtudisc
op_assign
id|IP_PMTUDISC_DONT
suffix:semicolon
r_else
id|sk-&gt;ip_pmtudisc
op_assign
id|IP_PMTUDISC_WANT
suffix:semicolon
id|prot
op_assign
op_amp
id|tcp_prot
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|inet_stream_ops
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOCK_SEQPACKET
suffix:colon
r_goto
id|free_and_badtype
suffix:semicolon
r_case
id|SOCK_DGRAM
suffix:colon
r_if
c_cond
(paren
id|protocol
op_logical_and
id|protocol
op_ne
id|IPPROTO_UDP
)paren
r_goto
id|free_and_noproto
suffix:semicolon
id|protocol
op_assign
id|IPPROTO_UDP
suffix:semicolon
id|sk-&gt;no_check
op_assign
id|UDP_NO_CHECK
suffix:semicolon
id|sk-&gt;ip_pmtudisc
op_assign
id|IP_PMTUDISC_DONT
suffix:semicolon
id|prot
op_assign
op_amp
id|udp_prot
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|inet_dgram_ops
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOCK_RAW
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_RAW
)paren
)paren
r_goto
id|free_and_badperm
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|protocol
)paren
r_goto
id|free_and_noproto
suffix:semicolon
id|prot
op_assign
op_amp
id|raw_prot
suffix:semicolon
id|sk-&gt;reuse
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;ip_pmtudisc
op_assign
id|IP_PMTUDISC_DONT
suffix:semicolon
id|sk-&gt;num
op_assign
id|protocol
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|inet_dgram_ops
suffix:semicolon
r_if
c_cond
(paren
id|protocol
op_eq
id|IPPROTO_RAW
)paren
id|sk-&gt;ip_hdrincl
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|free_and_badtype
suffix:semicolon
)brace
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk-&gt;destruct
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;zapped
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_TCP_NAGLE_OFF
id|sk-&gt;nonagle
op_assign
l_int|1
suffix:semicolon
macro_line|#endif  
id|sk-&gt;family
op_assign
id|PF_INET
suffix:semicolon
id|sk-&gt;protocol
op_assign
id|protocol
suffix:semicolon
id|sk-&gt;prot
op_assign
id|prot
suffix:semicolon
id|sk-&gt;backlog_rcv
op_assign
id|prot-&gt;backlog_rcv
suffix:semicolon
id|sk-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|sk
suffix:semicolon
id|sk-&gt;timer.function
op_assign
op_amp
id|net_timer
suffix:semicolon
id|sk-&gt;ip_ttl
op_assign
id|ip_statistics.IpDefaultTTL
suffix:semicolon
id|sk-&gt;ip_mc_loop
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;ip_mc_ttl
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;ip_mc_index
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;ip_mc_list
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;num
)paren
(brace
multiline_comment|/* It assumes that any protocol which allows&n;&t;&t; * the user to assign a number at socket&n;&t;&t; * creation time automatically&n;&t;&t; * shares.&n;&t;&t; */
id|sk-&gt;sport
op_assign
id|htons
c_func
(paren
id|sk-&gt;num
)paren
suffix:semicolon
multiline_comment|/* Add to protocol hash chains. */
id|sk-&gt;prot
op_member_access_from_pointer
id|hash
c_func
(paren
id|sk
)paren
suffix:semicolon
id|add_to_prot_sklist
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;init
)paren
(brace
r_int
id|err
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|init
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
(brace
id|destroy_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
id|free_and_badtype
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
id|free_and_badperm
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
id|free_and_noproto
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
id|do_oom
suffix:colon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;The peer socket should always be NULL (or else). When we call this&n; *&t;function we are destroying the object and from then on nobody&n; *&t;should refer to it.&n; */
DECL|function|inet_release
r_int
id|inet_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|peersock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
r_int
r_int
id|timeout
suffix:semicolon
multiline_comment|/* Begin closedown and wake up sleepers. */
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
id|sock-&gt;state
op_assign
id|SS_DISCONNECTING
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Applications forget to leave groups before exiting */
id|ip_mc_drop_socket
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* If linger is set, we don&squot;t return until the close&n;&t;&t; * is complete.  Otherwise we return immediately. The&n;&t;&t; * actually closing is done the same either way.&n;&t;&t; *&n;&t;&t; * If the close is due to the process exiting, we never&n;&t;&t; * linger..&n;&t;&t; */
id|timeout
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;linger
op_logical_and
op_logical_neg
(paren
id|current-&gt;flags
op_amp
id|PF_EXITING
)paren
)paren
(brace
id|timeout
op_assign
op_complement
l_int|0UL
suffix:semicolon
multiline_comment|/* XXX This makes no sense whatsoever... -DaveM */
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;lingertime
)paren
id|timeout
op_assign
id|jiffies
op_plus
id|HZ
op_star
id|sk-&gt;lingertime
suffix:semicolon
)brace
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;socket
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;prot
op_member_access_from_pointer
id|close
c_func
(paren
id|sk
comma
id|timeout
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inet_bind
r_static
r_int
id|inet_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sockaddr_in
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
r_int
id|snum
suffix:semicolon
r_int
id|chk_addr_ret
suffix:semicolon
multiline_comment|/* If the socket has its own bind function then use it. (RAW) */
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;bind
)paren
(brace
r_return
id|sk-&gt;prot
op_member_access_from_pointer
id|bind
c_func
(paren
id|sk
comma
id|uaddr
comma
id|addr_len
)paren
suffix:semicolon
)brace
multiline_comment|/* Check these errors (active socket, bad address length, double bind). */
r_if
c_cond
(paren
(paren
id|sk-&gt;state
op_ne
id|TCP_CLOSE
)paren
op_logical_or
(paren
id|addr_len
OL
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
)paren
op_logical_or
(paren
id|sk-&gt;num
op_ne
l_int|0
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|snum
op_assign
id|ntohs
c_func
(paren
id|addr-&gt;sin_port
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IP_MASQUERADE
multiline_comment|/* The kernel masquerader needs some ports. */
r_if
c_cond
(paren
(paren
id|snum
op_ge
id|PORT_MASQ_BEGIN
)paren
op_logical_and
(paren
id|snum
op_le
id|PORT_MASQ_END
)paren
)paren
(brace
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
macro_line|#endif&t;&t; 
r_if
c_cond
(paren
id|snum
op_eq
l_int|0
)paren
id|snum
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|good_socknum
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snum
OL
id|PROT_SOCK
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_BIND_SERVICE
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|chk_addr_ret
op_assign
id|inet_addr_type
c_func
(paren
id|addr-&gt;sin_addr.s_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sin_addr.s_addr
op_ne
l_int|0
op_logical_and
id|chk_addr_ret
op_ne
id|RTN_LOCAL
op_logical_and
id|chk_addr_ret
op_ne
id|RTN_MULTICAST
op_logical_and
id|chk_addr_ret
op_ne
id|RTN_BROADCAST
)paren
(brace
macro_line|#ifdef CONFIG_IP_TRANSPARENT_PROXY
multiline_comment|/* Superuser may bind to any address to allow transparent proxying. */
r_if
c_cond
(paren
id|chk_addr_ret
op_ne
id|RTN_UNICAST
op_logical_or
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
macro_line|#endif
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
multiline_comment|/* Source address MUST be ours! */
)brace
multiline_comment|/*      We keep a pair of addresses. rcv_saddr is the one&n;&t; *      used by hash lookups, and saddr is used for transmit.&n;&t; *&n;&t; *      In the BSD API these are the same except where it&n;&t; *      would be illegal to use them (multicast/broadcast) in&n;&t; *      which case the sending device address is used.&n;&t; */
id|sk-&gt;rcv_saddr
op_assign
id|sk-&gt;saddr
op_assign
id|addr-&gt;sin_addr.s_addr
suffix:semicolon
r_if
c_cond
(paren
id|chk_addr_ret
op_eq
id|RTN_MULTICAST
op_logical_or
id|chk_addr_ret
op_eq
id|RTN_BROADCAST
)paren
(brace
id|sk-&gt;saddr
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Use device */
multiline_comment|/* Make sure we are allowed to bind here. */
r_if
c_cond
(paren
id|sk-&gt;prot
op_member_access_from_pointer
id|verify_bind
c_func
(paren
id|sk
comma
id|snum
)paren
)paren
(brace
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
id|sk-&gt;num
op_assign
id|snum
suffix:semicolon
id|sk-&gt;sport
op_assign
id|htons
c_func
(paren
id|snum
)paren
suffix:semicolon
id|sk-&gt;daddr
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;dport
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;prot
op_member_access_from_pointer
id|rehash
c_func
(paren
id|sk
)paren
suffix:semicolon
id|add_to_prot_sklist
c_func
(paren
id|sk
)paren
suffix:semicolon
id|dst_release
c_func
(paren
id|sk-&gt;dst_cache
)paren
suffix:semicolon
id|sk-&gt;dst_cache
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inet_dgram_connect
r_int
id|inet_dgram_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|inet_autobind
c_func
(paren
id|sk
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;connect
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|err
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|connect
c_func
(paren
id|sk
comma
(paren
r_struct
id|sockaddr
op_star
)paren
id|uaddr
comma
id|addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Connect to a remote host. There is regrettably still a little&n; *&t;TCP &squot;magic&squot; in here.&n; */
DECL|function|inet_stream_connect
r_int
id|inet_stream_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addr_len
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
op_logical_and
id|sock-&gt;state
op_ne
id|SS_CONNECTING
)paren
(brace
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
(brace
r_return
op_minus
id|EISCONN
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTING
)paren
(brace
r_if
c_cond
(paren
id|tcp_connected
c_func
(paren
id|sk-&gt;state
)paren
)paren
(brace
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;protocol
op_eq
id|IPPROTO_TCP
op_logical_and
(paren
id|flags
op_amp
id|O_NONBLOCK
)paren
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;err
)paren
(brace
r_return
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EALREADY
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* We may need to bind the socket. */
r_if
c_cond
(paren
id|inet_autobind
c_func
(paren
id|sk
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;connect
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|err
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|connect
c_func
(paren
id|sk
comma
id|uaddr
comma
id|addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_CONNECTING
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;state
OG
id|TCP_FIN_WAIT2
op_logical_and
id|sock-&gt;state
op_eq
id|SS_CONNECTING
)paren
(brace
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_return
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
op_logical_and
(paren
id|flags
op_amp
id|O_NONBLOCK
)paren
)paren
r_return
(paren
op_minus
id|EINPROGRESS
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|sk-&gt;state
op_eq
id|TCP_SYN_SENT
op_logical_or
id|sk-&gt;state
op_eq
id|TCP_SYN_RECV
)paren
(brace
id|interruptible_sleep_on
c_func
(paren
id|sk-&gt;sleep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
multiline_comment|/* This fixes a nasty in the tcp/ip code. There is a hideous hassle with&n;&t;&t;   icmp error packets wanting to close a tcp or udp socket. */
r_if
c_cond
(paren
id|sk-&gt;err
op_logical_and
id|sk-&gt;protocol
op_eq
id|IPPROTO_TCP
)paren
(brace
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|sti
c_func
(paren
)paren
suffix:semicolon
r_return
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* set by tcp_err() */
)brace
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
op_logical_and
id|sk-&gt;err
)paren
(brace
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_return
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Accept a pending connection. The TCP layer now gives BSD semantics.&n; */
DECL|function|inet_accept
r_int
id|inet_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk1
op_assign
id|sock-&gt;sk
comma
op_star
id|sk2
suffix:semicolon
r_struct
id|sock
op_star
id|newsk
op_assign
id|newsock-&gt;sk
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
op_logical_or
op_logical_neg
(paren
id|sock-&gt;flags
op_amp
id|SO_ACCEPTCON
)paren
)paren
r_goto
id|do_err
suffix:semicolon
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|sk1-&gt;prot-&gt;accept
op_eq
l_int|NULL
)paren
r_goto
id|do_err
suffix:semicolon
multiline_comment|/* Restore the state if we have been interrupted, and then returned. */
r_if
c_cond
(paren
id|sk1-&gt;pair
op_ne
l_int|NULL
)paren
(brace
id|sk2
op_assign
id|sk1-&gt;pair
suffix:semicolon
id|sk1-&gt;pair
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|sk2
op_assign
id|sk1-&gt;prot
op_member_access_from_pointer
id|accept
c_func
(paren
id|sk1
comma
id|flags
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|do_sk1_err
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;We&squot;ve been passed an extra socket.&n;&t; *&t;We need to free it up because the tcp module creates&n;&t; *&t;its own when it accepts one.&n;&t; */
id|sk2-&gt;sleep
op_assign
id|newsk-&gt;sleep
suffix:semicolon
id|newsock-&gt;sk
op_assign
id|sk2
suffix:semicolon
id|sk2-&gt;socket
op_assign
id|newsock
suffix:semicolon
id|newsk-&gt;socket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|O_NONBLOCK
)paren
r_goto
id|do_half_success
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|sk2-&gt;state
op_eq
id|TCP_SYN_RECV
)paren
(brace
id|interruptible_sleep_on
c_func
(paren
id|sk2-&gt;sleep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_goto
id|do_interrupted
suffix:semicolon
)brace
id|sti
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk2-&gt;state
op_eq
id|TCP_ESTABLISHED
)paren
(brace
r_goto
id|do_full_success
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk2-&gt;err
OG
l_int|0
)paren
(brace
r_goto
id|do_connect_err
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ECONNABORTED
suffix:semicolon
r_if
c_cond
(paren
id|sk2-&gt;state
op_eq
id|TCP_CLOSE
)paren
r_goto
id|do_bad_connection
suffix:semicolon
id|do_full_success
suffix:colon
id|destroy_sock
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|newsock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|do_half_success
suffix:colon
id|destroy_sock
c_func
(paren
id|newsk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|do_connect_err
suffix:colon
id|err
op_assign
id|sock_error
c_func
(paren
id|sk2
)paren
suffix:semicolon
id|do_bad_connection
suffix:colon
id|sk2-&gt;sleep
op_assign
l_int|NULL
suffix:semicolon
id|sk2-&gt;socket
op_assign
l_int|NULL
suffix:semicolon
id|destroy_sock
c_func
(paren
id|sk2
)paren
suffix:semicolon
id|newsock-&gt;sk
op_assign
id|newsk
suffix:semicolon
id|newsk-&gt;socket
op_assign
id|newsock
suffix:semicolon
r_return
id|err
suffix:semicolon
id|do_interrupted
suffix:colon
id|sti
c_func
(paren
)paren
suffix:semicolon
id|sk1-&gt;pair
op_assign
id|sk2
suffix:semicolon
id|sk2-&gt;sleep
op_assign
l_int|NULL
suffix:semicolon
id|sk2-&gt;socket
op_assign
l_int|NULL
suffix:semicolon
id|newsock-&gt;sk
op_assign
id|newsk
suffix:semicolon
id|newsk-&gt;socket
op_assign
id|newsock
suffix:semicolon
id|err
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
id|do_err
suffix:colon
r_return
id|err
suffix:semicolon
id|do_sk1_err
suffix:colon
id|err
op_assign
id|sock_error
c_func
(paren
id|sk1
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This does both peername and sockname.&n; */
DECL|function|inet_getname
r_static
r_int
id|inet_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|uaddr
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|tcp_connected
c_func
(paren
id|sk-&gt;state
)paren
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|sk-&gt;dport
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|sk-&gt;daddr
suffix:semicolon
)brace
r_else
(brace
id|__u32
id|addr
op_assign
id|sk-&gt;rcv_saddr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|addr
)paren
id|addr
op_assign
id|sk-&gt;saddr
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|sk-&gt;sport
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|addr
suffix:semicolon
)brace
op_star
id|uaddr_len
op_assign
r_sizeof
(paren
op_star
id|sin
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inet_recvmsg
r_int
id|inet_recvmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_int
id|flags
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|addr_len
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;flags
op_amp
id|SO_ACCEPTCON
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;recvmsg
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;err
)paren
r_return
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* We may need to bind the socket. */
r_if
c_cond
(paren
id|inet_autobind
c_func
(paren
id|sk
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|err
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|recvmsg
c_func
(paren
id|sk
comma
id|msg
comma
id|size
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
id|flags
op_amp
op_complement
id|MSG_DONTWAIT
comma
op_amp
id|addr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
id|msg-&gt;msg_namelen
op_assign
id|addr_len
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|inet_sendmsg
r_int
id|inet_sendmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;shutdown
op_amp
id|SEND_SHUTDOWN
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|msg-&gt;msg_flags
op_amp
id|MSG_NOSIGNAL
)paren
)paren
id|send_sig
c_func
(paren
id|SIGPIPE
comma
id|current
comma
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EPIPE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;sendmsg
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;err
)paren
(brace
r_return
id|sock_error
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
multiline_comment|/* We may need to bind the socket. */
r_if
c_cond
(paren
id|inet_autobind
c_func
(paren
id|sk
)paren
op_ne
l_int|0
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_return
id|sk-&gt;prot
op_member_access_from_pointer
id|sendmsg
c_func
(paren
id|sk
comma
id|msg
comma
id|size
)paren
suffix:semicolon
)brace
DECL|function|inet_shutdown
r_int
id|inet_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|how
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
multiline_comment|/* This should really check to make sure&n;&t; * the socket is a TCP socket. (WHY AC...)&n;&t; */
id|how
op_increment
suffix:semicolon
multiline_comment|/* maps 0-&gt;1 has the advantage of making bit 1 rcvs and&n;&t;&t;       1-&gt;2 bit 2 snds.&n;&t;&t;       2-&gt;3 */
r_if
c_cond
(paren
(paren
id|how
op_amp
op_complement
id|SHUTDOWN_MASK
)paren
op_logical_or
id|how
op_eq
l_int|0
)paren
multiline_comment|/* MAXINT-&gt;0 */
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTING
op_logical_and
id|sk-&gt;state
op_eq
id|TCP_ESTABLISHED
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
op_logical_or
op_logical_neg
id|tcp_connected
c_func
(paren
id|sk-&gt;state
)paren
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|sk-&gt;shutdown
op_or_assign
id|how
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;shutdown
)paren
id|sk-&gt;prot
op_member_access_from_pointer
id|shutdown
c_func
(paren
id|sk
comma
id|how
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inet_poll
r_int
r_int
id|inet_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;poll
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|sk-&gt;prot
op_member_access_from_pointer
id|poll
c_func
(paren
id|file
comma
id|sock
comma
id|wait
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;ioctl() calls you can issue on an INET socket. Most of these are&n; *&t;device configuration and stuff and very rarely used. Some ioctls&n; *&t;pass on to the socket itself.&n; *&n; *&t;NOTE: I like the idea of a module for the config stuff. ie ifconfig&n; *&t;loads the devconfigure module does its configuring and unloads it.&n; *&t;There&squot;s a good 20K of config code hanging around the kernel.&n; */
DECL|function|inet_ioctl
r_static
r_int
id|inet_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|pid
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FIOSETOWN
suffix:colon
r_case
id|SIOCSPGRP
suffix:colon
id|err
op_assign
id|get_user
c_func
(paren
id|pid
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;pid
op_ne
id|pid
op_logical_and
id|current-&gt;pgrp
op_ne
op_minus
id|pid
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|sk-&gt;proc
op_assign
id|pid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|FIOGETOWN
suffix:colon
r_case
id|SIOCGPGRP
suffix:colon
r_return
id|put_user
c_func
(paren
id|sk-&gt;proc
comma
(paren
r_int
op_star
)paren
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCGSTAMP
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;stamp.tv_sec
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|err
op_assign
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sk-&gt;stamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
suffix:semicolon
r_case
id|SIOCADDRT
suffix:colon
r_case
id|SIOCDELRT
suffix:colon
r_case
id|SIOCRTMSG
suffix:colon
r_return
id|ip_rt_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCDARP
suffix:colon
r_case
id|SIOCGARP
suffix:colon
r_case
id|SIOCSARP
suffix:colon
r_return
id|arp_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCDRARP
suffix:colon
r_case
id|SIOCGRARP
suffix:colon
r_case
id|SIOCSRARP
suffix:colon
macro_line|#ifdef CONFIG_KMOD
r_if
c_cond
(paren
id|rarp_ioctl_hook
op_eq
l_int|NULL
)paren
id|request_module
c_func
(paren
l_string|&quot;rarp&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rarp_ioctl_hook
op_ne
l_int|NULL
)paren
r_return
id|rarp_ioctl_hook
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCGIFADDR
suffix:colon
r_case
id|SIOCSIFADDR
suffix:colon
r_case
id|SIOCGIFBRDADDR
suffix:colon
r_case
id|SIOCSIFBRDADDR
suffix:colon
r_case
id|SIOCGIFNETMASK
suffix:colon
r_case
id|SIOCSIFNETMASK
suffix:colon
r_case
id|SIOCGIFDSTADDR
suffix:colon
r_case
id|SIOCSIFDSTADDR
suffix:colon
r_case
id|SIOCSIFPFLAGS
suffix:colon
r_case
id|SIOCGIFPFLAGS
suffix:colon
r_case
id|SIOCSIFFLAGS
suffix:colon
r_return
id|devinet_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_case
id|SIOCGIFBR
suffix:colon
r_case
id|SIOCSIFBR
suffix:colon
macro_line|#ifdef CONFIG_BRIDGE&t;&t;
r_return
id|br_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#else
r_return
op_minus
id|ENOPKG
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;&t;&t;
r_case
id|SIOCADDDLCI
suffix:colon
r_case
id|SIOCDELDLCI
suffix:colon
macro_line|#ifdef CONFIG_DLCI
r_return
id|dlci_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_DLCI_MODULE
macro_line|#ifdef CONFIG_KMOD
r_if
c_cond
(paren
id|dlci_ioctl_hook
op_eq
l_int|NULL
)paren
id|request_module
c_func
(paren
l_string|&quot;dlci&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dlci_ioctl_hook
)paren
r_return
(paren
op_star
id|dlci_ioctl_hook
)paren
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENOPKG
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|cmd
op_ge
id|SIOCDEVPRIVATE
)paren
op_logical_and
(paren
id|cmd
op_le
(paren
id|SIOCDEVPRIVATE
op_plus
l_int|15
)paren
)paren
)paren
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NET_RADIO
r_if
c_cond
(paren
(paren
id|cmd
op_ge
id|SIOCIWFIRST
)paren
op_logical_and
(paren
id|cmd
op_le
id|SIOCIWLAST
)paren
)paren
(brace
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|sk-&gt;prot-&gt;ioctl
op_eq
l_int|NULL
op_logical_or
(paren
id|err
op_assign
id|sk-&gt;prot
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|sk
comma
id|cmd
comma
id|arg
)paren
)paren
op_eq
op_minus
id|ENOIOCTLCMD
)paren
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*NOTREACHED*/
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|inet_stream_ops
r_struct
id|proto_ops
id|inet_stream_ops
op_assign
(brace
id|PF_INET
comma
id|sock_no_dup
comma
id|inet_release
comma
id|inet_bind
comma
id|inet_stream_connect
comma
id|sock_no_socketpair
comma
id|inet_accept
comma
id|inet_getname
comma
id|inet_poll
comma
id|inet_ioctl
comma
id|inet_listen
comma
id|inet_shutdown
comma
id|inet_setsockopt
comma
id|inet_getsockopt
comma
id|sock_no_fcntl
comma
id|inet_sendmsg
comma
id|inet_recvmsg
)brace
suffix:semicolon
DECL|variable|inet_dgram_ops
r_struct
id|proto_ops
id|inet_dgram_ops
op_assign
(brace
id|PF_INET
comma
id|sock_no_dup
comma
id|inet_release
comma
id|inet_bind
comma
id|inet_dgram_connect
comma
id|sock_no_socketpair
comma
id|sock_no_accept
comma
id|inet_getname
comma
id|datagram_poll
comma
id|inet_ioctl
comma
id|sock_no_listen
comma
id|inet_shutdown
comma
id|inet_setsockopt
comma
id|inet_getsockopt
comma
id|sock_no_fcntl
comma
id|inet_sendmsg
comma
id|inet_recvmsg
)brace
suffix:semicolon
DECL|variable|inet_family_ops
r_struct
id|net_proto_family
id|inet_family_ops
op_assign
(brace
id|PF_INET
comma
id|inet_create
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#ifdef CONFIG_INET_RARP
DECL|variable|proc_net_rarp
r_static
r_struct
id|proc_dir_entry
id|proc_net_rarp
op_assign
(brace
id|PROC_NET_RARP
comma
l_int|4
comma
l_string|&quot;rarp&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|rarp_get_info
)brace
suffix:semicolon
macro_line|#endif&t;&t;/* RARP */
DECL|variable|proc_net_raw
r_static
r_struct
id|proc_dir_entry
id|proc_net_raw
op_assign
(brace
id|PROC_NET_RAW
comma
l_int|3
comma
l_string|&quot;raw&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|raw_get_info
)brace
suffix:semicolon
DECL|variable|proc_net_netstat
r_static
r_struct
id|proc_dir_entry
id|proc_net_netstat
op_assign
(brace
id|PROC_NET_NETSTAT
comma
l_int|7
comma
l_string|&quot;netstat&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|netstat_get_info
)brace
suffix:semicolon
DECL|variable|proc_net_snmp
r_static
r_struct
id|proc_dir_entry
id|proc_net_snmp
op_assign
(brace
id|PROC_NET_SNMP
comma
l_int|4
comma
l_string|&quot;snmp&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|snmp_get_info
)brace
suffix:semicolon
DECL|variable|proc_net_sockstat
r_static
r_struct
id|proc_dir_entry
id|proc_net_sockstat
op_assign
(brace
id|PROC_NET_SOCKSTAT
comma
l_int|8
comma
l_string|&quot;sockstat&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|afinet_get_info
)brace
suffix:semicolon
DECL|variable|proc_net_tcp
r_static
r_struct
id|proc_dir_entry
id|proc_net_tcp
op_assign
(brace
id|PROC_NET_TCP
comma
l_int|3
comma
l_string|&quot;tcp&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|tcp_get_info
)brace
suffix:semicolon
DECL|variable|proc_net_udp
r_static
r_struct
id|proc_dir_entry
id|proc_net_udp
op_assign
(brace
id|PROC_NET_UDP
comma
l_int|3
comma
l_string|&quot;udp&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_amp
id|proc_net_inode_operations
comma
id|udp_get_info
)brace
suffix:semicolon
macro_line|#endif&t;&t;/* CONFIG_PROC_FS */
r_extern
r_void
id|tcp_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|tcp_v4_init
c_func
(paren
r_struct
id|net_proto_family
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;Called by socket.c on kernel startup.  &n; */
DECL|function|__initfunc
id|__initfunc
c_func
(paren
r_void
id|inet_proto_init
c_func
(paren
r_struct
id|net_proto
op_star
id|pro
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|dummy_skb
suffix:semicolon
r_struct
id|inet_protocol
op_star
id|p
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Swansea University Computer Society TCP/IP for NET3.037&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|inet_skb_parm
)paren
OG
r_sizeof
(paren
id|dummy_skb-&gt;cb
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;inet_proto_init: panic&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Tell SOCKET that we are alive... &n;&t; */
(paren
r_void
)paren
id|sock_register
c_func
(paren
op_amp
id|inet_family_ops
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Add all the protocols. &n;&t; */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;IP Protocols: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|inet_protocol_base
suffix:semicolon
id|p
op_ne
l_int|NULL
suffix:semicolon
)paren
(brace
r_struct
id|inet_protocol
op_star
id|tmp
op_assign
(paren
r_struct
id|inet_protocol
op_star
)paren
id|p-&gt;next
suffix:semicolon
id|inet_add_protocol
c_func
(paren
id|p
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s%s&quot;
comma
id|p-&gt;name
comma
id|tmp
ques
c_cond
l_string|&quot;, &quot;
suffix:colon
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|p
op_assign
id|tmp
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Set the ARP module up&n;&t; */
id|arp_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;  &t; *&t;Set the IP module up&n;  &t; */
id|ip_init
c_func
(paren
)paren
suffix:semicolon
id|tcp_v4_init
c_func
(paren
op_amp
id|inet_family_ops
)paren
suffix:semicolon
multiline_comment|/* Setup TCP slab cache for open requests. */
id|tcp_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Set the ICMP layer up&n;&t; */
id|icmp_init
c_func
(paren
op_amp
id|inet_family_ops
)paren
suffix:semicolon
multiline_comment|/* I wish inet_add_protocol had no constructor hook...&n;&t;   I had to move IPIP from net/ipv4/protocol.c :-( --ANK&n;&t; */
macro_line|#ifdef CONFIG_NET_IPIP
id|ipip_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NET_IPGRE
id|ipgre_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *&t;Set the firewalling up&n;&t; */
macro_line|#if defined(CONFIG_IP_ACCT)||defined(CONFIG_IP_FIREWALL)
id|ip_fw_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_IP_MASQUERADE
id|ip_masq_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *&t;Initialise the multicast router&n;&t; */
macro_line|#if defined(CONFIG_IP_MROUTE)
id|ip_mr_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_INET_RARP
id|rarp_ioctl_hook
op_assign
id|rarp_ioctl
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *&t;Create all the /proc entries.&n;&t; */
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#ifdef CONFIG_INET_RARP
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_rarp
)paren
suffix:semicolon
macro_line|#endif&t;&t;/* RARP */
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_raw
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_snmp
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_netstat
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_sockstat
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_tcp
)paren
suffix:semicolon
id|proc_net_register
c_func
(paren
op_amp
id|proc_net_udp
)paren
suffix:semicolon
macro_line|#endif&t;&t;/* CONFIG_PROC_FS */
)brace
eof
