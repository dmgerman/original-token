multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;IPv4 FIB: lookup engine and maintenance routines.&n; *&n; * Version:&t;$Id: fib_hash.c,v 1.12 1999/08/31 07:03:27 davem Exp $&n; *&n; * Authors:&t;Alexey Kuznetsov, &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/ip_fib.h&gt;
DECL|macro|FTprint
mdefine_line|#define FTprint(a...)
multiline_comment|/*&n;   printk(KERN_DEBUG a)&n; */
DECL|variable|fn_hash_kmem
r_static
id|kmem_cache_t
op_star
id|fn_hash_kmem
suffix:semicolon
multiline_comment|/*&n;   These bizarre types are just to force strict type checking.&n;   When I reversed order of bytes and changed to natural mask lengths,&n;   I forgot to make fixes in several places. Now I am lazy to return&n;   it back.&n; */
r_typedef
r_struct
(brace
DECL|member|datum
id|u32
id|datum
suffix:semicolon
DECL|typedef|fn_key_t
)brace
id|fn_key_t
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|datum
id|u32
id|datum
suffix:semicolon
DECL|typedef|fn_hash_idx_t
)brace
id|fn_hash_idx_t
suffix:semicolon
DECL|struct|fib_node
r_struct
id|fib_node
(brace
DECL|member|fn_next
r_struct
id|fib_node
op_star
id|fn_next
suffix:semicolon
DECL|member|fn_info
r_struct
id|fib_info
op_star
id|fn_info
suffix:semicolon
DECL|macro|FIB_INFO
mdefine_line|#define FIB_INFO(f)&t;((f)-&gt;fn_info)
DECL|member|fn_key
id|fn_key_t
id|fn_key
suffix:semicolon
DECL|member|fn_tos
id|u8
id|fn_tos
suffix:semicolon
DECL|member|fn_type
id|u8
id|fn_type
suffix:semicolon
DECL|member|fn_scope
id|u8
id|fn_scope
suffix:semicolon
DECL|member|fn_state
id|u8
id|fn_state
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|FN_S_ZOMBIE
mdefine_line|#define FN_S_ZOMBIE&t;1
DECL|macro|FN_S_ACCESSED
mdefine_line|#define FN_S_ACCESSED&t;2
DECL|variable|fib_hash_zombies
r_static
r_int
id|fib_hash_zombies
suffix:semicolon
DECL|struct|fn_zone
r_struct
id|fn_zone
(brace
DECL|member|fz_next
r_struct
id|fn_zone
op_star
id|fz_next
suffix:semicolon
multiline_comment|/* Next not empty zone&t;*/
DECL|member|fz_hash
r_struct
id|fib_node
op_star
op_star
id|fz_hash
suffix:semicolon
multiline_comment|/* Hash table pointer&t;*/
DECL|member|fz_nent
r_int
id|fz_nent
suffix:semicolon
multiline_comment|/* Number of entries&t;*/
DECL|member|fz_divisor
r_int
id|fz_divisor
suffix:semicolon
multiline_comment|/* Hash divisor&t;&t;*/
DECL|member|fz_hashmask
id|u32
id|fz_hashmask
suffix:semicolon
multiline_comment|/* (1&lt;&lt;fz_divisor) - 1&t;*/
DECL|macro|FZ_HASHMASK
mdefine_line|#define FZ_HASHMASK(fz)&t;((fz)-&gt;fz_hashmask)
DECL|member|fz_order
r_int
id|fz_order
suffix:semicolon
multiline_comment|/* Zone order&t;&t;*/
DECL|member|fz_mask
id|u32
id|fz_mask
suffix:semicolon
DECL|macro|FZ_MASK
mdefine_line|#define FZ_MASK(fz)&t;((fz)-&gt;fz_mask)
)brace
suffix:semicolon
multiline_comment|/* NOTE. On fast computers evaluation of fz_hashmask and fz_mask&n;   can be cheaper than memory lookup, so that FZ_* macros are used.&n; */
DECL|struct|fn_hash
r_struct
id|fn_hash
(brace
DECL|member|fn_zones
r_struct
id|fn_zone
op_star
id|fn_zones
(braket
l_int|33
)braket
suffix:semicolon
DECL|member|fn_zone_list
r_struct
id|fn_zone
op_star
id|fn_zone_list
suffix:semicolon
)brace
suffix:semicolon
DECL|function|fn_hash
r_static
id|__inline__
id|fn_hash_idx_t
id|fn_hash
c_func
(paren
id|fn_key_t
id|key
comma
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
id|u32
id|h
op_assign
id|ntohl
c_func
(paren
id|key.datum
)paren
op_rshift
(paren
l_int|32
op_minus
id|fz-&gt;fz_order
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|20
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|10
)paren
suffix:semicolon
id|h
op_xor_assign
(paren
id|h
op_rshift
l_int|5
)paren
suffix:semicolon
id|h
op_and_assign
id|FZ_HASHMASK
c_func
(paren
id|fz
)paren
suffix:semicolon
r_return
op_star
(paren
id|fn_hash_idx_t
op_star
)paren
op_amp
id|h
suffix:semicolon
)brace
DECL|macro|fz_key_0
mdefine_line|#define fz_key_0(key)&t;&t;((key).datum = 0)
DECL|macro|fz_prefix
mdefine_line|#define fz_prefix(key,fz)&t;((key).datum)
DECL|function|fz_key
r_static
id|__inline__
id|fn_key_t
id|fz_key
c_func
(paren
id|u32
id|dst
comma
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
id|fn_key_t
id|k
suffix:semicolon
id|k.datum
op_assign
id|dst
op_amp
id|FZ_MASK
c_func
(paren
id|fz
)paren
suffix:semicolon
r_return
id|k
suffix:semicolon
)brace
DECL|function|fz_chain_p
r_static
id|__inline__
r_struct
id|fib_node
op_star
op_star
id|fz_chain_p
c_func
(paren
id|fn_key_t
id|key
comma
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
r_return
op_amp
id|fz-&gt;fz_hash
(braket
id|fn_hash
c_func
(paren
id|key
comma
id|fz
)paren
dot
id|datum
)braket
suffix:semicolon
)brace
DECL|function|fz_chain
r_static
id|__inline__
r_struct
id|fib_node
op_star
id|fz_chain
c_func
(paren
id|fn_key_t
id|key
comma
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
r_return
id|fz-&gt;fz_hash
(braket
id|fn_hash
c_func
(paren
id|key
comma
id|fz
)paren
dot
id|datum
)braket
suffix:semicolon
)brace
DECL|function|fn_key_eq
r_extern
id|__inline__
r_int
id|fn_key_eq
c_func
(paren
id|fn_key_t
id|a
comma
id|fn_key_t
id|b
)paren
(brace
r_return
id|a.datum
op_eq
id|b.datum
suffix:semicolon
)brace
DECL|function|fn_key_leq
r_extern
id|__inline__
r_int
id|fn_key_leq
c_func
(paren
id|fn_key_t
id|a
comma
id|fn_key_t
id|b
)paren
(brace
r_return
id|a.datum
op_le
id|b.datum
suffix:semicolon
)brace
DECL|variable|fib_hash_lock
r_static
id|rwlock_t
id|fib_hash_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|macro|FZ_MAX_DIVISOR
mdefine_line|#define FZ_MAX_DIVISOR 1024
macro_line|#ifdef CONFIG_IP_ROUTE_LARGE_TABLES
multiline_comment|/* The fib hash lock must be held when this is called. */
DECL|function|fn_rebuild_zone
r_static
id|__inline__
r_void
id|fn_rebuild_zone
c_func
(paren
r_struct
id|fn_zone
op_star
id|fz
comma
r_struct
id|fib_node
op_star
op_star
id|old_ht
comma
r_int
id|old_divisor
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
comma
op_star
op_star
id|fp
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|old_divisor
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|f
op_assign
id|old_ht
(braket
id|i
)braket
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|next
)paren
(brace
id|next
op_assign
id|f-&gt;fn_next
suffix:semicolon
r_for
c_loop
(paren
id|fp
op_assign
id|fz_chain_p
c_func
(paren
id|f-&gt;fn_key
comma
id|fz
)paren
suffix:semicolon
op_star
id|fp
op_logical_and
id|fn_key_leq
c_func
(paren
(paren
op_star
id|fp
)paren
op_member_access_from_pointer
id|fn_key
comma
id|f-&gt;fn_key
)paren
suffix:semicolon
id|fp
op_assign
op_amp
(paren
op_star
id|fp
)paren
op_member_access_from_pointer
id|fn_next
)paren
multiline_comment|/* NONE */
suffix:semicolon
id|f-&gt;fn_next
op_assign
op_star
id|fp
suffix:semicolon
op_star
id|fp
op_assign
id|f
suffix:semicolon
)brace
)brace
)brace
DECL|function|fn_rehash_zone
r_static
r_void
id|fn_rehash_zone
c_func
(paren
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
r_struct
id|fib_node
op_star
op_star
id|ht
comma
op_star
op_star
id|old_ht
suffix:semicolon
r_int
id|old_divisor
comma
id|new_divisor
suffix:semicolon
id|u32
id|new_hashmask
suffix:semicolon
id|old_divisor
op_assign
id|fz-&gt;fz_divisor
suffix:semicolon
r_switch
c_cond
(paren
id|old_divisor
)paren
(brace
r_case
l_int|16
suffix:colon
id|new_divisor
op_assign
l_int|256
suffix:semicolon
id|new_hashmask
op_assign
l_int|0xFF
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|256
suffix:colon
id|new_divisor
op_assign
l_int|1024
suffix:semicolon
id|new_hashmask
op_assign
l_int|0x3FF
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;route.c: bad divisor %d!&bslash;n&quot;
comma
id|old_divisor
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if RT_CACHE_DEBUG &gt;= 2
id|printk
c_func
(paren
l_string|&quot;fn_rehash_zone: hash for zone %d grows from %d&bslash;n&quot;
comma
id|fz-&gt;fz_order
comma
id|old_divisor
)paren
suffix:semicolon
macro_line|#endif
id|ht
op_assign
id|kmalloc
c_func
(paren
id|new_divisor
op_star
r_sizeof
(paren
r_struct
id|fib_node
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ht
)paren
(brace
id|memset
c_func
(paren
id|ht
comma
l_int|0
comma
id|new_divisor
op_star
r_sizeof
(paren
r_struct
id|fib_node
op_star
)paren
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|old_ht
op_assign
id|fz-&gt;fz_hash
suffix:semicolon
id|fz-&gt;fz_hash
op_assign
id|ht
suffix:semicolon
id|fz-&gt;fz_hashmask
op_assign
id|new_hashmask
suffix:semicolon
id|fz-&gt;fz_divisor
op_assign
id|new_divisor
suffix:semicolon
id|fn_rebuild_zone
c_func
(paren
id|fz
comma
id|old_ht
comma
id|old_divisor
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|old_ht
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_IP_ROUTE_LARGE_TABLES */
DECL|function|fn_free_node
r_static
r_void
id|fn_free_node
c_func
(paren
r_struct
id|fib_node
op_star
id|f
)paren
(brace
id|fib_release_info
c_func
(paren
id|FIB_INFO
c_func
(paren
id|f
)paren
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|fn_hash_kmem
comma
id|f
)paren
suffix:semicolon
)brace
r_static
r_struct
id|fn_zone
op_star
DECL|function|fn_new_zone
id|fn_new_zone
c_func
(paren
r_struct
id|fn_hash
op_star
id|table
comma
r_int
id|z
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fn_zone
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|fz
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fn_zone
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z
)paren
(brace
id|fz-&gt;fz_divisor
op_assign
l_int|16
suffix:semicolon
id|fz-&gt;fz_hashmask
op_assign
l_int|0xF
suffix:semicolon
)brace
r_else
(brace
id|fz-&gt;fz_divisor
op_assign
l_int|1
suffix:semicolon
id|fz-&gt;fz_hashmask
op_assign
l_int|0
suffix:semicolon
)brace
id|fz-&gt;fz_hash
op_assign
id|kmalloc
c_func
(paren
id|fz-&gt;fz_divisor
op_star
r_sizeof
(paren
r_struct
id|fib_node
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz-&gt;fz_hash
)paren
(brace
id|kfree
c_func
(paren
id|fz
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|fz-&gt;fz_hash
comma
l_int|0
comma
id|fz-&gt;fz_divisor
op_star
r_sizeof
(paren
r_struct
id|fib_node
op_star
)paren
)paren
suffix:semicolon
id|fz-&gt;fz_order
op_assign
id|z
suffix:semicolon
id|fz-&gt;fz_mask
op_assign
id|inet_make_mask
c_func
(paren
id|z
)paren
suffix:semicolon
multiline_comment|/* Find the first not empty zone with more specific mask */
r_for
c_loop
(paren
id|i
op_assign
id|z
op_plus
l_int|1
suffix:semicolon
id|i
op_le
l_int|32
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|table-&gt;fn_zones
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|32
)paren
(brace
multiline_comment|/* No more specific masks, we are the first. */
id|fz-&gt;fz_next
op_assign
id|table-&gt;fn_zone_list
suffix:semicolon
id|table-&gt;fn_zone_list
op_assign
id|fz
suffix:semicolon
)brace
r_else
(brace
id|fz-&gt;fz_next
op_assign
id|table-&gt;fn_zones
(braket
id|i
)braket
op_member_access_from_pointer
id|fz_next
suffix:semicolon
id|table-&gt;fn_zones
(braket
id|i
)braket
op_member_access_from_pointer
id|fz_next
op_assign
id|fz
suffix:semicolon
)brace
id|table-&gt;fn_zones
(braket
id|z
)braket
op_assign
id|fz
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_return
id|fz
suffix:semicolon
)brace
r_static
r_int
DECL|function|fn_hash_lookup
id|fn_hash_lookup
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_const
r_struct
id|rt_key
op_star
id|key
comma
r_struct
id|fib_result
op_star
id|res
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fn_hash
op_star
id|t
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|t-&gt;fn_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
id|fn_key_t
id|k
op_assign
id|fz_key
c_func
(paren
id|key-&gt;dst
comma
id|fz
)paren
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
id|fz_chain
c_func
(paren
id|k
comma
id|fz
)paren
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fn_next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fn_key_eq
c_func
(paren
id|k
comma
id|f-&gt;fn_key
)paren
)paren
(brace
r_if
c_cond
(paren
id|fn_key_leq
c_func
(paren
id|k
comma
id|f-&gt;fn_key
)paren
)paren
r_break
suffix:semicolon
r_else
r_continue
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_ROUTE_TOS
r_if
c_cond
(paren
id|f-&gt;fn_tos
op_logical_and
id|f-&gt;fn_tos
op_ne
id|key-&gt;tos
)paren
r_continue
suffix:semicolon
macro_line|#endif
id|f-&gt;fn_state
op_or_assign
id|FN_S_ACCESSED
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_scope
OL
id|key-&gt;scope
)paren
r_continue
suffix:semicolon
id|err
op_assign
id|fib_semantic_match
c_func
(paren
id|f-&gt;fn_type
comma
id|FIB_INFO
c_func
(paren
id|f
)paren
comma
id|key
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
(brace
id|res-&gt;type
op_assign
id|f-&gt;fn_type
suffix:semicolon
id|res-&gt;scope
op_assign
id|f-&gt;fn_scope
suffix:semicolon
id|res-&gt;prefixlen
op_assign
id|fz-&gt;fz_order
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
)brace
id|err
op_assign
l_int|1
suffix:semicolon
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|fn_hash_last_dflt
r_static
r_int
id|fn_hash_last_dflt
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|function|fib_detect_death
r_static
r_int
id|fib_detect_death
c_func
(paren
r_struct
id|fib_info
op_star
id|fi
comma
r_int
id|order
comma
r_struct
id|fib_info
op_star
op_star
id|last_resort
comma
r_int
op_star
id|last_idx
)paren
(brace
r_struct
id|neighbour
op_star
id|n
suffix:semicolon
r_int
id|state
op_assign
id|NUD_NONE
suffix:semicolon
id|n
op_assign
id|neigh_lookup
c_func
(paren
op_amp
id|arp_tbl
comma
op_amp
id|fi-&gt;fib_nh
(braket
l_int|0
)braket
dot
id|nh_gw
comma
id|fi-&gt;fib_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
)paren
(brace
id|state
op_assign
id|n-&gt;nud_state
suffix:semicolon
id|neigh_release
c_func
(paren
id|n
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state
op_eq
id|NUD_REACHABLE
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|state
op_amp
id|NUD_VALID
)paren
op_logical_and
id|order
op_ne
id|fn_hash_last_dflt
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|state
op_amp
id|NUD_VALID
)paren
op_logical_or
(paren
op_star
id|last_idx
id|fn_hash_last_dflt
)paren
)paren
(brace
op_star
id|last_resort
op_assign
id|fi
suffix:semicolon
op_star
id|last_idx
op_assign
id|order
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|fn_hash_select_default
id|fn_hash_select_default
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_const
r_struct
id|rt_key
op_star
id|key
comma
r_struct
id|fib_result
op_star
id|res
)paren
(brace
r_int
id|order
comma
id|last_idx
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|fib_info
op_star
id|last_resort
suffix:semicolon
r_struct
id|fn_hash
op_star
id|t
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
op_assign
id|t-&gt;fn_zones
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fz
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|last_idx
op_assign
op_minus
l_int|1
suffix:semicolon
id|last_resort
op_assign
l_int|NULL
suffix:semicolon
id|order
op_assign
op_minus
l_int|1
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|f
op_assign
id|fz-&gt;fz_hash
(braket
l_int|0
)braket
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fn_next
)paren
(brace
r_struct
id|fib_info
op_star
id|next_fi
op_assign
id|FIB_INFO
c_func
(paren
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
)paren
op_logical_or
id|f-&gt;fn_scope
op_ne
id|res-&gt;scope
op_logical_or
id|f-&gt;fn_type
op_ne
id|RTN_UNICAST
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|next_fi-&gt;fib_priority
OG
id|res-&gt;fi-&gt;fib_priority
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|next_fi-&gt;fib_nh
(braket
l_int|0
)braket
dot
id|nh_gw
op_logical_or
id|next_fi-&gt;fib_nh
(braket
l_int|0
)braket
dot
id|nh_scope
op_ne
id|RT_SCOPE_LINK
)paren
r_continue
suffix:semicolon
id|f-&gt;fn_state
op_or_assign
id|FN_S_ACCESSED
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|next_fi
op_ne
id|res-&gt;fi
)paren
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|fib_detect_death
c_func
(paren
id|fi
comma
id|order
comma
op_amp
id|last_resort
comma
op_amp
id|last_idx
)paren
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;fi
)paren
id|fib_info_put
c_func
(paren
id|res-&gt;fi
)paren
suffix:semicolon
id|res-&gt;fi
op_assign
id|fi
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|fi-&gt;fib_clntref
)paren
suffix:semicolon
id|fn_hash_last_dflt
op_assign
id|order
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|fi
op_assign
id|next_fi
suffix:semicolon
id|order
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|order
op_le
l_int|0
op_logical_or
id|fi
op_eq
l_int|NULL
)paren
(brace
id|fn_hash_last_dflt
op_assign
op_minus
l_int|1
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|fib_detect_death
c_func
(paren
id|fi
comma
id|order
comma
op_amp
id|last_resort
comma
op_amp
id|last_idx
)paren
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;fi
)paren
id|fib_info_put
c_func
(paren
id|res-&gt;fi
)paren
suffix:semicolon
id|res-&gt;fi
op_assign
id|fi
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|fi-&gt;fib_clntref
)paren
suffix:semicolon
id|fn_hash_last_dflt
op_assign
id|order
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|last_idx
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;fi
)paren
id|fib_info_put
c_func
(paren
id|res-&gt;fi
)paren
suffix:semicolon
id|res-&gt;fi
op_assign
id|last_resort
suffix:semicolon
r_if
c_cond
(paren
id|last_resort
)paren
id|atomic_inc
c_func
(paren
op_amp
id|last_resort-&gt;fib_clntref
)paren
suffix:semicolon
)brace
id|fn_hash_last_dflt
op_assign
id|last_idx
suffix:semicolon
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
)brace
DECL|macro|FIB_SCAN
mdefine_line|#define FIB_SCAN(f, fp) &bslash;&n;for ( ; ((f) = *(fp)) != NULL; (fp) = &amp;(f)-&gt;fn_next)
DECL|macro|FIB_SCAN_KEY
mdefine_line|#define FIB_SCAN_KEY(f, fp, key) &bslash;&n;for ( ; ((f) = *(fp)) != NULL &amp;&amp; fn_key_eq((f)-&gt;fn_key, (key)); (fp) = &amp;(f)-&gt;fn_next)
macro_line|#ifndef CONFIG_IP_ROUTE_TOS
DECL|macro|FIB_SCAN_TOS
mdefine_line|#define FIB_SCAN_TOS(f, fp, key, tos) FIB_SCAN_KEY(f, fp, key)
macro_line|#else
DECL|macro|FIB_SCAN_TOS
mdefine_line|#define FIB_SCAN_TOS(f, fp, key, tos) &bslash;&n;for ( ; ((f) = *(fp)) != NULL &amp;&amp; fn_key_eq((f)-&gt;fn_key, (key)) &amp;&amp; &bslash;&n;     (f)-&gt;fn_tos == (tos) ; (fp) = &amp;(f)-&gt;fn_next)
macro_line|#endif
macro_line|#ifdef CONFIG_RTNETLINK
r_static
r_void
id|rtmsg_fib
c_func
(paren
r_int
comma
r_struct
id|fib_node
op_star
comma
r_int
comma
r_int
comma
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|netlink_skb_parms
op_star
)paren
suffix:semicolon
macro_line|#else
DECL|macro|rtmsg_fib
mdefine_line|#define rtmsg_fib(a, b, c, d, e, f)
macro_line|#endif
r_static
r_int
DECL|function|fn_hash_insert
id|fn_hash_insert
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|kern_rta
op_star
id|rta
comma
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|netlink_skb_parms
op_star
id|req
)paren
(brace
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fib_node
op_star
id|new_f
comma
op_star
id|f
comma
op_star
op_star
id|fp
comma
op_star
op_star
id|del_fp
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fib_info
op_star
id|fi
suffix:semicolon
r_int
id|z
op_assign
id|r-&gt;rtm_dst_len
suffix:semicolon
r_int
id|type
op_assign
id|r-&gt;rtm_type
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_TOS
id|u8
id|tos
op_assign
id|r-&gt;rtm_tos
suffix:semicolon
macro_line|#endif
id|fn_key_t
id|key
suffix:semicolon
r_int
id|err
suffix:semicolon
id|FTprint
c_func
(paren
l_string|&quot;tb(%d)_insert: %d %08x/%d %d %08x&bslash;n&quot;
comma
id|tb-&gt;tb_id
comma
id|r-&gt;rtm_type
comma
id|rta-&gt;rta_dst
ques
c_cond
op_star
(paren
id|u32
op_star
)paren
id|rta-&gt;rta_dst
suffix:colon
l_int|0
comma
id|z
comma
id|rta-&gt;rta_oif
ques
c_cond
op_star
id|rta-&gt;rta_oif
suffix:colon
op_minus
l_int|1
comma
id|rta-&gt;rta_prefsrc
ques
c_cond
op_star
(paren
id|u32
op_star
)paren
id|rta-&gt;rta_prefsrc
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z
OG
l_int|32
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|fz
op_assign
id|table-&gt;fn_zones
(braket
id|z
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fz
op_logical_and
op_logical_neg
(paren
id|fz
op_assign
id|fn_new_zone
c_func
(paren
id|table
comma
id|z
)paren
)paren
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|fz_key_0
c_func
(paren
id|key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_dst
)paren
(brace
id|u32
id|dst
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|rta-&gt;rta_dst
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_amp
op_complement
id|FZ_MASK
c_func
(paren
id|fz
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|key
op_assign
id|fz_key
c_func
(paren
id|dst
comma
id|fz
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fi
op_assign
id|fib_create_info
c_func
(paren
id|r
comma
id|rta
comma
id|n
comma
op_amp
id|err
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_LARGE_TABLES
r_if
c_cond
(paren
id|fz-&gt;fz_nent
OG
(paren
id|fz-&gt;fz_divisor
op_lshift
l_int|2
)paren
op_logical_and
id|fz-&gt;fz_divisor
OL
id|FZ_MAX_DIVISOR
op_logical_and
(paren
id|z
op_eq
l_int|32
op_logical_or
(paren
l_int|1
op_lshift
id|z
)paren
OG
id|fz-&gt;fz_divisor
)paren
)paren
id|fn_rehash_zone
c_func
(paren
id|fz
)paren
suffix:semicolon
macro_line|#endif
id|fp
op_assign
id|fz_chain_p
c_func
(paren
id|key
comma
id|fz
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Scan list to find the first route with the same destination&n;&t; */
id|FIB_SCAN
c_func
(paren
id|f
comma
id|fp
)paren
(brace
r_if
c_cond
(paren
id|fn_key_leq
c_func
(paren
id|key
comma
id|f-&gt;fn_key
)paren
)paren
r_break
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_ROUTE_TOS
multiline_comment|/*&n;&t; * Find route with the same destination and tos.&n;&t; */
id|FIB_SCAN_KEY
c_func
(paren
id|f
comma
id|fp
comma
id|key
)paren
(brace
r_if
c_cond
(paren
id|f-&gt;fn_tos
op_le
id|tos
)paren
r_break
suffix:semicolon
)brace
macro_line|#endif
id|del_fp
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|f
op_logical_and
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
)paren
op_logical_and
macro_line|#ifdef CONFIG_IP_ROUTE_TOS
id|f-&gt;fn_tos
op_eq
id|tos
op_logical_and
macro_line|#endif
id|fn_key_eq
c_func
(paren
id|f-&gt;fn_key
comma
id|key
)paren
)paren
(brace
id|del_fp
op_assign
id|fp
suffix:semicolon
id|fp
op_assign
op_amp
id|f-&gt;fn_next
suffix:semicolon
id|f
op_assign
op_star
id|fp
suffix:semicolon
r_goto
id|create
suffix:semicolon
)brace
id|FIB_SCAN_TOS
c_func
(paren
id|f
comma
id|fp
comma
id|key
comma
id|tos
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_priority
op_le
id|FIB_INFO
c_func
(paren
id|f
)paren
op_member_access_from_pointer
id|fib_priority
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* Now f==*fp points to the first node with the same&n;&t;   keys [prefix,tos,priority], if such key already&n;&t;   exists or to the node, before which we will insert new one.&n;&t; */
r_if
c_cond
(paren
id|f
op_logical_and
macro_line|#ifdef CONFIG_IP_ROUTE_TOS
id|f-&gt;fn_tos
op_eq
id|tos
op_logical_and
macro_line|#endif
id|fn_key_eq
c_func
(paren
id|f-&gt;fn_key
comma
id|key
)paren
op_logical_and
id|fi-&gt;fib_priority
op_eq
id|FIB_INFO
c_func
(paren
id|f
)paren
op_member_access_from_pointer
id|fib_priority
)paren
(brace
r_struct
id|fib_node
op_star
op_star
id|ins_fp
suffix:semicolon
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_if
c_cond
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_EXCL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_REPLACE
)paren
(brace
id|del_fp
op_assign
id|fp
suffix:semicolon
id|fp
op_assign
op_amp
id|f-&gt;fn_next
suffix:semicolon
id|f
op_assign
op_star
id|fp
suffix:semicolon
r_goto
id|replace
suffix:semicolon
)brace
id|ins_fp
op_assign
id|fp
suffix:semicolon
id|err
op_assign
op_minus
id|EEXIST
suffix:semicolon
id|FIB_SCAN_TOS
c_func
(paren
id|f
comma
id|fp
comma
id|key
comma
id|tos
)paren
(brace
r_if
c_cond
(paren
id|fi-&gt;fib_priority
op_ne
id|FIB_INFO
c_func
(paren
id|f
)paren
op_member_access_from_pointer
id|fib_priority
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_type
op_eq
id|type
op_logical_and
id|f-&gt;fn_scope
op_eq
id|r-&gt;rtm_scope
op_logical_and
id|FIB_INFO
c_func
(paren
id|f
)paren
op_eq
id|fi
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_APPEND
)paren
)paren
(brace
id|fp
op_assign
id|ins_fp
suffix:semicolon
id|f
op_assign
op_star
id|fp
suffix:semicolon
)brace
)brace
id|create
suffix:colon
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_CREATE
)paren
)paren
r_goto
id|out
suffix:semicolon
id|replace
suffix:colon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|new_f
op_assign
id|kmem_cache_alloc
c_func
(paren
id|fn_hash_kmem
comma
id|SLAB_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_f
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|new_f
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fib_node
)paren
)paren
suffix:semicolon
id|new_f-&gt;fn_key
op_assign
id|key
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_TOS
id|new_f-&gt;fn_tos
op_assign
id|tos
suffix:semicolon
macro_line|#endif
id|new_f-&gt;fn_type
op_assign
id|type
suffix:semicolon
id|new_f-&gt;fn_scope
op_assign
id|r-&gt;rtm_scope
suffix:semicolon
id|FIB_INFO
c_func
(paren
id|new_f
)paren
op_assign
id|fi
suffix:semicolon
multiline_comment|/*&n;&t; * Insert new entry to the list.&n;&t; */
id|new_f-&gt;fn_next
op_assign
id|f
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
op_star
id|fp
op_assign
id|new_f
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|del_fp
)paren
(brace
id|f
op_assign
op_star
id|del_fp
suffix:semicolon
multiline_comment|/* Unlink replaced node */
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
op_star
id|del_fp
op_assign
id|f-&gt;fn_next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
)paren
)paren
id|rtmsg_fib
c_func
(paren
id|RTM_DELROUTE
comma
id|f
comma
id|z
comma
id|tb-&gt;tb_id
comma
id|n
comma
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ACCESSED
)paren
id|rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|fn_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|rtmsg_fib
c_func
(paren
id|RTM_NEWROUTE
comma
id|new_f
comma
id|z
comma
id|tb-&gt;tb_id
comma
id|n
comma
id|req
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|fib_release_info
c_func
(paren
id|fi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|fn_hash_delete
id|fn_hash_delete
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|rtmsg
op_star
id|r
comma
r_struct
id|kern_rta
op_star
id|rta
comma
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|netlink_skb_parms
op_star
id|req
)paren
(brace
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fib_node
op_star
op_star
id|fp
comma
op_star
op_star
id|del_fp
comma
op_star
id|f
suffix:semicolon
r_int
id|z
op_assign
id|r-&gt;rtm_dst_len
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
id|fn_key_t
id|key
suffix:semicolon
r_int
id|matched
suffix:semicolon
macro_line|#ifdef CONFIG_IP_ROUTE_TOS
id|u8
id|tos
op_assign
id|r-&gt;rtm_tos
suffix:semicolon
macro_line|#endif
id|FTprint
c_func
(paren
l_string|&quot;tb(%d)_delete: %d %08x/%d %d&bslash;n&quot;
comma
id|tb-&gt;tb_id
comma
id|r-&gt;rtm_type
comma
id|rta-&gt;rta_dst
ques
c_cond
op_star
(paren
id|u32
op_star
)paren
id|rta-&gt;rta_dst
suffix:colon
l_int|0
comma
id|z
comma
id|rta-&gt;rta_oif
ques
c_cond
op_star
id|rta-&gt;rta_oif
suffix:colon
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|z
OG
l_int|32
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fz
op_assign
id|table-&gt;fn_zones
(braket
id|z
)braket
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
id|fz_key_0
c_func
(paren
id|key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta-&gt;rta_dst
)paren
(brace
id|u32
id|dst
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dst
comma
id|rta-&gt;rta_dst
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst
op_amp
op_complement
id|FZ_MASK
c_func
(paren
id|fz
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|key
op_assign
id|fz_key
c_func
(paren
id|dst
comma
id|fz
)paren
suffix:semicolon
)brace
id|fp
op_assign
id|fz_chain_p
c_func
(paren
id|key
comma
id|fz
)paren
suffix:semicolon
id|FIB_SCAN
c_func
(paren
id|f
comma
id|fp
)paren
(brace
r_if
c_cond
(paren
id|fn_key_eq
c_func
(paren
id|f-&gt;fn_key
comma
id|key
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|fn_key_leq
c_func
(paren
id|key
comma
id|f-&gt;fn_key
)paren
)paren
(brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_IP_ROUTE_TOS
id|FIB_SCAN_KEY
c_func
(paren
id|f
comma
id|fp
comma
id|key
)paren
(brace
r_if
c_cond
(paren
id|f-&gt;fn_tos
op_eq
id|tos
)paren
r_break
suffix:semicolon
)brace
macro_line|#endif
id|matched
op_assign
l_int|0
suffix:semicolon
id|del_fp
op_assign
l_int|NULL
suffix:semicolon
id|FIB_SCAN_TOS
c_func
(paren
id|f
comma
id|fp
comma
id|key
comma
id|tos
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
op_assign
id|FIB_INFO
c_func
(paren
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
)paren
(brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
id|matched
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|del_fp
op_eq
l_int|NULL
op_logical_and
(paren
op_logical_neg
id|r-&gt;rtm_type
op_logical_or
id|f-&gt;fn_type
op_eq
id|r-&gt;rtm_type
)paren
op_logical_and
(paren
id|r-&gt;rtm_scope
op_eq
id|RT_SCOPE_NOWHERE
op_logical_or
id|f-&gt;fn_scope
op_eq
id|r-&gt;rtm_scope
)paren
op_logical_and
(paren
op_logical_neg
id|r-&gt;rtm_protocol
op_logical_or
id|fi-&gt;fib_protocol
op_eq
id|r-&gt;rtm_protocol
)paren
op_logical_and
id|fib_nh_match
c_func
(paren
id|r
comma
id|n
comma
id|rta
comma
id|fi
)paren
op_eq
l_int|0
)paren
id|del_fp
op_assign
id|fp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|del_fp
)paren
(brace
id|f
op_assign
op_star
id|del_fp
suffix:semicolon
id|rtmsg_fib
c_func
(paren
id|RTM_DELROUTE
comma
id|f
comma
id|z
comma
id|tb-&gt;tb_id
comma
id|n
comma
id|req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|matched
op_ne
l_int|1
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
op_star
id|del_fp
op_assign
id|f-&gt;fn_next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ACCESSED
)paren
id|rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
id|fn_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|f-&gt;fn_state
op_or_assign
id|FN_S_ZOMBIE
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ACCESSED
)paren
(brace
id|f-&gt;fn_state
op_and_assign
op_complement
id|FN_S_ACCESSED
suffix:semicolon
id|rt_cache_flush
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|fib_hash_zombies
OG
l_int|128
)paren
id|fib_flush
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
r_extern
id|__inline__
r_int
DECL|function|fn_flush_list
id|fn_flush_list
c_func
(paren
r_struct
id|fib_node
op_star
op_star
id|fp
comma
r_int
id|z
comma
r_struct
id|fn_hash
op_star
id|table
)paren
(brace
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_while
c_loop
(paren
(paren
id|f
op_assign
op_star
id|fp
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|fib_info
op_star
id|fi
op_assign
id|FIB_INFO
c_func
(paren
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fi
op_logical_and
(paren
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
)paren
op_logical_or
(paren
id|fi-&gt;fib_flags
op_amp
id|RTNH_F_DEAD
)paren
)paren
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
op_star
id|fp
op_assign
id|f-&gt;fn_next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|fn_free_node
c_func
(paren
id|f
)paren
suffix:semicolon
id|found
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|fp
op_assign
op_amp
id|f-&gt;fn_next
suffix:semicolon
)brace
r_return
id|found
suffix:semicolon
)brace
DECL|function|fn_hash_flush
r_static
r_int
id|fn_hash_flush
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
)paren
(brace
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
id|fib_hash_zombies
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|table-&gt;fn_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|tmp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|fz-&gt;fz_divisor
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|tmp
op_add_assign
id|fn_flush_list
c_func
(paren
op_amp
id|fz-&gt;fz_hash
(braket
id|i
)braket
comma
id|fz-&gt;fz_order
comma
id|table
)paren
suffix:semicolon
id|fz-&gt;fz_nent
op_sub_assign
id|tmp
suffix:semicolon
id|found
op_add_assign
id|tmp
suffix:semicolon
)brace
r_return
id|found
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|fn_hash_get_info
r_static
r_int
id|fn_hash_get_info
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_char
op_star
id|buffer
comma
r_int
id|first
comma
r_int
id|count
)paren
(brace
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_int
id|pos
op_assign
l_int|0
suffix:semicolon
r_int
id|n
op_assign
l_int|0
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|table-&gt;fn_zone_list
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|fib_node
op_star
id|f
suffix:semicolon
r_int
id|maxslot
op_assign
id|fz-&gt;fz_divisor
suffix:semicolon
r_struct
id|fib_node
op_star
op_star
id|fp
op_assign
id|fz-&gt;fz_hash
suffix:semicolon
r_if
c_cond
(paren
id|fz-&gt;fz_nent
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_plus
id|fz-&gt;fz_nent
op_le
id|first
)paren
(brace
id|pos
op_add_assign
id|fz-&gt;fz_nent
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|maxslot
suffix:semicolon
id|i
op_increment
comma
id|fp
op_increment
)paren
(brace
r_for
c_loop
(paren
id|f
op_assign
op_star
id|fp
suffix:semicolon
id|f
suffix:semicolon
id|f
op_assign
id|f-&gt;fn_next
)paren
(brace
r_if
c_cond
(paren
op_increment
id|pos
op_le
id|first
)paren
r_continue
suffix:semicolon
id|fib_node_get_info
c_func
(paren
id|f-&gt;fn_type
comma
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
comma
id|FIB_INFO
c_func
(paren
id|f
)paren
comma
id|fz_prefix
c_func
(paren
id|f-&gt;fn_key
comma
id|fz
)paren
comma
id|FZ_MASK
c_func
(paren
id|fz
)paren
comma
id|buffer
)paren
suffix:semicolon
id|buffer
op_add_assign
l_int|128
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|n
op_ge
id|count
)paren
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_RTNETLINK
r_extern
id|__inline__
r_int
DECL|function|fn_hash_dump_bucket
id|fn_hash_dump_bucket
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
comma
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|fn_zone
op_star
id|fz
comma
r_struct
id|fib_node
op_star
id|f
)paren
(brace
r_int
id|i
comma
id|s_i
suffix:semicolon
id|s_i
op_assign
id|cb-&gt;args
(braket
l_int|3
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|f
suffix:semicolon
id|i
op_increment
comma
id|f
op_assign
id|f-&gt;fn_next
)paren
(brace
r_if
c_cond
(paren
id|i
OL
id|s_i
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|fib_dump_info
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|RTM_NEWROUTE
comma
id|tb-&gt;tb_id
comma
(paren
id|f-&gt;fn_state
op_amp
id|FN_S_ZOMBIE
)paren
ques
c_cond
l_int|0
suffix:colon
id|f-&gt;fn_type
comma
id|f-&gt;fn_scope
comma
op_amp
id|f-&gt;fn_key
comma
id|fz-&gt;fz_order
comma
id|f-&gt;fn_tos
comma
id|f-&gt;fn_info
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|3
)braket
op_assign
id|i
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|cb-&gt;args
(braket
l_int|3
)braket
op_assign
id|i
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
r_extern
id|__inline__
r_int
DECL|function|fn_hash_dump_zone
id|fn_hash_dump_zone
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
comma
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|fn_zone
op_star
id|fz
)paren
(brace
r_int
id|h
comma
id|s_h
suffix:semicolon
id|s_h
op_assign
id|cb-&gt;args
(braket
l_int|2
)braket
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|fz-&gt;fz_divisor
suffix:semicolon
id|h
op_increment
)paren
(brace
r_if
c_cond
(paren
id|h
OL
id|s_h
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|h
OG
id|s_h
)paren
id|memset
c_func
(paren
op_amp
id|cb-&gt;args
(braket
l_int|3
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|cb-&gt;args
)paren
op_minus
l_int|3
op_star
r_sizeof
(paren
id|cb-&gt;args
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fz-&gt;fz_hash
op_eq
l_int|NULL
op_logical_or
id|fz-&gt;fz_hash
(braket
id|h
)braket
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|fn_hash_dump_bucket
c_func
(paren
id|skb
comma
id|cb
comma
id|tb
comma
id|fz
comma
id|fz-&gt;fz_hash
(braket
id|h
)braket
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|2
)braket
op_assign
id|h
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|cb-&gt;args
(braket
l_int|2
)braket
op_assign
id|h
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|fn_hash_dump
r_static
r_int
id|fn_hash_dump
c_func
(paren
r_struct
id|fib_table
op_star
id|tb
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_int
id|m
comma
id|s_m
suffix:semicolon
r_struct
id|fn_zone
op_star
id|fz
suffix:semicolon
r_struct
id|fn_hash
op_star
id|table
op_assign
(paren
r_struct
id|fn_hash
op_star
)paren
id|tb-&gt;tb_data
suffix:semicolon
id|s_m
op_assign
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|fz
op_assign
id|table-&gt;fn_zone_list
comma
id|m
op_assign
l_int|0
suffix:semicolon
id|fz
suffix:semicolon
id|fz
op_assign
id|fz-&gt;fz_next
comma
id|m
op_increment
)paren
(brace
r_if
c_cond
(paren
id|m
OL
id|s_m
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|m
OG
id|s_m
)paren
id|memset
c_func
(paren
op_amp
id|cb-&gt;args
(braket
l_int|2
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|cb-&gt;args
)paren
op_minus
l_int|2
op_star
r_sizeof
(paren
id|cb-&gt;args
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fn_hash_dump_zone
c_func
(paren
id|skb
comma
id|cb
comma
id|tb
comma
id|fz
)paren
OL
l_int|0
)paren
(brace
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|m
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|fib_hash_lock
)paren
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|m
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|rtmsg_fib
r_static
r_void
id|rtmsg_fib
c_func
(paren
r_int
id|event
comma
r_struct
id|fib_node
op_star
id|f
comma
r_int
id|z
comma
r_int
id|tb_id
comma
r_struct
id|nlmsghdr
op_star
id|n
comma
r_struct
id|netlink_skb_parms
op_star
id|req
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u32
id|pid
op_assign
id|req
ques
c_cond
id|req-&gt;pid
suffix:colon
l_int|0
suffix:semicolon
r_int
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|rtmsg
)paren
op_plus
l_int|256
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|fib_dump_info
c_func
(paren
id|skb
comma
id|pid
comma
id|n-&gt;nlmsg_seq
comma
id|event
comma
id|tb_id
comma
id|f-&gt;fn_type
comma
id|f-&gt;fn_scope
comma
op_amp
id|f-&gt;fn_key
comma
id|z
comma
id|f-&gt;fn_tos
comma
id|FIB_INFO
c_func
(paren
id|f
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|RTMGRP_IPV4_ROUTE
suffix:semicolon
r_if
c_cond
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_ECHO
)paren
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|pid
comma
id|RTMGRP_IPV4_ROUTE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n-&gt;nlmsg_flags
op_amp
id|NLM_F_ECHO
)paren
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_RTNETLINK */
macro_line|#ifdef CONFIG_IP_MULTIPLE_TABLES
DECL|function|fib_hash_init
r_struct
id|fib_table
op_star
id|fib_hash_init
c_func
(paren
r_int
id|id
)paren
macro_line|#else
r_struct
id|fib_table
op_star
id|__init
id|fib_hash_init
c_func
(paren
r_int
id|id
)paren
macro_line|#endif
(brace
r_struct
id|fib_table
op_star
id|tb
suffix:semicolon
r_if
c_cond
(paren
id|fn_hash_kmem
op_eq
l_int|NULL
)paren
id|fn_hash_kmem
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;ip_fib_hash&quot;
comma
r_sizeof
(paren
r_struct
id|fib_node
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|tb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fib_table
)paren
op_plus
r_sizeof
(paren
r_struct
id|fn_hash
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tb
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|tb-&gt;tb_id
op_assign
id|id
suffix:semicolon
id|tb-&gt;tb_lookup
op_assign
id|fn_hash_lookup
suffix:semicolon
id|tb-&gt;tb_insert
op_assign
id|fn_hash_insert
suffix:semicolon
id|tb-&gt;tb_delete
op_assign
id|fn_hash_delete
suffix:semicolon
id|tb-&gt;tb_flush
op_assign
id|fn_hash_flush
suffix:semicolon
id|tb-&gt;tb_select_default
op_assign
id|fn_hash_select_default
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
id|tb-&gt;tb_dump
op_assign
id|fn_hash_dump
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PROC_FS
id|tb-&gt;tb_get_info
op_assign
id|fn_hash_get_info
suffix:semicolon
macro_line|#endif
id|memset
c_func
(paren
id|tb-&gt;tb_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fn_hash
)paren
)paren
suffix:semicolon
r_return
id|tb
suffix:semicolon
)brace
eof
