multiline_comment|/*&n; *&t;IP multicast routing support for mrouted 3.6/3.8&n; *&n; *&t;&t;(c) 1995 Alan Cox, &lt;alan@redhat.com&gt;&n; *&t;  Linux Consultancy and Custom Driver Development&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; *&n; *&t;Version: $Id: ipmr.c,v 1.55 2000/11/28 13:13:27 davem Exp $&n; *&n; *&t;Fixes:&n; *&t;Michael Chastain&t;:&t;Incorrect size of copying.&n; *&t;Alan Cox&t;&t;:&t;Added the cache manager code&n; *&t;Alan Cox&t;&t;:&t;Fixed the clone/copy bug and device race.&n; *&t;Mike McLagan&t;&t;:&t;Routing by source&n; *&t;Malcolm Beattie&t;&t;:&t;Buffer handling fixes.&n; *&t;Alexey Kuznetsov&t;:&t;Double buffer free and other fixes.&n; *&t;SVR Anand&t;&t;:&t;Fixed several multicast bugs and problems.&n; *&t;Alexey Kuznetsov&t;:&t;Status, optimisations and more.&n; *&t;Brad Parker&t;&t;:&t;Better behaviour on mrouted upcall&n; *&t;&t;&t;&t;&t;overflow.&n; *      Carlos Picoto           :       PIMv1 Support&n; *&t;Pavlin Ivanov Radoslavov:&t;PIMv2 Registers must checksum only PIM header&n; *&t;&t;&t;&t;&t;Relax this requrement to work with older peers.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/igmp.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/mroute.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;net/udp.h&gt;
macro_line|#include &lt;net/raw.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/netfilter_ipv4.h&gt;
macro_line|#include &lt;net/ipip.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#if defined(CONFIG_IP_PIMSM_V1) || defined(CONFIG_IP_PIMSM_V2)
DECL|macro|CONFIG_IP_PIMSM
mdefine_line|#define CONFIG_IP_PIMSM&t;1
macro_line|#endif
DECL|variable|mroute_socket
r_static
r_struct
id|sock
op_star
id|mroute_socket
suffix:semicolon
multiline_comment|/* Big lock, protecting vif table, mrt cache and mroute socket state.&n;   Note that the changes are semaphored via rtnl_lock.&n; */
DECL|variable|mrt_lock
r_static
id|rwlock_t
id|mrt_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/*&n; *&t;Multicast router control variables&n; */
DECL|variable|vif_table
r_static
r_struct
id|vif_device
id|vif_table
(braket
id|MAXVIFS
)braket
suffix:semicolon
multiline_comment|/* Devices &t;&t;*/
DECL|variable|maxvif
r_static
r_int
id|maxvif
suffix:semicolon
DECL|macro|VIF_EXISTS
mdefine_line|#define VIF_EXISTS(idx) (vif_table[idx].dev != NULL)
DECL|variable|mroute_do_assert
r_int
id|mroute_do_assert
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set in PIM assert&t;*/
DECL|variable|mroute_do_pim
r_int
id|mroute_do_pim
op_assign
l_int|0
suffix:semicolon
DECL|variable|mfc_cache_array
r_static
r_struct
id|mfc_cache
op_star
id|mfc_cache_array
(braket
id|MFC_LINES
)braket
suffix:semicolon
multiline_comment|/* Forwarding cache&t;*/
DECL|variable|mfc_unres_queue
r_static
r_struct
id|mfc_cache
op_star
id|mfc_unres_queue
suffix:semicolon
multiline_comment|/* Queue of unresolved entries */
DECL|variable|cache_resolve_queue_len
id|atomic_t
id|cache_resolve_queue_len
suffix:semicolon
multiline_comment|/* Size of unresolved&t;*/
multiline_comment|/* Special spinlock for queue of unresolved entries */
DECL|variable|mfc_unres_lock
r_static
id|spinlock_t
id|mfc_unres_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/* We return to original Alan&squot;s scheme. Hash table of resolved&n;   entries is changed only in process context and protected&n;   with weak lock mrt_lock. Queue of unresolved entries is protected&n;   with strong spinlock mfc_unres_lock.&n;&n;   In this case data path is free of exclusive locks at all.&n; */
DECL|variable|mrt_cachep
id|kmem_cache_t
op_star
id|mrt_cachep
suffix:semicolon
r_static
r_int
id|ip_mr_forward
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|mfc_cache
op_star
id|cache
comma
r_int
id|local
)paren
suffix:semicolon
r_static
r_int
id|ipmr_cache_report
c_func
(paren
r_struct
id|sk_buff
op_star
id|pkt
comma
id|vifi_t
id|vifi
comma
r_int
m_assert
)paren
suffix:semicolon
r_static
r_int
id|ipmr_fill_mroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|mfc_cache
op_star
id|c
comma
r_struct
id|rtmsg
op_star
id|rtm
)paren
suffix:semicolon
r_extern
r_struct
id|inet_protocol
id|pim_protocol
suffix:semicolon
DECL|variable|ipmr_expire_timer
r_static
r_struct
id|timer_list
id|ipmr_expire_timer
suffix:semicolon
multiline_comment|/* Service routines creating virtual interfaces: DVMRP tunnels and PIMREG */
r_static
DECL|function|ipmr_new_tunnel
r_struct
id|net_device
op_star
id|ipmr_new_tunnel
c_func
(paren
r_struct
id|vifctl
op_star
id|v
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|__dev_get_by_name
c_func
(paren
l_string|&quot;tunl0&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|ifreq
id|ifr
suffix:semicolon
id|mm_segment_t
id|oldfs
suffix:semicolon
r_struct
id|ip_tunnel_parm
id|p
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|p
comma
l_int|0
comma
r_sizeof
(paren
id|p
)paren
)paren
suffix:semicolon
id|p.iph.daddr
op_assign
id|v-&gt;vifc_rmt_addr.s_addr
suffix:semicolon
id|p.iph.saddr
op_assign
id|v-&gt;vifc_lcl_addr.s_addr
suffix:semicolon
id|p.iph.version
op_assign
l_int|4
suffix:semicolon
id|p.iph.ihl
op_assign
l_int|5
suffix:semicolon
id|p.iph.protocol
op_assign
id|IPPROTO_IPIP
suffix:semicolon
id|sprintf
c_func
(paren
id|p.name
comma
l_string|&quot;dvmrp%d&quot;
comma
id|v-&gt;vifc_vifi
)paren
suffix:semicolon
id|ifr.ifr_ifru.ifru_data
op_assign
(paren
r_void
op_star
)paren
op_amp
id|p
suffix:semicolon
id|oldfs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|dev
op_member_access_from_pointer
id|do_ioctl
c_func
(paren
id|dev
comma
op_amp
id|ifr
comma
id|SIOCADDTUNNEL
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
op_logical_and
(paren
id|dev
op_assign
id|__dev_get_by_name
c_func
(paren
id|p.name
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|dev-&gt;flags
op_or_assign
id|IFF_MULTICAST
suffix:semicolon
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
op_logical_and
(paren
id|in_dev
op_assign
id|inetdev_init
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|failure
suffix:semicolon
id|in_dev-&gt;cnf.rp_filter
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev_open
c_func
(paren
id|dev
)paren
)paren
r_goto
id|failure
suffix:semicolon
)brace
)brace
r_return
id|dev
suffix:semicolon
id|failure
suffix:colon
id|unregister_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_PIMSM
DECL|variable|reg_vif_num
r_static
r_int
id|reg_vif_num
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|function|reg_vif_xmit
r_static
r_int
id|reg_vif_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tx_packets
op_increment
suffix:semicolon
id|ipmr_cache_report
c_func
(paren
id|skb
comma
id|reg_vif_num
comma
id|IGMPMSG_WHOLEPKT
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|reg_vif_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|reg_vif_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
(paren
r_struct
id|net_device_stats
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
)brace
r_static
DECL|function|ipmr_reg_vif
r_struct
id|net_device
op_star
id|ipmr_reg_vif
c_func
(paren
r_struct
id|vifctl
op_star
id|v
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_int
id|size
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
op_star
id|dev
)paren
op_plus
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
suffix:semicolon
id|dev
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
id|dev
op_plus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;name
comma
l_string|&quot;pimreg&quot;
)paren
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_PIMREG
suffix:semicolon
id|dev-&gt;mtu
op_assign
l_int|1500
op_minus
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_minus
l_int|8
suffix:semicolon
id|dev-&gt;flags
op_assign
id|IFF_NOARP
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|reg_vif_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|reg_vif_get_stats
suffix:semicolon
id|dev-&gt;features
op_or_assign
id|NETIF_F_DYNALLOC
suffix:semicolon
r_if
c_cond
(paren
id|register_netdevice
c_func
(paren
id|dev
)paren
)paren
(brace
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|dev-&gt;iflink
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|inetdev_init
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|failure
suffix:semicolon
id|in_dev-&gt;cnf.rp_filter
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev_open
c_func
(paren
id|dev
)paren
)paren
r_goto
id|failure
suffix:semicolon
r_return
id|dev
suffix:semicolon
id|failure
suffix:colon
id|unregister_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;Delete a VIF entry&n; */
DECL|function|vif_delete
r_static
r_int
id|vif_delete
c_func
(paren
r_int
id|vifi
)paren
(brace
r_struct
id|vif_device
op_star
id|v
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_if
c_cond
(paren
id|vifi
OL
l_int|0
op_logical_or
id|vifi
op_ge
id|maxvif
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
id|v
op_assign
op_amp
id|vif_table
(braket
id|vifi
)braket
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|dev
op_assign
id|v-&gt;dev
suffix:semicolon
id|v-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_PIMSM
r_if
c_cond
(paren
id|vifi
op_eq
id|reg_vif_num
)paren
id|reg_vif_num
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|vifi
op_plus
l_int|1
op_eq
id|maxvif
)paren
(brace
r_int
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
id|vifi
op_minus
l_int|1
suffix:semicolon
id|tmp
op_ge
l_int|0
suffix:semicolon
id|tmp
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|VIF_EXISTS
c_func
(paren
id|tmp
)paren
)paren
r_break
suffix:semicolon
)brace
id|maxvif
op_assign
id|tmp
op_plus
l_int|1
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|dev_set_allmulti
c_func
(paren
id|dev
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|in_dev-&gt;cnf.mc_forwarding
op_decrement
suffix:semicolon
id|ip_rt_multicast_event
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v-&gt;flags
op_amp
(paren
id|VIFF_TUNNEL
op_or
id|VIFF_REGISTER
)paren
)paren
id|unregister_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Destroy an unresolved cache entry, killing queued skbs&n;   and reporting error to netlink readers.&n; */
DECL|function|ipmr_destroy_unres
r_static
r_void
id|ipmr_destroy_unres
c_func
(paren
r_struct
id|mfc_cache
op_star
id|c
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|cache_resolve_queue_len
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|c-&gt;mfc_un.unres.unresolved
)paren
)paren
)paren
(brace
macro_line|#ifdef CONFIG_RTNETLINK
r_if
c_cond
(paren
id|skb-&gt;nh.iph-&gt;version
op_eq
l_int|0
)paren
(brace
r_struct
id|nlmsghdr
op_star
id|nlh
op_assign
(paren
r_struct
id|nlmsghdr
op_star
)paren
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_type
op_assign
id|NLMSG_ERROR
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|nlmsgerr
)paren
)paren
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|nlh-&gt;nlmsg_len
)paren
suffix:semicolon
(paren
(paren
r_struct
id|nlmsgerr
op_star
)paren
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
)paren
op_member_access_from_pointer
id|error
op_assign
op_minus
id|ETIMEDOUT
suffix:semicolon
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|kmem_cache_free
c_func
(paren
id|mrt_cachep
comma
id|c
)paren
suffix:semicolon
)brace
multiline_comment|/* Single timer process for all the unresolved queue. */
DECL|function|ipmr_expire_process
r_void
id|ipmr_expire_process
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
r_int
r_int
id|now
suffix:semicolon
r_int
r_int
id|expires
suffix:semicolon
r_struct
id|mfc_cache
op_star
id|c
comma
op_star
op_star
id|cp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|spin_trylock
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|ipmr_expire_timer
comma
id|jiffies
op_plus
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|cache_resolve_queue_len
)paren
op_eq
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|now
op_assign
id|jiffies
suffix:semicolon
id|expires
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
id|cp
op_assign
op_amp
id|mfc_unres_queue
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|cp
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
id|interval
op_assign
id|c-&gt;mfc_un.unres.expires
op_minus
id|now
suffix:semicolon
r_if
c_cond
(paren
id|interval
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|interval
OL
id|expires
)paren
id|expires
op_assign
id|interval
suffix:semicolon
id|cp
op_assign
op_amp
id|c-&gt;next
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|cp
op_assign
id|c-&gt;next
suffix:semicolon
id|ipmr_destroy_unres
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|cache_resolve_queue_len
)paren
)paren
id|mod_timer
c_func
(paren
op_amp
id|ipmr_expire_timer
comma
id|jiffies
op_plus
id|expires
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* Fill oifs list. It is called under write locked mrt_lock. */
DECL|function|ipmr_update_threshoulds
r_static
r_void
id|ipmr_update_threshoulds
c_func
(paren
r_struct
id|mfc_cache
op_star
id|cache
comma
r_int
r_char
op_star
id|ttls
)paren
(brace
r_int
id|vifi
suffix:semicolon
id|cache-&gt;mfc_un.res.minvif
op_assign
id|MAXVIFS
suffix:semicolon
id|cache-&gt;mfc_un.res.maxvif
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|cache-&gt;mfc_un.res.ttls
comma
l_int|255
comma
id|MAXVIFS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|vifi
op_assign
l_int|0
suffix:semicolon
id|vifi
OL
id|maxvif
suffix:semicolon
id|vifi
op_increment
)paren
(brace
r_if
c_cond
(paren
id|VIF_EXISTS
c_func
(paren
id|vifi
)paren
op_logical_and
id|ttls
(braket
id|vifi
)braket
op_logical_and
id|ttls
(braket
id|vifi
)braket
OL
l_int|255
)paren
(brace
id|cache-&gt;mfc_un.res.ttls
(braket
id|vifi
)braket
op_assign
id|ttls
(braket
id|vifi
)braket
suffix:semicolon
r_if
c_cond
(paren
id|cache-&gt;mfc_un.res.minvif
OG
id|vifi
)paren
id|cache-&gt;mfc_un.res.minvif
op_assign
id|vifi
suffix:semicolon
r_if
c_cond
(paren
id|cache-&gt;mfc_un.res.maxvif
op_le
id|vifi
)paren
id|cache-&gt;mfc_un.res.maxvif
op_assign
id|vifi
op_plus
l_int|1
suffix:semicolon
)brace
)brace
)brace
DECL|function|vif_add
r_static
r_int
id|vif_add
c_func
(paren
r_struct
id|vifctl
op_star
id|vifc
comma
r_int
id|mrtsock
)paren
(brace
r_int
id|vifi
op_assign
id|vifc-&gt;vifc_vifi
suffix:semicolon
r_struct
id|vif_device
op_star
id|v
op_assign
op_amp
id|vif_table
(braket
id|vifi
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
multiline_comment|/* Is vif busy ? */
r_if
c_cond
(paren
id|VIF_EXISTS
c_func
(paren
id|vifi
)paren
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
r_switch
c_cond
(paren
id|vifc-&gt;vifc_flags
)paren
(brace
macro_line|#ifdef CONFIG_IP_PIMSM
r_case
id|VIFF_REGISTER
suffix:colon
multiline_comment|/*&n;&t;&t; * Special Purpose VIF in PIM&n;&t;&t; * All the packets will be sent to the daemon&n;&t;&t; */
r_if
c_cond
(paren
id|reg_vif_num
op_ge
l_int|0
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
id|dev
op_assign
id|ipmr_reg_vif
c_func
(paren
id|vifc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|VIFF_TUNNEL
suffix:colon
id|dev
op_assign
id|ipmr_new_tunnel
c_func
(paren
id|vifc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|dev
op_assign
id|ip_dev_find
c_func
(paren
id|vifc-&gt;vifc_lcl_addr.s_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
id|__dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
id|in_dev-&gt;cnf.mc_forwarding
op_increment
suffix:semicolon
id|dev_set_allmulti
c_func
(paren
id|dev
comma
op_plus
l_int|1
)paren
suffix:semicolon
id|ip_rt_multicast_event
c_func
(paren
id|in_dev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Fill in the VIF structures&n;&t; */
id|v-&gt;rate_limit
op_assign
id|vifc-&gt;vifc_rate_limit
suffix:semicolon
id|v-&gt;local
op_assign
id|vifc-&gt;vifc_lcl_addr.s_addr
suffix:semicolon
id|v-&gt;remote
op_assign
id|vifc-&gt;vifc_rmt_addr.s_addr
suffix:semicolon
id|v-&gt;flags
op_assign
id|vifc-&gt;vifc_flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mrtsock
)paren
id|v-&gt;flags
op_or_assign
id|VIFF_STATIC
suffix:semicolon
id|v-&gt;threshold
op_assign
id|vifc-&gt;vifc_threshold
suffix:semicolon
id|v-&gt;bytes_in
op_assign
l_int|0
suffix:semicolon
id|v-&gt;bytes_out
op_assign
l_int|0
suffix:semicolon
id|v-&gt;pkt_in
op_assign
l_int|0
suffix:semicolon
id|v-&gt;pkt_out
op_assign
l_int|0
suffix:semicolon
id|v-&gt;link
op_assign
id|dev-&gt;ifindex
suffix:semicolon
r_if
c_cond
(paren
id|v-&gt;flags
op_amp
(paren
id|VIFF_TUNNEL
op_or
id|VIFF_REGISTER
)paren
)paren
id|v-&gt;link
op_assign
id|dev-&gt;iflink
suffix:semicolon
multiline_comment|/* And finish update writing critical data */
id|write_lock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
id|v-&gt;dev
op_assign
id|dev
suffix:semicolon
macro_line|#ifdef CONFIG_IP_PIMSM
r_if
c_cond
(paren
id|v-&gt;flags
op_amp
id|VIFF_REGISTER
)paren
id|reg_vif_num
op_assign
id|vifi
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|vifi
op_plus
l_int|1
OG
id|maxvif
)paren
id|maxvif
op_assign
id|vifi
op_plus
l_int|1
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipmr_cache_find
r_static
r_struct
id|mfc_cache
op_star
id|ipmr_cache_find
c_func
(paren
id|__u32
id|origin
comma
id|__u32
id|mcastgrp
)paren
(brace
r_int
id|line
op_assign
id|MFC_HASH
c_func
(paren
id|mcastgrp
comma
id|origin
)paren
suffix:semicolon
r_struct
id|mfc_cache
op_star
id|c
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
id|mfc_cache_array
(braket
id|line
)braket
suffix:semicolon
id|c
suffix:semicolon
id|c
op_assign
id|c-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;mfc_origin
op_eq
id|origin
op_logical_and
id|c-&gt;mfc_mcastgrp
op_eq
id|mcastgrp
)paren
r_break
suffix:semicolon
)brace
r_return
id|c
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Allocate a multicast cache entry&n; */
DECL|function|ipmr_cache_alloc
r_static
r_struct
id|mfc_cache
op_star
id|ipmr_cache_alloc
c_func
(paren
r_void
)paren
(brace
r_struct
id|mfc_cache
op_star
id|c
op_assign
id|kmem_cache_alloc
c_func
(paren
id|mrt_cachep
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|c
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|c
)paren
)paren
suffix:semicolon
id|c-&gt;mfc_un.res.minvif
op_assign
id|MAXVIFS
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
DECL|function|ipmr_cache_alloc_unres
r_static
r_struct
id|mfc_cache
op_star
id|ipmr_cache_alloc_unres
c_func
(paren
r_void
)paren
(brace
r_struct
id|mfc_cache
op_star
id|c
op_assign
id|kmem_cache_alloc
c_func
(paren
id|mrt_cachep
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|c
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|c
)paren
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|c-&gt;mfc_un.unres.unresolved
)paren
suffix:semicolon
id|c-&gt;mfc_un.unres.expires
op_assign
id|jiffies
op_plus
l_int|10
op_star
id|HZ
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;A cache entry has gone into a resolved state from queued&n; */
DECL|function|ipmr_cache_resolve
r_static
r_void
id|ipmr_cache_resolve
c_func
(paren
r_struct
id|mfc_cache
op_star
id|uc
comma
r_struct
id|mfc_cache
op_star
id|c
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Play the pending entries through our router&n;&t; */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|__skb_dequeue
c_func
(paren
op_amp
id|uc-&gt;mfc_un.unres.unresolved
)paren
)paren
)paren
(brace
macro_line|#ifdef CONFIG_RTNETLINK
r_if
c_cond
(paren
id|skb-&gt;nh.iph-&gt;version
op_eq
l_int|0
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
op_assign
(paren
r_struct
id|nlmsghdr
op_star
)paren
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipmr_fill_mroute
c_func
(paren
id|skb
comma
id|c
comma
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
)paren
OG
l_int|0
)paren
(brace
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
(paren
id|u8
op_star
)paren
id|nlh
suffix:semicolon
)brace
r_else
(brace
id|nlh-&gt;nlmsg_type
op_assign
id|NLMSG_ERROR
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|nlmsgerr
)paren
)paren
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|nlh-&gt;nlmsg_len
)paren
suffix:semicolon
(paren
(paren
r_struct
id|nlmsgerr
op_star
)paren
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
)paren
op_member_access_from_pointer
id|error
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
)brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|rtnl
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|ip_mr_forward
c_func
(paren
id|skb
comma
id|c
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Bounce a cache query up to mrouted. We could use netlink for this but mrouted&n; *&t;expects the following bizarre scheme.&n; *&n; *&t;Called under mrt_lock.&n; */
DECL|function|ipmr_cache_report
r_static
r_int
id|ipmr_cache_report
c_func
(paren
r_struct
id|sk_buff
op_star
id|pkt
comma
id|vifi_t
id|vifi
comma
r_int
m_assert
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|ihl
op_assign
id|pkt-&gt;nh.iph-&gt;ihl
op_lshift
l_int|2
suffix:semicolon
r_struct
id|igmphdr
op_star
id|igmp
suffix:semicolon
r_struct
id|igmpmsg
op_star
id|msg
suffix:semicolon
r_int
id|ret
suffix:semicolon
macro_line|#ifdef CONFIG_IP_PIMSM
r_if
c_cond
(paren
m_assert
op_eq
id|IGMPMSG_WHOLEPKT
)paren
id|skb
op_assign
id|skb_realloc_headroom
c_func
(paren
id|pkt
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
r_else
macro_line|#endif
id|skb
op_assign
id|alloc_skb
c_func
(paren
l_int|128
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_PIMSM
r_if
c_cond
(paren
m_assert
op_eq
id|IGMPMSG_WHOLEPKT
)paren
(brace
multiline_comment|/* Ugly, but we have no choice with this interface.&n;&t;&t;   Duplicate old header, fix ihl, length etc.&n;&t;&t;   And all this only to mangle msg-&gt;im_msgtype and&n;&t;&t;   to set msg-&gt;im_mbz to &quot;mbz&quot; :-)&n;&t;&t; */
id|msg
op_assign
(paren
r_struct
id|igmpmsg
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
id|skb-&gt;nh.raw
op_assign
id|skb-&gt;h.raw
op_assign
(paren
id|u8
op_star
)paren
id|msg
suffix:semicolon
id|memcpy
c_func
(paren
id|msg
comma
id|pkt-&gt;nh.raw
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
id|msg-&gt;im_msgtype
op_assign
id|IGMPMSG_WHOLEPKT
suffix:semicolon
id|msg-&gt;im_mbz
op_assign
l_int|0
suffix:semicolon
id|msg-&gt;im_vif
op_assign
id|reg_vif_num
suffix:semicolon
id|skb-&gt;nh.iph-&gt;ihl
op_assign
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_rshift
l_int|2
suffix:semicolon
id|skb-&gt;nh.iph-&gt;tot_len
op_assign
id|htons
c_func
(paren
id|ntohs
c_func
(paren
id|pkt-&gt;nh.iph-&gt;tot_len
)paren
op_plus
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
multiline_comment|/*&n;&t; *&t;Copy the IP header&n;&t; */
id|skb-&gt;nh.iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|ihl
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|pkt-&gt;data
comma
id|ihl
)paren
suffix:semicolon
id|skb-&gt;nh.iph-&gt;protocol
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Flag to the kernel this is a route add */
id|msg
op_assign
(paren
r_struct
id|igmpmsg
op_star
)paren
id|skb-&gt;nh.iph
suffix:semicolon
id|msg-&gt;im_vif
op_assign
id|vifi
suffix:semicolon
id|skb-&gt;dst
op_assign
id|dst_clone
c_func
(paren
id|pkt-&gt;dst
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Add our header&n;&t; */
id|igmp
op_assign
(paren
r_struct
id|igmphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|igmphdr
)paren
)paren
suffix:semicolon
id|igmp-&gt;type
op_assign
id|msg-&gt;im_msgtype
op_assign
m_assert
suffix:semicolon
id|igmp-&gt;code
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;nh.iph-&gt;tot_len
op_assign
id|htons
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
multiline_comment|/* Fix the length */
id|skb-&gt;h.raw
op_assign
id|skb-&gt;nh.raw
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mroute_socket
op_eq
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Deliver to mrouted&n;&t; */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|sock_queue_rcv_skb
c_func
(paren
id|mroute_socket
comma
id|skb
)paren
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;mroute: pending queue full, dropping entries.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Queue a packet for resolution. It gets locked cache entry!&n; */
r_static
r_int
DECL|function|ipmr_cache_unresolved
id|ipmr_cache_unresolved
c_func
(paren
id|vifi_t
id|vifi
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|mfc_cache
op_star
id|c
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
id|mfc_unres_queue
suffix:semicolon
id|c
suffix:semicolon
id|c
op_assign
id|c-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;mfc_mcastgrp
op_eq
id|skb-&gt;nh.iph-&gt;daddr
op_logical_and
id|c-&gt;mfc_origin
op_eq
id|skb-&gt;nh.iph-&gt;saddr
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;Create a new entry if allowable&n;&t;&t; */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|cache_resolve_queue_len
)paren
op_ge
l_int|10
op_logical_or
(paren
id|c
op_assign
id|ipmr_cache_alloc_unres
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *&t;Fill in the new cache entry&n;&t;&t; */
id|c-&gt;mfc_parent
op_assign
op_minus
l_int|1
suffix:semicolon
id|c-&gt;mfc_origin
op_assign
id|skb-&gt;nh.iph-&gt;saddr
suffix:semicolon
id|c-&gt;mfc_mcastgrp
op_assign
id|skb-&gt;nh.iph-&gt;daddr
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Reflect first query at mrouted.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ipmr_cache_report
c_func
(paren
id|skb
comma
id|vifi
comma
id|IGMPMSG_NOCACHE
)paren
)paren
OL
l_int|0
)paren
(brace
multiline_comment|/* If the report failed throw the cache entry &n;&t;&t;&t;   out - Brad Parker&n;&t;&t;&t; */
id|spin_unlock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|mrt_cachep
comma
id|c
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|cache_resolve_queue_len
)paren
suffix:semicolon
id|c-&gt;next
op_assign
id|mfc_unres_queue
suffix:semicolon
id|mfc_unres_queue
op_assign
id|c
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|ipmr_expire_timer
comma
id|c-&gt;mfc_un.unres.expires
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;See if we can append the packet&n;&t; */
r_if
c_cond
(paren
id|c-&gt;mfc_un.unres.unresolved.qlen
OG
l_int|3
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
)brace
r_else
(brace
id|skb_queue_tail
c_func
(paren
op_amp
id|c-&gt;mfc_un.unres.unresolved
comma
id|skb
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;MFC cache manipulation by user space mroute daemon&n; */
DECL|function|ipmr_mfc_delete
r_int
id|ipmr_mfc_delete
c_func
(paren
r_struct
id|mfcctl
op_star
id|mfc
)paren
(brace
r_int
id|line
suffix:semicolon
r_struct
id|mfc_cache
op_star
id|c
comma
op_star
op_star
id|cp
suffix:semicolon
id|line
op_assign
id|MFC_HASH
c_func
(paren
id|mfc-&gt;mfcc_mcastgrp.s_addr
comma
id|mfc-&gt;mfcc_origin.s_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
op_amp
id|mfc_cache_array
(braket
id|line
)braket
suffix:semicolon
(paren
id|c
op_assign
op_star
id|cp
)paren
op_ne
l_int|NULL
suffix:semicolon
id|cp
op_assign
op_amp
id|c-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;mfc_origin
op_eq
id|mfc-&gt;mfcc_origin.s_addr
op_logical_and
id|c-&gt;mfc_mcastgrp
op_eq
id|mfc-&gt;mfcc_mcastgrp.s_addr
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
op_star
id|cp
op_assign
id|c-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|mrt_cachep
comma
id|c
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
DECL|function|ipmr_mfc_add
r_int
id|ipmr_mfc_add
c_func
(paren
r_struct
id|mfcctl
op_star
id|mfc
comma
r_int
id|mrtsock
)paren
(brace
r_int
id|line
suffix:semicolon
r_struct
id|mfc_cache
op_star
id|uc
comma
op_star
id|c
comma
op_star
op_star
id|cp
suffix:semicolon
id|line
op_assign
id|MFC_HASH
c_func
(paren
id|mfc-&gt;mfcc_mcastgrp.s_addr
comma
id|mfc-&gt;mfcc_origin.s_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
op_amp
id|mfc_cache_array
(braket
id|line
)braket
suffix:semicolon
(paren
id|c
op_assign
op_star
id|cp
)paren
op_ne
l_int|NULL
suffix:semicolon
id|cp
op_assign
op_amp
id|c-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;mfc_origin
op_eq
id|mfc-&gt;mfcc_origin.s_addr
op_logical_and
id|c-&gt;mfc_mcastgrp
op_eq
id|mfc-&gt;mfcc_mcastgrp.s_addr
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c
op_ne
l_int|NULL
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|c-&gt;mfc_parent
op_assign
id|mfc-&gt;mfcc_parent
suffix:semicolon
id|ipmr_update_threshoulds
c_func
(paren
id|c
comma
id|mfc-&gt;mfcc_ttls
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mrtsock
)paren
id|c-&gt;mfc_flags
op_or_assign
id|MFC_STATIC
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|mfc-&gt;mfcc_mcastgrp.s_addr
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|c
op_assign
id|ipmr_cache_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|c-&gt;mfc_origin
op_assign
id|mfc-&gt;mfcc_origin.s_addr
suffix:semicolon
id|c-&gt;mfc_mcastgrp
op_assign
id|mfc-&gt;mfcc_mcastgrp.s_addr
suffix:semicolon
id|c-&gt;mfc_parent
op_assign
id|mfc-&gt;mfcc_parent
suffix:semicolon
id|ipmr_update_threshoulds
c_func
(paren
id|c
comma
id|mfc-&gt;mfcc_ttls
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mrtsock
)paren
id|c-&gt;mfc_flags
op_or_assign
id|MFC_STATIC
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|c-&gt;next
op_assign
id|mfc_cache_array
(braket
id|line
)braket
suffix:semicolon
id|mfc_cache_array
(braket
id|line
)braket
op_assign
id|c
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Check to see if we resolved a queued list. If so we&n;&t; *&t;need to send on the frames and tidy up.&n;&t; */
id|spin_lock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
op_amp
id|mfc_unres_queue
suffix:semicolon
(paren
id|uc
op_assign
op_star
id|cp
)paren
op_ne
l_int|NULL
suffix:semicolon
id|cp
op_assign
op_amp
id|uc-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|uc-&gt;mfc_origin
op_eq
id|c-&gt;mfc_origin
op_logical_and
id|uc-&gt;mfc_mcastgrp
op_eq
id|c-&gt;mfc_mcastgrp
)paren
(brace
op_star
id|cp
op_assign
id|uc-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|cache_resolve_queue_len
)paren
)paren
id|del_timer
c_func
(paren
op_amp
id|ipmr_expire_timer
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uc
)paren
(brace
id|ipmr_cache_resolve
c_func
(paren
id|uc
comma
id|c
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|mrt_cachep
comma
id|uc
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Close the multicast socket, and clear the vif tables etc&n; */
DECL|function|mroute_clean_tables
r_static
r_void
id|mroute_clean_tables
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Shut down all active vif entries&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|maxvif
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|vif_table
(braket
id|i
)braket
dot
id|flags
op_amp
id|VIFF_STATIC
)paren
)paren
id|vif_delete
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Wipe the cache&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MFC_LINES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|mfc_cache
op_star
id|c
comma
op_star
op_star
id|cp
suffix:semicolon
id|cp
op_assign
op_amp
id|mfc_cache_array
(braket
id|i
)braket
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|cp
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;mfc_flags
op_amp
id|MFC_STATIC
)paren
(brace
id|cp
op_assign
op_amp
id|c-&gt;next
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|write_lock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
op_star
id|cp
op_assign
id|c-&gt;next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|mrt_cachep
comma
id|c
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|cache_resolve_queue_len
)paren
op_ne
l_int|0
)paren
(brace
r_struct
id|mfc_cache
op_star
id|c
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
id|mfc_unres_queue
op_ne
l_int|NULL
)paren
(brace
id|c
op_assign
id|mfc_unres_queue
suffix:semicolon
id|mfc_unres_queue
op_assign
id|c-&gt;next
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
id|ipmr_destroy_unres
c_func
(paren
id|c
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
)brace
)brace
DECL|function|mrtsock_destruct
r_static
r_void
id|mrtsock_destruct
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
id|mroute_socket
)paren
(brace
id|ipv4_devconf.mc_forwarding
op_decrement
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|mroute_socket
op_assign
l_int|NULL
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|mroute_clean_tables
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Socket options and virtual interface manipulation. The whole&n; *&t;virtual interface system is a complete heap, but unfortunately&n; *&t;that&squot;s how BSD mrouted happens to think. Maybe one day with a proper&n; *&t;MOSPF/PIM router set up we can clean this up.&n; */
DECL|function|ip_mroute_setsockopt
r_int
id|ip_mroute_setsockopt
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|vifctl
id|vif
suffix:semicolon
r_struct
id|mfcctl
id|mfc
suffix:semicolon
r_if
c_cond
(paren
id|optname
op_ne
id|MRT_INIT
)paren
(brace
r_if
c_cond
(paren
id|sk
op_ne
id|mroute_socket
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|MRT_INIT
suffix:colon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_RAW
op_logical_or
id|sk-&gt;num
op_ne
id|IPPROTO_IGMP
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
r_int
)paren
)paren
(brace
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mroute_socket
)paren
(brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
id|ret
op_assign
id|ip_ra_control
c_func
(paren
id|sk
comma
l_int|1
comma
id|mrtsock_destruct
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|mroute_socket
op_assign
id|sk
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|ipv4_devconf.mc_forwarding
op_increment
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
r_case
id|MRT_DONE
suffix:colon
r_if
c_cond
(paren
id|sk
op_ne
id|mroute_socket
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_return
id|ip_ra_control
c_func
(paren
id|sk
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_case
id|MRT_ADD_VIF
suffix:colon
r_case
id|MRT_DEL_VIF
suffix:colon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
id|vif
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vif
comma
id|optval
comma
r_sizeof
(paren
id|vif
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|vif.vifc_vifi
op_ge
id|MAXVIFS
)paren
(brace
r_return
op_minus
id|ENFILE
suffix:semicolon
)brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|optname
op_eq
id|MRT_ADD_VIF
)paren
(brace
id|ret
op_assign
id|vif_add
c_func
(paren
op_amp
id|vif
comma
id|sk
op_eq
id|mroute_socket
)paren
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
id|vif_delete
c_func
(paren
id|vif.vifc_vifi
)paren
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Manipulate the forwarding caches. These live&n;&t;&t; *&t;in a sort of kernel/user symbiosis.&n;&t;&t; */
r_case
id|MRT_ADD_MFC
suffix:colon
r_case
id|MRT_DEL_MFC
suffix:colon
r_if
c_cond
(paren
id|optlen
op_ne
r_sizeof
(paren
id|mfc
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|mfc
comma
id|optval
comma
r_sizeof
(paren
id|mfc
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|optname
op_eq
id|MRT_DEL_MFC
)paren
id|ret
op_assign
id|ipmr_mfc_delete
c_func
(paren
op_amp
id|mfc
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|ipmr_mfc_add
c_func
(paren
op_amp
id|mfc
comma
id|sk
op_eq
id|mroute_socket
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
multiline_comment|/*&n;&t;&t; *&t;Control PIM assert.&n;&t;&t; */
r_case
id|MRT_ASSERT
suffix:colon
(brace
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|v
comma
(paren
r_int
op_star
)paren
id|optval
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|mroute_do_assert
op_assign
(paren
id|v
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_PIMSM
r_case
id|MRT_PIM
suffix:colon
(brace
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|v
comma
(paren
r_int
op_star
)paren
id|optval
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|v
op_assign
(paren
id|v
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_ne
id|mroute_do_pim
)paren
(brace
id|mroute_do_pim
op_assign
id|v
suffix:semicolon
id|mroute_do_assert
op_assign
id|v
suffix:semicolon
macro_line|#ifdef CONFIG_IP_PIMSM_V2
r_if
c_cond
(paren
id|mroute_do_pim
)paren
id|inet_add_protocol
c_func
(paren
op_amp
id|pim_protocol
)paren
suffix:semicolon
r_else
id|inet_del_protocol
c_func
(paren
op_amp
id|pim_protocol
)paren
suffix:semicolon
macro_line|#endif
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t;&t; *&t;Spurious command, or MRT_VERSION which you cannot&n;&t;&t; *&t;set.&n;&t;&t; */
r_default
suffix:colon
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Getsock opt support for the multicast routing system.&n; */
DECL|function|ip_mroute_getsockopt
r_int
id|ip_mroute_getsockopt
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_int
id|olr
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|optname
op_ne
id|MRT_VERSION
op_logical_and
macro_line|#ifdef CONFIG_IP_PIMSM
id|optname
op_ne
id|MRT_PIM
op_logical_and
macro_line|#endif
id|optname
op_ne
id|MRT_ASSERT
)paren
(brace
r_return
op_minus
id|ENOPROTOOPT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|olr
comma
id|optlen
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|olr
op_assign
id|min
c_func
(paren
id|olr
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|olr
comma
id|optlen
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|optname
op_eq
id|MRT_VERSION
)paren
(brace
id|val
op_assign
l_int|0x0305
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_PIMSM
r_else
r_if
c_cond
(paren
id|optname
op_eq
id|MRT_PIM
)paren
(brace
id|val
op_assign
id|mroute_do_pim
suffix:semicolon
)brace
macro_line|#endif
r_else
id|val
op_assign
id|mroute_do_assert
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|val
comma
id|olr
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;The IP multicast ioctl support routines.&n; */
DECL|function|ipmr_ioctl
r_int
id|ipmr_ioctl
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|sioc_sg_req
id|sr
suffix:semicolon
r_struct
id|sioc_vif_req
id|vr
suffix:semicolon
r_struct
id|vif_device
op_star
id|vif
suffix:semicolon
r_struct
id|mfc_cache
op_star
id|c
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGETVIFCNT
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|vr
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vr
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|vr.vifi
op_ge
id|maxvif
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|vif
op_assign
op_amp
id|vif_table
(braket
id|vr.vifi
)braket
suffix:semicolon
r_if
c_cond
(paren
id|VIF_EXISTS
c_func
(paren
id|vr.vifi
)paren
)paren
(brace
id|vr.icount
op_assign
id|vif-&gt;pkt_in
suffix:semicolon
id|vr.ocount
op_assign
id|vif-&gt;pkt_out
suffix:semicolon
id|vr.ibytes
op_assign
id|vif-&gt;bytes_in
suffix:semicolon
id|vr.obytes
op_assign
id|vif-&gt;bytes_out
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|vr
comma
r_sizeof
(paren
id|vr
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_case
id|SIOCGETSGCNT
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|sr
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|sr
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|c
op_assign
id|ipmr_cache_find
c_func
(paren
id|sr.src.s_addr
comma
id|sr.grp.s_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
)paren
(brace
id|sr.pktcnt
op_assign
id|c-&gt;mfc_un.res.pkt
suffix:semicolon
id|sr.bytecnt
op_assign
id|c-&gt;mfc_un.res.bytes
suffix:semicolon
id|sr.wrong_if
op_assign
id|c-&gt;mfc_un.res.wrong_if
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|sr
comma
r_sizeof
(paren
id|sr
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
)brace
DECL|function|ipmr_device_event
r_static
r_int
id|ipmr_device_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|vif_device
op_star
id|v
suffix:semicolon
r_int
id|ct
suffix:semicolon
r_if
c_cond
(paren
id|event
op_ne
id|NETDEV_UNREGISTER
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
id|v
op_assign
op_amp
id|vif_table
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|maxvif
suffix:semicolon
id|ct
op_increment
comma
id|v
op_increment
)paren
(brace
r_if
c_cond
(paren
id|v-&gt;dev
op_eq
id|ptr
)paren
id|vif_delete
c_func
(paren
id|ct
)paren
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|ip_mr_notifier
r_static
r_struct
id|notifier_block
id|ip_mr_notifier
op_assign
initialization_block
suffix:semicolon
multiline_comment|/*&n; * &t;Encapsulate a packet by attaching a valid IPIP header to it.&n; *&t;This avoids tunnel drivers and other mess and gives us the speed so&n; *&t;important for multicast video.&n; */
DECL|function|ip_encap
r_static
r_void
id|ip_encap
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|saddr
comma
id|u32
id|daddr
)paren
(brace
r_struct
id|iphdr
op_star
id|iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
id|iph-&gt;version
op_assign
l_int|4
suffix:semicolon
id|iph-&gt;tos
op_assign
id|skb-&gt;nh.iph-&gt;tos
suffix:semicolon
id|iph-&gt;ttl
op_assign
id|skb-&gt;nh.iph-&gt;ttl
suffix:semicolon
id|iph-&gt;frag_off
op_assign
l_int|0
suffix:semicolon
id|iph-&gt;daddr
op_assign
id|daddr
suffix:semicolon
id|iph-&gt;saddr
op_assign
id|saddr
suffix:semicolon
id|iph-&gt;protocol
op_assign
id|IPPROTO_IPIP
suffix:semicolon
id|iph-&gt;ihl
op_assign
l_int|5
suffix:semicolon
id|iph-&gt;tot_len
op_assign
id|htons
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
id|ip_select_ident
c_func
(paren
id|iph
comma
id|skb-&gt;dst
)paren
suffix:semicolon
id|ip_send_check
c_func
(paren
id|iph
)paren
suffix:semicolon
id|skb-&gt;h.ipiph
op_assign
id|skb-&gt;nh.iph
suffix:semicolon
id|skb-&gt;nh.iph
op_assign
id|iph
suffix:semicolon
macro_line|#ifdef CONFIG_NETFILTER
id|nf_conntrack_put
c_func
(paren
id|skb-&gt;nfct
)paren
suffix:semicolon
id|skb-&gt;nfct
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
)brace
DECL|function|ipmr_forward_finish
r_static
r_inline
r_int
id|ipmr_forward_finish
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|dst_entry
op_star
id|dst
op_assign
id|skb-&gt;dst
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
op_le
id|dst-&gt;pmtu
)paren
r_return
id|dst
op_member_access_from_pointer
id|output
c_func
(paren
id|skb
)paren
suffix:semicolon
r_else
r_return
id|ip_fragment
c_func
(paren
id|skb
comma
id|dst-&gt;output
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Processing handlers for ipmr_forward&n; */
DECL|function|ipmr_queue_xmit
r_static
r_void
id|ipmr_queue_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|mfc_cache
op_star
id|c
comma
r_int
id|vifi
comma
r_int
id|last
)paren
(brace
r_struct
id|iphdr
op_star
id|iph
op_assign
id|skb-&gt;nh.iph
suffix:semicolon
r_struct
id|vif_device
op_star
id|vif
op_assign
op_amp
id|vif_table
(braket
id|vifi
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_int
id|encap
op_assign
l_int|0
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
r_if
c_cond
(paren
id|vif-&gt;dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
macro_line|#ifdef CONFIG_IP_PIMSM
r_if
c_cond
(paren
id|vif-&gt;flags
op_amp
id|VIFF_REGISTER
)paren
(brace
id|vif-&gt;pkt_out
op_increment
suffix:semicolon
id|vif-&gt;bytes_out
op_add_assign
id|skb-&gt;len
suffix:semicolon
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
id|vif-&gt;dev-&gt;priv
)paren
op_member_access_from_pointer
id|tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
id|vif-&gt;dev-&gt;priv
)paren
op_member_access_from_pointer
id|tx_packets
op_increment
suffix:semicolon
id|ipmr_cache_report
c_func
(paren
id|skb
comma
id|vifi
comma
id|IGMPMSG_WHOLEPKT
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|vif-&gt;flags
op_amp
id|VIFF_TUNNEL
)paren
(brace
r_if
c_cond
(paren
id|ip_route_output
c_func
(paren
op_amp
id|rt
comma
id|vif-&gt;remote
comma
id|vif-&gt;local
comma
id|RT_TOS
c_func
(paren
id|iph-&gt;tos
)paren
comma
id|vif-&gt;link
)paren
)paren
r_return
suffix:semicolon
id|encap
op_assign
r_sizeof
(paren
r_struct
id|iphdr
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ip_route_output
c_func
(paren
op_amp
id|rt
comma
id|iph-&gt;daddr
comma
l_int|0
comma
id|RT_TOS
c_func
(paren
id|iph-&gt;tos
)paren
comma
id|vif-&gt;link
)paren
)paren
r_return
suffix:semicolon
)brace
id|dev
op_assign
id|rt-&gt;u.dst.dev
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
op_plus
id|encap
OG
id|rt-&gt;u.dst.pmtu
op_logical_and
(paren
id|ntohs
c_func
(paren
id|iph-&gt;frag_off
)paren
op_amp
id|IP_DF
)paren
)paren
(brace
multiline_comment|/* Do not fragment multicasts. Alas, IPv4 does not&n;&t;&t;   allow to send ICMP, so that packets will disappear&n;&t;&t;   to blackhole.&n;&t;&t; */
id|IP_INC_STATS_BH
c_func
(paren
id|IpFragFails
)paren
suffix:semicolon
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|encap
op_add_assign
id|dev-&gt;hard_header_len
suffix:semicolon
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
id|encap
op_logical_or
id|skb_cloned
c_func
(paren
id|skb
)paren
op_logical_or
op_logical_neg
id|last
)paren
id|skb2
op_assign
id|skb_realloc_headroom
c_func
(paren
id|skb
comma
(paren
id|encap
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|skb-&gt;users
)paren
op_ne
l_int|1
)paren
id|skb2
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_else
(brace
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|skb2
op_assign
id|skb
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|vif-&gt;pkt_out
op_increment
suffix:semicolon
id|vif-&gt;bytes_out
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|dst_release
c_func
(paren
id|skb2-&gt;dst
)paren
suffix:semicolon
id|skb2-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
id|iph
op_assign
id|skb2-&gt;nh.iph
suffix:semicolon
id|ip_decrease_ttl
c_func
(paren
id|iph
)paren
suffix:semicolon
multiline_comment|/* FIXME: forward and output firewalls used to be called here.&n;&t; * What do we do with netfilter? -- RR */
r_if
c_cond
(paren
id|vif-&gt;flags
op_amp
id|VIFF_TUNNEL
)paren
(brace
id|ip_encap
c_func
(paren
id|skb2
comma
id|vif-&gt;local
comma
id|vif-&gt;remote
)paren
suffix:semicolon
multiline_comment|/* FIXME: extra output firewall step used to be here. --RR */
(paren
(paren
r_struct
id|ip_tunnel
op_star
)paren
id|vif-&gt;dev-&gt;priv
)paren
op_member_access_from_pointer
id|stat.tx_packets
op_increment
suffix:semicolon
(paren
(paren
r_struct
id|ip_tunnel
op_star
)paren
id|vif-&gt;dev-&gt;priv
)paren
op_member_access_from_pointer
id|stat.tx_bytes
op_add_assign
id|skb2-&gt;len
suffix:semicolon
)brace
id|IPCB
c_func
(paren
id|skb2
)paren
op_member_access_from_pointer
id|flags
op_or_assign
id|IPSKB_FORWARDED
suffix:semicolon
multiline_comment|/*&n;&t; * RFC1584 teaches, that DVMRP/PIM router must deliver packets locally&n;&t; * not only before forwarding, but after forwarding on all output&n;&t; * interfaces. It is clear, if mrouter runs a multicasting&n;&t; * program, it should receive packets not depending to what interface&n;&t; * program is joined.&n;&t; * If we will not make it, the program will have to join on all&n;&t; * interfaces. On the other hand, multihoming host (or router, but&n;&t; * not mrouter) cannot join to more than one interface - it will&n;&t; * result in receiving multiple packets.&n;&t; */
id|NF_HOOK
c_func
(paren
id|PF_INET
comma
id|NF_IP_FORWARD
comma
id|skb2
comma
id|skb-&gt;dev
comma
id|dev
comma
id|ipmr_forward_finish
)paren
suffix:semicolon
)brace
DECL|function|ipmr_find_vif
r_int
id|ipmr_find_vif
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ct
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
id|maxvif
op_minus
l_int|1
suffix:semicolon
id|ct
op_ge
l_int|0
suffix:semicolon
id|ct
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|vif_table
(braket
id|ct
)braket
dot
id|dev
op_eq
id|dev
)paren
r_break
suffix:semicolon
)brace
r_return
id|ct
suffix:semicolon
)brace
multiline_comment|/* &quot;local&quot; means that we should preserve one skb (for local delivery) */
DECL|function|ip_mr_forward
r_int
id|ip_mr_forward
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|mfc_cache
op_star
id|cache
comma
r_int
id|local
)paren
(brace
r_int
id|psend
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|vif
comma
id|ct
suffix:semicolon
id|vif
op_assign
id|cache-&gt;mfc_parent
suffix:semicolon
id|cache-&gt;mfc_un.res.pkt
op_increment
suffix:semicolon
id|cache-&gt;mfc_un.res.bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/*&n;&t; * Wrong interface: drop packet and (maybe) send PIM assert.&n;&t; */
r_if
c_cond
(paren
id|vif_table
(braket
id|vif
)braket
dot
id|dev
op_ne
id|skb-&gt;dev
)paren
(brace
r_int
id|true_vifi
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|key.iif
op_eq
l_int|0
)paren
(brace
multiline_comment|/* It is our own packet, looped back.&n;&t;&t;&t;   Very complicated situation...&n;&n;&t;&t;&t;   The best workaround until routing daemons will be&n;&t;&t;&t;   fixed is not to redistribute packet, if it was&n;&t;&t;&t;   send through wrong interface. It means, that&n;&t;&t;&t;   multicast applications WILL NOT work for&n;&t;&t;&t;   (S,G), which have default multicast route pointing&n;&t;&t;&t;   to wrong oif. In any case, it is not a good&n;&t;&t;&t;   idea to use multicasting applications on router.&n;&t;&t;&t; */
r_goto
id|dont_forward
suffix:semicolon
)brace
id|cache-&gt;mfc_un.res.wrong_if
op_increment
suffix:semicolon
id|true_vifi
op_assign
id|ipmr_find_vif
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|true_vifi
op_ge
l_int|0
op_logical_and
id|mroute_do_assert
op_logical_and
multiline_comment|/* pimsm uses asserts, when switching from RPT to SPT,&n;&t;&t;       so that we cannot check that packet arrived on an oif.&n;&t;&t;       It is bad, but otherwise we would need to move pretty&n;&t;&t;       large chunk of pimd to kernel. Ough... --ANK&n;&t;&t;     */
(paren
id|mroute_do_pim
op_logical_or
id|cache-&gt;mfc_un.res.ttls
(braket
id|true_vifi
)braket
OL
l_int|255
)paren
op_logical_and
id|jiffies
op_minus
id|cache-&gt;mfc_un.res.last_assert
OG
id|MFC_ASSERT_THRESH
)paren
(brace
id|cache-&gt;mfc_un.res.last_assert
op_assign
id|jiffies
suffix:semicolon
id|ipmr_cache_report
c_func
(paren
id|skb
comma
id|true_vifi
comma
id|IGMPMSG_WRONGVIF
)paren
suffix:semicolon
)brace
r_goto
id|dont_forward
suffix:semicolon
)brace
id|vif_table
(braket
id|vif
)braket
dot
id|pkt_in
op_increment
suffix:semicolon
id|vif_table
(braket
id|vif
)braket
dot
id|bytes_in
op_add_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Forward the frame&n;&t; */
r_for
c_loop
(paren
id|ct
op_assign
id|cache-&gt;mfc_un.res.maxvif
op_minus
l_int|1
suffix:semicolon
id|ct
op_ge
id|cache-&gt;mfc_un.res.minvif
suffix:semicolon
id|ct
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;nh.iph-&gt;ttl
OG
id|cache-&gt;mfc_un.res.ttls
(braket
id|ct
)braket
)paren
(brace
r_if
c_cond
(paren
id|psend
op_ne
op_minus
l_int|1
)paren
id|ipmr_queue_xmit
c_func
(paren
id|skb
comma
id|cache
comma
id|psend
comma
l_int|0
)paren
suffix:semicolon
id|psend
op_assign
id|ct
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|psend
op_ne
op_minus
l_int|1
)paren
id|ipmr_queue_xmit
c_func
(paren
id|skb
comma
id|cache
comma
id|psend
comma
op_logical_neg
id|local
)paren
suffix:semicolon
id|dont_forward
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|local
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Multicast packets for forwarding arrive here&n; */
DECL|function|ip_mr_input
r_int
id|ip_mr_input
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|mfc_cache
op_star
id|cache
suffix:semicolon
r_int
id|local
op_assign
(paren
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
)paren
op_member_access_from_pointer
id|rt_flags
op_amp
id|RTCF_LOCAL
suffix:semicolon
multiline_comment|/* Packet is looped back after forward, it should not be&n;&t;   forwarded second time, but still can be delivered locally.&n;&t; */
r_if
c_cond
(paren
id|IPCB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|flags
op_amp
id|IPSKB_FORWARDED
)paren
r_goto
id|dont_forward
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|local
)paren
(brace
r_if
c_cond
(paren
id|IPCB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|opt.router_alert
)paren
(brace
r_if
c_cond
(paren
id|ip_call_ra_chain
c_func
(paren
id|skb
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|skb-&gt;nh.iph-&gt;protocol
op_eq
id|IPPROTO_IGMP
)paren
(brace
multiline_comment|/* IGMPv1 (and broken IGMPv2 implementations sort of&n;&t;&t;&t;       Cisco IOS &lt;= 11.2(8)) do not put router alert&n;&t;&t;&t;       option to IGMP packets destined to routable&n;&t;&t;&t;       groups. It is very bad, because it means&n;&t;&t;&t;       that we can forward NO IGMP messages.&n;&t;&t;&t;     */
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mroute_socket
)paren
(brace
id|raw_rcv
c_func
(paren
id|mroute_socket
comma
id|skb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
)brace
)brace
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|cache
op_assign
id|ipmr_cache_find
c_func
(paren
id|skb-&gt;nh.iph-&gt;saddr
comma
id|skb-&gt;nh.iph-&gt;daddr
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;No usable cache entry&n;&t; */
r_if
c_cond
(paren
id|cache
op_eq
l_int|NULL
)paren
(brace
r_int
id|vif
suffix:semicolon
r_if
c_cond
(paren
id|local
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb2
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|ip_local_deliver
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
op_eq
l_int|NULL
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|skb
op_assign
id|skb2
suffix:semicolon
)brace
id|vif
op_assign
id|ipmr_find_vif
c_func
(paren
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vif
op_ge
l_int|0
)paren
(brace
r_int
id|err
op_assign
id|ipmr_cache_unresolved
c_func
(paren
id|vif
comma
id|skb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ip_mr_forward
c_func
(paren
id|skb
comma
id|cache
comma
id|local
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|local
)paren
r_return
id|ip_local_deliver
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|dont_forward
suffix:colon
r_if
c_cond
(paren
id|local
)paren
r_return
id|ip_local_deliver
c_func
(paren
id|skb
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_PIMSM_V1
multiline_comment|/*&n; * Handle IGMP messages of PIMv1&n; */
DECL|function|pim_rcv_v1
r_int
id|pim_rcv_v1
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_int
id|len
)paren
(brace
r_struct
id|igmphdr
op_star
id|pim
op_assign
(paren
r_struct
id|igmphdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|iphdr
op_star
id|encap
suffix:semicolon
r_struct
id|net_device
op_star
id|reg_dev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mroute_do_pim
op_logical_or
id|len
OL
r_sizeof
(paren
op_star
id|pim
)paren
op_plus
r_sizeof
(paren
op_star
id|encap
)paren
op_logical_or
id|pim-&gt;group
op_ne
id|PIM_V1_VERSION
op_logical_or
id|pim-&gt;code
op_ne
id|PIM_V1_REGISTER
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|encap
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
(paren
id|skb-&gt;h.raw
op_plus
r_sizeof
(paren
r_struct
id|igmphdr
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;   Check that:&n;&t;   a. packet is really destinted to a multicast group&n;&t;   b. packet is not a NULL-REGISTER&n;&t;   c. packet is not truncated&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|encap-&gt;daddr
)paren
op_logical_or
id|ntohs
c_func
(paren
id|encap-&gt;tot_len
)paren
op_eq
l_int|0
op_logical_or
id|ntohs
c_func
(paren
id|encap-&gt;tot_len
)paren
op_plus
r_sizeof
(paren
op_star
id|pim
)paren
OG
id|len
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_vif_num
op_ge
l_int|0
)paren
id|reg_dev
op_assign
id|vif_table
(braket
id|reg_vif_num
)braket
dot
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|reg_dev
)paren
id|dev_hold
c_func
(paren
id|reg_dev
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_dev
op_eq
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;nh.raw
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
(paren
id|u8
op_star
)paren
id|encap
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
id|skb-&gt;nh.iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;dev
op_assign
id|reg_dev
suffix:semicolon
id|memset
c_func
(paren
op_amp
(paren
id|IPCB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|opt
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ip_options
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|dst_release
c_func
(paren
id|skb-&gt;dst
)paren
suffix:semicolon
id|skb-&gt;dst
op_assign
l_int|NULL
suffix:semicolon
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
id|reg_dev-&gt;priv
)paren
op_member_access_from_pointer
id|rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
id|reg_dev-&gt;priv
)paren
op_member_access_from_pointer
id|rx_packets
op_increment
suffix:semicolon
macro_line|#ifdef CONFIG_NETFILTER
id|nf_conntrack_put
c_func
(paren
id|skb-&gt;nfct
)paren
suffix:semicolon
id|skb-&gt;nfct
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|reg_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_IP_PIMSM_V2
DECL|function|pim_rcv
r_int
id|pim_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_int
id|len
)paren
(brace
r_struct
id|pimreghdr
op_star
id|pim
op_assign
(paren
r_struct
id|pimreghdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_struct
id|iphdr
op_star
id|encap
suffix:semicolon
r_struct
id|net_device
op_star
id|reg_dev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
r_sizeof
(paren
op_star
id|pim
)paren
op_plus
r_sizeof
(paren
op_star
id|encap
)paren
op_logical_or
id|pim-&gt;type
op_ne
(paren
(paren
id|PIM_VERSION
op_lshift
l_int|4
)paren
op_or
(paren
id|PIM_REGISTER
)paren
)paren
op_logical_or
(paren
id|pim-&gt;flags
op_amp
id|PIM_NULL_REGISTER
)paren
op_logical_or
(paren
id|ip_compute_csum
c_func
(paren
(paren
r_void
op_star
)paren
id|pim
comma
r_sizeof
(paren
op_star
id|pim
)paren
)paren
op_ne
l_int|0
op_logical_and
id|ip_compute_csum
c_func
(paren
(paren
r_void
op_star
)paren
id|pim
comma
id|len
)paren
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* check if the inner packet is destined to mcast group */
id|encap
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
(paren
id|skb-&gt;h.raw
op_plus
r_sizeof
(paren
r_struct
id|pimreghdr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|encap-&gt;daddr
)paren
op_logical_or
id|ntohs
c_func
(paren
id|encap-&gt;tot_len
)paren
op_eq
l_int|0
op_logical_or
id|ntohs
c_func
(paren
id|encap-&gt;tot_len
)paren
op_plus
r_sizeof
(paren
op_star
id|pim
)paren
OG
id|len
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_vif_num
op_ge
l_int|0
)paren
id|reg_dev
op_assign
id|vif_table
(braket
id|reg_vif_num
)braket
dot
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|reg_dev
)paren
id|dev_hold
c_func
(paren
id|reg_dev
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_dev
op_eq
l_int|NULL
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;nh.raw
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
(paren
id|u8
op_star
)paren
id|encap
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
id|skb-&gt;nh.iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;dev
op_assign
id|reg_dev
suffix:semicolon
id|memset
c_func
(paren
op_amp
(paren
id|IPCB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|opt
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ip_options
)paren
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|dst_release
c_func
(paren
id|skb-&gt;dst
)paren
suffix:semicolon
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
id|reg_dev-&gt;priv
)paren
op_member_access_from_pointer
id|rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
(paren
(paren
r_struct
id|net_device_stats
op_star
)paren
id|reg_dev-&gt;priv
)paren
op_member_access_from_pointer
id|rx_packets
op_increment
suffix:semicolon
id|skb-&gt;dst
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_NETFILTER
id|nf_conntrack_put
c_func
(paren
id|skb-&gt;nfct
)paren
suffix:semicolon
id|skb-&gt;nfct
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_put
c_func
(paren
id|reg_dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_RTNETLINK
r_static
r_int
DECL|function|ipmr_fill_mroute
id|ipmr_fill_mroute
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|mfc_cache
op_star
id|c
comma
r_struct
id|rtmsg
op_star
id|rtm
)paren
(brace
r_int
id|ct
suffix:semicolon
r_struct
id|rtnexthop
op_star
id|nhp
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|vif_table
(braket
id|c-&gt;mfc_parent
)braket
dot
id|dev
suffix:semicolon
id|u8
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
r_struct
id|rtattr
op_star
id|mp_head
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|RTA_IIF
comma
l_int|4
comma
op_amp
id|dev-&gt;ifindex
)paren
suffix:semicolon
id|mp_head
op_assign
(paren
r_struct
id|rtattr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|RTA_LENGTH
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
id|c-&gt;mfc_un.res.minvif
suffix:semicolon
id|ct
OL
id|c-&gt;mfc_un.res.maxvif
suffix:semicolon
id|ct
op_increment
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;mfc_un.res.ttls
(braket
id|ct
)braket
OL
l_int|255
)paren
(brace
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
id|RTA_ALIGN
c_func
(paren
id|RTA_ALIGN
c_func
(paren
r_sizeof
(paren
op_star
id|nhp
)paren
)paren
op_plus
l_int|4
)paren
)paren
r_goto
id|rtattr_failure
suffix:semicolon
id|nhp
op_assign
(paren
r_struct
id|rtnexthop
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|RTA_ALIGN
c_func
(paren
r_sizeof
(paren
op_star
id|nhp
)paren
)paren
)paren
suffix:semicolon
id|nhp-&gt;rtnh_flags
op_assign
l_int|0
suffix:semicolon
id|nhp-&gt;rtnh_hops
op_assign
id|c-&gt;mfc_un.res.ttls
(braket
id|ct
)braket
suffix:semicolon
id|nhp-&gt;rtnh_ifindex
op_assign
id|vif_table
(braket
id|ct
)braket
dot
id|dev-&gt;ifindex
suffix:semicolon
id|nhp-&gt;rtnh_len
op_assign
r_sizeof
(paren
op_star
id|nhp
)paren
suffix:semicolon
)brace
)brace
id|mp_head-&gt;rta_type
op_assign
id|RTA_MULTIPATH
suffix:semicolon
id|mp_head-&gt;rta_len
op_assign
id|skb-&gt;tail
op_minus
(paren
id|u8
op_star
)paren
id|mp_head
suffix:semicolon
id|rtm-&gt;rtm_type
op_assign
id|RTN_MULTICAST
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
id|EMSGSIZE
suffix:semicolon
)brace
DECL|function|ipmr_get_route
r_int
id|ipmr_get_route
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|rtmsg
op_star
id|rtm
comma
r_int
id|nowait
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|mfc_cache
op_star
id|cache
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
op_assign
(paren
r_struct
id|rtable
op_star
)paren
id|skb-&gt;dst
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
id|cache
op_assign
id|ipmr_cache_find
c_func
(paren
id|rt-&gt;rt_src
comma
id|rt-&gt;rt_dst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cache
op_eq
l_int|NULL
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|vif
suffix:semicolon
r_if
c_cond
(paren
id|nowait
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|dev
op_assign
id|skb-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
op_logical_or
(paren
id|vif
op_assign
id|ipmr_find_vif
c_func
(paren
id|dev
)paren
)paren
OL
l_int|0
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|skb-&gt;nh.raw
op_assign
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
id|skb-&gt;nh.iph-&gt;ihl
op_assign
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_rshift
l_int|2
suffix:semicolon
id|skb-&gt;nh.iph-&gt;saddr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
id|skb-&gt;nh.iph-&gt;daddr
op_assign
id|rt-&gt;rt_dst
suffix:semicolon
id|skb-&gt;nh.iph-&gt;version
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|ipmr_cache_unresolved
c_func
(paren
id|vif
comma
id|skb
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|nowait
op_logical_and
(paren
id|rtm-&gt;rtm_flags
op_amp
id|RTM_F_NOTIFY
)paren
)paren
id|cache-&gt;mfc_flags
op_or_assign
id|MFC_NOTIFY
suffix:semicolon
id|err
op_assign
id|ipmr_fill_mroute
c_func
(paren
id|skb
comma
id|cache
comma
id|rtm
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PROC_FS&t;
multiline_comment|/*&n; *&t;The /proc interfaces to multicast routing /proc/ip_mr_cache /proc/ip_mr_vif&n; */
DECL|function|ipmr_vif_info
r_static
r_int
id|ipmr_vif_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_struct
id|vif_device
op_star
id|vif
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|ct
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Interface      BytesIn  PktsIn  BytesOut PktsOut Flags Local    Remote&bslash;n&quot;
)paren
suffix:semicolon
id|pos
op_assign
id|len
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|maxvif
suffix:semicolon
id|ct
op_increment
)paren
(brace
r_char
op_star
id|name
op_assign
l_string|&quot;none&quot;
suffix:semicolon
id|vif
op_assign
op_amp
id|vif_table
(braket
id|ct
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|VIF_EXISTS
c_func
(paren
id|ct
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vif-&gt;dev
)paren
id|name
op_assign
id|vif-&gt;dev-&gt;name
suffix:semicolon
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%2d %-10s %8ld %7ld  %8ld %7ld %05X %08X %08X&bslash;n&quot;
comma
id|ct
comma
id|name
comma
id|vif-&gt;bytes_in
comma
id|vif-&gt;pkt_in
comma
id|vif-&gt;bytes_out
comma
id|vif-&gt;pkt_out
comma
id|vif-&gt;flags
comma
id|vif-&gt;local
comma
id|vif-&gt;remote
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_add_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|ipmr_mfc_info
r_static
r_int
id|ipmr_mfc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_struct
id|mfc_cache
op_star
id|mfc
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|ct
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Group    Origin   Iif     Pkts    Bytes    Wrong Oifs&bslash;n&quot;
)paren
suffix:semicolon
id|pos
op_assign
id|len
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ct
op_assign
l_int|0
suffix:semicolon
id|ct
OL
id|MFC_LINES
suffix:semicolon
id|ct
op_increment
)paren
(brace
r_for
c_loop
(paren
id|mfc
op_assign
id|mfc_cache_array
(braket
id|ct
)braket
suffix:semicolon
id|mfc
suffix:semicolon
id|mfc
op_assign
id|mfc-&gt;next
)paren
(brace
r_int
id|n
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; *&t;Interface forwarding map&n;&t;&t;&t; */
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%08lX %08lX %-3d %8ld %8ld %8ld&quot;
comma
(paren
r_int
r_int
)paren
id|mfc-&gt;mfc_mcastgrp
comma
(paren
r_int
r_int
)paren
id|mfc-&gt;mfc_origin
comma
id|mfc-&gt;mfc_parent
comma
id|mfc-&gt;mfc_un.res.pkt
comma
id|mfc-&gt;mfc_un.res.bytes
comma
id|mfc-&gt;mfc_un.res.wrong_if
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
id|mfc-&gt;mfc_un.res.minvif
suffix:semicolon
id|n
OL
id|mfc-&gt;mfc_un.res.maxvif
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
id|VIF_EXISTS
c_func
(paren
id|n
)paren
op_logical_and
id|mfc-&gt;mfc_un.res.ttls
(braket
id|n
)braket
OL
l_int|255
)paren
(brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
op_plus
id|size
comma
l_string|&quot; %2d:%-3d&quot;
comma
id|n
comma
id|mfc-&gt;mfc_un.res.ttls
(braket
id|n
)braket
)paren
suffix:semicolon
)brace
)brace
id|size
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
op_plus
id|size
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_add_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_goto
id|done
suffix:semicolon
)brace
)brace
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|mfc
op_assign
id|mfc_unres_queue
suffix:semicolon
id|mfc
suffix:semicolon
id|mfc
op_assign
id|mfc-&gt;next
)paren
(brace
id|size
op_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%08lX %08lX %-3d %8ld %8ld %8ld&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|mfc-&gt;mfc_mcastgrp
comma
(paren
r_int
r_int
)paren
id|mfc-&gt;mfc_origin
comma
op_minus
l_int|1
comma
(paren
r_int
)paren
id|mfc-&gt;mfc_un.unres.unresolved.qlen
comma
l_int|0L
comma
l_int|0L
)paren
suffix:semicolon
id|len
op_add_assign
id|size
suffix:semicolon
id|pos
op_add_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|mfc_unres_lock
)paren
suffix:semicolon
id|done
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|mrt_lock
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif&t;
macro_line|#ifdef CONFIG_IP_PIMSM_V2
DECL|variable|pim_protocol
r_struct
id|inet_protocol
id|pim_protocol
op_assign
(brace
id|pim_rcv
comma
multiline_comment|/* PIM handler&t;&t;*/
l_int|NULL
comma
multiline_comment|/* PIM error control&t;*/
l_int|NULL
comma
multiline_comment|/* next&t;&t;&t;*/
id|IPPROTO_PIM
comma
multiline_comment|/* protocol ID&t;&t;*/
l_int|0
comma
multiline_comment|/* copy&t;&t;&t;*/
l_int|NULL
comma
multiline_comment|/* data&t;&t;&t;*/
l_string|&quot;PIM&quot;
multiline_comment|/* name&t;&t;&t;*/
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; *&t;Setup for IP multicast routing&n; */
DECL|function|ip_mr_init
r_void
id|__init
id|ip_mr_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Linux IP multicast router 0.06 plus PIM-SM&bslash;n&quot;
)paren
suffix:semicolon
id|mrt_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;ip_mrt_cache&quot;
comma
r_sizeof
(paren
r_struct
id|mfc_cache
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|ipmr_expire_timer
)paren
suffix:semicolon
id|ipmr_expire_timer.function
op_assign
id|ipmr_expire_process
suffix:semicolon
id|register_netdevice_notifier
c_func
(paren
op_amp
id|ip_mr_notifier
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS&t;
id|proc_net_create
c_func
(paren
l_string|&quot;ip_mr_vif&quot;
comma
l_int|0
comma
id|ipmr_vif_info
)paren
suffix:semicolon
id|proc_net_create
c_func
(paren
l_string|&quot;ip_mr_cache&quot;
comma
l_int|0
comma
id|ipmr_mfc_info
)paren
suffix:semicolon
macro_line|#endif&t;
)brace
eof
