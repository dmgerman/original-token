multiline_comment|/*&n; * INET&t;&t;An implementation of the TCP/IP protocol suite for the LINUX&n; *&t;&t;operating system.  INET is implemented using the  BSD Socket&n; *&t;&t;interface as the means of communication with the user level.&n; *&n; *&t;&t;IP/TCP/UDP checksumming routines&n; *&n; * Authors:&t;Jorge Cwik, &lt;jorge@laser.satlink.net&gt;&n; *&t;&t;Arnt Gulbrandsen, &lt;agulbra@nvg.unit.no&gt;&n; *&t;&t;Lots of code moved from tcp.c and ip.c; see those files&n; *&t;&t;for more names.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;net/checksum.h&gt;
multiline_comment|/*&n; * computes a partial checksum, e.g. for TCP/UDP fragments&n; */
DECL|function|csum_partial
r_int
r_int
id|csum_partial
c_func
(paren
r_int
r_char
op_star
id|buff
comma
r_int
id|len
comma
r_int
r_int
id|sum
)paren
(brace
macro_line|#ifdef __i386__
id|__asm__
c_func
(paren
"&quot;"
id|movl
op_mod
op_mod
id|ecx
comma
op_mod
op_mod
id|edx
id|cld
id|shrl
"$"
l_int|5
comma
op_mod
op_mod
id|ecx
id|jz
l_float|2f
id|orl
op_mod
op_mod
id|ecx
comma
op_mod
op_mod
id|ecx
l_int|1
suffix:colon
id|movl
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
l_int|4
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
l_int|8
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
l_int|12
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
l_int|16
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
l_int|20
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
l_int|24
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
l_int|28
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|lea
l_int|32
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|esi
id|dec
op_mod
op_mod
id|ecx
id|jne
l_int|1
id|b
id|adcl
"$"
l_int|0
comma
op_mod
op_mod
id|ebx
l_int|2
suffix:colon
id|movl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|ecx
id|andl
"$"
l_int|28
comma
op_mod
op_mod
id|ecx
id|je
l_float|4f
id|shrl
"$"
l_int|2
comma
op_mod
op_mod
id|ecx
id|orl
op_mod
op_mod
id|ecx
comma
op_mod
op_mod
id|ecx
l_int|3
suffix:colon
id|adcl
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|ebx
id|lea
l_int|4
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|esi
id|dec
op_mod
op_mod
id|ecx
id|jne
l_int|3
id|b
id|adcl
"$"
l_int|0
comma
op_mod
op_mod
id|ebx
l_int|4
suffix:colon
id|movl
"$"
l_int|0
comma
op_mod
op_mod
id|eax
id|testw
"$"
l_int|2
comma
op_mod
op_mod
id|dx
id|je
l_float|5f
id|lodsw
id|addl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|adcl
"$"
l_int|0
comma
op_mod
op_mod
id|ebx
id|movw
"$"
l_int|0
comma
op_mod
op_mod
id|ax
l_int|5
suffix:colon
id|test
"$"
l_int|1
comma
op_mod
op_mod
id|edx
id|je
l_float|6f
id|lodsb
id|addl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|adcl
"$"
l_int|0
comma
op_mod
op_mod
id|ebx
l_int|6
suffix:colon
"&quot;"
suffix:colon
l_string|&quot;=b&quot;
(paren
id|sum
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|sum
)paren
comma
l_string|&quot;c&quot;
(paren
id|len
)paren
comma
l_string|&quot;S&quot;
(paren
id|buff
)paren
suffix:colon
l_string|&quot;ax&quot;
comma
l_string|&quot;bx&quot;
comma
l_string|&quot;cx&quot;
comma
l_string|&quot;dx&quot;
comma
l_string|&quot;si&quot;
)paren
suffix:semicolon
macro_line|#else
macro_line|#error Not implemented for this CPU
macro_line|#endif
r_return
id|sum
suffix:semicolon
)brace
multiline_comment|/*&n; * copy from fs while checksumming, otherwise like csum_partial&n; */
DECL|function|csum_partial_copyffs
r_int
r_int
id|csum_partial_copyffs
c_func
(paren
r_char
op_star
id|src
comma
r_char
op_star
id|dst
comma
r_int
id|len
comma
r_int
id|sum
)paren
(brace
macro_line|#ifdef __i386__
id|__asm__
c_func
(paren
"&quot;"
id|push
op_mod
op_mod
id|ds
id|push
op_mod
op_mod
id|es
id|movw
op_mod
op_mod
id|ds
comma
op_mod
op_mod
id|dx
id|movw
op_mod
op_mod
id|dx
comma
op_mod
op_mod
id|es
id|movw
op_mod
op_mod
id|fs
comma
op_mod
op_mod
id|dx
id|movw
op_mod
op_mod
id|dx
comma
op_mod
op_mod
id|ds
id|cld
id|cmpl
"$"
l_int|32
comma
op_mod
op_mod
id|ecx
id|jb
l_float|2f
id|pushl
op_mod
op_mod
id|ecx
id|shrl
"$"
l_int|5
comma
op_mod
op_mod
id|ecx
id|orl
op_mod
op_mod
id|ecx
comma
op_mod
op_mod
id|ecx
l_int|1
suffix:colon
id|movl
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|movl
l_int|4
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|edx
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|es
suffix:colon
(paren
op_mod
op_mod
id|edi
)paren
id|adcl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|es
suffix:colon
l_int|4
(paren
op_mod
op_mod
id|edi
)paren
id|movl
l_int|8
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|movl
l_int|12
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|edx
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|es
suffix:colon
l_int|8
(paren
op_mod
op_mod
id|edi
)paren
id|adcl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|es
suffix:colon
l_int|12
(paren
op_mod
op_mod
id|edi
)paren
id|movl
l_int|16
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|movl
l_int|20
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|edx
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|es
suffix:colon
l_int|16
(paren
op_mod
op_mod
id|edi
)paren
id|adcl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|es
suffix:colon
l_int|20
(paren
op_mod
op_mod
id|edi
)paren
id|movl
l_int|24
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|movl
l_int|28
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|edx
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|es
suffix:colon
l_int|24
(paren
op_mod
op_mod
id|edi
)paren
id|adcl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|edx
comma
op_mod
op_mod
id|es
suffix:colon
l_int|28
(paren
op_mod
op_mod
id|edi
)paren
id|lea
l_int|32
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|esi
id|lea
l_int|32
(paren
op_mod
op_mod
id|edi
)paren
comma
op_mod
op_mod
id|edi
id|dec
op_mod
op_mod
id|ecx
id|jne
l_int|1
id|b
id|adcl
"$"
l_int|0
comma
op_mod
op_mod
id|ebx
id|popl
op_mod
op_mod
id|ecx
l_int|2
suffix:colon
id|movl
op_mod
op_mod
id|ecx
comma
op_mod
op_mod
id|edx
id|andl
"$"
l_int|28
comma
op_mod
op_mod
id|ecx
id|je
l_float|4f
id|shrl
"$"
l_int|2
comma
op_mod
op_mod
id|ecx
id|orl
op_mod
op_mod
id|ecx
comma
op_mod
op_mod
id|ecx
l_int|3
suffix:colon
id|movl
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|eax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|es
suffix:colon
(paren
op_mod
op_mod
id|edi
)paren
id|lea
l_int|4
(paren
op_mod
op_mod
id|esi
)paren
comma
op_mod
op_mod
id|esi
id|lea
l_int|4
(paren
op_mod
op_mod
id|edi
)paren
comma
op_mod
op_mod
id|edi
id|dec
op_mod
op_mod
id|ecx
id|jne
l_int|3
id|b
id|adcl
"$"
l_int|0
comma
op_mod
op_mod
id|ebx
l_int|4
suffix:colon
id|movl
"$"
l_int|0
comma
op_mod
op_mod
id|eax
id|testl
"$"
l_int|2
comma
op_mod
op_mod
id|edx
id|je
l_float|5f
id|lodsw
id|stosw
id|addl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|movw
"$"
l_int|0
comma
op_mod
op_mod
id|ax
id|adcl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
l_int|5
suffix:colon
id|test
"$"
l_int|1
comma
op_mod
op_mod
id|edx
id|je
l_float|6f
id|lodsb
id|stosb
id|addl
op_mod
op_mod
id|eax
comma
op_mod
op_mod
id|ebx
id|adcl
"$"
l_int|0
comma
op_mod
op_mod
id|ebx
l_int|6
suffix:colon
id|pop
op_mod
op_mod
id|es
id|pop
op_mod
op_mod
id|ds
"&quot;"
suffix:colon
l_string|&quot;=b&quot;
(paren
id|sum
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|sum
)paren
comma
l_string|&quot;c&quot;
(paren
id|len
)paren
comma
l_string|&quot;S&quot;
(paren
id|src
)paren
comma
l_string|&quot;D&quot;
(paren
id|dst
)paren
suffix:colon
l_string|&quot;ax&quot;
comma
l_string|&quot;bx&quot;
comma
l_string|&quot;cx&quot;
comma
l_string|&quot;dx&quot;
comma
l_string|&quot;si&quot;
comma
l_string|&quot;di&quot;
)paren
suffix:semicolon
macro_line|#else
macro_line|#error Not implemented for this CPU
macro_line|#endif
r_return
id|sum
suffix:semicolon
)brace
eof
