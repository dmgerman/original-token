multiline_comment|/*&n; *&t;Linux NET3:&t;Internet Group Management Protocol  [IGMP]&n; *&n; *&t;This code implements the IGMP protocol as defined in RFC1112. There has&n; *&t;been a further revision of this protocol since which is now supported.&n; *&n; *&t;If you have trouble with this module be careful what gcc you have used,&n; *&t;the older version didn&squot;t come out right using gcc 2.5.8, the newer one&n; *&t;seems to fall out with gcc 2.6.2.&n; *&n; *&t;Authors:&n; *&t;&t;Alan Cox &lt;Alan.Cox@linux.org&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; *&n; *&t;Fixes:&n; *&n; *&t;&t;Alan Cox&t;:&t;Added lots of __inline__ to optimise&n; *&t;&t;&t;&t;&t;the memory usage of all the tiny little&n; *&t;&t;&t;&t;&t;functions.&n; *&t;&t;Alan Cox&t;:&t;Dumped the header building experiment.&n; *&t;&t;Alan Cox&t;:&t;Minor tweaks ready for multicast routing&n; *&t;&t;&t;&t;&t;and extended IGMP protocol.&n; *&t;&t;Alan Cox&t;:&t;Removed a load of inline directives. Gcc 2.5.8&n; *&t;&t;&t;&t;&t;writes utterly bogus code otherwise (sigh)&n; *&t;&t;&t;&t;&t;fixed IGMP loopback to behave in the manner&n; *&t;&t;&t;&t;&t;desired by mrouted, fixed the fact it has been&n; *&t;&t;&t;&t;&t;broken since 1.3.6 and cleaned up a few minor&n; *&t;&t;&t;&t;&t;points.&n; *&n; *&t;&t;Chih-Jen Chang&t;:&t;Tried to revise IGMP to Version 2&n; *&t;&t;Tsu-Sheng Tsao&t;&t;E-mail: chihjenc@scf.usc.edu and tsusheng@scf.usc.edu&n; *&t;&t;&t;&t;&t;The enhancements are mainly based on Steve Deering&squot;s &n; * &t;&t;&t;&t;&t;ipmulti-3.5 source code.&n; *&t;&t;Chih-Jen Chang&t;:&t;Added the igmp_get_mrouter_info and&n; *&t;&t;Tsu-Sheng Tsao&t;&t;igmp_set_mrouter_info to keep track of&n; *&t;&t;&t;&t;&t;the mrouted version on that device.&n; *&t;&t;Chih-Jen Chang&t;:&t;Added the max_resp_time parameter to&n; *&t;&t;Tsu-Sheng Tsao&t;&t;igmp_heard_query(). Using this parameter&n; *&t;&t;&t;&t;&t;to identify the multicast router version&n; *&t;&t;&t;&t;&t;and do what the IGMP version 2 specified.&n; *&t;&t;Chih-Jen Chang&t;:&t;Added a timer to revert to IGMP V2 router&n; *&t;&t;Tsu-Sheng Tsao&t;&t;if the specified time expired.&n; *&t;&t;Alan Cox&t;:&t;Stop IGMP from 0.0.0.0 being accepted.&n; *&t;&t;Alan Cox&t;:&t;Use GFP_ATOMIC in the right places.&n; *&t;&t;Christian Daudt :&t;igmp timer wasn&squot;t set for local group&n; *&t;&t;&t;&t;&t;memberships but was being deleted, &n; *&t;&t;&t;&t;&t;which caused a &quot;del_timer() called &n; *&t;&t;&t;&t;&t;from %p with timer not initialized&bslash;n&quot;&n; *&t;&t;&t;&t;&t;message (960131).&n; *&t;&t;Christian Daudt :&t;removed del_timer from &n; *&t;&t;&t;&t;&t;igmp_timer_expire function (960205).&n; *             Christian Daudt :       igmp_heard_report now only calls&n; *                                     igmp_timer_expire if tm-&gt;running is&n; *                                     true (960216).&n; *&t;&t;Malcolm Beattie :&t;ttl comparison wrong in igmp_rcv made&n; *&t;&t;&t;&t;&t;igmp_heard_query never trigger. Expiry&n; *&t;&t;&t;&t;&t;miscalculation fixed in igmp_heard_query&n; *&t;&t;&t;&t;&t;and random() made to return unsigned to&n; *&t;&t;&t;&t;&t;prevent negative expiry times.&n; *&t;&t;Alexey Kuznetsov:&t;Wrong group leaving behaviour, backport&n; *&t;&t;&t;&t;&t;fix from pending 2.1.x patches.&n; *&t;&t;Alan Cox:&t;&t;Forget to enable FDDI support earlier.&n; */
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/protocol.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;linux/igmp.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
multiline_comment|/*&n; *&t;If time expired, change the router type to IGMP_NEW_ROUTER.&n; */
DECL|function|ip_router_timer_expire
r_static
r_void
id|ip_router_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|ip_router_info
op_star
id|i
op_assign
(paren
r_struct
id|ip_router_info
op_star
)paren
id|data
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|i-&gt;timer
)paren
suffix:semicolon
id|i-&gt;type
op_assign
id|IGMP_NEW_ROUTER
suffix:semicolon
multiline_comment|/* Revert to new multicast router */
id|i-&gt;time
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Multicast router info manager&n; */
DECL|variable|ip_router_info_head
r_struct
id|ip_router_info
op_star
id|ip_router_info_head
op_assign
(paren
r_struct
id|ip_router_info
op_star
)paren
l_int|0
suffix:semicolon
multiline_comment|/*&n; *&t;Get the multicast router info on that device&n; */
DECL|function|igmp_get_mrouter_info
r_static
r_struct
id|ip_router_info
op_star
id|igmp_get_mrouter_info
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_register
r_struct
id|ip_router_info
op_star
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ip_router_info_head
suffix:semicolon
id|i
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|i-&gt;dev
op_eq
id|dev
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *  Not found. Create a new entry. The default is IGMP V2 router&n;&t; */
id|i
op_assign
(paren
r_struct
id|ip_router_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|i
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|i-&gt;dev
op_assign
id|dev
suffix:semicolon
id|i-&gt;type
op_assign
id|IGMP_NEW_ROUTER
suffix:semicolon
id|i-&gt;time
op_assign
id|IGMP_AGE_THRESHOLD
suffix:semicolon
id|i-&gt;next
op_assign
id|ip_router_info_head
suffix:semicolon
id|ip_router_info_head
op_assign
id|i
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|i-&gt;timer
)paren
suffix:semicolon
id|i-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|i
suffix:semicolon
id|i-&gt;timer.function
op_assign
op_amp
id|ip_router_timer_expire
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Set the multicast router info on that device&n; */
DECL|function|igmp_set_mrouter_info
r_static
r_struct
id|ip_router_info
op_star
id|igmp_set_mrouter_info
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|type
comma
r_int
id|time
)paren
(brace
r_register
r_struct
id|ip_router_info
op_star
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ip_router_info_head
suffix:semicolon
id|i
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|i-&gt;dev
op_eq
id|dev
)paren
(brace
r_if
c_cond
(paren
id|i-&gt;type
op_eq
id|IGMP_OLD_ROUTER
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|i-&gt;timer
)paren
suffix:semicolon
)brace
id|i-&gt;type
op_assign
id|type
suffix:semicolon
id|i-&gt;time
op_assign
id|time
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;type
op_eq
id|IGMP_OLD_ROUTER
)paren
(brace
id|i-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|i-&gt;time
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|i-&gt;timer
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *  Not found. Create a new entry.&n;&t; */
id|i
op_assign
(paren
r_struct
id|ip_router_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|i
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|i-&gt;dev
op_assign
id|dev
suffix:semicolon
id|i-&gt;type
op_assign
id|type
suffix:semicolon
id|i-&gt;time
op_assign
id|time
suffix:semicolon
id|i-&gt;next
op_assign
id|ip_router_info_head
suffix:semicolon
id|ip_router_info_head
op_assign
id|i
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|i-&gt;timer
)paren
suffix:semicolon
id|i-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|i
suffix:semicolon
id|i-&gt;timer.function
op_assign
op_amp
id|ip_router_timer_expire
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;type
op_eq
id|IGMP_OLD_ROUTER
)paren
(brace
id|i-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|i-&gt;time
op_star
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|i-&gt;timer
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Timer management&n; */
DECL|function|igmp_stop_timer
r_static
r_void
id|igmp_stop_timer
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
r_if
c_cond
(paren
id|im-&gt;tm_running
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|im-&gt;timer
)paren
suffix:semicolon
id|im-&gt;tm_running
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;igmp_stop_timer() called with timer not running by %p&bslash;n&quot;
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|random
r_extern
id|__inline__
r_int
r_int
id|random
c_func
(paren
r_void
)paren
(brace
r_static
r_int
r_int
id|seed
op_assign
l_int|152L
suffix:semicolon
id|seed
op_assign
id|seed
op_star
l_int|69069L
op_plus
l_int|1
suffix:semicolon
r_return
id|seed
op_xor
id|jiffies
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Inlined as it&squot;s only called once.&n; */
DECL|function|igmp_start_timer
r_static
r_void
id|igmp_start_timer
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
comma
r_int
r_char
id|max_resp_time
)paren
(brace
r_int
id|tv
suffix:semicolon
r_if
c_cond
(paren
id|im-&gt;tm_running
)paren
(brace
r_return
suffix:semicolon
)brace
id|tv
op_assign
id|random
c_func
(paren
)paren
op_mod
(paren
id|max_resp_time
op_star
id|HZ
op_div
id|IGMP_TIMER_SCALE
)paren
suffix:semicolon
multiline_comment|/* Pick a number any number 8) */
id|im-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|tv
suffix:semicolon
id|im-&gt;tm_running
op_assign
l_int|1
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|im-&gt;timer
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Send an IGMP report.&n; */
DECL|macro|IGMP_SIZE
mdefine_line|#define IGMP_SIZE (sizeof(struct igmphdr)+sizeof(struct iphdr)+4)
DECL|function|igmp_send_report
r_static
r_void
id|igmp_send_report
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|group
comma
r_int
id|type
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|iphdr
op_star
id|iph
suffix:semicolon
r_struct
id|igmphdr
op_star
id|ih
suffix:semicolon
r_struct
id|rtable
op_star
id|rt
suffix:semicolon
r_if
c_cond
(paren
id|ip_route_output
c_func
(paren
op_amp
id|rt
comma
id|group
comma
l_int|0
comma
l_int|0
comma
id|dev
)paren
)paren
r_return
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|IGMP_SIZE
op_plus
id|dev-&gt;hard_header_len
op_plus
l_int|15
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|ip_rt_put
c_func
(paren
id|rt
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;dst
op_assign
op_amp
id|rt-&gt;u.dst
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
(paren
id|dev-&gt;hard_header_len
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
id|ip_ll_header
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb-&gt;nh.iph
op_assign
id|iph
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_plus
l_int|4
)paren
suffix:semicolon
id|iph-&gt;version
op_assign
l_int|4
suffix:semicolon
id|iph-&gt;ihl
op_assign
(paren
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_plus
l_int|4
)paren
op_rshift
l_int|2
suffix:semicolon
id|iph-&gt;tos
op_assign
l_int|0
suffix:semicolon
id|iph-&gt;frag_off
op_assign
l_int|0
suffix:semicolon
id|iph-&gt;ttl
op_assign
l_int|1
suffix:semicolon
id|iph-&gt;daddr
op_assign
id|group
suffix:semicolon
id|iph-&gt;saddr
op_assign
id|rt-&gt;rt_src
suffix:semicolon
id|iph-&gt;protocol
op_assign
id|IPPROTO_IGMP
suffix:semicolon
id|iph-&gt;tot_len
op_assign
id|htons
c_func
(paren
id|IGMP_SIZE
)paren
suffix:semicolon
id|iph-&gt;id
op_assign
id|htons
c_func
(paren
id|ip_id_count
op_increment
)paren
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|iph
(braket
l_int|1
)braket
)paren
(braket
l_int|0
)braket
op_assign
id|IPOPT_RA
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|iph
(braket
l_int|1
)braket
)paren
(braket
l_int|1
)braket
op_assign
l_int|4
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|iph
(braket
l_int|1
)braket
)paren
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
op_amp
id|iph
(braket
l_int|1
)braket
)paren
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|ip_send_check
c_func
(paren
id|iph
)paren
suffix:semicolon
id|ih
op_assign
(paren
r_struct
id|igmphdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|igmphdr
)paren
)paren
suffix:semicolon
id|ih-&gt;type
op_assign
id|type
suffix:semicolon
id|ih-&gt;code
op_assign
l_int|0
suffix:semicolon
id|ih-&gt;csum
op_assign
l_int|0
suffix:semicolon
id|ih-&gt;group
op_assign
id|group
suffix:semicolon
id|ih-&gt;csum
op_assign
id|ip_compute_csum
c_func
(paren
(paren
r_void
op_star
)paren
id|ih
comma
r_sizeof
(paren
r_struct
id|igmphdr
)paren
)paren
suffix:semicolon
id|skb-&gt;dst
op_member_access_from_pointer
id|output
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|igmp_timer_expire
r_static
r_void
id|igmp_timer_expire
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
op_assign
(paren
r_struct
id|ip_mc_list
op_star
)paren
id|data
suffix:semicolon
r_struct
id|ip_router_info
op_star
id|r
suffix:semicolon
id|im-&gt;tm_running
op_assign
l_int|0
suffix:semicolon
id|r
op_assign
id|igmp_get_mrouter_info
c_func
(paren
id|im-&gt;interface
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r-&gt;type
op_eq
id|IGMP_NEW_ROUTER
)paren
(brace
id|igmp_send_report
c_func
(paren
id|im-&gt;interface
comma
id|im-&gt;multiaddr
comma
id|IGMP_HOST_NEW_MEMBERSHIP_REPORT
)paren
suffix:semicolon
)brace
r_else
id|igmp_send_report
c_func
(paren
id|im-&gt;interface
comma
id|im-&gt;multiaddr
comma
id|IGMP_HOST_MEMBERSHIP_REPORT
)paren
suffix:semicolon
id|im-&gt;reporter
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|igmp_init_timer
r_static
r_void
id|igmp_init_timer
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
id|im-&gt;tm_running
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|im-&gt;timer
)paren
suffix:semicolon
id|im-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|im
suffix:semicolon
id|im-&gt;timer.function
op_assign
op_amp
id|igmp_timer_expire
suffix:semicolon
)brace
DECL|function|igmp_heard_report
r_static
r_void
id|igmp_heard_report
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|group
comma
id|u32
id|source
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
multiline_comment|/* Timers are only set for non-local groups */
r_if
c_cond
(paren
id|LOCAL_MCAST
c_func
(paren
id|group
)paren
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|im
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|im
op_ne
l_int|NULL
suffix:semicolon
id|im
op_assign
id|im-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|im-&gt;multiaddr
op_eq
id|group
)paren
(brace
r_if
c_cond
(paren
id|im-&gt;tm_running
)paren
id|igmp_stop_timer
c_func
(paren
id|im
)paren
suffix:semicolon
r_if
c_cond
(paren
id|source
op_ne
id|dev-&gt;pa_addr
)paren
id|im-&gt;reporter
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
DECL|function|igmp_heard_query
r_static
r_void
id|igmp_heard_query
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
r_char
id|max_resp_time
comma
id|u32
id|group
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
r_int
id|mrouter_type
suffix:semicolon
multiline_comment|/*&n;&t; *&t;The max_resp_time is in units of 1/10 second.&n;&t; */
r_if
c_cond
(paren
id|max_resp_time
OG
l_int|0
)paren
(brace
id|mrouter_type
op_assign
id|IGMP_NEW_ROUTER
suffix:semicolon
r_if
c_cond
(paren
id|igmp_set_mrouter_info
c_func
(paren
id|dev
comma
id|mrouter_type
comma
l_int|0
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t;&t; * - Start the timers in all of our membership records&n;&t;&t; *   that the query applies to for the interface on&n;&t;&t; *   which the query arrived excl. those that belong&n;&t;&t; *   to a &quot;local&quot; group (224.0.0.X)&n;&t;&t; * - For timers already running check if they need to&n;&t;&t; *   be reset.&n;&t;&t; * - Use the igmp-&gt;igmp_code field as the maximum&n;&t;&t; *   delay possible&n;&t;&t; */
r_for
c_loop
(paren
id|im
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|im
op_ne
l_int|NULL
suffix:semicolon
id|im
op_assign
id|im-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|group
op_logical_and
id|group
op_ne
id|im-&gt;multiaddr
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|im-&gt;tm_running
)paren
(brace
r_if
c_cond
(paren
id|im-&gt;timer.expires
OG
id|jiffies
op_plus
id|max_resp_time
op_star
id|HZ
op_div
id|IGMP_TIMER_SCALE
)paren
(brace
id|igmp_stop_timer
c_func
(paren
id|im
)paren
suffix:semicolon
id|igmp_start_timer
c_func
(paren
id|im
comma
id|max_resp_time
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|im-&gt;multiaddr
)paren
)paren
id|igmp_start_timer
c_func
(paren
id|im
comma
id|max_resp_time
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|mrouter_type
op_assign
id|IGMP_OLD_ROUTER
suffix:semicolon
id|max_resp_time
op_assign
id|IGMP_MAX_HOST_REPORT_DELAY
op_star
id|IGMP_TIMER_SCALE
suffix:semicolon
r_if
c_cond
(paren
id|igmp_set_mrouter_info
c_func
(paren
id|dev
comma
id|mrouter_type
comma
id|IGMP_AGE_THRESHOLD
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Start the timers in all of our membership records for&n;&t;&t; * the interface on which the query arrived, except those&n;&t;&t; * that are already running and those that belong to a&n;&t;&t; * &quot;local&quot; group (224.0.0.X).&n;&t;&t; */
r_for
c_loop
(paren
id|im
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|im
op_ne
l_int|NULL
suffix:semicolon
id|im
op_assign
id|im-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|im-&gt;tm_running
op_logical_and
op_logical_neg
id|LOCAL_MCAST
c_func
(paren
id|im-&gt;multiaddr
)paren
)paren
(brace
id|igmp_start_timer
c_func
(paren
id|im
comma
id|max_resp_time
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/*&n; *&t;Map a multicast IP onto multicast MAC for type ethernet.&n; */
DECL|function|ip_mc_map
r_extern
id|__inline__
r_void
id|ip_mc_map
c_func
(paren
r_int
r_int
id|addr
comma
r_char
op_star
id|buf
)paren
(brace
id|addr
op_assign
id|ntohl
c_func
(paren
id|addr
)paren
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x01
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
l_int|0x5e
suffix:semicolon
id|buf
(braket
l_int|5
)braket
op_assign
id|addr
op_amp
l_int|0xFF
suffix:semicolon
id|addr
op_rshift_assign
l_int|8
suffix:semicolon
id|buf
(braket
l_int|4
)braket
op_assign
id|addr
op_amp
l_int|0xFF
suffix:semicolon
id|addr
op_rshift_assign
l_int|8
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
id|addr
op_amp
l_int|0x7F
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Add a filter to a device&n; */
DECL|function|ip_mc_filter_add
r_void
id|ip_mc_filter_add
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
(brace
r_char
id|buf
(braket
l_int|6
)braket
suffix:semicolon
id|ip_rt_multicast_event
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_MULTICAST
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_ETHER
op_logical_and
id|dev-&gt;type
op_ne
id|ARPHRD_FDDI
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* Only do ethernet or FDDI for now */
id|ip_mc_map
c_func
(paren
id|addr
comma
id|buf
)paren
suffix:semicolon
id|dev_mc_add
c_func
(paren
id|dev
comma
id|buf
comma
id|ETH_ALEN
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Remove a filter from a device&n; */
DECL|function|ip_mc_filter_del
r_void
id|ip_mc_filter_del
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
(brace
r_char
id|buf
(braket
l_int|6
)braket
suffix:semicolon
id|ip_rt_multicast_event
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_ne
id|ARPHRD_ETHER
op_logical_and
id|dev-&gt;type
op_ne
id|ARPHRD_FDDI
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* Only do ethernet or FDDI for now */
id|ip_mc_map
c_func
(paren
id|addr
comma
id|buf
)paren
suffix:semicolon
id|dev_mc_delete
c_func
(paren
id|dev
comma
id|buf
comma
id|ETH_ALEN
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|igmp_group_dropped
r_extern
id|__inline__
r_void
id|igmp_group_dropped
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|im-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|im-&gt;reporter
)paren
id|igmp_send_report
c_func
(paren
id|im-&gt;interface
comma
id|im-&gt;multiaddr
comma
id|IGMP_HOST_LEAVE_MESSAGE
)paren
suffix:semicolon
id|ip_mc_filter_del
c_func
(paren
id|im-&gt;interface
comma
id|im-&gt;multiaddr
)paren
suffix:semicolon
)brace
DECL|function|igmp_group_added
r_extern
id|__inline__
r_void
id|igmp_group_added
c_func
(paren
r_struct
id|ip_mc_list
op_star
id|im
)paren
(brace
r_struct
id|ip_router_info
op_star
id|r
suffix:semicolon
id|igmp_init_timer
c_func
(paren
id|im
)paren
suffix:semicolon
id|ip_mc_filter_add
c_func
(paren
id|im-&gt;interface
comma
id|im-&gt;multiaddr
)paren
suffix:semicolon
id|r
op_assign
id|igmp_get_mrouter_info
c_func
(paren
id|im-&gt;interface
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|r-&gt;type
op_eq
id|IGMP_NEW_ROUTER
)paren
(brace
id|igmp_send_report
c_func
(paren
id|im-&gt;interface
comma
id|im-&gt;multiaddr
comma
id|IGMP_HOST_NEW_MEMBERSHIP_REPORT
)paren
suffix:semicolon
)brace
r_else
id|igmp_send_report
c_func
(paren
id|im-&gt;interface
comma
id|im-&gt;multiaddr
comma
id|IGMP_HOST_MEMBERSHIP_REPORT
)paren
suffix:semicolon
)brace
DECL|function|igmp_rcv
r_int
id|igmp_rcv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_int
id|len
)paren
(brace
multiline_comment|/* This basically follows the spec line by line -- see RFC1112 */
r_struct
id|igmphdr
op_star
id|ih
op_assign
id|skb-&gt;h.igmph
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
r_sizeof
(paren
r_struct
id|igmphdr
)paren
op_logical_or
id|ip_compute_csum
c_func
(paren
(paren
r_void
op_star
)paren
id|ih
comma
id|len
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ih-&gt;type
)paren
(brace
r_case
id|IGMP_HOST_MEMBERSHIP_QUERY
suffix:colon
id|igmp_heard_query
c_func
(paren
id|skb-&gt;dev
comma
id|ih-&gt;code
comma
id|ih-&gt;group
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IGMP_HOST_MEMBERSHIP_REPORT
suffix:colon
r_case
id|IGMP_HOST_NEW_MEMBERSHIP_REPORT
suffix:colon
id|igmp_heard_report
c_func
(paren
id|skb-&gt;dev
comma
id|ih-&gt;group
comma
id|skb-&gt;nh.iph-&gt;saddr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IGMP_DVMRP
suffix:colon
r_case
id|IGMP_PIM
suffix:colon
r_case
id|IGMP_TRACE
suffix:colon
r_case
id|IGMP_HOST_LEAVE_MESSAGE
suffix:colon
r_case
id|IGMP_MTRACE
suffix:colon
r_case
id|IGMP_MTRACE_RESP
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|NETDEBUG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Unknown IGMP type=%d&bslash;n&quot;
comma
id|ih-&gt;type
)paren
)paren
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
comma
id|FREE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Multicast list managers&n; */
multiline_comment|/*&n; *&t;A socket has joined a multicast group on device dev.&n; */
DECL|function|ip_mc_inc_group
r_static
r_void
id|ip_mc_inc_group
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|i
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|i-&gt;multiaddr
op_eq
id|addr
)paren
(brace
id|i-&gt;users
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|i
op_assign
(paren
r_struct
id|ip_mc_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|i
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
r_return
suffix:semicolon
)brace
id|i-&gt;users
op_assign
l_int|1
suffix:semicolon
id|i-&gt;interface
op_assign
id|dev
suffix:semicolon
id|i-&gt;multiaddr
op_assign
id|addr
suffix:semicolon
id|i-&gt;next
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|igmp_group_added
c_func
(paren
id|i
)paren
suffix:semicolon
id|dev-&gt;ip_mc_list
op_assign
id|i
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;A socket has left a multicast group on device dev&n; */
DECL|function|ip_mc_dec_group
r_static
r_void
id|ip_mc_dec_group
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
(brace
r_struct
id|ip_mc_list
op_star
op_star
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
op_amp
(paren
id|dev-&gt;ip_mc_list
)paren
suffix:semicolon
(paren
op_star
id|i
)paren
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
op_amp
(paren
op_star
id|i
)paren
op_member_access_from_pointer
id|next
)paren
(brace
r_if
c_cond
(paren
(paren
op_star
id|i
)paren
op_member_access_from_pointer
id|multiaddr
op_eq
id|addr
)paren
(brace
r_if
c_cond
(paren
op_decrement
(paren
(paren
op_star
id|i
)paren
op_member_access_from_pointer
id|users
)paren
op_eq
l_int|0
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|tmp
op_assign
op_star
id|i
suffix:semicolon
id|igmp_group_dropped
c_func
(paren
id|tmp
)paren
suffix:semicolon
op_star
id|i
op_assign
(paren
op_star
id|i
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|kfree_s
c_func
(paren
id|tmp
comma
r_sizeof
(paren
op_star
id|tmp
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; *&t;Device going down: Clean up.&n; */
DECL|function|ip_mc_drop_device
r_void
id|ip_mc_drop_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|i
suffix:semicolon
r_struct
id|ip_mc_list
op_star
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|i
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
id|j
)paren
(brace
id|j
op_assign
id|i-&gt;next
suffix:semicolon
id|kfree_s
c_func
(paren
id|i
comma
r_sizeof
(paren
op_star
id|i
)paren
)paren
suffix:semicolon
)brace
id|dev-&gt;ip_mc_list
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Device going up. Make sure it is in all hosts&n; */
DECL|function|ip_mc_allhost
r_void
id|ip_mc_allhost
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|ip_mc_list
op_star
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|i
op_ne
l_int|NULL
suffix:semicolon
id|i
op_assign
id|i-&gt;next
)paren
r_if
c_cond
(paren
id|i-&gt;multiaddr
op_eq
id|IGMP_ALL_HOSTS
)paren
(brace
r_return
suffix:semicolon
)brace
id|i
op_assign
(paren
r_struct
id|ip_mc_list
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|i
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
r_return
suffix:semicolon
)brace
id|i-&gt;users
op_assign
l_int|1
suffix:semicolon
id|i-&gt;interface
op_assign
id|dev
suffix:semicolon
id|i-&gt;multiaddr
op_assign
id|IGMP_ALL_HOSTS
suffix:semicolon
id|i-&gt;tm_running
op_assign
l_int|0
suffix:semicolon
id|i-&gt;next
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|dev-&gt;ip_mc_list
op_assign
id|i
suffix:semicolon
id|ip_mc_filter_add
c_func
(paren
id|i-&gt;interface
comma
id|i-&gt;multiaddr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Join a socket to a group&n; */
DECL|function|ip_mc_join_group
r_int
id|ip_mc_join_group
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
(brace
r_int
id|unused
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|addr
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;ip_mc_list
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|sk-&gt;ip_mc_list
op_assign
(paren
r_struct
id|ip_mc_socklist
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sk-&gt;ip_mc_list
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sk-&gt;ip_mc_list
comma
l_char|&squot;&bslash;0&squot;
comma
r_sizeof
(paren
op_star
id|sk-&gt;ip_mc_list
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IP_MAX_MEMBERSHIPS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;ip_mc_list-&gt;multiaddr
(braket
id|i
)braket
op_eq
id|addr
op_logical_and
id|sk-&gt;ip_mc_list-&gt;multidev
(braket
id|i
)braket
op_eq
id|dev
)paren
(brace
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;ip_mc_list-&gt;multidev
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
(brace
id|unused
op_assign
id|i
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|unused
op_eq
op_minus
l_int|1
)paren
(brace
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|sk-&gt;ip_mc_list-&gt;multiaddr
(braket
id|unused
)braket
op_assign
id|addr
suffix:semicolon
id|sk-&gt;ip_mc_list-&gt;multidev
(braket
id|unused
)braket
op_assign
id|dev
suffix:semicolon
id|ip_mc_inc_group
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Ask a socket to leave a group.&n; */
DECL|function|ip_mc_leave_group
r_int
id|ip_mc_leave_group
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|device
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MULTICAST
c_func
(paren
id|addr
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;ip_mc_list
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IP_MAX_MEMBERSHIPS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;ip_mc_list-&gt;multiaddr
(braket
id|i
)braket
op_eq
id|addr
op_logical_and
id|sk-&gt;ip_mc_list-&gt;multidev
(braket
id|i
)braket
op_eq
id|dev
)paren
(brace
id|sk-&gt;ip_mc_list-&gt;multidev
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|ip_mc_dec_group
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;A socket is closing.&n; */
DECL|function|ip_mc_drop_socket
r_void
id|ip_mc_drop_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;ip_mc_list
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IP_MAX_MEMBERSHIPS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;ip_mc_list-&gt;multidev
(braket
id|i
)braket
)paren
(brace
id|ip_mc_dec_group
c_func
(paren
id|sk-&gt;ip_mc_list-&gt;multidev
(braket
id|i
)braket
comma
id|sk-&gt;ip_mc_list-&gt;multiaddr
(braket
id|i
)braket
)paren
suffix:semicolon
id|sk-&gt;ip_mc_list-&gt;multidev
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|kfree_s
c_func
(paren
id|sk-&gt;ip_mc_list
comma
r_sizeof
(paren
op_star
id|sk-&gt;ip_mc_list
)paren
)paren
suffix:semicolon
id|sk-&gt;ip_mc_list
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Write an multicast group list table for the IGMP daemon to&n; *&t;read.&n; */
DECL|function|ip_mc_procinfo
r_int
id|ip_mc_procinfo
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
id|dummy
)paren
(brace
id|off_t
id|pos
op_assign
l_int|0
comma
id|begin
op_assign
l_int|0
suffix:semicolon
r_struct
id|ip_mc_list
op_star
id|im
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Device    : Count&bslash;tGroup    Users Timer&bslash;tReporter&bslash;n&quot;
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-10s: %5d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;mc_count
)paren
suffix:semicolon
r_for
c_loop
(paren
id|im
op_assign
id|dev-&gt;ip_mc_list
suffix:semicolon
id|im
suffix:semicolon
id|im
op_assign
id|im-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;&bslash;t&bslash;t&bslash;t%08lX %5d %d:%08lX&bslash;t%d&bslash;n&quot;
comma
id|im-&gt;multiaddr
comma
id|im-&gt;users
comma
id|im-&gt;tm_running
comma
id|im-&gt;timer.expires
op_minus
id|jiffies
comma
id|im-&gt;reporter
)paren
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
(brace
id|len
op_assign
id|length
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
eof
