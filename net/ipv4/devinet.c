multiline_comment|/*&n; *&t;NET3&t;IP device support routines.&n; *&n; *&t;Version: $Id: devinet.c,v 1.39 2000/12/10 22:24:11 davem Exp $&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; *&t;Derived from the IP parts of dev.c 1.0.19&n; * &t;&t;Authors:&t;Ross Biro, &lt;bir7@leland.Stanford.Edu&gt;&n; *&t;&t;&t;&t;Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;&n; *&t;&t;&t;&t;Mark Evans, &lt;evansmp@uhura.aston.ac.uk&gt;&n; *&n; *&t;Additional Authors:&n; *&t;&t;Alan Cox, &lt;gw4pts@gw4pts.ampr.org&gt;&n; *&t;&t;Alexey Kuznetsov, &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; *&t;Changes:&n; *&t;        Alexey Kuznetsov:&t;pa_* fields are replaced with ifaddr lists.&n; *&t;&t;Cyrus Durgin:&t;&t;updated for kmod&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/igmp.h&gt;
macro_line|#ifdef CONFIG_SYSCTL
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_KMOD
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#endif
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/ip_fib.h&gt;
DECL|variable|ipv4_devconf
r_struct
id|ipv4_devconf
id|ipv4_devconf
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|ipv4_devconf_dflt
r_static
r_struct
id|ipv4_devconf
id|ipv4_devconf_dflt
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
r_static
r_void
id|rtmsg_ifa
c_func
(paren
r_int
id|event
comma
r_struct
id|in_ifaddr
op_star
)paren
suffix:semicolon
macro_line|#else
DECL|macro|rtmsg_ifa
mdefine_line|#define rtmsg_ifa(a,b)&t;do { } while(0)
macro_line|#endif
DECL|variable|inetaddr_chain
r_static
r_struct
id|notifier_block
op_star
id|inetaddr_chain
suffix:semicolon
r_static
r_void
id|inet_del_ifa
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|in_ifaddr
op_star
op_star
id|ifap
comma
r_int
id|destroy
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
r_static
r_void
id|devinet_sysctl_register
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|ipv4_devconf
op_star
id|p
)paren
suffix:semicolon
r_static
r_void
id|devinet_sysctl_unregister
c_func
(paren
r_struct
id|ipv4_devconf
op_star
id|p
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|inet_ifa_count
r_int
id|inet_ifa_count
suffix:semicolon
DECL|variable|inet_dev_count
r_int
id|inet_dev_count
suffix:semicolon
multiline_comment|/* Locks all the inet devices. */
DECL|variable|inetdev_lock
id|rwlock_t
id|inetdev_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|function|inet_alloc_ifa
r_static
r_struct
id|in_ifaddr
op_star
id|inet_alloc_ifa
c_func
(paren
r_void
)paren
(brace
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
id|ifa
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|ifa
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa
)paren
(brace
id|memset
c_func
(paren
id|ifa
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|ifa
)paren
)paren
suffix:semicolon
id|inet_ifa_count
op_increment
suffix:semicolon
)brace
r_return
id|ifa
suffix:semicolon
)brace
DECL|function|inet_free_ifa
r_static
id|__inline__
r_void
id|inet_free_ifa
c_func
(paren
r_struct
id|in_ifaddr
op_star
id|ifa
)paren
(brace
r_if
c_cond
(paren
id|ifa-&gt;ifa_dev
)paren
id|__in_dev_put
c_func
(paren
id|ifa-&gt;ifa_dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ifa
)paren
suffix:semicolon
id|inet_ifa_count
op_decrement
suffix:semicolon
)brace
DECL|function|in_dev_finish_destroy
r_void
id|in_dev_finish_destroy
c_func
(paren
r_struct
id|in_device
op_star
id|idev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|idev-&gt;dev
suffix:semicolon
id|BUG_TRAP
c_func
(paren
id|idev-&gt;ifa_list
op_eq
l_int|NULL
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
id|idev-&gt;mc_list
op_eq
l_int|NULL
)paren
suffix:semicolon
macro_line|#ifdef NET_REFCNT_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;in_dev_finish_destroy: %p=%s&bslash;n&quot;
comma
id|idev
comma
id|dev
ques
c_cond
id|dev-&gt;name
suffix:colon
l_string|&quot;NIL&quot;
)paren
suffix:semicolon
macro_line|#endif
id|dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|idev-&gt;dead
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Freeing alive in_device %p&bslash;n&quot;
comma
id|idev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|inet_dev_count
op_decrement
suffix:semicolon
id|kfree
c_func
(paren
id|idev
)paren
suffix:semicolon
)brace
DECL|function|inetdev_init
r_struct
id|in_device
op_star
id|inetdev_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
id|in_dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|in_dev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|in_dev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|in_dev
)paren
)paren
suffix:semicolon
id|in_dev-&gt;lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|in_dev-&gt;cnf
comma
op_amp
id|ipv4_devconf_dflt
comma
r_sizeof
(paren
id|in_dev-&gt;cnf
)paren
)paren
suffix:semicolon
id|in_dev-&gt;cnf.sysctl
op_assign
l_int|NULL
suffix:semicolon
id|in_dev-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev-&gt;arp_parms
op_assign
id|neigh_parms_alloc
c_func
(paren
id|dev
comma
op_amp
id|arp_tbl
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|inet_dev_count
op_increment
suffix:semicolon
multiline_comment|/* Reference in_dev-&gt;dev */
id|dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
id|neigh_sysctl_register
c_func
(paren
id|dev
comma
id|in_dev-&gt;arp_parms
comma
id|NET_IPV4
comma
id|NET_IPV4_NEIGH
comma
l_string|&quot;ipv4&quot;
)paren
suffix:semicolon
macro_line|#endif
id|write_lock_bh
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
id|dev-&gt;ip_ptr
op_assign
id|in_dev
suffix:semicolon
multiline_comment|/* Account for reference dev-&gt;ip_ptr */
id|in_dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
id|devinet_sysctl_register
c_func
(paren
id|in_dev
comma
op_amp
id|in_dev-&gt;cnf
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
id|ip_mc_up
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
id|in_dev
suffix:semicolon
)brace
DECL|function|inetdev_destroy
r_static
r_void
id|inetdev_destroy
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
)paren
(brace
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
id|in_dev-&gt;dead
op_assign
l_int|1
suffix:semicolon
id|ip_mc_destroy_dev
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ifa
op_assign
id|in_dev-&gt;ifa_list
)paren
op_ne
l_int|NULL
)paren
(brace
id|inet_del_ifa
c_func
(paren
id|in_dev
comma
op_amp
id|in_dev-&gt;ifa_list
comma
l_int|0
)paren
suffix:semicolon
id|inet_free_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SYSCTL
id|devinet_sysctl_unregister
c_func
(paren
op_amp
id|in_dev-&gt;cnf
)paren
suffix:semicolon
macro_line|#endif
id|write_lock_bh
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
id|in_dev-&gt;dev-&gt;ip_ptr
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* in_dev_put following below will kill the in_device */
id|write_unlock_bh
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
id|neigh_parms_release
c_func
(paren
op_amp
id|arp_tbl
comma
id|in_dev-&gt;arp_parms
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
DECL|function|inet_addr_onlink
r_int
id|inet_addr_onlink
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|u32
id|a
comma
id|u32
id|b
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|for_primary_ifa
c_func
(paren
id|in_dev
)paren
(brace
r_if
c_cond
(paren
id|inet_ifa_match
c_func
(paren
id|a
comma
id|ifa
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|b
op_logical_or
id|inet_ifa_match
c_func
(paren
id|b
comma
id|ifa
)paren
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
id|endfor_ifa
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|inet_del_ifa
id|inet_del_ifa
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|in_ifaddr
op_star
op_star
id|ifap
comma
r_int
id|destroy
)paren
(brace
r_struct
id|in_ifaddr
op_star
id|ifa1
op_assign
op_star
id|ifap
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* 1. Deleting primary ifaddr forces deletion all secondaries */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifa1-&gt;ifa_flags
op_amp
id|IFA_F_SECONDARY
)paren
)paren
(brace
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
r_struct
id|in_ifaddr
op_star
op_star
id|ifap1
op_assign
op_amp
id|ifa1-&gt;ifa_next
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ifa
op_assign
op_star
id|ifap1
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifa-&gt;ifa_flags
op_amp
id|IFA_F_SECONDARY
)paren
op_logical_or
id|ifa1-&gt;ifa_mask
op_ne
id|ifa-&gt;ifa_mask
op_logical_or
op_logical_neg
id|inet_ifa_match
c_func
(paren
id|ifa1-&gt;ifa_address
comma
id|ifa
)paren
)paren
(brace
id|ifap1
op_assign
op_amp
id|ifa-&gt;ifa_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|write_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
op_star
id|ifap1
op_assign
id|ifa-&gt;ifa_next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|rtmsg_ifa
c_func
(paren
id|RTM_DELADDR
comma
id|ifa
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|inetaddr_chain
comma
id|NETDEV_DOWN
comma
id|ifa
)paren
suffix:semicolon
id|inet_free_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* 2. Unlink it */
id|write_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
op_star
id|ifap
op_assign
id|ifa1-&gt;ifa_next
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* 3. Announce address deletion */
multiline_comment|/* Send message first, then call notifier.&n;&t;   At first sight, FIB update triggered by notifier&n;&t;   will refer to already deleted ifaddr, that could confuse&n;&t;   netlink listeners. It is not true: look, gated sees&n;&t;   that route deleted and if it still thinks that ifaddr&n;&t;   is valid, it will try to restore deleted routes... Grr.&n;&t;   So that, this order is correct.&n;&t; */
id|rtmsg_ifa
c_func
(paren
id|RTM_DELADDR
comma
id|ifa1
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|inetaddr_chain
comma
id|NETDEV_DOWN
comma
id|ifa1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|destroy
)paren
(brace
id|inet_free_ifa
c_func
(paren
id|ifa1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev-&gt;ifa_list
op_eq
l_int|NULL
)paren
id|inetdev_destroy
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|inet_insert_ifa
id|inet_insert_ifa
c_func
(paren
r_struct
id|in_ifaddr
op_star
id|ifa
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|ifa-&gt;ifa_dev
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|ifa1
comma
op_star
op_star
id|ifap
comma
op_star
op_star
id|last_primary
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_local
op_eq
l_int|0
)paren
(brace
id|inet_free_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ifa-&gt;ifa_flags
op_and_assign
op_complement
id|IFA_F_SECONDARY
suffix:semicolon
id|last_primary
op_assign
op_amp
id|in_dev-&gt;ifa_list
suffix:semicolon
r_for
c_loop
(paren
id|ifap
op_assign
op_amp
id|in_dev-&gt;ifa_list
suffix:semicolon
(paren
id|ifa1
op_assign
op_star
id|ifap
)paren
op_ne
l_int|NULL
suffix:semicolon
id|ifap
op_assign
op_amp
id|ifa1-&gt;ifa_next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifa1-&gt;ifa_flags
op_amp
id|IFA_F_SECONDARY
)paren
op_logical_and
id|ifa-&gt;ifa_scope
op_le
id|ifa1-&gt;ifa_scope
)paren
id|last_primary
op_assign
op_amp
id|ifa1-&gt;ifa_next
suffix:semicolon
r_if
c_cond
(paren
id|ifa1-&gt;ifa_mask
op_eq
id|ifa-&gt;ifa_mask
op_logical_and
id|inet_ifa_match
c_func
(paren
id|ifa1-&gt;ifa_address
comma
id|ifa
)paren
)paren
(brace
r_if
c_cond
(paren
id|ifa1-&gt;ifa_local
op_eq
id|ifa-&gt;ifa_local
)paren
(brace
id|inet_free_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifa1-&gt;ifa_scope
op_ne
id|ifa-&gt;ifa_scope
)paren
(brace
id|inet_free_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ifa-&gt;ifa_flags
op_or_assign
id|IFA_F_SECONDARY
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifa-&gt;ifa_flags
op_amp
id|IFA_F_SECONDARY
)paren
)paren
(brace
id|net_srandom
c_func
(paren
id|ifa-&gt;ifa_local
)paren
suffix:semicolon
id|ifap
op_assign
id|last_primary
suffix:semicolon
)brace
id|ifa-&gt;ifa_next
op_assign
op_star
id|ifap
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
op_star
id|ifap
op_assign
id|ifa
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Send message first, then call notifier.&n;&t;   Notifier will trigger FIB update, so that&n;&t;   listeners of netlink will know about new ifaddr */
id|rtmsg_ifa
c_func
(paren
id|RTM_NEWADDR
comma
id|ifa
)paren
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|inetaddr_chain
comma
id|NETDEV_UP
comma
id|ifa
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|inet_set_ifa
id|inet_set_ifa
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|in_ifaddr
op_star
id|ifa
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
)paren
(brace
id|in_dev
op_assign
id|inetdev_init
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
)paren
(brace
id|inet_free_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ifa-&gt;ifa_dev
op_ne
id|in_dev
)paren
(brace
id|BUG_TRAP
c_func
(paren
id|ifa-&gt;ifa_dev
op_eq
l_int|NULL
)paren
suffix:semicolon
id|in_dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|ifa-&gt;ifa_dev
op_assign
id|in_dev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|LOOPBACK
c_func
(paren
id|ifa-&gt;ifa_local
)paren
)paren
id|ifa-&gt;ifa_scope
op_assign
id|RT_SCOPE_HOST
suffix:semicolon
r_return
id|inet_insert_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
DECL|function|inetdev_by_index
r_struct
id|in_device
op_star
id|inetdev_by_index
c_func
(paren
r_int
id|ifindex
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
l_int|NULL
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
id|dev
op_assign
id|__dev_get_by_index
c_func
(paren
id|ifindex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
id|in_dev
suffix:semicolon
)brace
multiline_comment|/* Called only from RTNL semaphored context. No locks. */
DECL|function|inet_ifa_byprefix
r_struct
id|in_ifaddr
op_star
id|inet_ifa_byprefix
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
id|u32
id|prefix
comma
id|u32
id|mask
)paren
(brace
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
id|for_primary_ifa
c_func
(paren
id|in_dev
)paren
(brace
r_if
c_cond
(paren
id|ifa-&gt;ifa_mask
op_eq
id|mask
op_logical_and
id|inet_ifa_match
c_func
(paren
id|prefix
comma
id|ifa
)paren
)paren
r_return
id|ifa
suffix:semicolon
)brace
id|endfor_ifa
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_RTNETLINK
r_int
DECL|function|inet_rtm_deladdr
id|inet_rtm_deladdr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|ifaddrmsg
op_star
id|ifm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|ifa
comma
op_star
op_star
id|ifap
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|inetdev_by_index
c_func
(paren
id|ifm-&gt;ifa_index
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
id|__in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ifap
op_assign
op_amp
id|in_dev-&gt;ifa_list
suffix:semicolon
(paren
id|ifa
op_assign
op_star
id|ifap
)paren
op_ne
l_int|NULL
suffix:semicolon
id|ifap
op_assign
op_amp
id|ifa-&gt;ifa_next
)paren
(brace
r_if
c_cond
(paren
(paren
id|rta
(braket
id|IFA_LOCAL
op_minus
l_int|1
)braket
op_logical_and
id|memcmp
c_func
(paren
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_LOCAL
op_minus
l_int|1
)braket
)paren
comma
op_amp
id|ifa-&gt;ifa_local
comma
l_int|4
)paren
)paren
op_logical_or
(paren
id|rta
(braket
id|IFA_LABEL
op_minus
l_int|1
)braket
op_logical_and
id|strcmp
c_func
(paren
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_LABEL
op_minus
l_int|1
)braket
)paren
comma
id|ifa-&gt;ifa_label
)paren
)paren
op_logical_or
(paren
id|rta
(braket
id|IFA_ADDRESS
op_minus
l_int|1
)braket
op_logical_and
(paren
id|ifm-&gt;ifa_prefixlen
op_ne
id|ifa-&gt;ifa_prefixlen
op_logical_or
op_logical_neg
id|inet_ifa_match
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_ADDRESS
op_minus
l_int|1
)braket
)paren
comma
id|ifa
)paren
)paren
)paren
)paren
r_continue
suffix:semicolon
id|inet_del_ifa
c_func
(paren
id|in_dev
comma
id|ifap
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
)brace
r_int
DECL|function|inet_rtm_newaddr
id|inet_rtm_newaddr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|rtattr
op_star
op_star
id|rta
op_assign
id|arg
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|ifaddrmsg
op_star
id|ifm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifm-&gt;ifa_prefixlen
OG
l_int|32
op_logical_or
id|rta
(braket
id|IFA_LOCAL
op_minus
l_int|1
)braket
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|__dev_get_by_index
c_func
(paren
id|ifm-&gt;ifa_index
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|in_dev
op_assign
id|inetdev_init
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ifa
op_assign
id|inet_alloc_ifa
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|IFA_ADDRESS
op_minus
l_int|1
)braket
op_eq
l_int|NULL
)paren
id|rta
(braket
id|IFA_ADDRESS
op_minus
l_int|1
)braket
op_assign
id|rta
(braket
id|IFA_LOCAL
op_minus
l_int|1
)braket
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ifa-&gt;ifa_local
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_LOCAL
op_minus
l_int|1
)braket
)paren
comma
l_int|4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ifa-&gt;ifa_address
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_ADDRESS
op_minus
l_int|1
)braket
)paren
comma
l_int|4
)paren
suffix:semicolon
id|ifa-&gt;ifa_prefixlen
op_assign
id|ifm-&gt;ifa_prefixlen
suffix:semicolon
id|ifa-&gt;ifa_mask
op_assign
id|inet_make_mask
c_func
(paren
id|ifm-&gt;ifa_prefixlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|IFA_BROADCAST
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|ifa-&gt;ifa_broadcast
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_BROADCAST
op_minus
l_int|1
)braket
)paren
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|IFA_ANYCAST
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
op_amp
id|ifa-&gt;ifa_anycast
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_ANYCAST
op_minus
l_int|1
)braket
)paren
comma
l_int|4
)paren
suffix:semicolon
id|ifa-&gt;ifa_flags
op_assign
id|ifm-&gt;ifa_flags
suffix:semicolon
id|ifa-&gt;ifa_scope
op_assign
id|ifm-&gt;ifa_scope
suffix:semicolon
id|in_dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|ifa-&gt;ifa_dev
op_assign
id|in_dev
suffix:semicolon
r_if
c_cond
(paren
id|rta
(braket
id|IFA_LABEL
op_minus
l_int|1
)braket
)paren
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|RTA_DATA
c_func
(paren
id|rta
(braket
id|IFA_LABEL
op_minus
l_int|1
)braket
)paren
comma
id|IFNAMSIZ
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|dev-&gt;name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
r_return
id|inet_insert_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* &n; *&t;Determine a default network mask, based on the IP address. &n; */
DECL|function|inet_abc_len
r_static
id|__inline__
r_int
id|inet_abc_len
c_func
(paren
id|u32
id|addr
)paren
(brace
r_if
c_cond
(paren
id|ZERONET
c_func
(paren
id|addr
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|addr
op_assign
id|ntohl
c_func
(paren
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IN_CLASSA
c_func
(paren
id|addr
)paren
)paren
r_return
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|IN_CLASSB
c_func
(paren
id|addr
)paren
)paren
r_return
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|IN_CLASSC
c_func
(paren
id|addr
)paren
)paren
r_return
l_int|24
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Something else, probably a multicast. &n;&t; */
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|devinet_ioctl
r_int
id|devinet_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|ifreq
id|ifr
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|ifr.ifr_addr
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|in_ifaddr
op_star
op_star
id|ifap
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|ifa
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_char
op_star
id|colon
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Fetch the caller&squot;s info block into kernel space&n;&t; */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ifr
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|ifreq
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ifr.ifr_name
(braket
id|IFNAMSIZ
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|colon
op_assign
id|strchr
c_func
(paren
id|ifr.ifr_name
comma
l_char|&squot;:&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|colon
)paren
op_star
id|colon
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_KMOD
id|dev_load
c_func
(paren
id|ifr.ifr_name
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGIFADDR
suffix:colon
multiline_comment|/* Get interface address */
r_case
id|SIOCGIFBRDADDR
suffix:colon
multiline_comment|/* Get the broadcast address */
r_case
id|SIOCGIFDSTADDR
suffix:colon
multiline_comment|/* Get the destination address */
r_case
id|SIOCGIFNETMASK
suffix:colon
multiline_comment|/* Get the netmask for the interface */
multiline_comment|/* Note that this ioctls will not sleep,&n;&t;&t;   so that we do not impose a lock.&n;&t;&t;   One day we will be forced to put shlock here (I mean SMP)&n;&t;&t; */
id|memset
c_func
(paren
id|sin
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sin
)paren
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIFFLAGS
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIFADDR
suffix:colon
multiline_comment|/* Set interface address (and family) */
r_case
id|SIOCSIFBRDADDR
suffix:colon
multiline_comment|/* Set the broadcast address */
r_case
id|SIOCSIFDSTADDR
suffix:colon
multiline_comment|/* Set the destination address */
r_case
id|SIOCSIFNETMASK
suffix:colon
multiline_comment|/* Set the netmask for the interface */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
r_if
c_cond
(paren
id|sin-&gt;sin_family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev_probe_lock
c_func
(paren
)paren
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|__dev_get_by_name
c_func
(paren
id|ifr.ifr_name
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|colon
)paren
op_star
id|colon
op_assign
l_char|&squot;:&squot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|ifap
op_assign
op_amp
id|in_dev-&gt;ifa_list
suffix:semicolon
(paren
id|ifa
op_assign
op_star
id|ifap
)paren
op_ne
l_int|NULL
suffix:semicolon
id|ifap
op_assign
op_amp
id|ifa-&gt;ifa_next
)paren
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ifr.ifr_name
comma
id|ifa-&gt;ifa_label
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifa
op_eq
l_int|NULL
op_logical_and
id|cmd
op_ne
id|SIOCSIFADDR
op_logical_and
id|cmd
op_ne
id|SIOCSIFFLAGS
)paren
(brace
id|ret
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGIFADDR
suffix:colon
multiline_comment|/* Get interface address */
id|sin-&gt;sin_addr.s_addr
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
r_goto
id|rarok
suffix:semicolon
r_case
id|SIOCGIFBRDADDR
suffix:colon
multiline_comment|/* Get the broadcast address */
id|sin-&gt;sin_addr.s_addr
op_assign
id|ifa-&gt;ifa_broadcast
suffix:semicolon
r_goto
id|rarok
suffix:semicolon
r_case
id|SIOCGIFDSTADDR
suffix:colon
multiline_comment|/* Get the destination address */
id|sin-&gt;sin_addr.s_addr
op_assign
id|ifa-&gt;ifa_address
suffix:semicolon
r_goto
id|rarok
suffix:semicolon
r_case
id|SIOCGIFNETMASK
suffix:colon
multiline_comment|/* Get the netmask for the interface */
id|sin-&gt;sin_addr.s_addr
op_assign
id|ifa-&gt;ifa_mask
suffix:semicolon
r_goto
id|rarok
suffix:semicolon
r_case
id|SIOCSIFFLAGS
suffix:colon
r_if
c_cond
(paren
id|colon
)paren
(brace
r_if
c_cond
(paren
id|ifa
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|EADDRNOTAVAIL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ifr.ifr_flags
op_amp
id|IFF_UP
)paren
)paren
id|inet_del_ifa
c_func
(paren
id|in_dev
comma
id|ifap
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ret
op_assign
id|dev_change_flags
c_func
(paren
id|dev
comma
id|ifr.ifr_flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIFADDR
suffix:colon
multiline_comment|/* Set interface address (and family) */
r_if
c_cond
(paren
id|inet_abc_len
c_func
(paren
id|sin-&gt;sin_addr.s_addr
)paren
OL
l_int|0
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ifa
)paren
(brace
r_if
c_cond
(paren
(paren
id|ifa
op_assign
id|inet_alloc_ifa
c_func
(paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|ret
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|colon
)paren
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|ifr.ifr_name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|dev-&gt;name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_local
op_eq
id|sin-&gt;sin_addr.s_addr
)paren
r_break
suffix:semicolon
id|inet_del_ifa
c_func
(paren
id|in_dev
comma
id|ifap
comma
l_int|0
)paren
suffix:semicolon
id|ifa-&gt;ifa_broadcast
op_assign
l_int|0
suffix:semicolon
id|ifa-&gt;ifa_anycast
op_assign
l_int|0
suffix:semicolon
)brace
id|ifa-&gt;ifa_address
op_assign
id|ifa-&gt;ifa_local
op_assign
id|sin-&gt;sin_addr.s_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_POINTOPOINT
)paren
)paren
(brace
id|ifa-&gt;ifa_prefixlen
op_assign
id|inet_abc_len
c_func
(paren
id|ifa-&gt;ifa_address
)paren
suffix:semicolon
id|ifa-&gt;ifa_mask
op_assign
id|inet_make_mask
c_func
(paren
id|ifa-&gt;ifa_prefixlen
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_BROADCAST
)paren
op_logical_and
id|ifa-&gt;ifa_prefixlen
OL
l_int|31
)paren
id|ifa-&gt;ifa_broadcast
op_assign
id|ifa-&gt;ifa_address
op_or
op_complement
id|ifa-&gt;ifa_mask
suffix:semicolon
)brace
r_else
(brace
id|ifa-&gt;ifa_prefixlen
op_assign
l_int|32
suffix:semicolon
id|ifa-&gt;ifa_mask
op_assign
id|inet_make_mask
c_func
(paren
l_int|32
)paren
suffix:semicolon
)brace
id|ret
op_assign
id|inet_set_ifa
c_func
(paren
id|dev
comma
id|ifa
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIFBRDADDR
suffix:colon
multiline_comment|/* Set the broadcast address */
r_if
c_cond
(paren
id|ifa-&gt;ifa_broadcast
op_ne
id|sin-&gt;sin_addr.s_addr
)paren
(brace
id|inet_del_ifa
c_func
(paren
id|in_dev
comma
id|ifap
comma
l_int|0
)paren
suffix:semicolon
id|ifa-&gt;ifa_broadcast
op_assign
id|sin-&gt;sin_addr.s_addr
suffix:semicolon
id|inet_insert_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCSIFDSTADDR
suffix:colon
multiline_comment|/* Set the destination address */
r_if
c_cond
(paren
id|ifa-&gt;ifa_address
op_ne
id|sin-&gt;sin_addr.s_addr
)paren
(brace
r_if
c_cond
(paren
id|inet_abc_len
c_func
(paren
id|sin-&gt;sin_addr.s_addr
)paren
OL
l_int|0
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|inet_del_ifa
c_func
(paren
id|in_dev
comma
id|ifap
comma
l_int|0
)paren
suffix:semicolon
id|ifa-&gt;ifa_address
op_assign
id|sin-&gt;sin_addr.s_addr
suffix:semicolon
id|inet_insert_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCSIFNETMASK
suffix:colon
multiline_comment|/* Set the netmask for the interface */
multiline_comment|/*&n;&t;&t;&t; *&t;The mask we set must be legal.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|bad_mask
c_func
(paren
id|sin-&gt;sin_addr.s_addr
comma
l_int|0
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifa-&gt;ifa_mask
op_ne
id|sin-&gt;sin_addr.s_addr
)paren
(brace
id|inet_del_ifa
c_func
(paren
id|in_dev
comma
id|ifap
comma
l_int|0
)paren
suffix:semicolon
id|ifa-&gt;ifa_mask
op_assign
id|sin-&gt;sin_addr.s_addr
suffix:semicolon
id|ifa-&gt;ifa_prefixlen
op_assign
id|inet_mask_len
c_func
(paren
id|ifa-&gt;ifa_mask
)paren
suffix:semicolon
id|inet_insert_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|done
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
id|dev_probe_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
id|rarok
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
id|dev_probe_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|ifr
comma
r_sizeof
(paren
r_struct
id|ifreq
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|inet_gifconf
id|inet_gifconf
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
r_struct
id|ifreq
id|ifr
suffix:semicolon
r_int
id|done
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
op_logical_or
(paren
id|ifa
op_assign
id|in_dev-&gt;ifa_list
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;ifa_next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
(brace
id|done
op_add_assign
r_sizeof
(paren
id|ifr
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
(paren
r_int
)paren
r_sizeof
(paren
id|ifr
)paren
)paren
r_return
id|done
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ifr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ifreq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_label
)paren
id|strcpy
c_func
(paren
id|ifr.ifr_name
comma
id|ifa-&gt;ifa_label
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|ifr.ifr_name
comma
id|dev-&gt;name
)paren
suffix:semicolon
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|ifr.ifr_addr.sin_family
op_assign
id|AF_INET
suffix:semicolon
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|ifr.ifr_addr.sin_addr.s_addr
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
op_amp
id|ifr
comma
r_sizeof
(paren
r_struct
id|ifreq
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|buf
op_add_assign
r_sizeof
(paren
r_struct
id|ifreq
)paren
suffix:semicolon
id|len
op_sub_assign
r_sizeof
(paren
r_struct
id|ifreq
)paren
suffix:semicolon
id|done
op_add_assign
r_sizeof
(paren
r_struct
id|ifreq
)paren
suffix:semicolon
)brace
r_return
id|done
suffix:semicolon
)brace
DECL|function|inet_select_addr
id|u32
id|inet_select_addr
c_func
(paren
r_const
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|dst
comma
r_int
id|scope
)paren
(brace
id|u32
id|addr
op_assign
l_int|0
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|for_primary_ifa
c_func
(paren
id|in_dev
)paren
(brace
r_if
c_cond
(paren
id|ifa-&gt;ifa_scope
OG
id|scope
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst
op_logical_or
id|inet_ifa_match
c_func
(paren
id|dst
comma
id|ifa
)paren
)paren
(brace
id|addr
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|addr
)paren
id|addr
op_assign
id|ifa-&gt;ifa_local
suffix:semicolon
)brace
id|endfor_ifa
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
r_return
id|addr
suffix:semicolon
multiline_comment|/* Not loopback addresses on loopback should be preferred&n;&t;   in this case. It is importnat that lo is the first interface&n;&t;   in dev_base list.&n;&t; */
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|for_primary_ifa
c_func
(paren
id|in_dev
)paren
(brace
r_if
c_cond
(paren
id|ifa-&gt;ifa_scope
op_ne
id|RT_SCOPE_LINK
op_logical_and
id|ifa-&gt;ifa_scope
op_le
id|scope
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
id|ifa-&gt;ifa_local
suffix:semicolon
)brace
)brace
id|endfor_ifa
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Device notifier&n; */
DECL|function|register_inetaddr_notifier
r_int
id|register_inetaddr_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
)paren
(brace
r_return
id|notifier_chain_register
c_func
(paren
op_amp
id|inetaddr_chain
comma
id|nb
)paren
suffix:semicolon
)brace
DECL|function|unregister_inetaddr_notifier
r_int
id|unregister_inetaddr_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
)paren
(brace
r_return
id|notifier_chain_unregister
c_func
(paren
op_amp
id|inetaddr_chain
comma
id|nb
)paren
suffix:semicolon
)brace
multiline_comment|/* Called only under RTNL semaphore */
DECL|function|inetdev_event
r_static
r_int
id|inetdev_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|ptr
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_REGISTER
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;inetdev_event: bug&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;ip_ptr
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_UP
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;mtu
OL
l_int|68
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
op_amp
id|loopback_dev
)paren
(brace
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ifa
op_assign
id|inet_alloc_ifa
c_func
(paren
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|ifa-&gt;ifa_local
op_assign
id|ifa-&gt;ifa_address
op_assign
id|htonl
c_func
(paren
id|INADDR_LOOPBACK
)paren
suffix:semicolon
id|ifa-&gt;ifa_prefixlen
op_assign
l_int|8
suffix:semicolon
id|ifa-&gt;ifa_mask
op_assign
id|inet_make_mask
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|in_dev_hold
c_func
(paren
id|in_dev
)paren
suffix:semicolon
id|ifa-&gt;ifa_dev
op_assign
id|in_dev
suffix:semicolon
id|ifa-&gt;ifa_scope
op_assign
id|RT_SCOPE_HOST
suffix:semicolon
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|dev-&gt;name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
id|inet_insert_ifa
c_func
(paren
id|ifa
)paren
suffix:semicolon
)brace
)brace
id|ip_mc_up
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
id|ip_mc_down
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_CHANGEMTU
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;mtu
op_ge
l_int|68
)paren
r_break
suffix:semicolon
multiline_comment|/* MTU falled under 68, disable IP */
r_case
id|NETDEV_UNREGISTER
suffix:colon
id|inetdev_destroy
c_func
(paren
id|in_dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_CHANGENAME
suffix:colon
r_if
c_cond
(paren
id|in_dev-&gt;ifa_list
)paren
(brace
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
r_for
c_loop
(paren
id|ifa
op_assign
id|in_dev-&gt;ifa_list
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;ifa_next
)paren
id|memcpy
c_func
(paren
id|ifa-&gt;ifa_label
comma
id|dev-&gt;name
comma
id|IFNAMSIZ
)paren
suffix:semicolon
multiline_comment|/* Do not notify about label change, this event is&n;&t;&t;&t;   not interesting to applications using netlink.&n;&t;&t;&t; */
)brace
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|ip_netdev_notifier
r_struct
id|notifier_block
id|ip_netdev_notifier
op_assign
initialization_block
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
DECL|function|inet_fill_ifaddr
r_static
r_int
id|inet_fill_ifaddr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|in_ifaddr
op_star
id|ifa
comma
id|u32
id|pid
comma
id|u32
id|seq
comma
r_int
id|event
)paren
(brace
r_struct
id|ifaddrmsg
op_star
id|ifm
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|pid
comma
id|seq
comma
id|event
comma
r_sizeof
(paren
op_star
id|ifm
)paren
)paren
suffix:semicolon
id|ifm
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|ifm-&gt;ifa_family
op_assign
id|AF_INET
suffix:semicolon
id|ifm-&gt;ifa_prefixlen
op_assign
id|ifa-&gt;ifa_prefixlen
suffix:semicolon
id|ifm-&gt;ifa_flags
op_assign
id|ifa-&gt;ifa_flags
op_or
id|IFA_F_PERMANENT
suffix:semicolon
id|ifm-&gt;ifa_scope
op_assign
id|ifa-&gt;ifa_scope
suffix:semicolon
id|ifm-&gt;ifa_index
op_assign
id|ifa-&gt;ifa_dev-&gt;dev-&gt;ifindex
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_address
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|IFA_ADDRESS
comma
l_int|4
comma
op_amp
id|ifa-&gt;ifa_address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_local
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|IFA_LOCAL
comma
l_int|4
comma
op_amp
id|ifa-&gt;ifa_local
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_broadcast
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|IFA_BROADCAST
comma
l_int|4
comma
op_amp
id|ifa-&gt;ifa_broadcast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_anycast
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|IFA_ANYCAST
comma
l_int|4
comma
op_amp
id|ifa-&gt;ifa_anycast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ifa-&gt;ifa_label
(braket
l_int|0
)braket
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|IFA_LABEL
comma
id|IFNAMSIZ
comma
op_amp
id|ifa-&gt;ifa_label
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|inet_dump_ifaddr
r_static
r_int
id|inet_dump_ifaddr
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_int
id|idx
comma
id|ip_idx
suffix:semicolon
r_int
id|s_idx
comma
id|s_ip_idx
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
id|s_idx
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
id|s_ip_idx
op_assign
id|ip_idx
op_assign
id|cb-&gt;args
(braket
l_int|1
)braket
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
comma
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|idx
OL
id|s_idx
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|idx
OG
id|s_idx
)paren
id|s_ip_idx
op_assign
l_int|0
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ifa
op_assign
id|in_dev-&gt;ifa_list
comma
id|ip_idx
op_assign
l_int|0
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;ifa_next
comma
id|ip_idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ip_idx
OL
id|s_ip_idx
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|inet_fill_ifaddr
c_func
(paren
id|skb
comma
id|ifa
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|RTM_NEWADDR
)paren
op_le
l_int|0
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
)brace
id|done
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|idx
suffix:semicolon
id|cb-&gt;args
(braket
l_int|1
)braket
op_assign
id|ip_idx
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|rtmsg_ifa
r_static
r_void
id|rtmsg_ifa
c_func
(paren
r_int
id|event
comma
r_struct
id|in_ifaddr
op_star
id|ifa
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|ifaddrmsg
)paren
op_plus
l_int|128
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|netlink_set_err
c_func
(paren
id|rtnl
comma
l_int|0
comma
id|RTMGRP_IPV4_IFADDR
comma
id|ENOBUFS
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inet_fill_ifaddr
c_func
(paren
id|skb
comma
id|ifa
comma
l_int|0
comma
l_int|0
comma
id|event
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|netlink_set_err
c_func
(paren
id|rtnl
comma
l_int|0
comma
id|RTMGRP_IPV4_IFADDR
comma
id|EINVAL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|RTMGRP_IPV4_IFADDR
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|rtnl
comma
id|skb
comma
l_int|0
comma
id|RTMGRP_IPV4_IFADDR
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
DECL|variable|inet_rtnetlink_table
r_static
r_struct
id|rtnetlink_link
id|inet_rtnetlink_table
(braket
id|RTM_MAX
op_minus
id|RTM_BASE
op_plus
l_int|1
)braket
op_assign
(brace
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
id|inet_rtm_newaddr
comma
l_int|NULL
comma
)brace
comma
(brace
id|inet_rtm_deladdr
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
id|inet_dump_ifaddr
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
id|inet_rtm_newroute
comma
l_int|NULL
comma
)brace
comma
(brace
id|inet_rtm_delroute
comma
l_int|NULL
comma
)brace
comma
(brace
id|inet_rtm_getroute
comma
id|inet_dump_fib
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
macro_line|#ifdef CONFIG_IP_MULTIPLE_TABLES
(brace
id|inet_rtm_newrule
comma
l_int|NULL
comma
)brace
comma
(brace
id|inet_rtm_delrule
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
id|inet_dump_rules
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
macro_line|#else
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
(brace
l_int|NULL
comma
l_int|NULL
comma
)brace
comma
macro_line|#endif
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_RTNETLINK */
macro_line|#ifdef CONFIG_SYSCTL
DECL|function|inet_forward_change
r_void
id|inet_forward_change
c_func
(paren
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|on
op_assign
id|ipv4_devconf.forwarding
suffix:semicolon
id|ipv4_devconf.accept_redirects
op_assign
op_logical_neg
id|on
suffix:semicolon
id|ipv4_devconf_dflt.forwarding
op_assign
id|on
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
)paren
id|in_dev-&gt;cnf.forwarding
op_assign
id|on
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|inetdev_lock
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|dev_base_lock
)paren
suffix:semicolon
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
DECL|function|devinet_sysctl_forward
r_int
id|devinet_sysctl_forward
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|buffer
comma
r_int
op_star
id|lenp
)paren
(brace
r_int
op_star
id|valp
op_assign
id|ctl-&gt;data
suffix:semicolon
r_int
id|val
op_assign
op_star
id|valp
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|proc_dointvec
c_func
(paren
id|ctl
comma
id|write
comma
id|filp
comma
id|buffer
comma
id|lenp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write
op_logical_and
op_star
id|valp
op_ne
id|val
)paren
(brace
r_if
c_cond
(paren
id|valp
op_eq
op_amp
id|ipv4_devconf.forwarding
)paren
id|inet_forward_change
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|valp
op_ne
op_amp
id|ipv4_devconf_dflt.forwarding
)paren
id|rt_cache_flush
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|struct|devinet_sysctl_table
r_static
r_struct
id|devinet_sysctl_table
(brace
DECL|member|sysctl_header
r_struct
id|ctl_table_header
op_star
id|sysctl_header
suffix:semicolon
DECL|member|devinet_vars
id|ctl_table
id|devinet_vars
(braket
l_int|13
)braket
suffix:semicolon
DECL|member|devinet_dev
id|ctl_table
id|devinet_dev
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|devinet_conf_dir
id|ctl_table
id|devinet_conf_dir
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|devinet_proto_dir
id|ctl_table
id|devinet_proto_dir
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|devinet_root_dir
id|ctl_table
id|devinet_root_dir
(braket
l_int|2
)braket
suffix:semicolon
DECL|variable|devinet_sysctl
)brace
id|devinet_sysctl
op_assign
(brace
l_int|NULL
comma
(brace
(brace
id|NET_IPV4_CONF_FORWARDING
comma
l_string|&quot;forwarding&quot;
comma
op_amp
id|ipv4_devconf.forwarding
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|devinet_sysctl_forward
)brace
comma
(brace
id|NET_IPV4_CONF_MC_FORWARDING
comma
l_string|&quot;mc_forwarding&quot;
comma
op_amp
id|ipv4_devconf.mc_forwarding
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0444
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_ACCEPT_REDIRECTS
comma
l_string|&quot;accept_redirects&quot;
comma
op_amp
id|ipv4_devconf.accept_redirects
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_SECURE_REDIRECTS
comma
l_string|&quot;secure_redirects&quot;
comma
op_amp
id|ipv4_devconf.secure_redirects
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_SHARED_MEDIA
comma
l_string|&quot;shared_media&quot;
comma
op_amp
id|ipv4_devconf.shared_media
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_RP_FILTER
comma
l_string|&quot;rp_filter&quot;
comma
op_amp
id|ipv4_devconf.rp_filter
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_SEND_REDIRECTS
comma
l_string|&quot;send_redirects&quot;
comma
op_amp
id|ipv4_devconf.send_redirects
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_ACCEPT_SOURCE_ROUTE
comma
l_string|&quot;accept_source_route&quot;
comma
op_amp
id|ipv4_devconf.accept_source_route
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_PROXY_ARP
comma
l_string|&quot;proxy_arp&quot;
comma
op_amp
id|ipv4_devconf.proxy_arp
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_BOOTP_RELAY
comma
l_string|&quot;bootp_relay&quot;
comma
op_amp
id|ipv4_devconf.bootp_relay
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_LOG_MARTIANS
comma
l_string|&quot;log_martians&quot;
comma
op_amp
id|ipv4_devconf.log_martians
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|NET_IPV4_CONF_TAG
comma
l_string|&quot;tag&quot;
comma
op_amp
id|ipv4_devconf.tag
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
l_int|0
)brace
)brace
comma
(brace
(brace
id|NET_PROTO_CONF_ALL
comma
l_string|&quot;all&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|devinet_sysctl.devinet_vars
)brace
comma
(brace
l_int|0
)brace
)brace
comma
(brace
(brace
id|NET_IPV4_CONF
comma
l_string|&quot;conf&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|devinet_sysctl.devinet_dev
)brace
comma
(brace
l_int|0
)brace
)brace
comma
(brace
(brace
id|NET_IPV4
comma
l_string|&quot;ipv4&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|devinet_sysctl.devinet_conf_dir
)brace
comma
(brace
l_int|0
)brace
)brace
comma
(brace
(brace
id|CTL_NET
comma
l_string|&quot;net&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|devinet_sysctl.devinet_proto_dir
)brace
comma
(brace
l_int|0
)brace
)brace
)brace
suffix:semicolon
DECL|function|devinet_sysctl_register
r_static
r_void
id|devinet_sysctl_register
c_func
(paren
r_struct
id|in_device
op_star
id|in_dev
comma
r_struct
id|ipv4_devconf
op_star
id|p
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|in_dev
ques
c_cond
id|in_dev-&gt;dev
suffix:colon
l_int|NULL
suffix:semicolon
r_struct
id|devinet_sysctl_table
op_star
id|t
suffix:semicolon
id|t
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|memcpy
c_func
(paren
id|t
comma
op_amp
id|devinet_sysctl
comma
r_sizeof
(paren
op_star
id|t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|t-&gt;devinet_vars
)paren
op_div
r_sizeof
(paren
id|t-&gt;devinet_vars
(braket
l_int|0
)braket
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
id|t-&gt;devinet_vars
(braket
id|i
)braket
dot
id|data
op_add_assign
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
op_amp
id|ipv4_devconf
suffix:semicolon
id|t-&gt;devinet_vars
(braket
id|i
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
)paren
(brace
id|t-&gt;devinet_dev
(braket
l_int|0
)braket
dot
id|procname
op_assign
id|dev-&gt;name
suffix:semicolon
id|t-&gt;devinet_dev
(braket
l_int|0
)braket
dot
id|ctl_name
op_assign
id|dev-&gt;ifindex
suffix:semicolon
)brace
r_else
(brace
id|t-&gt;devinet_dev
(braket
l_int|0
)braket
dot
id|procname
op_assign
l_string|&quot;default&quot;
suffix:semicolon
id|t-&gt;devinet_dev
(braket
l_int|0
)braket
dot
id|ctl_name
op_assign
id|NET_PROTO_CONF_DEFAULT
suffix:semicolon
)brace
id|t-&gt;devinet_dev
(braket
l_int|0
)braket
dot
id|child
op_assign
id|t-&gt;devinet_vars
suffix:semicolon
id|t-&gt;devinet_dev
(braket
l_int|0
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;devinet_conf_dir
(braket
l_int|0
)braket
dot
id|child
op_assign
id|t-&gt;devinet_dev
suffix:semicolon
id|t-&gt;devinet_conf_dir
(braket
l_int|0
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;devinet_proto_dir
(braket
l_int|0
)braket
dot
id|child
op_assign
id|t-&gt;devinet_conf_dir
suffix:semicolon
id|t-&gt;devinet_proto_dir
(braket
l_int|0
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;devinet_root_dir
(braket
l_int|0
)braket
dot
id|child
op_assign
id|t-&gt;devinet_proto_dir
suffix:semicolon
id|t-&gt;devinet_root_dir
(braket
l_int|0
)braket
dot
id|de
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;sysctl_header
op_assign
id|register_sysctl_table
c_func
(paren
id|t-&gt;devinet_root_dir
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;sysctl_header
op_eq
l_int|NULL
)paren
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
r_else
id|p-&gt;sysctl
op_assign
id|t
suffix:semicolon
)brace
DECL|function|devinet_sysctl_unregister
r_static
r_void
id|devinet_sysctl_unregister
c_func
(paren
r_struct
id|ipv4_devconf
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;sysctl
)paren
(brace
r_struct
id|devinet_sysctl_table
op_star
id|t
op_assign
id|p-&gt;sysctl
suffix:semicolon
id|p-&gt;sysctl
op_assign
l_int|NULL
suffix:semicolon
id|unregister_sysctl_table
c_func
(paren
id|t-&gt;sysctl_header
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|devinet_init
r_void
id|__init
id|devinet_init
c_func
(paren
r_void
)paren
(brace
id|register_gifconf
c_func
(paren
id|PF_INET
comma
id|inet_gifconf
)paren
suffix:semicolon
id|register_netdevice_notifier
c_func
(paren
op_amp
id|ip_netdev_notifier
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_RTNETLINK
id|rtnetlink_links
(braket
id|PF_INET
)braket
op_assign
id|inet_rtnetlink_table
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SYSCTL
id|devinet_sysctl.sysctl_header
op_assign
id|register_sysctl_table
c_func
(paren
id|devinet_sysctl.devinet_root_dir
comma
l_int|0
)paren
suffix:semicolon
id|devinet_sysctl_register
c_func
(paren
l_int|NULL
comma
op_amp
id|ipv4_devconf_dflt
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
