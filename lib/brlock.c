multiline_comment|/*&n; *&n; * linux/lib/brlock.c&n; *&n; * &squot;Big Reader&squot; read-write spinlocks.  See linux/brlock.h for details.&n; *&n; * Copyright 2000, Ingo Molnar &lt;mingo@redhat.com&gt;&n; * Copyright 2000, David S. Miller &lt;davem@redhat.com&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#ifdef CONFIG_SMP
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/brlock.h&gt;
macro_line|#ifdef __BRLOCK_USE_ATOMICS
DECL|variable|__brlock_array
id|brlock_read_lock_t
id|__brlock_array
(braket
id|NR_CPUS
)braket
(braket
id|__BR_IDX_MAX
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_CPUS
op_minus
l_int|1
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|__BR_IDX_MAX
op_minus
l_int|1
)braket
op_assign
id|RW_LOCK_UNLOCKED
)brace
)brace
suffix:semicolon
DECL|function|__br_write_lock
r_void
id|__br_write_lock
(paren
r_enum
id|brlock_indices
id|idx
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|smp_num_cpus
suffix:semicolon
id|i
op_increment
)paren
id|write_lock
c_func
(paren
id|__brlock_array
(braket
id|idx
)braket
op_plus
id|cpu_logical_map
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
DECL|function|__br_write_unlock
r_void
id|__br_write_unlock
(paren
r_enum
id|brlock_indices
id|idx
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|smp_num_cpus
suffix:semicolon
id|i
op_increment
)paren
id|write_unlock
c_func
(paren
id|__brlock_array
(braket
id|idx
)braket
op_plus
id|cpu_logical_map
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
macro_line|#else /* ! __BRLOCK_USE_ATOMICS */
DECL|variable|__brlock_array
id|brlock_read_lock_t
id|__brlock_array
(braket
id|NR_CPUS
)braket
(braket
id|__BR_IDX_MAX
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_CPUS
op_minus
l_int|1
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|__BR_IDX_MAX
op_minus
l_int|1
)braket
op_assign
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|__br_write_locks
r_struct
id|br_wrlock
id|__br_write_locks
(braket
id|__BR_IDX_MAX
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|__BR_IDX_MAX
op_minus
l_int|1
)braket
op_assign
(brace
id|SPIN_LOCK_UNLOCKED
)brace
)brace
suffix:semicolon
DECL|function|__br_write_lock
r_void
id|__br_write_lock
(paren
r_enum
id|brlock_indices
id|idx
)paren
(brace
r_int
id|i
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|__br_write_locks
(braket
id|idx
)braket
dot
id|lock
)paren
suffix:semicolon
id|again
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|smp_num_cpus
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|__brlock_array
(braket
id|cpu_logical_map
c_func
(paren
id|i
)paren
)braket
(braket
id|idx
)braket
op_ne
l_int|0
)paren
r_goto
id|again
suffix:semicolon
)brace
DECL|function|__br_write_unlock
r_void
id|__br_write_unlock
(paren
r_enum
id|brlock_indices
id|idx
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|__br_write_locks
(braket
id|idx
)braket
dot
id|lock
)paren
suffix:semicolon
)brace
macro_line|#endif /* __BRLOCK_USE_ATOMICS */
macro_line|#endif /* CONFIG_SMP */
eof
